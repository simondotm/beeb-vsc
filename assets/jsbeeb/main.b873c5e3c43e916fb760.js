/*! For license information please see main.b873c5e3c43e916fb760.js.LICENSE.txt */
(()=>{var t,e,s={271:function(t,e){var s;!function(e,s){"use strict";"object"==typeof t.exports?t.exports=e.document?s(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return s(t)}:s(e)}("undefined"!=typeof window?window:this,(function(i,r){"use strict";var n=[],o=Object.getPrototypeOf,a=n.slice,c=n.flat?function(t){return n.flat.call(t)}:function(t){return n.concat.apply([],t)},h=n.push,u=n.indexOf,l={},d=l.toString,p=l.hasOwnProperty,f=p.toString,m=f.call(Object),g={},b=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},v=function(t){return null!=t&&t===t.window},y=i.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function C(t,e,s){var i,r,n=(s=s||y).createElement("script");if(n.text=t,e)for(i in w)(r=e[i]||e.getAttribute&&e.getAttribute(i))&&n.setAttribute(i,r);s.head.appendChild(n).parentNode.removeChild(n)}function A(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?l[d.call(t)]||"object":typeof t}var _="3.7.1",x=/HTML$/i,S=function(t,e){return new S.fn.init(t,e)};function T(t){var e=!!t&&"length"in t&&t.length,s=A(t);return!b(t)&&!v(t)&&("array"===s||0===e||"number"==typeof e&&e>0&&e-1 in t)}function k(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}S.fn=S.prototype={jquery:_,constructor:S,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=S.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return S.each(this,t)},map:function(t){return this.pushStack(S.map(this,(function(e,s){return t.call(e,s,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(S.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,s=+t+(t<0?e:0);return this.pushStack(s>=0&&s<e?[this[s]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:n.sort,splice:n.splice},S.extend=S.fn.extend=function(){var t,e,s,i,r,n,o=arguments[0]||{},a=1,c=arguments.length,h=!1;for("boolean"==typeof o&&(h=o,o=arguments[a]||{},a++),"object"==typeof o||b(o)||(o={}),a===c&&(o=this,a--);a<c;a++)if(null!=(t=arguments[a]))for(e in t)i=t[e],"__proto__"!==e&&o!==i&&(h&&i&&(S.isPlainObject(i)||(r=Array.isArray(i)))?(s=o[e],n=r&&!Array.isArray(s)?[]:r||S.isPlainObject(s)?s:{},r=!1,o[e]=S.extend(h,n,i)):void 0!==i&&(o[e]=i));return o},S.extend({expando:"jQuery"+(_+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,s;return!(!t||"[object Object]"!==d.call(t))&&(!(e=o(t))||"function"==typeof(s=p.call(e,"constructor")&&e.constructor)&&f.call(s)===m)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,s){C(t,{nonce:e&&e.nonce},s)},each:function(t,e){var s,i=0;if(T(t))for(s=t.length;i<s&&!1!==e.call(t[i],i,t[i]);i++);else for(i in t)if(!1===e.call(t[i],i,t[i]))break;return t},text:function(t){var e,s="",i=0,r=t.nodeType;if(!r)for(;e=t[i++];)s+=S.text(e);return 1===r||11===r?t.textContent:9===r?t.documentElement.textContent:3===r||4===r?t.nodeValue:s},makeArray:function(t,e){var s=e||[];return null!=t&&(T(Object(t))?S.merge(s,"string"==typeof t?[t]:t):h.call(s,t)),s},inArray:function(t,e,s){return null==e?-1:u.call(e,t,s)},isXMLDoc:function(t){var e=t&&t.namespaceURI,s=t&&(t.ownerDocument||t).documentElement;return!x.test(e||s&&s.nodeName||"HTML")},merge:function(t,e){for(var s=+e.length,i=0,r=t.length;i<s;i++)t[r++]=e[i];return t.length=r,t},grep:function(t,e,s){for(var i=[],r=0,n=t.length,o=!s;r<n;r++)!e(t[r],r)!==o&&i.push(t[r]);return i},map:function(t,e,s){var i,r,n=0,o=[];if(T(t))for(i=t.length;n<i;n++)null!=(r=e(t[n],n,s))&&o.push(r);else for(n in t)null!=(r=e(t[n],n,s))&&o.push(r);return c(o)},guid:1,support:g}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=n[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){l["[object "+e+"]"]=e.toLowerCase()}));var E=n.pop,D=n.sort,L=n.splice,R="[\\x20\\t\\r\\n\\f]",O=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g");S.contains=function(t,e){var s=e&&e.parentNode;return t===s||!(!s||1!==s.nodeType||!(t.contains?t.contains(s):t.compareDocumentPosition&&16&t.compareDocumentPosition(s)))};var P=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function I(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}S.escapeSelector=function(t){return(t+"").replace(P,I)};var N=y,M=h;!function(){var t,e,s,r,o,c,h,l,d,f,m=M,b=S.expando,v=0,y=0,w=tt(),C=tt(),A=tt(),_=tt(),x=function(t,e){return t===e&&(o=!0),0},T="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="(?:\\\\[\\da-fA-F]{1,6}"+R+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",I="\\["+R+"*("+P+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+P+"))|)"+R+"*\\]",B=":("+P+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+I+")*)|.*)\\)|)",F=new RegExp(R+"+","g"),U=new RegExp("^"+R+"*,"+R+"*"),H=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),j=new RegExp(R+"|>"),z=new RegExp(B),W=new RegExp("^"+P+"$"),G={ID:new RegExp("^#("+P+")"),CLASS:new RegExp("^\\.("+P+")"),TAG:new RegExp("^("+P+"|[*])"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+B),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+T+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},K=/^(?:input|select|textarea|button)$/i,$=/^h\d$/i,q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,V=new RegExp("\\\\[\\da-fA-F]{1,6}"+R+"?|\\\\([^\\r\\n\\f])","g"),Y=function(t,e){var s="0x"+t.slice(1)-65536;return e||(s<0?String.fromCharCode(s+65536):String.fromCharCode(s>>10|55296,1023&s|56320))},Q=function(){ct()},Z=dt((function(t){return!0===t.disabled&&k(t,"fieldset")}),{dir:"parentNode",next:"legend"});try{m.apply(n=a.call(N.childNodes),N.childNodes),n[N.childNodes.length].nodeType}catch(t){m={apply:function(t,e){M.apply(t,a.call(e))},call:function(t){M.apply(t,a.call(arguments,1))}}}function J(t,e,s,i){var r,n,o,a,h,u,p,f=e&&e.ownerDocument,v=e?e.nodeType:9;if(s=s||[],"string"!=typeof t||!t||1!==v&&9!==v&&11!==v)return s;if(!i&&(ct(e),e=e||c,l)){if(11!==v&&(h=q.exec(t)))if(r=h[1]){if(9===v){if(!(o=e.getElementById(r)))return s;if(o.id===r)return m.call(s,o),s}else if(f&&(o=f.getElementById(r))&&J.contains(e,o)&&o.id===r)return m.call(s,o),s}else{if(h[2])return m.apply(s,e.getElementsByTagName(t)),s;if((r=h[3])&&e.getElementsByClassName)return m.apply(s,e.getElementsByClassName(r)),s}if(!(_[t+" "]||d&&d.test(t))){if(p=t,f=e,1===v&&(j.test(t)||H.test(t))){for((f=X.test(t)&&at(e.parentNode)||e)==e&&g.scope||((a=e.getAttribute("id"))?a=S.escapeSelector(a):e.setAttribute("id",a=b)),n=(u=ut(t)).length;n--;)u[n]=(a?"#"+a:":scope")+" "+lt(u[n]);p=u.join(",")}try{return m.apply(s,f.querySelectorAll(p)),s}catch(e){_(t,!0)}finally{a===b&&e.removeAttribute("id")}}}return vt(t.replace(O,"$1"),e,s,i)}function tt(){var t=[];return function s(i,r){return t.push(i+" ")>e.cacheLength&&delete s[t.shift()],s[i+" "]=r}}function et(t){return t[b]=!0,t}function st(t){var e=c.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function it(t){return function(e){return k(e,"input")&&e.type===t}}function rt(t){return function(e){return(k(e,"input")||k(e,"button"))&&e.type===t}}function nt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Z(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ot(t){return et((function(e){return e=+e,et((function(s,i){for(var r,n=t([],s.length,e),o=n.length;o--;)s[r=n[o]]&&(s[r]=!(i[r]=s[r]))}))}))}function at(t){return t&&void 0!==t.getElementsByTagName&&t}function ct(t){var s,i=t?t.ownerDocument||t:N;return i!=c&&9===i.nodeType&&i.documentElement?(h=(c=i).documentElement,l=!S.isXMLDoc(c),f=h.matches||h.webkitMatchesSelector||h.msMatchesSelector,h.msMatchesSelector&&N!=c&&(s=c.defaultView)&&s.top!==s&&s.addEventListener("unload",Q),g.getById=st((function(t){return h.appendChild(t).id=S.expando,!c.getElementsByName||!c.getElementsByName(S.expando).length})),g.disconnectedMatch=st((function(t){return f.call(t,"*")})),g.scope=st((function(){return c.querySelectorAll(":scope")})),g.cssHas=st((function(){try{return c.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),g.getById?(e.filter.ID=function(t){var e=t.replace(V,Y);return function(t){return t.getAttribute("id")===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&l){var s=e.getElementById(t);return s?[s]:[]}}):(e.filter.ID=function(t){var e=t.replace(V,Y);return function(t){var s=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return s&&s.value===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&l){var s,i,r,n=e.getElementById(t);if(n){if((s=n.getAttributeNode("id"))&&s.value===t)return[n];for(r=e.getElementsByName(t),i=0;n=r[i++];)if((s=n.getAttributeNode("id"))&&s.value===t)return[n]}return[]}}),e.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},e.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&l)return e.getElementsByClassName(t)},d=[],st((function(t){var e;h.appendChild(t).innerHTML="<a id='"+b+"' href='' disabled='disabled'></a><select id='"+b+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||d.push("\\["+R+"*(?:value|"+T+")"),t.querySelectorAll("[id~="+b+"-]").length||d.push("~="),t.querySelectorAll("a#"+b+"+*").length||d.push(".#.+[+~]"),t.querySelectorAll(":checked").length||d.push(":checked"),(e=c.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),h.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(e=c.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||d.push("\\["+R+"*name"+R+"*="+R+"*(?:''|\"\")")})),g.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),x=function(t,e){if(t===e)return o=!0,0;var s=!t.compareDocumentPosition-!e.compareDocumentPosition;return s||(1&(s=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!g.sortDetached&&e.compareDocumentPosition(t)===s?t===c||t.ownerDocument==N&&J.contains(N,t)?-1:e===c||e.ownerDocument==N&&J.contains(N,e)?1:r?u.call(r,t)-u.call(r,e):0:4&s?-1:1)},c):c}for(t in J.matches=function(t,e){return J(t,null,null,e)},J.matchesSelector=function(t,e){if(ct(t),l&&!_[e+" "]&&(!d||!d.test(e)))try{var s=f.call(t,e);if(s||g.disconnectedMatch||t.document&&11!==t.document.nodeType)return s}catch(t){_(e,!0)}return J(e,c,null,[t]).length>0},J.contains=function(t,e){return(t.ownerDocument||t)!=c&&ct(t),S.contains(t,e)},J.attr=function(t,s){(t.ownerDocument||t)!=c&&ct(t);var i=e.attrHandle[s.toLowerCase()],r=i&&p.call(e.attrHandle,s.toLowerCase())?i(t,s,!l):void 0;return void 0!==r?r:t.getAttribute(s)},J.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},S.uniqueSort=function(t){var e,s=[],i=0,n=0;if(o=!g.sortStable,r=!g.sortStable&&a.call(t,0),D.call(t,x),o){for(;e=t[n++];)e===t[n]&&(i=s.push(n));for(;i--;)L.call(t,s[i],1)}return r=null,t},S.fn.uniqueSort=function(){return this.pushStack(S.uniqueSort(a.apply(this)))},e=S.expr={cacheLength:50,createPseudo:et,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(V,Y),t[3]=(t[3]||t[4]||t[5]||"").replace(V,Y),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||J.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&J.error(t[0]),t},PSEUDO:function(t){var e,s=!t[6]&&t[2];return G.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":s&&z.test(s)&&(e=ut(s,!0))&&(e=s.indexOf(")",s.length-e)-s.length)&&(t[0]=t[0].slice(0,e),t[2]=s.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(V,Y).toLowerCase();return"*"===t?function(){return!0}:function(t){return k(t,e)}},CLASS:function(t){var e=w[t+" "];return e||(e=new RegExp("(^|"+R+")"+t+"("+R+"|$)"))&&w(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,s){return function(i){var r=J.attr(i,t);return null==r?"!="===e:!e||(r+="","="===e?r===s:"!="===e?r!==s:"^="===e?s&&0===r.indexOf(s):"*="===e?s&&r.indexOf(s)>-1:"$="===e?s&&r.slice(-s.length)===s:"~="===e?(" "+r.replace(F," ")+" ").indexOf(s)>-1:"|="===e&&(r===s||r.slice(0,s.length+1)===s+"-"))}},CHILD:function(t,e,s,i,r){var n="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===i&&0===r?function(t){return!!t.parentNode}:function(e,s,c){var h,u,l,d,p,f=n!==o?"nextSibling":"previousSibling",m=e.parentNode,g=a&&e.nodeName.toLowerCase(),y=!c&&!a,w=!1;if(m){if(n){for(;f;){for(l=e;l=l[f];)if(a?k(l,g):1===l.nodeType)return!1;p=f="only"===t&&!p&&"nextSibling"}return!0}if(p=[o?m.firstChild:m.lastChild],o&&y){for(w=(d=(h=(u=m[b]||(m[b]={}))[t]||[])[0]===v&&h[1])&&h[2],l=d&&m.childNodes[d];l=++d&&l&&l[f]||(w=d=0)||p.pop();)if(1===l.nodeType&&++w&&l===e){u[t]=[v,d,w];break}}else if(y&&(w=d=(h=(u=e[b]||(e[b]={}))[t]||[])[0]===v&&h[1]),!1===w)for(;(l=++d&&l&&l[f]||(w=d=0)||p.pop())&&(!(a?k(l,g):1===l.nodeType)||!++w||(y&&((u=l[b]||(l[b]={}))[t]=[v,w]),l!==e)););return(w-=r)===i||w%i==0&&w/i>=0}}},PSEUDO:function(t,s){var i,r=e.pseudos[t]||e.setFilters[t.toLowerCase()]||J.error("unsupported pseudo: "+t);return r[b]?r(s):r.length>1?(i=[t,t,"",s],e.setFilters.hasOwnProperty(t.toLowerCase())?et((function(t,e){for(var i,n=r(t,s),o=n.length;o--;)t[i=u.call(t,n[o])]=!(e[i]=n[o])})):function(t){return r(t,0,i)}):r}},pseudos:{not:et((function(t){var e=[],s=[],i=bt(t.replace(O,"$1"));return i[b]?et((function(t,e,s,r){for(var n,o=i(t,null,r,[]),a=t.length;a--;)(n=o[a])&&(t[a]=!(e[a]=n))})):function(t,r,n){return e[0]=t,i(e,null,n,s),e[0]=null,!s.pop()}})),has:et((function(t){return function(e){return J(t,e).length>0}})),contains:et((function(t){return t=t.replace(V,Y),function(e){return(e.textContent||S.text(e)).indexOf(t)>-1}})),lang:et((function(t){return W.test(t||"")||J.error("unsupported lang: "+t),t=t.replace(V,Y).toLowerCase(),function(e){var s;do{if(s=l?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(s=s.toLowerCase())===t||0===s.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(t){var e=i.location&&i.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===h},focus:function(t){return t===function(){try{return c.activeElement}catch(t){}}()&&c.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:nt(!1),disabled:nt(!0),checked:function(t){return k(t,"input")&&!!t.checked||k(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!e.pseudos.empty(t)},header:function(t){return $.test(t.nodeName)},input:function(t){return K.test(t.nodeName)},button:function(t){return k(t,"input")&&"button"===t.type||k(t,"button")},text:function(t){var e;return k(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:ot((function(){return[0]})),last:ot((function(t,e){return[e-1]})),eq:ot((function(t,e,s){return[s<0?s+e:s]})),even:ot((function(t,e){for(var s=0;s<e;s+=2)t.push(s);return t})),odd:ot((function(t,e){for(var s=1;s<e;s+=2)t.push(s);return t})),lt:ot((function(t,e,s){var i;for(i=s<0?s+e:s>e?e:s;--i>=0;)t.push(i);return t})),gt:ot((function(t,e,s){for(var i=s<0?s+e:s;++i<e;)t.push(i);return t}))}},e.pseudos.nth=e.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})e.pseudos[t]=it(t);for(t in{submit:!0,reset:!0})e.pseudos[t]=rt(t);function ht(){}function ut(t,s){var i,r,n,o,a,c,h,u=C[t+" "];if(u)return s?0:u.slice(0);for(a=t,c=[],h=e.preFilter;a;){for(o in i&&!(r=U.exec(a))||(r&&(a=a.slice(r[0].length)||a),c.push(n=[])),i=!1,(r=H.exec(a))&&(i=r.shift(),n.push({value:i,type:r[0].replace(O," ")}),a=a.slice(i.length)),e.filter)!(r=G[o].exec(a))||h[o]&&!(r=h[o](r))||(i=r.shift(),n.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return s?a.length:a?J.error(t):C(t,c).slice(0)}function lt(t){for(var e=0,s=t.length,i="";e<s;e++)i+=t[e].value;return i}function dt(t,e,s){var i=e.dir,r=e.next,n=r||i,o=s&&"parentNode"===n,a=y++;return e.first?function(e,s,r){for(;e=e[i];)if(1===e.nodeType||o)return t(e,s,r);return!1}:function(e,s,c){var h,u,l=[v,a];if(c){for(;e=e[i];)if((1===e.nodeType||o)&&t(e,s,c))return!0}else for(;e=e[i];)if(1===e.nodeType||o)if(u=e[b]||(e[b]={}),r&&k(e,r))e=e[i]||e;else{if((h=u[n])&&h[0]===v&&h[1]===a)return l[2]=h[2];if(u[n]=l,l[2]=t(e,s,c))return!0}return!1}}function pt(t){return t.length>1?function(e,s,i){for(var r=t.length;r--;)if(!t[r](e,s,i))return!1;return!0}:t[0]}function ft(t,e,s,i,r){for(var n,o=[],a=0,c=t.length,h=null!=e;a<c;a++)(n=t[a])&&(s&&!s(n,i,r)||(o.push(n),h&&e.push(a)));return o}function mt(t,e,s,i,r,n){return i&&!i[b]&&(i=mt(i)),r&&!r[b]&&(r=mt(r,n)),et((function(n,o,a,c){var h,l,d,p,f=[],g=[],b=o.length,v=n||function(t,e,s){for(var i=0,r=e.length;i<r;i++)J(t,e[i],s);return s}(e||"*",a.nodeType?[a]:a,[]),y=!t||!n&&e?v:ft(v,f,t,a,c);if(s?s(y,p=r||(n?t:b||i)?[]:o,a,c):p=y,i)for(h=ft(p,g),i(h,[],a,c),l=h.length;l--;)(d=h[l])&&(p[g[l]]=!(y[g[l]]=d));if(n){if(r||t){if(r){for(h=[],l=p.length;l--;)(d=p[l])&&h.push(y[l]=d);r(null,p=[],h,c)}for(l=p.length;l--;)(d=p[l])&&(h=r?u.call(n,d):f[l])>-1&&(n[h]=!(o[h]=d))}}else p=ft(p===o?p.splice(b,p.length):p),r?r(null,o,p,c):m.apply(o,p)}))}function gt(t){for(var i,r,n,o=t.length,a=e.relative[t[0].type],c=a||e.relative[" "],h=a?1:0,l=dt((function(t){return t===i}),c,!0),d=dt((function(t){return u.call(i,t)>-1}),c,!0),p=[function(t,e,r){var n=!a&&(r||e!=s)||((i=e).nodeType?l(t,e,r):d(t,e,r));return i=null,n}];h<o;h++)if(r=e.relative[t[h].type])p=[dt(pt(p),r)];else{if((r=e.filter[t[h].type].apply(null,t[h].matches))[b]){for(n=++h;n<o&&!e.relative[t[n].type];n++);return mt(h>1&&pt(p),h>1&&lt(t.slice(0,h-1).concat({value:" "===t[h-2].type?"*":""})).replace(O,"$1"),r,h<n&&gt(t.slice(h,n)),n<o&&gt(t=t.slice(n)),n<o&&lt(t))}p.push(r)}return pt(p)}function bt(t,i){var r,n=[],o=[],a=A[t+" "];if(!a){for(i||(i=ut(t)),r=i.length;r--;)(a=gt(i[r]))[b]?n.push(a):o.push(a);a=A(t,function(t,i){var r=i.length>0,n=t.length>0,o=function(o,a,h,u,d){var p,f,g,b=0,y="0",w=o&&[],C=[],A=s,_=o||n&&e.find.TAG("*",d),x=v+=null==A?1:Math.random()||.1,T=_.length;for(d&&(s=a==c||a||d);y!==T&&null!=(p=_[y]);y++){if(n&&p){for(f=0,a||p.ownerDocument==c||(ct(p),h=!l);g=t[f++];)if(g(p,a||c,h)){m.call(u,p);break}d&&(v=x)}r&&((p=!g&&p)&&b--,o&&w.push(p))}if(b+=y,r&&y!==b){for(f=0;g=i[f++];)g(w,C,a,h);if(o){if(b>0)for(;y--;)w[y]||C[y]||(C[y]=E.call(u));C=ft(C)}m.apply(u,C),d&&!o&&C.length>0&&b+i.length>1&&S.uniqueSort(u)}return d&&(v=x,s=A),w};return r?et(o):o}(o,n)),a.selector=t}return a}function vt(t,s,i,r){var n,o,a,c,h,u="function"==typeof t&&t,d=!r&&ut(t=u.selector||t);if(i=i||[],1===d.length){if((o=d[0]=d[0].slice(0)).length>2&&"ID"===(a=o[0]).type&&9===s.nodeType&&l&&e.relative[o[1].type]){if(!(s=(e.find.ID(a.matches[0].replace(V,Y),s)||[])[0]))return i;u&&(s=s.parentNode),t=t.slice(o.shift().value.length)}for(n=G.needsContext.test(t)?0:o.length;n--&&(a=o[n],!e.relative[c=a.type]);)if((h=e.find[c])&&(r=h(a.matches[0].replace(V,Y),X.test(o[0].type)&&at(s.parentNode)||s))){if(o.splice(n,1),!(t=r.length&&lt(o)))return m.apply(i,r),i;break}}return(u||bt(t,d))(r,s,!l,i,!s||X.test(t)&&at(s.parentNode)||s),i}ht.prototype=e.filters=e.pseudos,e.setFilters=new ht,g.sortStable=b.split("").sort(x).join("")===b,ct(),g.sortDetached=st((function(t){return 1&t.compareDocumentPosition(c.createElement("fieldset"))})),S.find=J,S.expr[":"]=S.expr.pseudos,S.unique=S.uniqueSort,J.compile=bt,J.select=vt,J.setDocument=ct,J.tokenize=ut,J.escape=S.escapeSelector,J.getText=S.text,J.isXML=S.isXMLDoc,J.selectors=S.expr,J.support=S.support,J.uniqueSort=S.uniqueSort}();var B=function(t,e,s){for(var i=[],r=void 0!==s;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&S(t).is(s))break;i.push(t)}return i},F=function(t,e){for(var s=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&s.push(t);return s},U=S.expr.match.needsContext,H=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(t,e,s){return b(e)?S.grep(t,(function(t,i){return!!e.call(t,i,t)!==s})):e.nodeType?S.grep(t,(function(t){return t===e!==s})):"string"!=typeof e?S.grep(t,(function(t){return u.call(e,t)>-1!==s})):S.filter(e,t,s)}S.filter=function(t,e,s){var i=e[0];return s&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?S.find.matchesSelector(i,t)?[i]:[]:S.find.matches(t,S.grep(e,(function(t){return 1===t.nodeType})))},S.fn.extend({find:function(t){var e,s,i=this.length,r=this;if("string"!=typeof t)return this.pushStack(S(t).filter((function(){for(e=0;e<i;e++)if(S.contains(r[e],this))return!0})));for(s=this.pushStack([]),e=0;e<i;e++)S.find(t,r[e],s);return i>1?S.uniqueSort(s):s},filter:function(t){return this.pushStack(j(this,t||[],!1))},not:function(t){return this.pushStack(j(this,t||[],!0))},is:function(t){return!!j(this,"string"==typeof t&&U.test(t)?S(t):t||[],!1).length}});var z,W=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(t,e,s){var i,r;if(!t)return this;if(s=s||z,"string"==typeof t){if(!(i="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:W.exec(t))||!i[1]&&e)return!e||e.jquery?(e||s).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof S?e[0]:e,S.merge(this,S.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:y,!0)),H.test(i[1])&&S.isPlainObject(e))for(i in e)b(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}return(r=y.getElementById(i[2]))&&(this[0]=r,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):b(t)?void 0!==s.ready?s.ready(t):t(S):S.makeArray(t,this)}).prototype=S.fn,z=S(y);var G=/^(?:parents|prev(?:Until|All))/,K={children:!0,contents:!0,next:!0,prev:!0};function $(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}S.fn.extend({has:function(t){var e=S(t,this),s=e.length;return this.filter((function(){for(var t=0;t<s;t++)if(S.contains(this,e[t]))return!0}))},closest:function(t,e){var s,i=0,r=this.length,n=[],o="string"!=typeof t&&S(t);if(!U.test(t))for(;i<r;i++)for(s=this[i];s&&s!==e;s=s.parentNode)if(s.nodeType<11&&(o?o.index(s)>-1:1===s.nodeType&&S.find.matchesSelector(s,t))){n.push(s);break}return this.pushStack(n.length>1?S.uniqueSort(n):n)},index:function(t){return t?"string"==typeof t?u.call(S(t),this[0]):u.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),S.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return B(t,"parentNode")},parentsUntil:function(t,e,s){return B(t,"parentNode",s)},next:function(t){return $(t,"nextSibling")},prev:function(t){return $(t,"previousSibling")},nextAll:function(t){return B(t,"nextSibling")},prevAll:function(t){return B(t,"previousSibling")},nextUntil:function(t,e,s){return B(t,"nextSibling",s)},prevUntil:function(t,e,s){return B(t,"previousSibling",s)},siblings:function(t){return F((t.parentNode||{}).firstChild,t)},children:function(t){return F(t.firstChild)},contents:function(t){return null!=t.contentDocument&&o(t.contentDocument)?t.contentDocument:(k(t,"template")&&(t=t.content||t),S.merge([],t.childNodes))}},(function(t,e){S.fn[t]=function(s,i){var r=S.map(this,e,s);return"Until"!==t.slice(-5)&&(i=s),i&&"string"==typeof i&&(r=S.filter(i,r)),this.length>1&&(K[t]||S.uniqueSort(r),G.test(t)&&r.reverse()),this.pushStack(r)}}));var q=/[^\x20\t\r\n\f]+/g;function X(t){return t}function V(t){throw t}function Y(t,e,s,i){var r;try{t&&b(r=t.promise)?r.call(t).done(e).fail(s):t&&b(r=t.then)?r.call(t,e,s):e.apply(void 0,[t].slice(i))}catch(t){s.apply(void 0,[t])}}S.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return S.each(t.match(q)||[],(function(t,s){e[s]=!0})),e}(t):S.extend({},t);var e,s,i,r,n=[],o=[],a=-1,c=function(){for(r=r||t.once,i=e=!0;o.length;a=-1)for(s=o.shift();++a<n.length;)!1===n[a].apply(s[0],s[1])&&t.stopOnFalse&&(a=n.length,s=!1);t.memory||(s=!1),e=!1,r&&(n=s?[]:"")},h={add:function(){return n&&(s&&!e&&(a=n.length-1,o.push(s)),function e(s){S.each(s,(function(s,i){b(i)?t.unique&&h.has(i)||n.push(i):i&&i.length&&"string"!==A(i)&&e(i)}))}(arguments),s&&!e&&c()),this},remove:function(){return S.each(arguments,(function(t,e){for(var s;(s=S.inArray(e,n,s))>-1;)n.splice(s,1),s<=a&&a--})),this},has:function(t){return t?S.inArray(t,n)>-1:n.length>0},empty:function(){return n&&(n=[]),this},disable:function(){return r=o=[],n=s="",this},disabled:function(){return!n},lock:function(){return r=o=[],s||e||(n=s=""),this},locked:function(){return!!r},fireWith:function(t,s){return r||(s=[t,(s=s||[]).slice?s.slice():s],o.push(s),e||c()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h},S.extend({Deferred:function(t){var e=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],s="pending",r={state:function(){return s},always:function(){return n.done(arguments).fail(arguments),this},catch:function(t){return r.then(null,t)},pipe:function(){var t=arguments;return S.Deferred((function(s){S.each(e,(function(e,i){var r=b(t[i[4]])&&t[i[4]];n[i[1]]((function(){var t=r&&r.apply(this,arguments);t&&b(t.promise)?t.promise().progress(s.notify).done(s.resolve).fail(s.reject):s[i[0]+"With"](this,r?[t]:arguments)}))})),t=null})).promise()},then:function(t,s,r){var n=0;function o(t,e,s,r){return function(){var a=this,c=arguments,h=function(){var i,h;if(!(t<n)){if((i=s.apply(a,c))===e.promise())throw new TypeError("Thenable self-resolution");h=i&&("object"==typeof i||"function"==typeof i)&&i.then,b(h)?r?h.call(i,o(n,e,X,r),o(n,e,V,r)):(n++,h.call(i,o(n,e,X,r),o(n,e,V,r),o(n,e,X,e.notifyWith))):(s!==X&&(a=void 0,c=[i]),(r||e.resolveWith)(a,c))}},u=r?h:function(){try{h()}catch(i){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(i,u.error),t+1>=n&&(s!==V&&(a=void 0,c=[i]),e.rejectWith(a,c))}};t?u():(S.Deferred.getErrorHook?u.error=S.Deferred.getErrorHook():S.Deferred.getStackHook&&(u.error=S.Deferred.getStackHook()),i.setTimeout(u))}}return S.Deferred((function(i){e[0][3].add(o(0,i,b(r)?r:X,i.notifyWith)),e[1][3].add(o(0,i,b(t)?t:X)),e[2][3].add(o(0,i,b(s)?s:V))})).promise()},promise:function(t){return null!=t?S.extend(t,r):r}},n={};return S.each(e,(function(t,i){var o=i[2],a=i[5];r[i[1]]=o.add,a&&o.add((function(){s=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),o.add(i[3].fire),n[i[0]]=function(){return n[i[0]+"With"](this===n?void 0:this,arguments),this},n[i[0]+"With"]=o.fireWith})),r.promise(n),t&&t.call(n,n),n},when:function(t){var e=arguments.length,s=e,i=Array(s),r=a.call(arguments),n=S.Deferred(),o=function(t){return function(s){i[t]=this,r[t]=arguments.length>1?a.call(arguments):s,--e||n.resolveWith(i,r)}};if(e<=1&&(Y(t,n.done(o(s)).resolve,n.reject,!e),"pending"===n.state()||b(r[s]&&r[s].then)))return n.then();for(;s--;)Y(r[s],o(s),n.reject);return n.promise()}});var Q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&Q.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},S.readyException=function(t){i.setTimeout((function(){throw t}))};var Z=S.Deferred();function J(){y.removeEventListener("DOMContentLoaded",J),i.removeEventListener("load",J),S.ready()}S.fn.ready=function(t){return Z.then(t).catch((function(t){S.readyException(t)})),this},S.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--S.readyWait:S.isReady)||(S.isReady=!0,!0!==t&&--S.readyWait>0||Z.resolveWith(y,[S]))}}),S.ready.then=Z.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?i.setTimeout(S.ready):(y.addEventListener("DOMContentLoaded",J),i.addEventListener("load",J));var tt=function(t,e,s,i,r,n,o){var a=0,c=t.length,h=null==s;if("object"===A(s))for(a in r=!0,s)tt(t,e,a,s[a],!0,n,o);else if(void 0!==i&&(r=!0,b(i)||(o=!0),h&&(o?(e.call(t,i),e=null):(h=e,e=function(t,e,s){return h.call(S(t),s)})),e))for(;a<c;a++)e(t[a],s,o?i:i.call(t[a],a,e(t[a],s)));return r?t:h?e.call(t):c?e(t[0],s):n},et=/^-ms-/,st=/-([a-z])/g;function it(t,e){return e.toUpperCase()}function rt(t){return t.replace(et,"ms-").replace(st,it)}var nt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function ot(){this.expando=S.expando+ot.uid++}ot.uid=1,ot.prototype={cache:function(t){var e=t[this.expando];return e||(e={},nt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,s){var i,r=this.cache(t);if("string"==typeof e)r[rt(e)]=s;else for(i in e)r[rt(i)]=e[i];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][rt(e)]},access:function(t,e,s){return void 0===e||e&&"string"==typeof e&&void 0===s?this.get(t,e):(this.set(t,e,s),void 0!==s?s:e)},remove:function(t,e){var s,i=t[this.expando];if(void 0!==i){if(void 0!==e){s=(e=Array.isArray(e)?e.map(rt):(e=rt(e))in i?[e]:e.match(q)||[]).length;for(;s--;)delete i[e[s]]}(void 0===e||S.isEmptyObject(i))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!S.isEmptyObject(e)}};var at=new ot,ct=new ot,ht=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ut=/[A-Z]/g;function lt(t,e,s){var i;if(void 0===s&&1===t.nodeType)if(i="data-"+e.replace(ut,"-$&").toLowerCase(),"string"==typeof(s=t.getAttribute(i))){try{s=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:ht.test(t)?JSON.parse(t):t)}(s)}catch(t){}ct.set(t,e,s)}else s=void 0;return s}S.extend({hasData:function(t){return ct.hasData(t)||at.hasData(t)},data:function(t,e,s){return ct.access(t,e,s)},removeData:function(t,e){ct.remove(t,e)},_data:function(t,e,s){return at.access(t,e,s)},_removeData:function(t,e){at.remove(t,e)}}),S.fn.extend({data:function(t,e){var s,i,r,n=this[0],o=n&&n.attributes;if(void 0===t){if(this.length&&(r=ct.get(n),1===n.nodeType&&!at.get(n,"hasDataAttrs"))){for(s=o.length;s--;)o[s]&&0===(i=o[s].name).indexOf("data-")&&(i=rt(i.slice(5)),lt(n,i,r[i]));at.set(n,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each((function(){ct.set(this,t)})):tt(this,(function(e){var s;if(n&&void 0===e)return void 0!==(s=ct.get(n,t))||void 0!==(s=lt(n,t))?s:void 0;this.each((function(){ct.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){ct.remove(this,t)}))}}),S.extend({queue:function(t,e,s){var i;if(t)return e=(e||"fx")+"queue",i=at.get(t,e),s&&(!i||Array.isArray(s)?i=at.access(t,e,S.makeArray(s)):i.push(s)),i||[]},dequeue:function(t,e){e=e||"fx";var s=S.queue(t,e),i=s.length,r=s.shift(),n=S._queueHooks(t,e);"inprogress"===r&&(r=s.shift(),i--),r&&("fx"===e&&s.unshift("inprogress"),delete n.stop,r.call(t,(function(){S.dequeue(t,e)}),n)),!i&&n&&n.empty.fire()},_queueHooks:function(t,e){var s=e+"queueHooks";return at.get(t,s)||at.access(t,s,{empty:S.Callbacks("once memory").add((function(){at.remove(t,[e+"queue",s])}))})}}),S.fn.extend({queue:function(t,e){var s=2;return"string"!=typeof t&&(e=t,t="fx",s--),arguments.length<s?S.queue(this[0],t):void 0===e?this:this.each((function(){var s=S.queue(this,t,e);S._queueHooks(this,t),"fx"===t&&"inprogress"!==s[0]&&S.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){S.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var s,i=1,r=S.Deferred(),n=this,o=this.length,a=function(){--i||r.resolveWith(n,[n])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(s=at.get(n[o],t+"queueHooks"))&&s.empty&&(i++,s.empty.add(a));return a(),r.promise(e)}});var dt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pt=new RegExp("^(?:([+-])=|)("+dt+")([a-z%]*)$","i"),ft=["Top","Right","Bottom","Left"],mt=y.documentElement,gt=function(t){return S.contains(t.ownerDocument,t)},bt={composed:!0};mt.getRootNode&&(gt=function(t){return S.contains(t.ownerDocument,t)||t.getRootNode(bt)===t.ownerDocument});var vt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&gt(t)&&"none"===S.css(t,"display")};function yt(t,e,s,i){var r,n,o=20,a=i?function(){return i.cur()}:function(){return S.css(t,e,"")},c=a(),h=s&&s[3]||(S.cssNumber[e]?"":"px"),u=t.nodeType&&(S.cssNumber[e]||"px"!==h&&+c)&&pt.exec(S.css(t,e));if(u&&u[3]!==h){for(c/=2,h=h||u[3],u=+c||1;o--;)S.style(t,e,u+h),(1-n)*(1-(n=a()/c||.5))<=0&&(o=0),u/=n;u*=2,S.style(t,e,u+h),s=s||[]}return s&&(u=+u||+c||0,r=s[1]?u+(s[1]+1)*s[2]:+s[2],i&&(i.unit=h,i.start=u,i.end=r)),r}var wt={};function Ct(t){var e,s=t.ownerDocument,i=t.nodeName,r=wt[i];return r||(e=s.body.appendChild(s.createElement(i)),r=S.css(e,"display"),e.parentNode.removeChild(e),"none"===r&&(r="block"),wt[i]=r,r)}function At(t,e){for(var s,i,r=[],n=0,o=t.length;n<o;n++)(i=t[n]).style&&(s=i.style.display,e?("none"===s&&(r[n]=at.get(i,"display")||null,r[n]||(i.style.display="")),""===i.style.display&&vt(i)&&(r[n]=Ct(i))):"none"!==s&&(r[n]="none",at.set(i,"display",s)));for(n=0;n<o;n++)null!=r[n]&&(t[n].style.display=r[n]);return t}S.fn.extend({show:function(){return At(this,!0)},hide:function(){return At(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){vt(this)?S(this).show():S(this).hide()}))}});var _t,xt,St=/^(?:checkbox|radio)$/i,Tt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,kt=/^$|^module$|\/(?:java|ecma)script/i;_t=y.createDocumentFragment().appendChild(y.createElement("div")),(xt=y.createElement("input")).setAttribute("type","radio"),xt.setAttribute("checked","checked"),xt.setAttribute("name","t"),_t.appendChild(xt),g.checkClone=_t.cloneNode(!0).cloneNode(!0).lastChild.checked,_t.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!_t.cloneNode(!0).lastChild.defaultValue,_t.innerHTML="<option></option>",g.option=!!_t.lastChild;var Et={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Dt(t,e){var s;return s=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&k(t,e)?S.merge([t],s):s}function Lt(t,e){for(var s=0,i=t.length;s<i;s++)at.set(t[s],"globalEval",!e||at.get(e[s],"globalEval"))}Et.tbody=Et.tfoot=Et.colgroup=Et.caption=Et.thead,Et.th=Et.td,g.option||(Et.optgroup=Et.option=[1,"<select multiple='multiple'>","</select>"]);var Rt=/<|&#?\w+;/;function Ot(t,e,s,i,r){for(var n,o,a,c,h,u,l=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if((n=t[p])||0===n)if("object"===A(n))S.merge(d,n.nodeType?[n]:n);else if(Rt.test(n)){for(o=o||l.appendChild(e.createElement("div")),a=(Tt.exec(n)||["",""])[1].toLowerCase(),c=Et[a]||Et._default,o.innerHTML=c[1]+S.htmlPrefilter(n)+c[2],u=c[0];u--;)o=o.lastChild;S.merge(d,o.childNodes),(o=l.firstChild).textContent=""}else d.push(e.createTextNode(n));for(l.textContent="",p=0;n=d[p++];)if(i&&S.inArray(n,i)>-1)r&&r.push(n);else if(h=gt(n),o=Dt(l.appendChild(n),"script"),h&&Lt(o),s)for(u=0;n=o[u++];)kt.test(n.type||"")&&s.push(n);return l}var Pt=/^([^.]*)(?:\.(.+)|)/;function It(){return!0}function Nt(){return!1}function Mt(t,e,s,i,r,n){var o,a;if("object"==typeof e){for(a in"string"!=typeof s&&(i=i||s,s=void 0),e)Mt(t,a,s,i,e[a],n);return t}if(null==i&&null==r?(r=s,i=s=void 0):null==r&&("string"==typeof s?(r=i,i=void 0):(r=i,i=s,s=void 0)),!1===r)r=Nt;else if(!r)return t;return 1===n&&(o=r,r=function(t){return S().off(t),o.apply(this,arguments)},r.guid=o.guid||(o.guid=S.guid++)),t.each((function(){S.event.add(this,e,r,i,s)}))}function Bt(t,e,s){s?(at.set(t,e,!1),S.event.add(t,e,{namespace:!1,handler:function(t){var s,i=at.get(this,e);if(1&t.isTrigger&&this[e]){if(i)(S.event.special[e]||{}).delegateType&&t.stopPropagation();else if(i=a.call(arguments),at.set(this,e,i),this[e](),s=at.get(this,e),at.set(this,e,!1),i!==s)return t.stopImmediatePropagation(),t.preventDefault(),s}else i&&(at.set(this,e,S.event.trigger(i[0],i.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=It)}})):void 0===at.get(t,e)&&S.event.add(t,e,It)}S.event={global:{},add:function(t,e,s,i,r){var n,o,a,c,h,u,l,d,p,f,m,g=at.get(t);if(nt(t))for(s.handler&&(s=(n=s).handler,r=n.selector),r&&S.find.matchesSelector(mt,r),s.guid||(s.guid=S.guid++),(c=g.events)||(c=g.events=Object.create(null)),(o=g.handle)||(o=g.handle=function(e){return void 0!==S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),h=(e=(e||"").match(q)||[""]).length;h--;)p=m=(a=Pt.exec(e[h])||[])[1],f=(a[2]||"").split(".").sort(),p&&(l=S.event.special[p]||{},p=(r?l.delegateType:l.bindType)||p,l=S.event.special[p]||{},u=S.extend({type:p,origType:m,data:i,handler:s,guid:s.guid,selector:r,needsContext:r&&S.expr.match.needsContext.test(r),namespace:f.join(".")},n),(d=c[p])||((d=c[p]=[]).delegateCount=0,l.setup&&!1!==l.setup.call(t,i,f,o)||t.addEventListener&&t.addEventListener(p,o)),l.add&&(l.add.call(t,u),u.handler.guid||(u.handler.guid=s.guid)),r?d.splice(d.delegateCount++,0,u):d.push(u),S.event.global[p]=!0)},remove:function(t,e,s,i,r){var n,o,a,c,h,u,l,d,p,f,m,g=at.hasData(t)&&at.get(t);if(g&&(c=g.events)){for(h=(e=(e||"").match(q)||[""]).length;h--;)if(p=m=(a=Pt.exec(e[h])||[])[1],f=(a[2]||"").split(".").sort(),p){for(l=S.event.special[p]||{},d=c[p=(i?l.delegateType:l.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=n=d.length;n--;)u=d[n],!r&&m!==u.origType||s&&s.guid!==u.guid||a&&!a.test(u.namespace)||i&&i!==u.selector&&("**"!==i||!u.selector)||(d.splice(n,1),u.selector&&d.delegateCount--,l.remove&&l.remove.call(t,u));o&&!d.length&&(l.teardown&&!1!==l.teardown.call(t,f,g.handle)||S.removeEvent(t,p,g.handle),delete c[p])}else for(p in c)S.event.remove(t,p+e[h],s,i,!0);S.isEmptyObject(c)&&at.remove(t,"handle events")}},dispatch:function(t){var e,s,i,r,n,o,a=new Array(arguments.length),c=S.event.fix(t),h=(at.get(this,"events")||Object.create(null))[c.type]||[],u=S.event.special[c.type]||{};for(a[0]=c,e=1;e<arguments.length;e++)a[e]=arguments[e];if(c.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,c)){for(o=S.event.handlers.call(this,c,h),e=0;(r=o[e++])&&!c.isPropagationStopped();)for(c.currentTarget=r.elem,s=0;(n=r.handlers[s++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==n.namespace&&!c.rnamespace.test(n.namespace)||(c.handleObj=n,c.data=n.data,void 0!==(i=((S.event.special[n.origType]||{}).handle||n.handler).apply(r.elem,a))&&!1===(c.result=i)&&(c.preventDefault(),c.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,c),c.result}},handlers:function(t,e){var s,i,r,n,o,a=[],c=e.delegateCount,h=t.target;if(c&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||!0!==h.disabled)){for(n=[],o={},s=0;s<c;s++)void 0===o[r=(i=e[s]).selector+" "]&&(o[r]=i.needsContext?S(r,this).index(h)>-1:S.find(r,this,null,[h]).length),o[r]&&n.push(i);n.length&&a.push({elem:h,handlers:n})}return h=this,c<e.length&&a.push({elem:h,handlers:e.slice(c)}),a},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:b(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[S.expando]?t:new S.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return St.test(e.type)&&e.click&&k(e,"input")&&Bt(e,"click",!0),!1},trigger:function(t){var e=this||t;return St.test(e.type)&&e.click&&k(e,"input")&&Bt(e,"click"),!0},_default:function(t){var e=t.target;return St.test(e.type)&&e.click&&k(e,"input")&&at.get(e,"click")||k(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},S.removeEvent=function(t,e,s){t.removeEventListener&&t.removeEventListener(e,s)},S.Event=function(t,e){if(!(this instanceof S.Event))return new S.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?It:Nt,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&S.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Nt,isPropagationStopped:Nt,isImmediatePropagationStopped:Nt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=It,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=It,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=It,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},(function(t,e){function s(t){if(y.documentMode){var s=at.get(this,"handle"),i=S.event.fix(t);i.type="focusin"===t.type?"focus":"blur",i.isSimulated=!0,s(t),i.target===i.currentTarget&&s(i)}else S.event.simulate(e,t.target,S.event.fix(t))}S.event.special[t]={setup:function(){var i;if(Bt(this,t,!0),!y.documentMode)return!1;(i=at.get(this,e))||this.addEventListener(e,s),at.set(this,e,(i||0)+1)},trigger:function(){return Bt(this,t),!0},teardown:function(){var t;if(!y.documentMode)return!1;(t=at.get(this,e)-1)?at.set(this,e,t):(this.removeEventListener(e,s),at.remove(this,e))},_default:function(e){return at.get(e.target,t)},delegateType:e},S.event.special[e]={setup:function(){var i=this.ownerDocument||this.document||this,r=y.documentMode?this:i,n=at.get(r,e);n||(y.documentMode?this.addEventListener(e,s):i.addEventListener(t,s,!0)),at.set(r,e,(n||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,r=y.documentMode?this:i,n=at.get(r,e)-1;n?at.set(r,e,n):(y.documentMode?this.removeEventListener(e,s):i.removeEventListener(t,s,!0),at.remove(r,e))}}})),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){S.event.special[t]={delegateType:e,bindType:e,handle:function(t){var s,i=t.relatedTarget,r=t.handleObj;return i&&(i===this||S.contains(this,i))||(t.type=r.origType,s=r.handler.apply(this,arguments),t.type=e),s}}})),S.fn.extend({on:function(t,e,s,i){return Mt(this,t,e,s,i)},one:function(t,e,s,i){return Mt(this,t,e,s,i,1)},off:function(t,e,s){var i,r;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,S(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(s=e,e=void 0),!1===s&&(s=Nt),this.each((function(){S.event.remove(this,t,s,e)}))}});var Ft=/<script|<style|<link/i,Ut=/checked\s*(?:[^=]|=\s*.checked.)/i,Ht=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function jt(t,e){return k(t,"table")&&k(11!==e.nodeType?e:e.firstChild,"tr")&&S(t).children("tbody")[0]||t}function zt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Wt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Gt(t,e){var s,i,r,n,o,a;if(1===e.nodeType){if(at.hasData(t)&&(a=at.get(t).events))for(r in at.remove(e,"handle events"),a)for(s=0,i=a[r].length;s<i;s++)S.event.add(e,r,a[r][s]);ct.hasData(t)&&(n=ct.access(t),o=S.extend({},n),ct.set(e,o))}}function Kt(t,e){var s=e.nodeName.toLowerCase();"input"===s&&St.test(t.type)?e.checked=t.checked:"input"!==s&&"textarea"!==s||(e.defaultValue=t.defaultValue)}function $t(t,e,s,i){e=c(e);var r,n,o,a,h,u,l=0,d=t.length,p=d-1,f=e[0],m=b(f);if(m||d>1&&"string"==typeof f&&!g.checkClone&&Ut.test(f))return t.each((function(r){var n=t.eq(r);m&&(e[0]=f.call(this,r,n.html())),$t(n,e,s,i)}));if(d&&(n=(r=Ot(e,t[0].ownerDocument,!1,t,i)).firstChild,1===r.childNodes.length&&(r=n),n||i)){for(a=(o=S.map(Dt(r,"script"),zt)).length;l<d;l++)h=r,l!==p&&(h=S.clone(h,!0,!0),a&&S.merge(o,Dt(h,"script"))),s.call(t[l],h,l);if(a)for(u=o[o.length-1].ownerDocument,S.map(o,Wt),l=0;l<a;l++)h=o[l],kt.test(h.type||"")&&!at.access(h,"globalEval")&&S.contains(u,h)&&(h.src&&"module"!==(h.type||"").toLowerCase()?S._evalUrl&&!h.noModule&&S._evalUrl(h.src,{nonce:h.nonce||h.getAttribute("nonce")},u):C(h.textContent.replace(Ht,""),h,u))}return t}function qt(t,e,s){for(var i,r=e?S.filter(e,t):t,n=0;null!=(i=r[n]);n++)s||1!==i.nodeType||S.cleanData(Dt(i)),i.parentNode&&(s&&gt(i)&&Lt(Dt(i,"script")),i.parentNode.removeChild(i));return t}S.extend({htmlPrefilter:function(t){return t},clone:function(t,e,s){var i,r,n,o,a=t.cloneNode(!0),c=gt(t);if(!(g.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||S.isXMLDoc(t)))for(o=Dt(a),i=0,r=(n=Dt(t)).length;i<r;i++)Kt(n[i],o[i]);if(e)if(s)for(n=n||Dt(t),o=o||Dt(a),i=0,r=n.length;i<r;i++)Gt(n[i],o[i]);else Gt(t,a);return(o=Dt(a,"script")).length>0&&Lt(o,!c&&Dt(t,"script")),a},cleanData:function(t){for(var e,s,i,r=S.event.special,n=0;void 0!==(s=t[n]);n++)if(nt(s)){if(e=s[at.expando]){if(e.events)for(i in e.events)r[i]?S.event.remove(s,i):S.removeEvent(s,i,e.handle);s[at.expando]=void 0}s[ct.expando]&&(s[ct.expando]=void 0)}}}),S.fn.extend({detach:function(t){return qt(this,t,!0)},remove:function(t){return qt(this,t)},text:function(t){return tt(this,(function(t){return void 0===t?S.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return $t(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||jt(this,t).appendChild(t)}))},prepend:function(){return $t(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=jt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return $t(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return $t(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(S.cleanData(Dt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return S.clone(this,t,e)}))},html:function(t){return tt(this,(function(t){var e=this[0]||{},s=0,i=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Ft.test(t)&&!Et[(Tt.exec(t)||["",""])[1].toLowerCase()]){t=S.htmlPrefilter(t);try{for(;s<i;s++)1===(e=this[s]||{}).nodeType&&(S.cleanData(Dt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return $t(this,arguments,(function(e){var s=this.parentNode;S.inArray(this,t)<0&&(S.cleanData(Dt(this)),s&&s.replaceChild(e,this))}),t)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){S.fn[t]=function(t){for(var s,i=[],r=S(t),n=r.length-1,o=0;o<=n;o++)s=o===n?this:this.clone(!0),S(r[o])[e](s),h.apply(i,s.get());return this.pushStack(i)}}));var Xt=new RegExp("^("+dt+")(?!px)[a-z%]+$","i"),Vt=/^--/,Yt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)},Qt=function(t,e,s){var i,r,n={};for(r in e)n[r]=t.style[r],t.style[r]=e[r];for(r in i=s.call(t),e)t.style[r]=n[r];return i},Zt=new RegExp(ft.join("|"),"i");function Jt(t,e,s){var i,r,n,o,a=Vt.test(e),c=t.style;return(s=s||Yt(t))&&(o=s.getPropertyValue(e)||s[e],a&&o&&(o=o.replace(O,"$1")||void 0),""!==o||gt(t)||(o=S.style(t,e)),!g.pixelBoxStyles()&&Xt.test(o)&&Zt.test(e)&&(i=c.width,r=c.minWidth,n=c.maxWidth,c.minWidth=c.maxWidth=c.width=o,o=s.width,c.width=i,c.minWidth=r,c.maxWidth=n)),void 0!==o?o+"":o}function te(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(u){h.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",mt.appendChild(h).appendChild(u);var t=i.getComputedStyle(u);s="1%"!==t.top,c=12===e(t.marginLeft),u.style.right="60%",o=36===e(t.right),r=36===e(t.width),u.style.position="absolute",n=12===e(u.offsetWidth/3),mt.removeChild(h),u=null}}function e(t){return Math.round(parseFloat(t))}var s,r,n,o,a,c,h=y.createElement("div"),u=y.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===u.style.backgroundClip,S.extend(g,{boxSizingReliable:function(){return t(),r},pixelBoxStyles:function(){return t(),o},pixelPosition:function(){return t(),s},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),n},reliableTrDimensions:function(){var t,e,s,r;return null==a&&(t=y.createElement("table"),e=y.createElement("tr"),s=y.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="box-sizing:content-box;border:1px solid",e.style.height="1px",s.style.height="9px",s.style.display="block",mt.appendChild(t).appendChild(e).appendChild(s),r=i.getComputedStyle(e),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===e.offsetHeight,mt.removeChild(t)),a}}))}();var ee=["Webkit","Moz","ms"],se=y.createElement("div").style,ie={};function re(t){var e=S.cssProps[t]||ie[t];return e||(t in se?t:ie[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),s=ee.length;s--;)if((t=ee[s]+e)in se)return t}(t)||t)}var ne=/^(none|table(?!-c[ea]).+)/,oe={position:"absolute",visibility:"hidden",display:"block"},ae={letterSpacing:"0",fontWeight:"400"};function ce(t,e,s){var i=pt.exec(e);return i?Math.max(0,i[2]-(s||0))+(i[3]||"px"):e}function he(t,e,s,i,r,n){var o="width"===e?1:0,a=0,c=0,h=0;if(s===(i?"border":"content"))return 0;for(;o<4;o+=2)"margin"===s&&(h+=S.css(t,s+ft[o],!0,r)),i?("content"===s&&(c-=S.css(t,"padding"+ft[o],!0,r)),"margin"!==s&&(c-=S.css(t,"border"+ft[o]+"Width",!0,r))):(c+=S.css(t,"padding"+ft[o],!0,r),"padding"!==s?c+=S.css(t,"border"+ft[o]+"Width",!0,r):a+=S.css(t,"border"+ft[o]+"Width",!0,r));return!i&&n>=0&&(c+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-n-c-a-.5))||0),c+h}function ue(t,e,s){var i=Yt(t),r=(!g.boxSizingReliable()||s)&&"border-box"===S.css(t,"boxSizing",!1,i),n=r,o=Jt(t,e,i),a="offset"+e[0].toUpperCase()+e.slice(1);if(Xt.test(o)){if(!s)return o;o="auto"}return(!g.boxSizingReliable()&&r||!g.reliableTrDimensions()&&k(t,"tr")||"auto"===o||!parseFloat(o)&&"inline"===S.css(t,"display",!1,i))&&t.getClientRects().length&&(r="border-box"===S.css(t,"boxSizing",!1,i),(n=a in t)&&(o=t[a])),(o=parseFloat(o)||0)+he(t,e,s||(r?"border":"content"),n,i,o)+"px"}function le(t,e,s,i,r){return new le.prototype.init(t,e,s,i,r)}S.extend({cssHooks:{opacity:{get:function(t,e){if(e){var s=Jt(t,"opacity");return""===s?"1":s}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,s,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,n,o,a=rt(e),c=Vt.test(e),h=t.style;if(c||(e=re(a)),o=S.cssHooks[e]||S.cssHooks[a],void 0===s)return o&&"get"in o&&void 0!==(r=o.get(t,!1,i))?r:h[e];"string"===(n=typeof s)&&(r=pt.exec(s))&&r[1]&&(s=yt(t,e,r),n="number"),null!=s&&s==s&&("number"!==n||c||(s+=r&&r[3]||(S.cssNumber[a]?"":"px")),g.clearCloneStyle||""!==s||0!==e.indexOf("background")||(h[e]="inherit"),o&&"set"in o&&void 0===(s=o.set(t,s,i))||(c?h.setProperty(e,s):h[e]=s))}},css:function(t,e,s,i){var r,n,o,a=rt(e);return Vt.test(e)||(e=re(a)),(o=S.cssHooks[e]||S.cssHooks[a])&&"get"in o&&(r=o.get(t,!0,s)),void 0===r&&(r=Jt(t,e,i)),"normal"===r&&e in ae&&(r=ae[e]),""===s||s?(n=parseFloat(r),!0===s||isFinite(n)?n||0:r):r}}),S.each(["height","width"],(function(t,e){S.cssHooks[e]={get:function(t,s,i){if(s)return!ne.test(S.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?ue(t,e,i):Qt(t,oe,(function(){return ue(t,e,i)}))},set:function(t,s,i){var r,n=Yt(t),o=!g.scrollboxSize()&&"absolute"===n.position,a=(o||i)&&"border-box"===S.css(t,"boxSizing",!1,n),c=i?he(t,e,i,a,n):0;return a&&o&&(c-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(n[e])-he(t,e,"border",!1,n)-.5)),c&&(r=pt.exec(s))&&"px"!==(r[3]||"px")&&(t.style[e]=s,s=S.css(t,e)),ce(0,s,c)}}})),S.cssHooks.marginLeft=te(g.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Jt(t,"marginLeft"))||t.getBoundingClientRect().left-Qt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),S.each({margin:"",padding:"",border:"Width"},(function(t,e){S.cssHooks[t+e]={expand:function(s){for(var i=0,r={},n="string"==typeof s?s.split(" "):[s];i<4;i++)r[t+ft[i]+e]=n[i]||n[i-2]||n[0];return r}},"margin"!==t&&(S.cssHooks[t+e].set=ce)})),S.fn.extend({css:function(t,e){return tt(this,(function(t,e,s){var i,r,n={},o=0;if(Array.isArray(e)){for(i=Yt(t),r=e.length;o<r;o++)n[e[o]]=S.css(t,e[o],!1,i);return n}return void 0!==s?S.style(t,e,s):S.css(t,e)}),t,e,arguments.length>1)}}),S.Tween=le,le.prototype={constructor:le,init:function(t,e,s,i,r,n){this.elem=t,this.prop=s,this.easing=r||S.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=n||(S.cssNumber[s]?"":"px")},cur:function(){var t=le.propHooks[this.prop];return t&&t.get?t.get(this):le.propHooks._default.get(this)},run:function(t){var e,s=le.propHooks[this.prop];return this.options.duration?this.pos=e=S.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),s&&s.set?s.set(this):le.propHooks._default.set(this),this}},le.prototype.init.prototype=le.prototype,le.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=S.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){S.fx.step[t.prop]?S.fx.step[t.prop](t):1!==t.elem.nodeType||!S.cssHooks[t.prop]&&null==t.elem.style[re(t.prop)]?t.elem[t.prop]=t.now:S.style(t.elem,t.prop,t.now+t.unit)}}},le.propHooks.scrollTop=le.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},S.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},S.fx=le.prototype.init,S.fx.step={};var de,pe,fe=/^(?:toggle|show|hide)$/,me=/queueHooks$/;function ge(){pe&&(!1===y.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(ge):i.setTimeout(ge,S.fx.interval),S.fx.tick())}function be(){return i.setTimeout((function(){de=void 0})),de=Date.now()}function ve(t,e){var s,i=0,r={height:t};for(e=e?1:0;i<4;i+=2-e)r["margin"+(s=ft[i])]=r["padding"+s]=t;return e&&(r.opacity=r.width=t),r}function ye(t,e,s){for(var i,r=(we.tweeners[e]||[]).concat(we.tweeners["*"]),n=0,o=r.length;n<o;n++)if(i=r[n].call(s,e,t))return i}function we(t,e,s){var i,r,n=0,o=we.prefilters.length,a=S.Deferred().always((function(){delete c.elem})),c=function(){if(r)return!1;for(var e=de||be(),s=Math.max(0,h.startTime+h.duration-e),i=1-(s/h.duration||0),n=0,o=h.tweens.length;n<o;n++)h.tweens[n].run(i);return a.notifyWith(t,[h,i,s]),i<1&&o?s:(o||a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},s),originalProperties:e,originalOptions:s,startTime:de||be(),duration:s.duration,tweens:[],createTween:function(e,s){var i=S.Tween(t,h.opts,e,s,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(i),i},stop:function(e){var s=0,i=e?h.tweens.length:0;if(r)return this;for(r=!0;s<i;s++)h.tweens[s].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),u=h.props;for(!function(t,e){var s,i,r,n,o;for(s in t)if(r=e[i=rt(s)],n=t[s],Array.isArray(n)&&(r=n[1],n=t[s]=n[0]),s!==i&&(t[i]=n,delete t[s]),(o=S.cssHooks[i])&&"expand"in o)for(s in n=o.expand(n),delete t[i],n)s in t||(t[s]=n[s],e[s]=r);else e[i]=r}(u,h.opts.specialEasing);n<o;n++)if(i=we.prefilters[n].call(h,t,u,h.opts))return b(i.stop)&&(S._queueHooks(h.elem,h.opts.queue).stop=i.stop.bind(i)),i;return S.map(u,ye,h),b(h.opts.start)&&h.opts.start.call(t,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),S.fx.timer(S.extend(c,{elem:t,anim:h,queue:h.opts.queue})),h}S.Animation=S.extend(we,{tweeners:{"*":[function(t,e){var s=this.createTween(t,e);return yt(s.elem,t,pt.exec(e),s),s}]},tweener:function(t,e){b(t)?(e=t,t=["*"]):t=t.match(q);for(var s,i=0,r=t.length;i<r;i++)s=t[i],we.tweeners[s]=we.tweeners[s]||[],we.tweeners[s].unshift(e)},prefilters:[function(t,e,s){var i,r,n,o,a,c,h,u,l="width"in e||"height"in e,d=this,p={},f=t.style,m=t.nodeType&&vt(t),g=at.get(t,"fxshow");for(i in s.queue||(null==(o=S._queueHooks(t,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,d.always((function(){d.always((function(){o.unqueued--,S.queue(t,"fx").length||o.empty.fire()}))}))),e)if(r=e[i],fe.test(r)){if(delete e[i],n=n||"toggle"===r,r===(m?"hide":"show")){if("show"!==r||!g||void 0===g[i])continue;m=!0}p[i]=g&&g[i]||S.style(t,i)}if((c=!S.isEmptyObject(e))||!S.isEmptyObject(p))for(i in l&&1===t.nodeType&&(s.overflow=[f.overflow,f.overflowX,f.overflowY],null==(h=g&&g.display)&&(h=at.get(t,"display")),"none"===(u=S.css(t,"display"))&&(h?u=h:(At([t],!0),h=t.style.display||h,u=S.css(t,"display"),At([t]))),("inline"===u||"inline-block"===u&&null!=h)&&"none"===S.css(t,"float")&&(c||(d.done((function(){f.display=h})),null==h&&(u=f.display,h="none"===u?"":u)),f.display="inline-block")),s.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=s.overflow[0],f.overflowX=s.overflow[1],f.overflowY=s.overflow[2]}))),c=!1,p)c||(g?"hidden"in g&&(m=g.hidden):g=at.access(t,"fxshow",{display:h}),n&&(g.hidden=!m),m&&At([t],!0),d.done((function(){for(i in m||At([t]),at.remove(t,"fxshow"),p)S.style(t,i,p[i])}))),c=ye(m?g[i]:0,i,d),i in g||(g[i]=c.start,m&&(c.end=c.start,c.start=0))}],prefilter:function(t,e){e?we.prefilters.unshift(t):we.prefilters.push(t)}}),S.speed=function(t,e,s){var i=t&&"object"==typeof t?S.extend({},t):{complete:s||!s&&e||b(t)&&t,duration:t,easing:s&&e||e&&!b(e)&&e};return S.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in S.fx.speeds?i.duration=S.fx.speeds[i.duration]:i.duration=S.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){b(i.old)&&i.old.call(this),i.queue&&S.dequeue(this,i.queue)},i},S.fn.extend({fadeTo:function(t,e,s,i){return this.filter(vt).css("opacity",0).show().end().animate({opacity:e},t,s,i)},animate:function(t,e,s,i){var r=S.isEmptyObject(t),n=S.speed(e,s,i),o=function(){var e=we(this,S.extend({},t),n);(r||at.get(this,"finish"))&&e.stop(!0)};return o.finish=o,r||!1===n.queue?this.each(o):this.queue(n.queue,o)},stop:function(t,e,s){var i=function(t){var e=t.stop;delete t.stop,e(s)};return"string"!=typeof t&&(s=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,r=null!=t&&t+"queueHooks",n=S.timers,o=at.get(this);if(r)o[r]&&o[r].stop&&i(o[r]);else for(r in o)o[r]&&o[r].stop&&me.test(r)&&i(o[r]);for(r=n.length;r--;)n[r].elem!==this||null!=t&&n[r].queue!==t||(n[r].anim.stop(s),e=!1,n.splice(r,1));!e&&s||S.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,s=at.get(this),i=s[t+"queue"],r=s[t+"queueHooks"],n=S.timers,o=i?i.length:0;for(s.finish=!0,S.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=n.length;e--;)n[e].elem===this&&n[e].queue===t&&(n[e].anim.stop(!0),n.splice(e,1));for(e=0;e<o;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete s.finish}))}}),S.each(["toggle","show","hide"],(function(t,e){var s=S.fn[e];S.fn[e]=function(t,i,r){return null==t||"boolean"==typeof t?s.apply(this,arguments):this.animate(ve(e,!0),t,i,r)}})),S.each({slideDown:ve("show"),slideUp:ve("hide"),slideToggle:ve("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){S.fn[t]=function(t,s,i){return this.animate(e,t,s,i)}})),S.timers=[],S.fx.tick=function(){var t,e=0,s=S.timers;for(de=Date.now();e<s.length;e++)(t=s[e])()||s[e]!==t||s.splice(e--,1);s.length||S.fx.stop(),de=void 0},S.fx.timer=function(t){S.timers.push(t),S.fx.start()},S.fx.interval=13,S.fx.start=function(){pe||(pe=!0,ge())},S.fx.stop=function(){pe=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(t,e){return t=S.fx&&S.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,s){var r=i.setTimeout(e,t);s.stop=function(){i.clearTimeout(r)}}))},function(){var t=y.createElement("input"),e=y.createElement("select").appendChild(y.createElement("option"));t.type="checkbox",g.checkOn=""!==t.value,g.optSelected=e.selected,(t=y.createElement("input")).value="t",t.type="radio",g.radioValue="t"===t.value}();var Ce,Ae=S.expr.attrHandle;S.fn.extend({attr:function(t,e){return tt(this,S.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){S.removeAttr(this,t)}))}}),S.extend({attr:function(t,e,s){var i,r,n=t.nodeType;if(3!==n&&8!==n&&2!==n)return void 0===t.getAttribute?S.prop(t,e,s):(1===n&&S.isXMLDoc(t)||(r=S.attrHooks[e.toLowerCase()]||(S.expr.match.bool.test(e)?Ce:void 0)),void 0!==s?null===s?void S.removeAttr(t,e):r&&"set"in r&&void 0!==(i=r.set(t,s,e))?i:(t.setAttribute(e,s+""),s):r&&"get"in r&&null!==(i=r.get(t,e))?i:null==(i=S.find.attr(t,e))?void 0:i)},attrHooks:{type:{set:function(t,e){if(!g.radioValue&&"radio"===e&&k(t,"input")){var s=t.value;return t.setAttribute("type",e),s&&(t.value=s),e}}}},removeAttr:function(t,e){var s,i=0,r=e&&e.match(q);if(r&&1===t.nodeType)for(;s=r[i++];)t.removeAttribute(s)}}),Ce={set:function(t,e,s){return!1===e?S.removeAttr(t,s):t.setAttribute(s,s),s}},S.each(S.expr.match.bool.source.match(/\w+/g),(function(t,e){var s=Ae[e]||S.find.attr;Ae[e]=function(t,e,i){var r,n,o=e.toLowerCase();return i||(n=Ae[o],Ae[o]=r,r=null!=s(t,e,i)?o:null,Ae[o]=n),r}}));var _e=/^(?:input|select|textarea|button)$/i,xe=/^(?:a|area)$/i;function Se(t){return(t.match(q)||[]).join(" ")}function Te(t){return t.getAttribute&&t.getAttribute("class")||""}function ke(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(q)||[]}S.fn.extend({prop:function(t,e){return tt(this,S.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[S.propFix[t]||t]}))}}),S.extend({prop:function(t,e,s){var i,r,n=t.nodeType;if(3!==n&&8!==n&&2!==n)return 1===n&&S.isXMLDoc(t)||(e=S.propFix[e]||e,r=S.propHooks[e]),void 0!==s?r&&"set"in r&&void 0!==(i=r.set(t,s,e))?i:t[e]=s:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=S.find.attr(t,"tabindex");return e?parseInt(e,10):_e.test(t.nodeName)||xe.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(S.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){S.propFix[this.toLowerCase()]=this})),S.fn.extend({addClass:function(t){var e,s,i,r,n,o;return b(t)?this.each((function(e){S(this).addClass(t.call(this,e,Te(this)))})):(e=ke(t)).length?this.each((function(){if(i=Te(this),s=1===this.nodeType&&" "+Se(i)+" "){for(n=0;n<e.length;n++)r=e[n],s.indexOf(" "+r+" ")<0&&(s+=r+" ");o=Se(s),i!==o&&this.setAttribute("class",o)}})):this},removeClass:function(t){var e,s,i,r,n,o;return b(t)?this.each((function(e){S(this).removeClass(t.call(this,e,Te(this)))})):arguments.length?(e=ke(t)).length?this.each((function(){if(i=Te(this),s=1===this.nodeType&&" "+Se(i)+" "){for(n=0;n<e.length;n++)for(r=e[n];s.indexOf(" "+r+" ")>-1;)s=s.replace(" "+r+" "," ");o=Se(s),i!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(t,e){var s,i,r,n,o=typeof t,a="string"===o||Array.isArray(t);return b(t)?this.each((function(s){S(this).toggleClass(t.call(this,s,Te(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(s=ke(t),this.each((function(){if(a)for(n=S(this),r=0;r<s.length;r++)i=s[r],n.hasClass(i)?n.removeClass(i):n.addClass(i);else void 0!==t&&"boolean"!==o||((i=Te(this))&&at.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===t?"":at.get(this,"__className__")||""))})))},hasClass:function(t){var e,s,i=0;for(e=" "+t+" ";s=this[i++];)if(1===s.nodeType&&(" "+Se(Te(s))+" ").indexOf(e)>-1)return!0;return!1}});var Ee=/\r/g;S.fn.extend({val:function(t){var e,s,i,r=this[0];return arguments.length?(i=b(t),this.each((function(s){var r;1===this.nodeType&&(null==(r=i?t.call(this,s,S(this).val()):t)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=S.map(r,(function(t){return null==t?"":t+""}))),(e=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))}))):r?(e=S.valHooks[r.type]||S.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&void 0!==(s=e.get(r,"value"))?s:"string"==typeof(s=r.value)?s.replace(Ee,""):null==s?"":s:void 0}}),S.extend({valHooks:{option:{get:function(t){var e=S.find.attr(t,"value");return null!=e?e:Se(S.text(t))}},select:{get:function(t){var e,s,i,r=t.options,n=t.selectedIndex,o="select-one"===t.type,a=o?null:[],c=o?n+1:r.length;for(i=n<0?c:o?n:0;i<c;i++)if(((s=r[i]).selected||i===n)&&!s.disabled&&(!s.parentNode.disabled||!k(s.parentNode,"optgroup"))){if(e=S(s).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var s,i,r=t.options,n=S.makeArray(e),o=r.length;o--;)((i=r[o]).selected=S.inArray(S.valHooks.option.get(i),n)>-1)&&(s=!0);return s||(t.selectedIndex=-1),n}}}}),S.each(["radio","checkbox"],(function(){S.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=S.inArray(S(t).val(),e)>-1}},g.checkOn||(S.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var De=i.location,Le={guid:Date.now()},Re=/\?/;S.parseXML=function(t){var e,s;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){}return s=e&&e.getElementsByTagName("parsererror")[0],e&&!s||S.error("Invalid XML: "+(s?S.map(s.childNodes,(function(t){return t.textContent})).join("\n"):t)),e};var Oe=/^(?:focusinfocus|focusoutblur)$/,Pe=function(t){t.stopPropagation()};S.extend(S.event,{trigger:function(t,e,s,r){var n,o,a,c,h,u,l,d,f=[s||y],m=p.call(t,"type")?t.type:t,g=p.call(t,"namespace")?t.namespace.split("."):[];if(o=d=a=s=s||y,3!==s.nodeType&&8!==s.nodeType&&!Oe.test(m+S.event.triggered)&&(m.indexOf(".")>-1&&(g=m.split("."),m=g.shift(),g.sort()),h=m.indexOf(":")<0&&"on"+m,(t=t[S.expando]?t:new S.Event(m,"object"==typeof t&&t)).isTrigger=r?2:3,t.namespace=g.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=s),e=null==e?[t]:S.makeArray(e,[t]),l=S.event.special[m]||{},r||!l.trigger||!1!==l.trigger.apply(s,e))){if(!r&&!l.noBubble&&!v(s)){for(c=l.delegateType||m,Oe.test(c+m)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(s.ownerDocument||y)&&f.push(a.defaultView||a.parentWindow||i)}for(n=0;(o=f[n++])&&!t.isPropagationStopped();)d=o,t.type=n>1?c:l.bindType||m,(u=(at.get(o,"events")||Object.create(null))[t.type]&&at.get(o,"handle"))&&u.apply(o,e),(u=h&&o[h])&&u.apply&&nt(o)&&(t.result=u.apply(o,e),!1===t.result&&t.preventDefault());return t.type=m,r||t.isDefaultPrevented()||l._default&&!1!==l._default.apply(f.pop(),e)||!nt(s)||h&&b(s[m])&&!v(s)&&((a=s[h])&&(s[h]=null),S.event.triggered=m,t.isPropagationStopped()&&d.addEventListener(m,Pe),s[m](),t.isPropagationStopped()&&d.removeEventListener(m,Pe),S.event.triggered=void 0,a&&(s[h]=a)),t.result}},simulate:function(t,e,s){var i=S.extend(new S.Event,s,{type:t,isSimulated:!0});S.event.trigger(i,null,e)}}),S.fn.extend({trigger:function(t,e){return this.each((function(){S.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var s=this[0];if(s)return S.event.trigger(t,e,s,!0)}});var Ie=/\[\]$/,Ne=/\r?\n/g,Me=/^(?:submit|button|image|reset|file)$/i,Be=/^(?:input|select|textarea|keygen)/i;function Fe(t,e,s,i){var r;if(Array.isArray(e))S.each(e,(function(e,r){s||Ie.test(t)?i(t,r):Fe(t+"["+("object"==typeof r&&null!=r?e:"")+"]",r,s,i)}));else if(s||"object"!==A(e))i(t,e);else for(r in e)Fe(t+"["+r+"]",e[r],s,i)}S.param=function(t,e){var s,i=[],r=function(t,e){var s=b(e)?e():e;i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==s?"":s)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!S.isPlainObject(t))S.each(t,(function(){r(this.name,this.value)}));else for(s in t)Fe(s,t[s],e,r);return i.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=S.prop(this,"elements");return t?S.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!S(this).is(":disabled")&&Be.test(this.nodeName)&&!Me.test(t)&&(this.checked||!St.test(t))})).map((function(t,e){var s=S(this).val();return null==s?null:Array.isArray(s)?S.map(s,(function(t){return{name:e.name,value:t.replace(Ne,"\r\n")}})):{name:e.name,value:s.replace(Ne,"\r\n")}})).get()}});var Ue=/%20/g,He=/#.*$/,je=/([?&])_=[^&]*/,ze=/^(.*?):[ \t]*([^\r\n]*)$/gm,We=/^(?:GET|HEAD)$/,Ge=/^\/\//,Ke={},$e={},qe="*/".concat("*"),Xe=y.createElement("a");function Ve(t){return function(e,s){"string"!=typeof e&&(s=e,e="*");var i,r=0,n=e.toLowerCase().match(q)||[];if(b(s))for(;i=n[r++];)"+"===i[0]?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(s)):(t[i]=t[i]||[]).push(s)}}function Ye(t,e,s,i){var r={},n=t===$e;function o(a){var c;return r[a]=!0,S.each(t[a]||[],(function(t,a){var h=a(e,s,i);return"string"!=typeof h||n||r[h]?n?!(c=h):void 0:(e.dataTypes.unshift(h),o(h),!1)})),c}return o(e.dataTypes[0])||!r["*"]&&o("*")}function Qe(t,e){var s,i,r=S.ajaxSettings.flatOptions||{};for(s in e)void 0!==e[s]&&((r[s]?t:i||(i={}))[s]=e[s]);return i&&S.extend(!0,t,i),t}Xe.href=De.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:De.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(De.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Qe(Qe(t,S.ajaxSettings),e):Qe(S.ajaxSettings,t)},ajaxPrefilter:Ve(Ke),ajaxTransport:Ve($e),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var s,r,n,o,a,c,h,u,l,d,p=S.ajaxSetup({},e),f=p.context||p,m=p.context&&(f.nodeType||f.jquery)?S(f):S.event,g=S.Deferred(),b=S.Callbacks("once memory"),v=p.statusCode||{},w={},C={},A="canceled",_={readyState:0,getResponseHeader:function(t){var e;if(h){if(!o)for(o={};e=ze.exec(n);)o[e[1].toLowerCase()+" "]=(o[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=o[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return h?n:null},setRequestHeader:function(t,e){return null==h&&(t=C[t.toLowerCase()]=C[t.toLowerCase()]||t,w[t]=e),this},overrideMimeType:function(t){return null==h&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(h)_.always(t[_.status]);else for(e in t)v[e]=[v[e],t[e]];return this},abort:function(t){var e=t||A;return s&&s.abort(e),x(0,e),this}};if(g.promise(_),p.url=((t||p.url||De.href)+"").replace(Ge,De.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(q)||[""],null==p.crossDomain){c=y.createElement("a");try{c.href=p.url,c.href=c.href,p.crossDomain=Xe.protocol+"//"+Xe.host!=c.protocol+"//"+c.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=S.param(p.data,p.traditional)),Ye(Ke,p,e,_),h)return _;for(l in(u=S.event&&p.global)&&0==S.active++&&S.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!We.test(p.type),r=p.url.replace(He,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ue,"+")):(d=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(Re.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(je,"$1"),d=(Re.test(r)?"&":"?")+"_="+Le.guid+++d),p.url=r+d),p.ifModified&&(S.lastModified[r]&&_.setRequestHeader("If-Modified-Since",S.lastModified[r]),S.etag[r]&&_.setRequestHeader("If-None-Match",S.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&_.setRequestHeader("Content-Type",p.contentType),_.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+qe+"; q=0.01":""):p.accepts["*"]),p.headers)_.setRequestHeader(l,p.headers[l]);if(p.beforeSend&&(!1===p.beforeSend.call(f,_,p)||h))return _.abort();if(A="abort",b.add(p.complete),_.done(p.success),_.fail(p.error),s=Ye($e,p,e,_)){if(_.readyState=1,u&&m.trigger("ajaxSend",[_,p]),h)return _;p.async&&p.timeout>0&&(a=i.setTimeout((function(){_.abort("timeout")}),p.timeout));try{h=!1,s.send(w,x)}catch(t){if(h)throw t;x(-1,t)}}else x(-1,"No Transport");function x(t,e,o,c){var l,d,y,w,C,A=e;h||(h=!0,a&&i.clearTimeout(a),s=void 0,n=c||"",_.readyState=t>0?4:0,l=t>=200&&t<300||304===t,o&&(w=function(t,e,s){for(var i,r,n,o,a=t.contents,c=t.dataTypes;"*"===c[0];)c.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(r in a)if(a[r]&&a[r].test(i)){c.unshift(r);break}if(c[0]in s)n=c[0];else{for(r in s){if(!c[0]||t.converters[r+" "+c[0]]){n=r;break}o||(o=r)}n=n||o}if(n)return n!==c[0]&&c.unshift(n),s[n]}(p,_,o)),!l&&S.inArray("script",p.dataTypes)>-1&&S.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(t,e,s,i){var r,n,o,a,c,h={},u=t.dataTypes.slice();if(u[1])for(o in t.converters)h[o.toLowerCase()]=t.converters[o];for(n=u.shift();n;)if(t.responseFields[n]&&(s[t.responseFields[n]]=e),!c&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),c=n,n=u.shift())if("*"===n)n=c;else if("*"!==c&&c!==n){if(!(o=h[c+" "+n]||h["* "+n]))for(r in h)if((a=r.split(" "))[1]===n&&(o=h[c+" "+a[0]]||h["* "+a[0]])){!0===o?o=h[r]:!0!==h[r]&&(n=a[0],u.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+c+" to "+n}}}return{state:"success",data:e}}(p,w,_,l),l?(p.ifModified&&((C=_.getResponseHeader("Last-Modified"))&&(S.lastModified[r]=C),(C=_.getResponseHeader("etag"))&&(S.etag[r]=C)),204===t||"HEAD"===p.type?A="nocontent":304===t?A="notmodified":(A=w.state,d=w.data,l=!(y=w.error))):(y=A,!t&&A||(A="error",t<0&&(t=0))),_.status=t,_.statusText=(e||A)+"",l?g.resolveWith(f,[d,A,_]):g.rejectWith(f,[_,A,y]),_.statusCode(v),v=void 0,u&&m.trigger(l?"ajaxSuccess":"ajaxError",[_,p,l?d:y]),b.fireWith(f,[_,A]),u&&(m.trigger("ajaxComplete",[_,p]),--S.active||S.event.trigger("ajaxStop")))}return _},getJSON:function(t,e,s){return S.get(t,e,s,"json")},getScript:function(t,e){return S.get(t,void 0,e,"script")}}),S.each(["get","post"],(function(t,e){S[e]=function(t,s,i,r){return b(s)&&(r=r||i,i=s,s=void 0),S.ajax(S.extend({url:t,type:e,dataType:r,data:s,success:i},S.isPlainObject(t)&&t))}})),S.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),S._evalUrl=function(t,e,s){return S.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){S.globalEval(t,e,s)}})},S.fn.extend({wrapAll:function(t){var e;return this[0]&&(b(t)&&(t=t.call(this[0])),e=S(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return b(t)?this.each((function(e){S(this).wrapInner(t.call(this,e))})):this.each((function(){var e=S(this),s=e.contents();s.length?s.wrapAll(t):e.append(t)}))},wrap:function(t){var e=b(t);return this.each((function(s){S(this).wrapAll(e?t.call(this,s):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){S(this).replaceWith(this.childNodes)})),this}}),S.expr.pseudos.hidden=function(t){return!S.expr.pseudos.visible(t)},S.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var Ze={0:200,1223:204},Je=S.ajaxSettings.xhr();g.cors=!!Je&&"withCredentials"in Je,g.ajax=Je=!!Je,S.ajaxTransport((function(t){var e,s;if(g.cors||Je&&!t.crossDomain)return{send:function(r,n){var o,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)a[o]=t.xhrFields[o];for(o in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);e=function(t){return function(){e&&(e=s=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?n(0,"error"):n(a.status,a.statusText):n(Ze[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=e(),s=a.onerror=a.ontimeout=e("error"),void 0!==a.onabort?a.onabort=s:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){e&&s()}))},e=e("abort");try{a.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),S.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return S.globalEval(t),t}}}),S.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),S.ajaxTransport("script",(function(t){var e,s;if(t.crossDomain||t.scriptAttrs)return{send:function(i,r){e=S("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",s=function(t){e.remove(),s=null,t&&r("error"===t.type?404:200,t.type)}),y.head.appendChild(e[0])},abort:function(){s&&s()}}}));var ts,es=[],ss=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=es.pop()||S.expando+"_"+Le.guid++;return this[t]=!0,t}}),S.ajaxPrefilter("json jsonp",(function(t,e,s){var r,n,o,a=!1!==t.jsonp&&(ss.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&ss.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return r=t.jsonpCallback=b(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(ss,"$1"+r):!1!==t.jsonp&&(t.url+=(Re.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},t.dataTypes[0]="json",n=i[r],i[r]=function(){o=arguments},s.always((function(){void 0===n?S(i).removeProp(r):i[r]=n,t[r]&&(t.jsonpCallback=e.jsonpCallback,es.push(r)),o&&b(n)&&n(o[0]),o=n=void 0})),"script"})),g.createHTMLDocument=((ts=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===ts.childNodes.length),S.parseHTML=function(t,e,s){return"string"!=typeof t?[]:("boolean"==typeof e&&(s=e,e=!1),e||(g.createHTMLDocument?((i=(e=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,e.head.appendChild(i)):e=y),n=!s&&[],(r=H.exec(t))?[e.createElement(r[1])]:(r=Ot([t],e,n),n&&n.length&&S(n).remove(),S.merge([],r.childNodes)));var i,r,n},S.fn.load=function(t,e,s){var i,r,n,o=this,a=t.indexOf(" ");return a>-1&&(i=Se(t.slice(a)),t=t.slice(0,a)),b(e)?(s=e,e=void 0):e&&"object"==typeof e&&(r="POST"),o.length>0&&S.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done((function(t){n=arguments,o.html(i?S("<div>").append(S.parseHTML(t)).find(i):t)})).always(s&&function(t,e){o.each((function(){s.apply(this,n||[t.responseText,e,t])}))}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,(function(e){return t===e.elem})).length},S.offset={setOffset:function(t,e,s){var i,r,n,o,a,c,h=S.css(t,"position"),u=S(t),l={};"static"===h&&(t.style.position="relative"),a=u.offset(),n=S.css(t,"top"),c=S.css(t,"left"),("absolute"===h||"fixed"===h)&&(n+c).indexOf("auto")>-1?(o=(i=u.position()).top,r=i.left):(o=parseFloat(n)||0,r=parseFloat(c)||0),b(e)&&(e=e.call(t,s,S.extend({},a))),null!=e.top&&(l.top=e.top-a.top+o),null!=e.left&&(l.left=e.left-a.left+r),"using"in e?e.using.call(t,l):u.css(l)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){S.offset.setOffset(this,t,e)}));var e,s,i=this[0];return i?i.getClientRects().length?(e=i.getBoundingClientRect(),s=i.ownerDocument.defaultView,{top:e.top+s.pageYOffset,left:e.left+s.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,s,i=this[0],r={top:0,left:0};if("fixed"===S.css(i,"position"))e=i.getBoundingClientRect();else{for(e=this.offset(),s=i.ownerDocument,t=i.offsetParent||s.documentElement;t&&(t===s.body||t===s.documentElement)&&"static"===S.css(t,"position");)t=t.parentNode;t&&t!==i&&1===t.nodeType&&((r=S(t).offset()).top+=S.css(t,"borderTopWidth",!0),r.left+=S.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-S.css(i,"marginTop",!0),left:e.left-r.left-S.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===S.css(t,"position");)t=t.offsetParent;return t||mt}))}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var s="pageYOffset"===e;S.fn[t]=function(i){return tt(this,(function(t,i,r){var n;if(v(t)?n=t:9===t.nodeType&&(n=t.defaultView),void 0===r)return n?n[e]:t[i];n?n.scrollTo(s?n.pageXOffset:r,s?r:n.pageYOffset):t[i]=r}),t,i,arguments.length)}})),S.each(["top","left"],(function(t,e){S.cssHooks[e]=te(g.pixelPosition,(function(t,s){if(s)return s=Jt(t,e),Xt.test(s)?S(t).position()[e]+"px":s}))})),S.each({Height:"height",Width:"width"},(function(t,e){S.each({padding:"inner"+t,content:e,"":"outer"+t},(function(s,i){S.fn[i]=function(r,n){var o=arguments.length&&(s||"boolean"!=typeof r),a=s||(!0===r||!0===n?"margin":"border");return tt(this,(function(e,s,r){var n;return v(e)?0===i.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(n=e.documentElement,Math.max(e.body["scroll"+t],n["scroll"+t],e.body["offset"+t],n["offset"+t],n["client"+t])):void 0===r?S.css(e,s,a):S.style(e,s,r,a)}),e,o?r:void 0,o)}}))})),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){S.fn[e]=function(t){return this.on(e,t)}})),S.fn.extend({bind:function(t,e,s){return this.on(t,null,e,s)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,s,i){return this.on(e,t,s,i)},undelegate:function(t,e,s){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",s)},hover:function(t,e){return this.on("mouseenter",t).on("mouseleave",e||t)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){S.fn[e]=function(t,s){return arguments.length>0?this.on(e,null,t,s):this.trigger(e)}}));var is=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;S.proxy=function(t,e){var s,i,r;if("string"==typeof e&&(s=t[e],e=t,t=s),b(t))return i=a.call(arguments,2),r=function(){return t.apply(e||this,i.concat(a.call(arguments)))},r.guid=t.guid=t.guid||S.guid++,r},S.holdReady=function(t){t?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=k,S.isFunction=b,S.isWindow=v,S.camelCase=rt,S.type=A,S.now=Date.now,S.isNumeric=function(t){var e=S.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},S.trim=function(t){return null==t?"":(t+"").replace(is,"$1")},void 0===(s=function(){return S}.apply(e,[]))||(t.exports=s);var rs=i.jQuery,ns=i.$;return S.noConflict=function(t){return i.$===S&&(i.$=ns),t&&i.jQuery===S&&(i.jQuery=rs),S},void 0===r&&(i.jQuery=i.$=S),S}))},565:t=>{"use strict";t.exports=fs}},i={};function r(t){var e=i[t];if(void 0!==e)return e.exports;var n=i[t]={exports:{}};return s[t].call(n.exports,n,n.exports,r),n.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,r.t=function(s,i){if(1&i&&(s=this(s)),8&i)return s;if("object"==typeof s&&s){if(4&i&&s.__esModule)return s;if(16&i&&"function"==typeof s.then)return s}var n=Object.create(null);r.r(n);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&i&&s;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>s[t]));return o.default=()=>s,r.d(n,o),n},r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};r.r(t),r.d(t,{VERSION:()=>i,after:()=>Ie,all:()=>ts,allKeys:()=>gt,any:()=>es,assign:()=>It,before:()=>Ne,bind:()=>Ae,bindAll:()=>Se,chain:()=>ve,chunk:()=>Bs,clone:()=>Ft,collect:()=>Xe,compact:()=>Ts,compose:()=>Pe,constant:()=>Z,contains:()=>ss,countBy:()=>gs,create:()=>Bt,debounce:()=>Le,default:()=>Hs,defaults:()=>Nt,defer:()=>Ee,delay:()=>ke,detect:()=>Ke,difference:()=>Es,drop:()=>xs,each:()=>qe,escape:()=>oe,every:()=>ts,extend:()=>Pt,extendOwn:()=>It,filter:()=>Ze,find:()=>Ke,findIndex:()=>Ue,findKey:()=>Be,findLastIndex:()=>He,findWhere:()=>$e,first:()=>_s,flatten:()=>ks,foldl:()=>Ye,foldr:()=>Qe,forEach:()=>qe,functions:()=>Rt,get:()=>Wt,groupBy:()=>fs,has:()=>Gt,head:()=>_s,identity:()=>Kt,include:()=>ss,includes:()=>ss,indexBy:()=>ms,indexOf:()=>We,initial:()=>As,inject:()=>Ye,intersection:()=>Os,invert:()=>Lt,invoke:()=>is,isArguments:()=>V,isArray:()=>$,isArrayBuffer:()=>B,isBoolean:()=>E,isDataView:()=>K,isDate:()=>P,isElement:()=>D,isEmpty:()=>ct,isEqual:()=>mt,isError:()=>N,isFinite:()=>Y,isFunction:()=>H,isMap:()=>xt,isMatch:()=>ht,isNaN:()=>Q,isNull:()=>T,isNumber:()=>O,isObject:()=>S,isRegExp:()=>I,isSet:()=>Tt,isString:()=>R,isSymbol:()=>M,isTypedArray:()=>rt,isUndefined:()=>k,isWeakMap:()=>St,isWeakSet:()=>kt,iteratee:()=>Yt,keys:()=>at,last:()=>Ss,lastIndexOf:()=>Ge,map:()=>Xe,mapObject:()=>Zt,matcher:()=>$t,matches:()=>$t,max:()=>os,memoize:()=>Te,methods:()=>Rt,min:()=>as,mixin:()=>Us,negate:()=>Oe,noop:()=>Jt,now:()=>ie,object:()=>Ns,omit:()=>Cs,once:()=>Me,pairs:()=>Dt,partial:()=>Ce,partition:()=>bs,pick:()=>ws,pluck:()=>rs,property:()=>qt,propertyOf:()=>te,random:()=>se,range:()=>Ms,reduce:()=>Ye,reduceRight:()=>Qe,reject:()=>Je,rest:()=>xs,restArguments:()=>x,result:()=>me,sample:()=>us,select:()=>Ze,shuffle:()=>ls,size:()=>vs,some:()=>es,sortBy:()=>ds,sortedIndex:()=>je,tail:()=>xs,take:()=>_s,tap:()=>Ut,template:()=>fe,templateSettings:()=>ce,throttle:()=>De,times:()=>ee,toArray:()=>hs,toPath:()=>Ht,transpose:()=>Ps,unescape:()=>ae,union:()=>Rs,uniq:()=>Ls,unique:()=>Ls,uniqueId:()=>be,unzip:()=>Ps,values:()=>Et,where:()=>ns,without:()=>Ds,wrap:()=>Re,zip:()=>Is});var e={};r.r(e),r.d(e,{afterMain:()=>ci,afterRead:()=>ni,afterWrite:()=>li,applyStyles:()=>vi,arrow:()=>Fi,auto:()=>qs,basePlacements:()=>Xs,beforeMain:()=>oi,beforeRead:()=>ii,beforeWrite:()=>hi,bottom:()=>Gs,clippingParents:()=>Qs,computeStyles:()=>zi,createPopper:()=>vr,createPopperBase:()=>br,createPopperLite:()=>yr,detectOverflow:()=>rr,end:()=>Ys,eventListeners:()=>Gi,flip:()=>nr,hide:()=>cr,left:()=>$s,main:()=>ai,modifierPhases:()=>di,offset:()=>hr,placements:()=>si,popper:()=>Js,popperGenerator:()=>gr,popperOffsets:()=>ur,preventOverflow:()=>lr,read:()=>ri,reference:()=>ti,right:()=>Ks,start:()=>Vs,top:()=>Ws,variationPlacements:()=>ei,viewport:()=>Zs,write:()=>ui});var s=r(271),i="1.13.6",n="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},o=Array.prototype,a=Object.prototype,c="undefined"!=typeof Symbol?Symbol.prototype:null,h=o.push,u=o.slice,l=a.toString,d=a.hasOwnProperty,p="undefined"!=typeof ArrayBuffer,f="undefined"!=typeof DataView,m=Array.isArray,g=Object.keys,b=Object.create,v=p&&ArrayBuffer.isView,y=isNaN,w=isFinite,C=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],_=Math.pow(2,53)-1;function x(t,e){return e=null==e?t.length-1:+e,function(){for(var s=Math.max(arguments.length-e,0),i=Array(s),r=0;r<s;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var n=Array(e+1);for(r=0;r<e;r++)n[r]=arguments[r];return n[e]=i,t.apply(this,n)}}function S(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function T(t){return null===t}function k(t){return void 0===t}function E(t){return!0===t||!1===t||"[object Boolean]"===l.call(t)}function D(t){return!(!t||1!==t.nodeType)}function L(t){var e="[object "+t+"]";return function(t){return l.call(t)===e}}const R=L("String"),O=L("Number"),P=L("Date"),I=L("RegExp"),N=L("Error"),M=L("Symbol"),B=L("ArrayBuffer");var F=L("Function"),U=n.document&&n.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof U&&(F=function(t){return"function"==typeof t||!1});const H=F,j=L("Object");var z=f&&j(new DataView(new ArrayBuffer(8))),W="undefined"!=typeof Map&&j(new Map),G=L("DataView");const K=z?function(t){return null!=t&&H(t.getInt8)&&B(t.buffer)}:G,$=m||L("Array");function q(t,e){return null!=t&&d.call(t,e)}var X=L("Arguments");!function(){X(arguments)||(X=function(t){return q(t,"callee")})}();const V=X;function Y(t){return!M(t)&&w(t)&&!isNaN(parseFloat(t))}function Q(t){return O(t)&&y(t)}function Z(t){return function(){return t}}function J(t){return function(e){var s=t(e);return"number"==typeof s&&s>=0&&s<=_}}function tt(t){return function(e){return null==e?void 0:e[t]}}const et=tt("byteLength"),st=J(et);var it=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;const rt=p?function(t){return v?v(t)&&!K(t):st(t)&&it.test(l.call(t))}:Z(!1),nt=tt("length");function ot(t,e){e=function(t){for(var e={},s=t.length,i=0;i<s;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(s){return e[s]=!0,t.push(s)}}}(e);var s=A.length,i=t.constructor,r=H(i)&&i.prototype||a,n="constructor";for(q(t,n)&&!e.contains(n)&&e.push(n);s--;)(n=A[s])in t&&t[n]!==r[n]&&!e.contains(n)&&e.push(n)}function at(t){if(!S(t))return[];if(g)return g(t);var e=[];for(var s in t)q(t,s)&&e.push(s);return C&&ot(t,e),e}function ct(t){if(null==t)return!0;var e=nt(t);return"number"==typeof e&&($(t)||R(t)||V(t))?0===e:0===nt(at(t))}function ht(t,e){var s=at(e),i=s.length;if(null==t)return!i;for(var r=Object(t),n=0;n<i;n++){var o=s[n];if(e[o]!==r[o]||!(o in r))return!1}return!0}function ut(t){return t instanceof ut?t:this instanceof ut?void(this._wrapped=t):new ut(t)}function lt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,et(t))}ut.VERSION=i,ut.prototype.value=function(){return this._wrapped},ut.prototype.valueOf=ut.prototype.toJSON=ut.prototype.value,ut.prototype.toString=function(){return String(this._wrapped)};var dt="[object DataView]";function pt(t,e,s,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&ft(t,e,s,i)}function ft(t,e,s,i){t instanceof ut&&(t=t._wrapped),e instanceof ut&&(e=e._wrapped);var r=l.call(t);if(r!==l.call(e))return!1;if(z&&"[object Object]"==r&&K(t)){if(!K(e))return!1;r=dt}switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return c.valueOf.call(t)===c.valueOf.call(e);case"[object ArrayBuffer]":case dt:return ft(lt(t),lt(e),s,i)}var n="[object Array]"===r;if(!n&&rt(t)){if(et(t)!==et(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;n=!0}if(!n){if("object"!=typeof t||"object"!=typeof e)return!1;var o=t.constructor,a=e.constructor;if(o!==a&&!(H(o)&&o instanceof o&&H(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var h=(s=s||[]).length;h--;)if(s[h]===t)return i[h]===e;if(s.push(t),i.push(e),n){if((h=t.length)!==e.length)return!1;for(;h--;)if(!pt(t[h],e[h],s,i))return!1}else{var u,d=at(t);if(h=d.length,at(e).length!==h)return!1;for(;h--;)if(!q(e,u=d[h])||!pt(t[u],e[u],s,i))return!1}return s.pop(),i.pop(),!0}function mt(t,e){return pt(t,e)}function gt(t){if(!S(t))return[];var e=[];for(var s in t)e.push(s);return C&&ot(t,e),e}function bt(t){var e=nt(t);return function(s){if(null==s)return!1;var i=gt(s);if(nt(i))return!1;for(var r=0;r<e;r++)if(!H(s[t[r]]))return!1;return t!==At||!H(s[vt])}}var vt="forEach",yt=["clear","delete"],wt=["get","has","set"],Ct=yt.concat(vt,wt),At=yt.concat(wt),_t=["add"].concat(yt,vt,"has");const xt=W?bt(Ct):L("Map"),St=W?bt(At):L("WeakMap"),Tt=W?bt(_t):L("Set"),kt=L("WeakSet");function Et(t){for(var e=at(t),s=e.length,i=Array(s),r=0;r<s;r++)i[r]=t[e[r]];return i}function Dt(t){for(var e=at(t),s=e.length,i=Array(s),r=0;r<s;r++)i[r]=[e[r],t[e[r]]];return i}function Lt(t){for(var e={},s=at(t),i=0,r=s.length;i<r;i++)e[t[s[i]]]=s[i];return e}function Rt(t){var e=[];for(var s in t)H(t[s])&&e.push(s);return e.sort()}function Ot(t,e){return function(s){var i=arguments.length;if(e&&(s=Object(s)),i<2||null==s)return s;for(var r=1;r<i;r++)for(var n=arguments[r],o=t(n),a=o.length,c=0;c<a;c++){var h=o[c];e&&void 0!==s[h]||(s[h]=n[h])}return s}}const Pt=Ot(gt),It=Ot(at),Nt=Ot(gt,!0);function Mt(t){if(!S(t))return{};if(b)return b(t);var e=function(){};e.prototype=t;var s=new e;return e.prototype=null,s}function Bt(t,e){var s=Mt(t);return e&&It(s,e),s}function Ft(t){return S(t)?$(t)?t.slice():Pt({},t):t}function Ut(t,e){return e(t),t}function Ht(t){return $(t)?t:[t]}function jt(t){return ut.toPath(t)}function zt(t,e){for(var s=e.length,i=0;i<s;i++){if(null==t)return;t=t[e[i]]}return s?t:void 0}function Wt(t,e,s){var i=zt(t,jt(e));return k(i)?s:i}function Gt(t,e){for(var s=(e=jt(e)).length,i=0;i<s;i++){var r=e[i];if(!q(t,r))return!1;t=t[r]}return!!s}function Kt(t){return t}function $t(t){return t=It({},t),function(e){return ht(e,t)}}function qt(t){return t=jt(t),function(e){return zt(e,t)}}function Xt(t,e,s){if(void 0===e)return t;switch(null==s?3:s){case 1:return function(s){return t.call(e,s)};case 3:return function(s,i,r){return t.call(e,s,i,r)};case 4:return function(s,i,r,n){return t.call(e,s,i,r,n)}}return function(){return t.apply(e,arguments)}}function Vt(t,e,s){return null==t?Kt:H(t)?Xt(t,e,s):S(t)&&!$(t)?$t(t):qt(t)}function Yt(t,e){return Vt(t,e,1/0)}function Qt(t,e,s){return ut.iteratee!==Yt?ut.iteratee(t,e):Vt(t,e,s)}function Zt(t,e,s){e=Qt(e,s);for(var i=at(t),r=i.length,n={},o=0;o<r;o++){var a=i[o];n[a]=e(t[a],a,t)}return n}function Jt(){}function te(t){return null==t?Jt:function(e){return Wt(t,e)}}function ee(t,e,s){var i=Array(Math.max(0,t));e=Xt(e,s,1);for(var r=0;r<t;r++)i[r]=e(r);return i}function se(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}ut.toPath=Ht,ut.iteratee=Yt;const ie=Date.now||function(){return(new Date).getTime()};function re(t){var e=function(e){return t[e]},s="(?:"+at(t).join("|")+")",i=RegExp(s),r=RegExp(s,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}}const ne={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},oe=re(ne),ae=re(Lt(ne)),ce=ut.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var he=/(.)^/,ue={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},le=/\\|'|\r|\n|\u2028|\u2029/g;function de(t){return"\\"+ue[t]}var pe=/^\s*(\w|\$)+\s*$/;function fe(t,e,s){!e&&s&&(e=s),e=Nt({},e,ut.templateSettings);var i=RegExp([(e.escape||he).source,(e.interpolate||he).source,(e.evaluate||he).source].join("|")+"|$","g"),r=0,n="__p+='";t.replace(i,(function(e,s,i,o,a){return n+=t.slice(r,a).replace(le,de),r=a+e.length,s?n+="'+\n((__t=("+s+"))==null?'':_.escape(__t))+\n'":i?n+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(n+="';\n"+o+"\n__p+='"),e})),n+="';\n";var o,a=e.variable;if(a){if(!pe.test(a))throw new Error("variable is not a bare identifier: "+a)}else n="with(obj||{}){\n"+n+"}\n",a="obj";n="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+n+"return __p;\n";try{o=new Function(a,"_",n)}catch(t){throw t.source=n,t}var c=function(t){return o.call(this,t,ut)};return c.source="function("+a+"){\n"+n+"}",c}function me(t,e,s){var i=(e=jt(e)).length;if(!i)return H(s)?s.call(t):s;for(var r=0;r<i;r++){var n=null==t?void 0:t[e[r]];void 0===n&&(n=s,r=i),t=H(n)?n.call(t):n}return t}var ge=0;function be(t){var e=++ge+"";return t?t+e:e}function ve(t){var e=ut(t);return e._chain=!0,e}function ye(t,e,s,i,r){if(!(i instanceof e))return t.apply(s,r);var n=Mt(t.prototype),o=t.apply(n,r);return S(o)?o:n}var we=x((function(t,e){var s=we.placeholder,i=function(){for(var r=0,n=e.length,o=Array(n),a=0;a<n;a++)o[a]=e[a]===s?arguments[r++]:e[a];for(;r<arguments.length;)o.push(arguments[r++]);return ye(t,i,this,this,o)};return i}));we.placeholder=ut;const Ce=we,Ae=x((function(t,e,s){if(!H(t))throw new TypeError("Bind must be called on a function");var i=x((function(r){return ye(t,i,e,this,s.concat(r))}));return i})),_e=J(nt);function xe(t,e,s,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var r=i.length,n=0,o=nt(t);n<o;n++){var a=t[n];if(_e(a)&&($(a)||V(a)))if(e>1)xe(a,e-1,s,i),r=i.length;else for(var c=0,h=a.length;c<h;)i[r++]=a[c++];else s||(i[r++]=a)}return i}const Se=x((function(t,e){var s=(e=xe(e,!1,!1)).length;if(s<1)throw new Error("bindAll must be passed function names");for(;s--;){var i=e[s];t[i]=Ae(t[i],t)}return t}));function Te(t,e){var s=function(i){var r=s.cache,n=""+(e?e.apply(this,arguments):i);return q(r,n)||(r[n]=t.apply(this,arguments)),r[n]};return s.cache={},s}const ke=x((function(t,e,s){return setTimeout((function(){return t.apply(null,s)}),e)})),Ee=Ce(ke,ut,1);function De(t,e,s){var i,r,n,o,a=0;s||(s={});var c=function(){a=!1===s.leading?0:ie(),i=null,o=t.apply(r,n),i||(r=n=null)},h=function(){var h=ie();a||!1!==s.leading||(a=h);var u=e-(h-a);return r=this,n=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),a=h,o=t.apply(r,n),i||(r=n=null)):i||!1===s.trailing||(i=setTimeout(c,u)),o};return h.cancel=function(){clearTimeout(i),a=0,i=r=n=null},h}function Le(t,e,s){var i,r,n,o,a,c=function(){var h=ie()-r;e>h?i=setTimeout(c,e-h):(i=null,s||(o=t.apply(a,n)),i||(n=a=null))},h=x((function(h){return a=this,n=h,r=ie(),i||(i=setTimeout(c,e),s&&(o=t.apply(a,n))),o}));return h.cancel=function(){clearTimeout(i),i=n=a=null},h}function Re(t,e){return Ce(e,t)}function Oe(t){return function(){return!t.apply(this,arguments)}}function Pe(){var t=arguments,e=t.length-1;return function(){for(var s=e,i=t[e].apply(this,arguments);s--;)i=t[s].call(this,i);return i}}function Ie(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function Ne(t,e){var s;return function(){return--t>0&&(s=e.apply(this,arguments)),t<=1&&(e=null),s}}const Me=Ce(Ne,2);function Be(t,e,s){e=Qt(e,s);for(var i,r=at(t),n=0,o=r.length;n<o;n++)if(e(t[i=r[n]],i,t))return i}function Fe(t){return function(e,s,i){s=Qt(s,i);for(var r=nt(e),n=t>0?0:r-1;n>=0&&n<r;n+=t)if(s(e[n],n,e))return n;return-1}}const Ue=Fe(1),He=Fe(-1);function je(t,e,s,i){for(var r=(s=Qt(s,i,1))(e),n=0,o=nt(t);n<o;){var a=Math.floor((n+o)/2);s(t[a])<r?n=a+1:o=a}return n}function ze(t,e,s){return function(i,r,n){var o=0,a=nt(i);if("number"==typeof n)t>0?o=n>=0?n:Math.max(n+a,o):a=n>=0?Math.min(n+1,a):n+a+1;else if(s&&n&&a)return i[n=s(i,r)]===r?n:-1;if(r!=r)return(n=e(u.call(i,o,a),Q))>=0?n+o:-1;for(n=t>0?o:a-1;n>=0&&n<a;n+=t)if(i[n]===r)return n;return-1}}const We=ze(1,Ue,je),Ge=ze(-1,He);function Ke(t,e,s){var i=(_e(t)?Ue:Be)(t,e,s);if(void 0!==i&&-1!==i)return t[i]}function $e(t,e){return Ke(t,$t(e))}function qe(t,e,s){var i,r;if(e=Xt(e,s),_e(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var n=at(t);for(i=0,r=n.length;i<r;i++)e(t[n[i]],n[i],t)}return t}function Xe(t,e,s){e=Qt(e,s);for(var i=!_e(t)&&at(t),r=(i||t).length,n=Array(r),o=0;o<r;o++){var a=i?i[o]:o;n[o]=e(t[a],a,t)}return n}function Ve(t){return function(e,s,i,r){var n=arguments.length>=3;return function(e,s,i,r){var n=!_e(e)&&at(e),o=(n||e).length,a=t>0?0:o-1;for(r||(i=e[n?n[a]:a],a+=t);a>=0&&a<o;a+=t){var c=n?n[a]:a;i=s(i,e[c],c,e)}return i}(e,Xt(s,r,4),i,n)}}const Ye=Ve(1),Qe=Ve(-1);function Ze(t,e,s){var i=[];return e=Qt(e,s),qe(t,(function(t,s,r){e(t,s,r)&&i.push(t)})),i}function Je(t,e,s){return Ze(t,Oe(Qt(e)),s)}function ts(t,e,s){e=Qt(e,s);for(var i=!_e(t)&&at(t),r=(i||t).length,n=0;n<r;n++){var o=i?i[n]:n;if(!e(t[o],o,t))return!1}return!0}function es(t,e,s){e=Qt(e,s);for(var i=!_e(t)&&at(t),r=(i||t).length,n=0;n<r;n++){var o=i?i[n]:n;if(e(t[o],o,t))return!0}return!1}function ss(t,e,s,i){return _e(t)||(t=Et(t)),("number"!=typeof s||i)&&(s=0),We(t,e,s)>=0}const is=x((function(t,e,s){var i,r;return H(e)?r=e:(e=jt(e),i=e.slice(0,-1),e=e[e.length-1]),Xe(t,(function(t){var n=r;if(!n){if(i&&i.length&&(t=zt(t,i)),null==t)return;n=t[e]}return null==n?n:n.apply(t,s)}))}));function rs(t,e){return Xe(t,qt(e))}function ns(t,e){return Ze(t,$t(e))}function os(t,e,s){var i,r,n=-1/0,o=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,c=(t=_e(t)?t:Et(t)).length;a<c;a++)null!=(i=t[a])&&i>n&&(n=i);else e=Qt(e,s),qe(t,(function(t,s,i){((r=e(t,s,i))>o||r===-1/0&&n===-1/0)&&(n=t,o=r)}));return n}function as(t,e,s){var i,r,n=1/0,o=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,c=(t=_e(t)?t:Et(t)).length;a<c;a++)null!=(i=t[a])&&i<n&&(n=i);else e=Qt(e,s),qe(t,(function(t,s,i){((r=e(t,s,i))<o||r===1/0&&n===1/0)&&(n=t,o=r)}));return n}var cs=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function hs(t){return t?$(t)?u.call(t):R(t)?t.match(cs):_e(t)?Xe(t,Kt):Et(t):[]}function us(t,e,s){if(null==e||s)return _e(t)||(t=Et(t)),t[se(t.length-1)];var i=hs(t),r=nt(i);e=Math.max(Math.min(e,r),0);for(var n=r-1,o=0;o<e;o++){var a=se(o,n),c=i[o];i[o]=i[a],i[a]=c}return i.slice(0,e)}function ls(t){return us(t,1/0)}function ds(t,e,s){var i=0;return e=Qt(e,s),rs(Xe(t,(function(t,s,r){return{value:t,index:i++,criteria:e(t,s,r)}})).sort((function(t,e){var s=t.criteria,i=e.criteria;if(s!==i){if(s>i||void 0===s)return 1;if(s<i||void 0===i)return-1}return t.index-e.index})),"value")}function ps(t,e){return function(s,i,r){var n=e?[[],[]]:{};return i=Qt(i,r),qe(s,(function(e,r){var o=i(e,r,s);t(n,e,o)})),n}}const fs=ps((function(t,e,s){q(t,s)?t[s].push(e):t[s]=[e]})),ms=ps((function(t,e,s){t[s]=e})),gs=ps((function(t,e,s){q(t,s)?t[s]++:t[s]=1})),bs=ps((function(t,e,s){t[s?0:1].push(e)}),!0);function vs(t){return null==t?0:_e(t)?t.length:at(t).length}function ys(t,e,s){return e in s}const ws=x((function(t,e){var s={},i=e[0];if(null==t)return s;H(i)?(e.length>1&&(i=Xt(i,e[1])),e=gt(t)):(i=ys,e=xe(e,!1,!1),t=Object(t));for(var r=0,n=e.length;r<n;r++){var o=e[r],a=t[o];i(a,o,t)&&(s[o]=a)}return s})),Cs=x((function(t,e){var s,i=e[0];return H(i)?(i=Oe(i),e.length>1&&(s=e[1])):(e=Xe(xe(e,!1,!1),String),i=function(t,s){return!ss(e,s)}),ws(t,i,s)}));function As(t,e,s){return u.call(t,0,Math.max(0,t.length-(null==e||s?1:e)))}function _s(t,e,s){return null==t||t.length<1?null==e||s?void 0:[]:null==e||s?t[0]:As(t,t.length-e)}function xs(t,e,s){return u.call(t,null==e||s?1:e)}function Ss(t,e,s){return null==t||t.length<1?null==e||s?void 0:[]:null==e||s?t[t.length-1]:xs(t,Math.max(0,t.length-e))}function Ts(t){return Ze(t,Boolean)}function ks(t,e){return xe(t,e,!1)}const Es=x((function(t,e){return e=xe(e,!0,!0),Ze(t,(function(t){return!ss(e,t)}))})),Ds=x((function(t,e){return Es(t,e)}));function Ls(t,e,s,i){E(e)||(i=s,s=e,e=!1),null!=s&&(s=Qt(s,i));for(var r=[],n=[],o=0,a=nt(t);o<a;o++){var c=t[o],h=s?s(c,o,t):c;e&&!s?(o&&n===h||r.push(c),n=h):s?ss(n,h)||(n.push(h),r.push(c)):ss(r,c)||r.push(c)}return r}const Rs=x((function(t){return Ls(xe(t,!0,!0))}));function Os(t){for(var e=[],s=arguments.length,i=0,r=nt(t);i<r;i++){var n=t[i];if(!ss(e,n)){var o;for(o=1;o<s&&ss(arguments[o],n);o++);o===s&&e.push(n)}}return e}function Ps(t){for(var e=t&&os(t,nt).length||0,s=Array(e),i=0;i<e;i++)s[i]=rs(t,i);return s}const Is=x(Ps);function Ns(t,e){for(var s={},i=0,r=nt(t);i<r;i++)e?s[t[i]]=e[i]:s[t[i][0]]=t[i][1];return s}function Ms(t,e,s){null==e&&(e=t||0,t=0),s||(s=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/s),0),r=Array(i),n=0;n<i;n++,t+=s)r[n]=t;return r}function Bs(t,e){if(null==e||e<1)return[];for(var s=[],i=0,r=t.length;i<r;)s.push(u.call(t,i,i+=e));return s}function Fs(t,e){return t._chain?ut(e).chain():e}function Us(t){return qe(Rt(t),(function(e){var s=ut[e]=t[e];ut.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),Fs(this,s.apply(ut,t))}})),ut}qe(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=o[t];ut.prototype[t]=function(){var s=this._wrapped;return null!=s&&(e.apply(s,arguments),"shift"!==t&&"splice"!==t||0!==s.length||delete s[0]),Fs(this,s)}})),qe(["concat","join","slice"],(function(t){var e=o[t];ut.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Fs(this,t)}}));const Hs=ut;var js=Us(t);js._=js;const zs=js;var Ws="top",Gs="bottom",Ks="right",$s="left",qs="auto",Xs=[Ws,Gs,Ks,$s],Vs="start",Ys="end",Qs="clippingParents",Zs="viewport",Js="popper",ti="reference",ei=Xs.reduce((function(t,e){return t.concat([e+"-"+Vs,e+"-"+Ys])}),[]),si=[].concat(Xs,[qs]).reduce((function(t,e){return t.concat([e,e+"-"+Vs,e+"-"+Ys])}),[]),ii="beforeRead",ri="read",ni="afterRead",oi="beforeMain",ai="main",ci="afterMain",hi="beforeWrite",ui="write",li="afterWrite",di=[ii,ri,ni,oi,ai,ci,hi,ui,li];function pi(t){return t?(t.nodeName||"").toLowerCase():null}function fi(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function mi(t){return t instanceof fi(t).Element||t instanceof Element}function gi(t){return t instanceof fi(t).HTMLElement||t instanceof HTMLElement}function bi(t){return"undefined"!=typeof ShadowRoot&&(t instanceof fi(t).ShadowRoot||t instanceof ShadowRoot)}const vi={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var s=e.styles[t]||{},i=e.attributes[t]||{},r=e.elements[t];gi(r)&&pi(r)&&(Object.assign(r.style,s),Object.keys(i).forEach((function(t){var e=i[t];!1===e?r.removeAttribute(t):r.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,s={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,s.popper),e.styles=s,e.elements.arrow&&Object.assign(e.elements.arrow.style,s.arrow),function(){Object.keys(e.elements).forEach((function(t){var i=e.elements[t],r=e.attributes[t]||{},n=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:s[t]).reduce((function(t,e){return t[e]="",t}),{});gi(i)&&pi(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(t){i.removeAttribute(t)})))}))}},requires:["computeStyles"]};function yi(t){return t.split("-")[0]}var wi=Math.max,Ci=Math.min,Ai=Math.round;function _i(){var t=navigator.userAgentData;return null!=t&&t.brands&&Array.isArray(t.brands)?t.brands.map((function(t){return t.brand+"/"+t.version})).join(" "):navigator.userAgent}function xi(){return!/^((?!chrome|android).)*safari/i.test(_i())}function Si(t,e,s){void 0===e&&(e=!1),void 0===s&&(s=!1);var i=t.getBoundingClientRect(),r=1,n=1;e&&gi(t)&&(r=t.offsetWidth>0&&Ai(i.width)/t.offsetWidth||1,n=t.offsetHeight>0&&Ai(i.height)/t.offsetHeight||1);var o=(mi(t)?fi(t):window).visualViewport,a=!xi()&&s,c=(i.left+(a&&o?o.offsetLeft:0))/r,h=(i.top+(a&&o?o.offsetTop:0))/n,u=i.width/r,l=i.height/n;return{width:u,height:l,top:h,right:c+u,bottom:h+l,left:c,x:c,y:h}}function Ti(t){var e=Si(t),s=t.offsetWidth,i=t.offsetHeight;return Math.abs(e.width-s)<=1&&(s=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:t.offsetLeft,y:t.offsetTop,width:s,height:i}}function ki(t,e){var s=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(s&&bi(s)){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Ei(t){return fi(t).getComputedStyle(t)}function Di(t){return["table","td","th"].indexOf(pi(t))>=0}function Li(t){return((mi(t)?t.ownerDocument:t.document)||window.document).documentElement}function Ri(t){return"html"===pi(t)?t:t.assignedSlot||t.parentNode||(bi(t)?t.host:null)||Li(t)}function Oi(t){return gi(t)&&"fixed"!==Ei(t).position?t.offsetParent:null}function Pi(t){for(var e=fi(t),s=Oi(t);s&&Di(s)&&"static"===Ei(s).position;)s=Oi(s);return s&&("html"===pi(s)||"body"===pi(s)&&"static"===Ei(s).position)?e:s||function(t){var e=/firefox/i.test(_i());if(/Trident/i.test(_i())&&gi(t)&&"fixed"===Ei(t).position)return null;var s=Ri(t);for(bi(s)&&(s=s.host);gi(s)&&["html","body"].indexOf(pi(s))<0;){var i=Ei(s);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||e&&"filter"===i.willChange||e&&i.filter&&"none"!==i.filter)return s;s=s.parentNode}return null}(t)||e}function Ii(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Ni(t,e,s){return wi(t,Ci(e,s))}function Mi(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function Bi(t,e){return e.reduce((function(e,s){return e[s]=t,e}),{})}const Fi={name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,s=t.state,i=t.name,r=t.options,n=s.elements.arrow,o=s.modifiersData.popperOffsets,a=yi(s.placement),c=Ii(a),h=[$s,Ks].indexOf(a)>=0?"height":"width";if(n&&o){var u=function(t,e){return Mi("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:Bi(t,Xs))}(r.padding,s),l=Ti(n),d="y"===c?Ws:$s,p="y"===c?Gs:Ks,f=s.rects.reference[h]+s.rects.reference[c]-o[c]-s.rects.popper[h],m=o[c]-s.rects.reference[c],g=Pi(n),b=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,v=f/2-m/2,y=u[d],w=b-l[h]-u[p],C=b/2-l[h]/2+v,A=Ni(y,C,w),_=c;s.modifiersData[i]=((e={})[_]=A,e.centerOffset=A-C,e)}},effect:function(t){var e=t.state,s=t.options.element,i=void 0===s?"[data-popper-arrow]":s;null!=i&&("string"!=typeof i||(i=e.elements.popper.querySelector(i)))&&ki(e.elements.popper,i)&&(e.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ui(t){return t.split("-")[1]}var Hi={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ji(t){var e,s=t.popper,i=t.popperRect,r=t.placement,n=t.variation,o=t.offsets,a=t.position,c=t.gpuAcceleration,h=t.adaptive,u=t.roundOffsets,l=t.isFixed,d=o.x,p=void 0===d?0:d,f=o.y,m=void 0===f?0:f,g="function"==typeof u?u({x:p,y:m}):{x:p,y:m};p=g.x,m=g.y;var b=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),y=$s,w=Ws,C=window;if(h){var A=Pi(s),_="clientHeight",x="clientWidth";if(A===fi(s)&&"static"!==Ei(A=Li(s)).position&&"absolute"===a&&(_="scrollHeight",x="scrollWidth"),r===Ws||(r===$s||r===Ks)&&n===Ys)w=Gs,m-=(l&&A===C&&C.visualViewport?C.visualViewport.height:A[_])-i.height,m*=c?1:-1;if(r===$s||(r===Ws||r===Gs)&&n===Ys)y=Ks,p-=(l&&A===C&&C.visualViewport?C.visualViewport.width:A[x])-i.width,p*=c?1:-1}var S,T=Object.assign({position:a},h&&Hi),k=!0===u?function(t,e){var s=t.x,i=t.y,r=e.devicePixelRatio||1;return{x:Ai(s*r)/r||0,y:Ai(i*r)/r||0}}({x:p,y:m},fi(s)):{x:p,y:m};return p=k.x,m=k.y,c?Object.assign({},T,((S={})[w]=v?"0":"",S[y]=b?"0":"",S.transform=(C.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",S)):Object.assign({},T,((e={})[w]=v?m+"px":"",e[y]=b?p+"px":"",e.transform="",e))}const zi={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,s=t.options,i=s.gpuAcceleration,r=void 0===i||i,n=s.adaptive,o=void 0===n||n,a=s.roundOffsets,c=void 0===a||a,h={placement:yi(e.placement),variation:Ui(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,ji(Object.assign({},h,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:c})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,ji(Object.assign({},h,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}};var Wi={passive:!0};const Gi={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,s=t.instance,i=t.options,r=i.scroll,n=void 0===r||r,o=i.resize,a=void 0===o||o,c=fi(e.elements.popper),h=[].concat(e.scrollParents.reference,e.scrollParents.popper);return n&&h.forEach((function(t){t.addEventListener("scroll",s.update,Wi)})),a&&c.addEventListener("resize",s.update,Wi),function(){n&&h.forEach((function(t){t.removeEventListener("scroll",s.update,Wi)})),a&&c.removeEventListener("resize",s.update,Wi)}},data:{}};var Ki={left:"right",right:"left",bottom:"top",top:"bottom"};function $i(t){return t.replace(/left|right|bottom|top/g,(function(t){return Ki[t]}))}var qi={start:"end",end:"start"};function Xi(t){return t.replace(/start|end/g,(function(t){return qi[t]}))}function Vi(t){var e=fi(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Yi(t){return Si(Li(t)).left+Vi(t).scrollLeft}function Qi(t){var e=Ei(t),s=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(s+r+i)}function Zi(t){return["html","body","#document"].indexOf(pi(t))>=0?t.ownerDocument.body:gi(t)&&Qi(t)?t:Zi(Ri(t))}function Ji(t,e){var s;void 0===e&&(e=[]);var i=Zi(t),r=i===(null==(s=t.ownerDocument)?void 0:s.body),n=fi(i),o=r?[n].concat(n.visualViewport||[],Qi(i)?i:[]):i,a=e.concat(o);return r?a:a.concat(Ji(Ri(o)))}function tr(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function er(t,e,s){return e===Zs?tr(function(t,e){var s=fi(t),i=Li(t),r=s.visualViewport,n=i.clientWidth,o=i.clientHeight,a=0,c=0;if(r){n=r.width,o=r.height;var h=xi();(h||!h&&"fixed"===e)&&(a=r.offsetLeft,c=r.offsetTop)}return{width:n,height:o,x:a+Yi(t),y:c}}(t,s)):mi(e)?function(t,e){var s=Si(t,!1,"fixed"===e);return s.top=s.top+t.clientTop,s.left=s.left+t.clientLeft,s.bottom=s.top+t.clientHeight,s.right=s.left+t.clientWidth,s.width=t.clientWidth,s.height=t.clientHeight,s.x=s.left,s.y=s.top,s}(e,s):tr(function(t){var e,s=Li(t),i=Vi(t),r=null==(e=t.ownerDocument)?void 0:e.body,n=wi(s.scrollWidth,s.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=wi(s.scrollHeight,s.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+Yi(t),c=-i.scrollTop;return"rtl"===Ei(r||s).direction&&(a+=wi(s.clientWidth,r?r.clientWidth:0)-n),{width:n,height:o,x:a,y:c}}(Li(t)))}function sr(t,e,s,i){var r="clippingParents"===e?function(t){var e=Ji(Ri(t)),s=["absolute","fixed"].indexOf(Ei(t).position)>=0&&gi(t)?Pi(t):t;return mi(s)?e.filter((function(t){return mi(t)&&ki(t,s)&&"body"!==pi(t)})):[]}(t):[].concat(e),n=[].concat(r,[s]),o=n[0],a=n.reduce((function(e,s){var r=er(t,s,i);return e.top=wi(r.top,e.top),e.right=Ci(r.right,e.right),e.bottom=Ci(r.bottom,e.bottom),e.left=wi(r.left,e.left),e}),er(t,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function ir(t){var e,s=t.reference,i=t.element,r=t.placement,n=r?yi(r):null,o=r?Ui(r):null,a=s.x+s.width/2-i.width/2,c=s.y+s.height/2-i.height/2;switch(n){case Ws:e={x:a,y:s.y-i.height};break;case Gs:e={x:a,y:s.y+s.height};break;case Ks:e={x:s.x+s.width,y:c};break;case $s:e={x:s.x-i.width,y:c};break;default:e={x:s.x,y:s.y}}var h=n?Ii(n):null;if(null!=h){var u="y"===h?"height":"width";switch(o){case Vs:e[h]=e[h]-(s[u]/2-i[u]/2);break;case Ys:e[h]=e[h]+(s[u]/2-i[u]/2)}}return e}function rr(t,e){void 0===e&&(e={});var s=e,i=s.placement,r=void 0===i?t.placement:i,n=s.strategy,o=void 0===n?t.strategy:n,a=s.boundary,c=void 0===a?Qs:a,h=s.rootBoundary,u=void 0===h?Zs:h,l=s.elementContext,d=void 0===l?Js:l,p=s.altBoundary,f=void 0!==p&&p,m=s.padding,g=void 0===m?0:m,b=Mi("number"!=typeof g?g:Bi(g,Xs)),v=d===Js?ti:Js,y=t.rects.popper,w=t.elements[f?v:d],C=sr(mi(w)?w:w.contextElement||Li(t.elements.popper),c,u,o),A=Si(t.elements.reference),_=ir({reference:A,element:y,strategy:"absolute",placement:r}),x=tr(Object.assign({},y,_)),S=d===Js?x:A,T={top:C.top-S.top+b.top,bottom:S.bottom-C.bottom+b.bottom,left:C.left-S.left+b.left,right:S.right-C.right+b.right},k=t.modifiersData.offset;if(d===Js&&k){var E=k[r];Object.keys(T).forEach((function(t){var e=[Ks,Gs].indexOf(t)>=0?1:-1,s=[Ws,Gs].indexOf(t)>=0?"y":"x";T[t]+=E[s]*e}))}return T}const nr={name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,s=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var r=s.mainAxis,n=void 0===r||r,o=s.altAxis,a=void 0===o||o,c=s.fallbackPlacements,h=s.padding,u=s.boundary,l=s.rootBoundary,d=s.altBoundary,p=s.flipVariations,f=void 0===p||p,m=s.allowedAutoPlacements,g=e.options.placement,b=yi(g),v=c||(b===g||!f?[$i(g)]:function(t){if(yi(t)===qs)return[];var e=$i(t);return[Xi(t),e,Xi(e)]}(g)),y=[g].concat(v).reduce((function(t,s){return t.concat(yi(s)===qs?function(t,e){void 0===e&&(e={});var s=e,i=s.placement,r=s.boundary,n=s.rootBoundary,o=s.padding,a=s.flipVariations,c=s.allowedAutoPlacements,h=void 0===c?si:c,u=Ui(i),l=u?a?ei:ei.filter((function(t){return Ui(t)===u})):Xs,d=l.filter((function(t){return h.indexOf(t)>=0}));0===d.length&&(d=l);var p=d.reduce((function(e,s){return e[s]=rr(t,{placement:s,boundary:r,rootBoundary:n,padding:o})[yi(s)],e}),{});return Object.keys(p).sort((function(t,e){return p[t]-p[e]}))}(e,{placement:s,boundary:u,rootBoundary:l,padding:h,flipVariations:f,allowedAutoPlacements:m}):s)}),[]),w=e.rects.reference,C=e.rects.popper,A=new Map,_=!0,x=y[0],S=0;S<y.length;S++){var T=y[S],k=yi(T),E=Ui(T)===Vs,D=[Ws,Gs].indexOf(k)>=0,L=D?"width":"height",R=rr(e,{placement:T,boundary:u,rootBoundary:l,altBoundary:d,padding:h}),O=D?E?Ks:$s:E?Gs:Ws;w[L]>C[L]&&(O=$i(O));var P=$i(O),I=[];if(n&&I.push(R[k]<=0),a&&I.push(R[O]<=0,R[P]<=0),I.every((function(t){return t}))){x=T,_=!1;break}A.set(T,I)}if(_)for(var N=function(t){var e=y.find((function(e){var s=A.get(e);if(s)return s.slice(0,t).every((function(t){return t}))}));if(e)return x=e,"break"},M=f?3:1;M>0;M--){if("break"===N(M))break}e.placement!==x&&(e.modifiersData[i]._skip=!0,e.placement=x,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function or(t,e,s){return void 0===s&&(s={x:0,y:0}),{top:t.top-e.height-s.y,right:t.right-e.width+s.x,bottom:t.bottom-e.height+s.y,left:t.left-e.width-s.x}}function ar(t){return[Ws,Ks,Gs,$s].some((function(e){return t[e]>=0}))}const cr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,s=t.name,i=e.rects.reference,r=e.rects.popper,n=e.modifiersData.preventOverflow,o=rr(e,{elementContext:"reference"}),a=rr(e,{altBoundary:!0}),c=or(o,i),h=or(a,r,n),u=ar(c),l=ar(h);e.modifiersData[s]={referenceClippingOffsets:c,popperEscapeOffsets:h,isReferenceHidden:u,hasPopperEscaped:l},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":l})}};const hr={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,s=t.options,i=t.name,r=s.offset,n=void 0===r?[0,0]:r,o=si.reduce((function(t,s){return t[s]=function(t,e,s){var i=yi(t),r=[$s,Ws].indexOf(i)>=0?-1:1,n="function"==typeof s?s(Object.assign({},e,{placement:t})):s,o=n[0],a=n[1];return o=o||0,a=(a||0)*r,[$s,Ks].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}(s,e.rects,n),t}),{}),a=o[e.placement],c=a.x,h=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=h),e.modifiersData[i]=o}};const ur={name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,s=t.name;e.modifiersData[s]=ir({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}};const lr={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,s=t.options,i=t.name,r=s.mainAxis,n=void 0===r||r,o=s.altAxis,a=void 0!==o&&o,c=s.boundary,h=s.rootBoundary,u=s.altBoundary,l=s.padding,d=s.tether,p=void 0===d||d,f=s.tetherOffset,m=void 0===f?0:f,g=rr(e,{boundary:c,rootBoundary:h,padding:l,altBoundary:u}),b=yi(e.placement),v=Ui(e.placement),y=!v,w=Ii(b),C="x"===w?"y":"x",A=e.modifiersData.popperOffsets,_=e.rects.reference,x=e.rects.popper,S="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,T="number"==typeof S?{mainAxis:S,altAxis:S}:Object.assign({mainAxis:0,altAxis:0},S),k=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,E={x:0,y:0};if(A){if(n){var D,L="y"===w?Ws:$s,R="y"===w?Gs:Ks,O="y"===w?"height":"width",P=A[w],I=P+g[L],N=P-g[R],M=p?-x[O]/2:0,B=v===Vs?_[O]:x[O],F=v===Vs?-x[O]:-_[O],U=e.elements.arrow,H=p&&U?Ti(U):{width:0,height:0},j=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},z=j[L],W=j[R],G=Ni(0,_[O],H[O]),K=y?_[O]/2-M-G-z-T.mainAxis:B-G-z-T.mainAxis,$=y?-_[O]/2+M+G+W+T.mainAxis:F+G+W+T.mainAxis,q=e.elements.arrow&&Pi(e.elements.arrow),X=q?"y"===w?q.clientTop||0:q.clientLeft||0:0,V=null!=(D=null==k?void 0:k[w])?D:0,Y=P+$-V,Q=Ni(p?Ci(I,P+K-V-X):I,P,p?wi(N,Y):N);A[w]=Q,E[w]=Q-P}if(a){var Z,J="x"===w?Ws:$s,tt="x"===w?Gs:Ks,et=A[C],st="y"===C?"height":"width",it=et+g[J],rt=et-g[tt],nt=-1!==[Ws,$s].indexOf(b),ot=null!=(Z=null==k?void 0:k[C])?Z:0,at=nt?it:et-_[st]-x[st]-ot+T.altAxis,ct=nt?et+_[st]+x[st]-ot-T.altAxis:rt,ht=p&&nt?function(t,e,s){var i=Ni(t,e,s);return i>s?s:i}(at,et,ct):Ni(p?at:it,et,p?ct:rt);A[C]=ht,E[C]=ht-et}e.modifiersData[i]=E}},requiresIfExists:["offset"]};function dr(t,e,s){void 0===s&&(s=!1);var i,r,n=gi(e),o=gi(e)&&function(t){var e=t.getBoundingClientRect(),s=Ai(e.width)/t.offsetWidth||1,i=Ai(e.height)/t.offsetHeight||1;return 1!==s||1!==i}(e),a=Li(e),c=Si(t,o,s),h={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(n||!n&&!s)&&(("body"!==pi(e)||Qi(a))&&(h=(i=e)!==fi(i)&&gi(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:Vi(i)),gi(e)?((u=Si(e,!0)).x+=e.clientLeft,u.y+=e.clientTop):a&&(u.x=Yi(a))),{x:c.left+h.scrollLeft-u.x,y:c.top+h.scrollTop-u.y,width:c.width,height:c.height}}function pr(t){var e=new Map,s=new Set,i=[];function r(t){s.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!s.has(t)){var i=e.get(t);i&&r(i)}})),i.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){s.has(t.name)||r(t)})),i}var fr={placement:"bottom",modifiers:[],strategy:"absolute"};function mr(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function gr(t){void 0===t&&(t={});var e=t,s=e.defaultModifiers,i=void 0===s?[]:s,r=e.defaultOptions,n=void 0===r?fr:r;return function(t,e,s){void 0===s&&(s=n);var r,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},fr,n),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},c=[],h=!1,u={state:a,setOptions:function(s){var r="function"==typeof s?s(a.options):s;l(),a.options=Object.assign({},n,a.options,r),a.scrollParents={reference:mi(t)?Ji(t):t.contextElement?Ji(t.contextElement):[],popper:Ji(e)};var o,h,d=function(t){var e=pr(t);return di.reduce((function(t,s){return t.concat(e.filter((function(t){return t.phase===s})))}),[])}((o=[].concat(i,a.options.modifiers),h=o.reduce((function(t,e){var s=t[e.name];return t[e.name]=s?Object.assign({},s,e,{options:Object.assign({},s.options,e.options),data:Object.assign({},s.data,e.data)}):e,t}),{}),Object.keys(h).map((function(t){return h[t]}))));return a.orderedModifiers=d.filter((function(t){return t.enabled})),a.orderedModifiers.forEach((function(t){var e=t.name,s=t.options,i=void 0===s?{}:s,r=t.effect;if("function"==typeof r){var n=r({state:a,name:e,instance:u,options:i}),o=function(){};c.push(n||o)}})),u.update()},forceUpdate:function(){if(!h){var t=a.elements,e=t.reference,s=t.popper;if(mr(e,s)){a.rects={reference:dr(e,Pi(s),"fixed"===a.options.strategy),popper:Ti(s)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(t){return a.modifiersData[t.name]=Object.assign({},t.data)}));for(var i=0;i<a.orderedModifiers.length;i++)if(!0!==a.reset){var r=a.orderedModifiers[i],n=r.fn,o=r.options,c=void 0===o?{}:o,l=r.name;"function"==typeof n&&(a=n({state:a,options:c,name:l,instance:u})||a)}else a.reset=!1,i=-1}}},update:(r=function(){return new Promise((function(t){u.forceUpdate(),t(a)}))},function(){return o||(o=new Promise((function(t){Promise.resolve().then((function(){o=void 0,t(r())}))}))),o}),destroy:function(){l(),h=!0}};if(!mr(t,e))return u;function l(){c.forEach((function(t){return t()})),c=[]}return u.setOptions(s).then((function(t){!h&&s.onFirstUpdate&&s.onFirstUpdate(t)})),u}}var br=gr(),vr=gr({defaultModifiers:[Gi,ur,zi,vi,hr,nr,lr,Fi,cr]}),yr=gr({defaultModifiers:[Gi,ur,zi,vi]});const wr=new Map,Cr={set(t,e,s){wr.has(t)||wr.set(t,new Map);const i=wr.get(t);i.has(e)||0===i.size?i.set(e,s):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(i.keys())[0]}.`)},get:(t,e)=>wr.has(t)&&wr.get(t).get(e)||null,remove(t,e){if(!wr.has(t))return;const s=wr.get(t);s.delete(e),0===s.size&&wr.delete(t)}},Ar="transitionend",_r=t=>(t&&window.CSS&&window.CSS.escape&&(t=t.replace(/#([^\s"#']+)/g,((t,e)=>`#${CSS.escape(e)}`))),t),xr=t=>null==t?`${t}`:Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase(),Sr=t=>{t.dispatchEvent(new Event(Ar))},Tr=t=>!(!t||"object"!=typeof t)&&(void 0!==t.jquery&&(t=t[0]),void 0!==t.nodeType),kr=t=>Tr(t)?t.jquery?t[0]:t:"string"==typeof t&&t.length>0?document.querySelector(_r(t)):null,Er=t=>{if(!Tr(t)||0===t.getClientRects().length)return!1;const e="visible"===getComputedStyle(t).getPropertyValue("visibility"),s=t.closest("details:not([open])");if(!s)return e;if(s!==t){const e=t.closest("summary");if(e&&e.parentNode!==s)return!1;if(null===e)return!1}return e},Dr=t=>!t||t.nodeType!==Node.ELEMENT_NODE||(!!t.classList.contains("disabled")||(void 0!==t.disabled?t.disabled:t.hasAttribute("disabled")&&"false"!==t.getAttribute("disabled"))),Lr=t=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof t.getRootNode){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?Lr(t.parentNode):null},Rr=()=>{},Or=t=>{t.offsetHeight},Pr=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Ir=[],Nr=()=>"rtl"===document.documentElement.dir,Mr=t=>{var e;e=()=>{const e=Pr();if(e){const s=t.NAME,i=e.fn[s];e.fn[s]=t.jQueryInterface,e.fn[s].Constructor=t,e.fn[s].noConflict=()=>(e.fn[s]=i,t.jQueryInterface)}},"loading"===document.readyState?(Ir.length||document.addEventListener("DOMContentLoaded",(()=>{for(const t of Ir)t()})),Ir.push(e)):e()},Br=(t,e=[],s=t)=>"function"==typeof t?t(...e):s,Fr=(t,e,s=!0)=>{if(!s)return void Br(t);const i=(t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:s}=window.getComputedStyle(t);const i=Number.parseFloat(e),r=Number.parseFloat(s);return i||r?(e=e.split(",")[0],s=s.split(",")[0],1e3*(Number.parseFloat(e)+Number.parseFloat(s))):0})(e)+5;let r=!1;const n=({target:s})=>{s===e&&(r=!0,e.removeEventListener(Ar,n),Br(t))};e.addEventListener(Ar,n),setTimeout((()=>{r||Sr(e)}),i)},Ur=(t,e,s,i)=>{const r=t.length;let n=t.indexOf(e);return-1===n?!s&&i?t[r-1]:t[0]:(n+=s?1:-1,i&&(n=(n+r)%r),t[Math.max(0,Math.min(n,r-1))])},Hr=/[^.]*(?=\..*)\.|.*/,jr=/\..*/,zr=/::\d+$/,Wr={};let Gr=1;const Kr={mouseenter:"mouseover",mouseleave:"mouseout"},$r=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function qr(t,e){return e&&`${e}::${Gr++}`||t.uidEvent||Gr++}function Xr(t){const e=qr(t);return t.uidEvent=e,Wr[e]=Wr[e]||{},Wr[e]}function Vr(t,e,s=null){return Object.values(t).find((t=>t.callable===e&&t.delegationSelector===s))}function Yr(t,e,s){const i="string"==typeof e,r=i?s:e||s;let n=tn(t);return $r.has(n)||(n=t),[i,r,n]}function Qr(t,e,s,i,r){if("string"!=typeof e||!t)return;let[n,o,a]=Yr(e,s,i);if(e in Kr){const t=t=>function(e){if(!e.relatedTarget||e.relatedTarget!==e.delegateTarget&&!e.delegateTarget.contains(e.relatedTarget))return t.call(this,e)};o=t(o)}const c=Xr(t),h=c[a]||(c[a]={}),u=Vr(h,o,n?s:null);if(u)return void(u.oneOff=u.oneOff&&r);const l=qr(o,e.replace(Hr,"")),d=n?function(t,e,s){return function i(r){const n=t.querySelectorAll(e);for(let{target:o}=r;o&&o!==this;o=o.parentNode)for(const a of n)if(a===o)return sn(r,{delegateTarget:o}),i.oneOff&&en.off(t,r.type,e,s),s.apply(o,[r])}}(t,s,o):function(t,e){return function s(i){return sn(i,{delegateTarget:t}),s.oneOff&&en.off(t,i.type,e),e.apply(t,[i])}}(t,o);d.delegationSelector=n?s:null,d.callable=o,d.oneOff=r,d.uidEvent=l,h[l]=d,t.addEventListener(a,d,n)}function Zr(t,e,s,i,r){const n=Vr(e[s],i,r);n&&(t.removeEventListener(s,n,Boolean(r)),delete e[s][n.uidEvent])}function Jr(t,e,s,i){const r=e[s]||{};for(const[n,o]of Object.entries(r))n.includes(i)&&Zr(t,e,s,o.callable,o.delegationSelector)}function tn(t){return t=t.replace(jr,""),Kr[t]||t}const en={on(t,e,s,i){Qr(t,e,s,i,!1)},one(t,e,s,i){Qr(t,e,s,i,!0)},off(t,e,s,i){if("string"!=typeof e||!t)return;const[r,n,o]=Yr(e,s,i),a=o!==e,c=Xr(t),h=c[o]||{},u=e.startsWith(".");if(void 0===n){if(u)for(const s of Object.keys(c))Jr(t,c,s,e.slice(1));for(const[s,i]of Object.entries(h)){const r=s.replace(zr,"");a&&!e.includes(r)||Zr(t,c,o,i.callable,i.delegationSelector)}}else{if(!Object.keys(h).length)return;Zr(t,c,o,n,r?s:null)}},trigger(t,e,s){if("string"!=typeof e||!t)return null;const i=Pr();let r=null,n=!0,o=!0,a=!1;e!==tn(e)&&i&&(r=i.Event(e,s),i(t).trigger(r),n=!r.isPropagationStopped(),o=!r.isImmediatePropagationStopped(),a=r.isDefaultPrevented());const c=sn(new Event(e,{bubbles:n,cancelable:!0}),s);return a&&c.preventDefault(),o&&t.dispatchEvent(c),c.defaultPrevented&&r&&r.preventDefault(),c}};function sn(t,e={}){for(const[s,i]of Object.entries(e))try{t[s]=i}catch(e){Object.defineProperty(t,s,{configurable:!0,get:()=>i})}return t}function rn(t){if("true"===t)return!0;if("false"===t)return!1;if(t===Number(t).toString())return Number(t);if(""===t||"null"===t)return null;if("string"!=typeof t)return t;try{return JSON.parse(decodeURIComponent(t))}catch(e){return t}}function nn(t){return t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`))}const on={setDataAttribute(t,e,s){t.setAttribute(`data-bs-${nn(e)}`,s)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${nn(e)}`)},getDataAttributes(t){if(!t)return{};const e={},s=Object.keys(t.dataset).filter((t=>t.startsWith("bs")&&!t.startsWith("bsConfig")));for(const i of s){let s=i.replace(/^bs/,"");s=s.charAt(0).toLowerCase()+s.slice(1,s.length),e[s]=rn(t.dataset[i])}return e},getDataAttribute:(t,e)=>rn(t.getAttribute(`data-bs-${nn(e)}`))};class an{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const s=Tr(e)?on.getDataAttribute(e,"config"):{};return{...this.constructor.Default,..."object"==typeof s?s:{},...Tr(e)?on.getDataAttributes(e):{},..."object"==typeof t?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[s,i]of Object.entries(e)){const e=t[s],r=Tr(e)?"element":xr(e);if(!new RegExp(i).test(r))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${s}" provided type "${r}" but expected type "${i}".`)}}}class cn extends an{constructor(t,e){super(),(t=kr(t))&&(this._element=t,this._config=this._getConfig(e),Cr.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Cr.remove(this._element,this.constructor.DATA_KEY),en.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,s=!0){Fr(t,e,s)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return Cr.get(kr(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,"object"==typeof e?e:null)}static get VERSION(){return"5.3.2"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const hn=t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){let s=t.getAttribute("href");if(!s||!s.includes("#")&&!s.startsWith("."))return null;s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),e=s&&"#"!==s?_r(s.trim()):null}return e},un={find:(t,e=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(e,t)),findOne:(t,e=document.documentElement)=>Element.prototype.querySelector.call(e,t),children:(t,e)=>[].concat(...t.children).filter((t=>t.matches(e))),parents(t,e){const s=[];let i=t.parentNode.closest(e);for(;i;)s.push(i),i=i.parentNode.closest(e);return s},prev(t,e){let s=t.previousElementSibling;for(;s;){if(s.matches(e))return[s];s=s.previousElementSibling}return[]},next(t,e){let s=t.nextElementSibling;for(;s;){if(s.matches(e))return[s];s=s.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((t=>`${t}:not([tabindex^="-"])`)).join(",");return this.find(e,t).filter((t=>!Dr(t)&&Er(t)))},getSelectorFromElement(t){const e=hn(t);return e&&un.findOne(e)?e:null},getElementFromSelector(t){const e=hn(t);return e?un.findOne(e):null},getMultipleElementsFromSelector(t){const e=hn(t);return e?un.find(e):[]}},ln=(t,e="hide")=>{const s=`click.dismiss${t.EVENT_KEY}`,i=t.NAME;en.on(document,s,`[data-bs-dismiss="${i}"]`,(function(s){if(["A","AREA"].includes(this.tagName)&&s.preventDefault(),Dr(this))return;const r=un.getElementFromSelector(this)||this.closest(`.${i}`);t.getOrCreateInstance(r)[e]()}))},dn=".bs.alert",pn=`close${dn}`,fn=`closed${dn}`;class mn extends cn{static get NAME(){return"alert"}close(){if(en.trigger(this._element,pn).defaultPrevented)return;this._element.classList.remove("show");const t=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,t)}_destroyElement(){this._element.remove(),en.trigger(this._element,fn),this.dispose()}static jQueryInterface(t){return this.each((function(){const e=mn.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}ln(mn,"close"),Mr(mn);const gn='[data-bs-toggle="button"]';class bn extends cn{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(t){return this.each((function(){const e=bn.getOrCreateInstance(this);"toggle"===t&&e[t]()}))}}en.on(document,"click.bs.button.data-api",gn,(t=>{t.preventDefault();const e=t.target.closest(gn);bn.getOrCreateInstance(e).toggle()})),Mr(bn);const vn=".bs.swipe",yn=`touchstart${vn}`,wn=`touchmove${vn}`,Cn=`touchend${vn}`,An=`pointerdown${vn}`,_n=`pointerup${vn}`,xn={endCallback:null,leftCallback:null,rightCallback:null},Sn={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Tn extends an{constructor(t,e){super(),this._element=t,t&&Tn.isSupported()&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return xn}static get DefaultType(){return Sn}static get NAME(){return"swipe"}dispose(){en.off(this._element,vn)}_start(t){this._supportPointerEvents?this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX):this._deltaX=t.touches[0].clientX}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),Br(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=40)return;const e=t/this._deltaX;this._deltaX=0,e&&Br(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(en.on(this._element,An,(t=>this._start(t))),en.on(this._element,_n,(t=>this._end(t))),this._element.classList.add("pointer-event")):(en.on(this._element,yn,(t=>this._start(t))),en.on(this._element,wn,(t=>this._move(t))),en.on(this._element,Cn,(t=>this._end(t))))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&("pen"===t.pointerType||"touch"===t.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const kn=".bs.carousel",En=".data-api",Dn="next",Ln="prev",Rn="left",On="right",Pn=`slide${kn}`,In=`slid${kn}`,Nn=`keydown${kn}`,Mn=`mouseenter${kn}`,Bn=`mouseleave${kn}`,Fn=`dragstart${kn}`,Un=`load${kn}${En}`,Hn=`click${kn}${En}`,jn="carousel",zn="active",Wn=".active",Gn=".carousel-item",Kn=Wn+Gn,$n={ArrowLeft:On,ArrowRight:Rn},qn={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Xn={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Vn extends cn{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=un.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===jn&&this.cycle()}static get Default(){return qn}static get DefaultType(){return Xn}static get NAME(){return"carousel"}next(){this._slide(Dn)}nextWhenVisible(){!document.hidden&&Er(this._element)&&this.next()}prev(){this._slide(Ln)}pause(){this._isSliding&&Sr(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?en.one(this._element,In,(()=>this.cycle())):this.cycle())}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding)return void en.one(this._element,In,(()=>this.to(t)));const s=this._getItemIndex(this._getActive());if(s===t)return;const i=t>s?Dn:Ln;this._slide(i,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&en.on(this._element,Nn,(t=>this._keydown(t))),"hover"===this._config.pause&&(en.on(this._element,Mn,(()=>this.pause())),en.on(this._element,Bn,(()=>this._maybeEnableCycle()))),this._config.touch&&Tn.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const t of un.find(".carousel-item img",this._element))en.on(t,Fn,(t=>t.preventDefault()));const t={leftCallback:()=>this._slide(this._directionToOrder(Rn)),rightCallback:()=>this._slide(this._directionToOrder(On)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),500+this._config.interval))}};this._swipeHelper=new Tn(this._element,t)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=$n[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=un.findOne(Wn,this._indicatorsElement);e.classList.remove(zn),e.removeAttribute("aria-current");const s=un.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);s&&(s.classList.add(zn),s.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const s=this._getActive(),i=t===Dn,r=e||Ur(this._getItems(),s,i,this._config.wrap);if(r===s)return;const n=this._getItemIndex(r),o=e=>en.trigger(this._element,e,{relatedTarget:r,direction:this._orderToDirection(t),from:this._getItemIndex(s),to:n});if(o(Pn).defaultPrevented)return;if(!s||!r)return;const a=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(n),this._activeElement=r;const c=i?"carousel-item-start":"carousel-item-end",h=i?"carousel-item-next":"carousel-item-prev";r.classList.add(h),Or(r),s.classList.add(c),r.classList.add(c);this._queueCallback((()=>{r.classList.remove(c,h),r.classList.add(zn),s.classList.remove(zn,h,c),this._isSliding=!1,o(In)}),s,this._isAnimated()),a&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return un.findOne(Kn,this._element)}_getItems(){return un.find(Gn,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return Nr()?t===Rn?Ln:Dn:t===Rn?Dn:Ln}_orderToDirection(t){return Nr()?t===Ln?Rn:On:t===Ln?On:Rn}static jQueryInterface(t){return this.each((function(){const e=Vn.getOrCreateInstance(this,t);if("number"!=typeof t){if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}else e.to(t)}))}}en.on(document,Hn,"[data-bs-slide], [data-bs-slide-to]",(function(t){const e=un.getElementFromSelector(this);if(!e||!e.classList.contains(jn))return;t.preventDefault();const s=Vn.getOrCreateInstance(e),i=this.getAttribute("data-bs-slide-to");return i?(s.to(i),void s._maybeEnableCycle()):"next"===on.getDataAttribute(this,"slide")?(s.next(),void s._maybeEnableCycle()):(s.prev(),void s._maybeEnableCycle())})),en.on(window,Un,(()=>{const t=un.find('[data-bs-ride="carousel"]');for(const e of t)Vn.getOrCreateInstance(e)})),Mr(Vn);const Yn=".bs.collapse",Qn=`show${Yn}`,Zn=`shown${Yn}`,Jn=`hide${Yn}`,to=`hidden${Yn}`,eo=`click${Yn}.data-api`,so="show",io="collapse",ro="collapsing",no=`:scope .${io} .${io}`,oo='[data-bs-toggle="collapse"]',ao={parent:null,toggle:!0},co={parent:"(null|element)",toggle:"boolean"};class ho extends cn{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const s=un.find(oo);for(const t of s){const e=un.getSelectorFromElement(t),s=un.find(e).filter((t=>t===this._element));null!==e&&s.length&&this._triggerArray.push(t)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return ao}static get DefaultType(){return co}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter((t=>t!==this._element)).map((t=>ho.getOrCreateInstance(t,{toggle:!1})))),t.length&&t[0]._isTransitioning)return;if(en.trigger(this._element,Qn).defaultPrevented)return;for(const e of t)e.hide();const e=this._getDimension();this._element.classList.remove(io),this._element.classList.add(ro),this._element.style[e]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const s=`scroll${e[0].toUpperCase()+e.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(ro),this._element.classList.add(io,so),this._element.style[e]="",en.trigger(this._element,Zn)}),this._element,!0),this._element.style[e]=`${this._element[s]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(en.trigger(this._element,Jn).defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,Or(this._element),this._element.classList.add(ro),this._element.classList.remove(io,so);for(const t of this._triggerArray){const e=un.getElementFromSelector(t);e&&!this._isShown(e)&&this._addAriaAndCollapsedClass([t],!1)}this._isTransitioning=!0;this._element.style[t]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(ro),this._element.classList.add(io),en.trigger(this._element,to)}),this._element,!0)}_isShown(t=this._element){return t.classList.contains(so)}_configAfterMerge(t){return t.toggle=Boolean(t.toggle),t.parent=kr(t.parent),t}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(oo);for(const e of t){const t=un.getElementFromSelector(e);t&&this._addAriaAndCollapsedClass([e],this._isShown(t))}}_getFirstLevelChildren(t){const e=un.find(no,this._config.parent);return un.find(t,this._config.parent).filter((t=>!e.includes(t)))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const s of t)s.classList.toggle("collapsed",!e),s.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return"string"==typeof t&&/show|hide/.test(t)&&(e.toggle=!1),this.each((function(){const s=ho.getOrCreateInstance(this,e);if("string"==typeof t){if(void 0===s[t])throw new TypeError(`No method named "${t}"`);s[t]()}}))}}en.on(document,eo,oo,(function(t){("A"===t.target.tagName||t.delegateTarget&&"A"===t.delegateTarget.tagName)&&t.preventDefault();for(const t of un.getMultipleElementsFromSelector(this))ho.getOrCreateInstance(t,{toggle:!1}).toggle()})),Mr(ho);const uo="dropdown",lo=".bs.dropdown",po=".data-api",fo="ArrowUp",mo="ArrowDown",go=`hide${lo}`,bo=`hidden${lo}`,vo=`show${lo}`,yo=`shown${lo}`,wo=`click${lo}${po}`,Co=`keydown${lo}${po}`,Ao=`keyup${lo}${po}`,_o="show",xo='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',So=`${xo}.${_o}`,To=".dropdown-menu",ko=Nr()?"top-end":"top-start",Eo=Nr()?"top-start":"top-end",Do=Nr()?"bottom-end":"bottom-start",Lo=Nr()?"bottom-start":"bottom-end",Ro=Nr()?"left-start":"right-start",Oo=Nr()?"right-start":"left-start",Po={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Io={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class No extends cn{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=un.next(this._element,To)[0]||un.prev(this._element,To)[0]||un.findOne(To,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Po}static get DefaultType(){return Io}static get NAME(){return uo}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Dr(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!en.trigger(this._element,vo,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const t of[].concat(...document.body.children))en.on(t,"mouseover",Rr);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(_o),this._element.classList.add(_o),en.trigger(this._element,yo,t)}}hide(){if(Dr(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!en.trigger(this._element,go,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))en.off(t,"mouseover",Rr);this._popper&&this._popper.destroy(),this._menu.classList.remove(_o),this._element.classList.remove(_o),this._element.setAttribute("aria-expanded","false"),on.removeDataAttribute(this._menu,"popper"),en.trigger(this._element,bo,t)}}_getConfig(t){if("object"==typeof(t=super._getConfig(t)).reference&&!Tr(t.reference)&&"function"!=typeof t.reference.getBoundingClientRect)throw new TypeError(`${uo.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(void 0===e)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;"parent"===this._config.reference?t=this._parent:Tr(this._config.reference)?t=kr(this._config.reference):"object"==typeof this._config.reference&&(t=this._config.reference);const s=this._getPopperConfig();this._popper=vr(t,this._menu,s)}_isShown(){return this._menu.classList.contains(_o)}_getPlacement(){const t=this._parent;if(t.classList.contains("dropend"))return Ro;if(t.classList.contains("dropstart"))return Oo;if(t.classList.contains("dropup-center"))return"top";if(t.classList.contains("dropdown-center"))return"bottom";const e="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return t.classList.contains("dropup")?e?Eo:ko:e?Lo:Do}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(on.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...Br(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:e}){const s=un.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((t=>Er(t)));s.length&&Ur(s,e,t===mo,!s.includes(e)).focus()}static jQueryInterface(t){return this.each((function(){const e=No.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}static clearMenus(t){if(2===t.button||"keyup"===t.type&&"Tab"!==t.key)return;const e=un.find(So);for(const s of e){const e=No.getInstance(s);if(!e||!1===e._config.autoClose)continue;const i=t.composedPath(),r=i.includes(e._menu);if(i.includes(e._element)||"inside"===e._config.autoClose&&!r||"outside"===e._config.autoClose&&r)continue;if(e._menu.contains(t.target)&&("keyup"===t.type&&"Tab"===t.key||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const n={relatedTarget:e._element};"click"===t.type&&(n.clickEvent=t),e._completeHide(n)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),s="Escape"===t.key,i=[fo,mo].includes(t.key);if(!i&&!s)return;if(e&&!s)return;t.preventDefault();const r=this.matches(xo)?this:un.prev(this,xo)[0]||un.next(this,xo)[0]||un.findOne(xo,t.delegateTarget.parentNode),n=No.getOrCreateInstance(r);if(i)return t.stopPropagation(),n.show(),void n._selectMenuItem(t);n._isShown()&&(t.stopPropagation(),n.hide(),r.focus())}}en.on(document,Co,xo,No.dataApiKeydownHandler),en.on(document,Co,To,No.dataApiKeydownHandler),en.on(document,wo,No.clearMenus),en.on(document,Ao,No.clearMenus),en.on(document,wo,xo,(function(t){t.preventDefault(),No.getOrCreateInstance(this).toggle()})),Mr(No);const Mo="backdrop",Bo="show",Fo=`mousedown.bs.${Mo}`,Uo={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Ho={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jo extends an{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return Uo}static get DefaultType(){return Ho}static get NAME(){return Mo}show(t){if(!this._config.isVisible)return void Br(t);this._append();const e=this._getElement();this._config.isAnimated&&Or(e),e.classList.add(Bo),this._emulateAnimation((()=>{Br(t)}))}hide(t){this._config.isVisible?(this._getElement().classList.remove(Bo),this._emulateAnimation((()=>{this.dispose(),Br(t)}))):Br(t)}dispose(){this._isAppended&&(en.off(this._element,Fo),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add("fade"),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=kr(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),en.on(t,Fo,(()=>{Br(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(t){Fr(t,this._getElement(),this._config.isAnimated)}}const zo=".bs.focustrap",Wo=`focusin${zo}`,Go=`keydown.tab${zo}`,Ko="backward",$o={autofocus:!0,trapElement:null},qo={autofocus:"boolean",trapElement:"element"};class Xo extends an{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return $o}static get DefaultType(){return qo}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),en.off(document,zo),en.on(document,Wo,(t=>this._handleFocusin(t))),en.on(document,Go,(t=>this._handleKeydown(t))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,en.off(document,zo))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const s=un.focusableChildren(e);0===s.length?e.focus():this._lastTabNavDirection===Ko?s[s.length-1].focus():s[0].focus()}_handleKeydown(t){"Tab"===t.key&&(this._lastTabNavDirection=t.shiftKey?Ko:"forward")}}const Vo=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Yo=".sticky-top",Qo="padding-right",Zo="margin-right";class Jo{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Qo,(e=>e+t)),this._setElementAttributes(Vo,Qo,(e=>e+t)),this._setElementAttributes(Yo,Zo,(e=>e-t))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Qo),this._resetElementAttributes(Vo,Qo),this._resetElementAttributes(Yo,Zo)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,s){const i=this.getWidth();this._applyManipulationCallback(t,(t=>{if(t!==this._element&&window.innerWidth>t.clientWidth+i)return;this._saveInitialAttribute(t,e);const r=window.getComputedStyle(t).getPropertyValue(e);t.style.setProperty(e,`${s(Number.parseFloat(r))}px`)}))}_saveInitialAttribute(t,e){const s=t.style.getPropertyValue(e);s&&on.setDataAttribute(t,e,s)}_resetElementAttributes(t,e){this._applyManipulationCallback(t,(t=>{const s=on.getDataAttribute(t,e);null!==s?(on.removeDataAttribute(t,e),t.style.setProperty(e,s)):t.style.removeProperty(e)}))}_applyManipulationCallback(t,e){if(Tr(t))e(t);else for(const s of un.find(t,this._element))e(s)}}const ta=".bs.modal",ea=`hide${ta}`,sa=`hidePrevented${ta}`,ia=`hidden${ta}`,ra=`show${ta}`,na=`shown${ta}`,oa=`resize${ta}`,aa=`click.dismiss${ta}`,ca=`mousedown.dismiss${ta}`,ha=`keydown.dismiss${ta}`,ua=`click${ta}.data-api`,la="modal-open",da="show",pa="modal-static",fa={backdrop:!0,focus:!0,keyboard:!0},ma={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ga extends cn{constructor(t,e){super(t,e),this._dialog=un.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Jo,this._addEventListeners()}static get Default(){return fa}static get DefaultType(){return ma}static get NAME(){return"modal"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||this._isTransitioning)return;en.trigger(this._element,ra,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(la),this._adjustDialog(),this._backdrop.show((()=>this._showElement(t))))}hide(){if(!this._isShown||this._isTransitioning)return;en.trigger(this._element,ea).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(da),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){en.off(window,ta),en.off(this._dialog,ta),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jo({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Xo({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=un.findOne(".modal-body",this._dialog);e&&(e.scrollTop=0),Or(this._element),this._element.classList.add(da);this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,en.trigger(this._element,na,{relatedTarget:t})}),this._dialog,this._isAnimated())}_addEventListeners(){en.on(this._element,ha,(t=>{"Escape"===t.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),en.on(window,oa,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),en.on(this._element,ca,(t=>{en.one(this._element,aa,(e=>{this._element===t.target&&this._element===e.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(la),this._resetAdjustments(),this._scrollBar.reset(),en.trigger(this._element,ia)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(en.trigger(this._element,sa).defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._element.style.overflowY;"hidden"===e||this._element.classList.contains(pa)||(t||(this._element.style.overflowY="hidden"),this._element.classList.add(pa),this._queueCallback((()=>{this._element.classList.remove(pa),this._queueCallback((()=>{this._element.style.overflowY=e}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),s=e>0;if(s&&!t){const t=Nr()?"paddingLeft":"paddingRight";this._element.style[t]=`${e}px`}if(!s&&t){const t=Nr()?"paddingRight":"paddingLeft";this._element.style[t]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each((function(){const s=ga.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===s[t])throw new TypeError(`No method named "${t}"`);s[t](e)}}))}}en.on(document,ua,'[data-bs-toggle="modal"]',(function(t){const e=un.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),en.one(e,ra,(t=>{t.defaultPrevented||en.one(e,ia,(()=>{Er(this)&&this.focus()}))}));const s=un.findOne(".modal.show");s&&ga.getInstance(s).hide();ga.getOrCreateInstance(e).toggle(this)})),ln(ga),Mr(ga);const ba=".bs.offcanvas",va=".data-api",ya=`load${ba}${va}`,wa="show",Ca="showing",Aa="hiding",_a=".offcanvas.show",xa=`show${ba}`,Sa=`shown${ba}`,Ta=`hide${ba}`,ka=`hidePrevented${ba}`,Ea=`hidden${ba}`,Da=`resize${ba}`,La=`click${ba}${va}`,Ra=`keydown.dismiss${ba}`,Oa={backdrop:!0,keyboard:!0,scroll:!1},Pa={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Ia extends cn{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Oa}static get DefaultType(){return Pa}static get NAME(){return"offcanvas"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown)return;if(en.trigger(this._element,xa,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||(new Jo).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Ca);this._queueCallback((()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(wa),this._element.classList.remove(Ca),en.trigger(this._element,Sa,{relatedTarget:t})}),this._element,!0)}hide(){if(!this._isShown)return;if(en.trigger(this._element,Ta).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Aa),this._backdrop.hide();this._queueCallback((()=>{this._element.classList.remove(wa,Aa),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new Jo).reset(),en.trigger(this._element,Ea)}),this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=Boolean(this._config.backdrop);return new jo({className:"offcanvas-backdrop",isVisible:t,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:t?()=>{"static"!==this._config.backdrop?this.hide():en.trigger(this._element,ka)}:null})}_initializeFocusTrap(){return new Xo({trapElement:this._element})}_addEventListeners(){en.on(this._element,Ra,(t=>{"Escape"===t.key&&(this._config.keyboard?this.hide():en.trigger(this._element,ka))}))}static jQueryInterface(t){return this.each((function(){const e=Ia.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}en.on(document,La,'[data-bs-toggle="offcanvas"]',(function(t){const e=un.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),Dr(this))return;en.one(e,Ea,(()=>{Er(this)&&this.focus()}));const s=un.findOne(_a);s&&s!==e&&Ia.getInstance(s).hide();Ia.getOrCreateInstance(e).toggle(this)})),en.on(window,ya,(()=>{for(const t of un.find(_a))Ia.getOrCreateInstance(t).show()})),en.on(window,Da,(()=>{for(const t of un.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(t).position&&Ia.getOrCreateInstance(t).hide()})),ln(Ia),Mr(Ia);const Na={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Ma=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Ba=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Fa=(t,e)=>{const s=t.nodeName.toLowerCase();return e.includes(s)?!Ma.has(s)||Boolean(Ba.test(t.nodeValue)):e.filter((t=>t instanceof RegExp)).some((t=>t.test(s)))};const Ua={allowList:Na,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Ha={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},ja={entry:"(string|element|function|null)",selector:"(string|element)"};class za extends an{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return Ua}static get DefaultType(){return Ha}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((t=>this._resolvePossibleFunction(t))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[e,s]of Object.entries(this._config.content))this._setContent(t,s,e);const e=t.children[0],s=this._resolvePossibleFunction(this._config.extraClass);return s&&e.classList.add(...s.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,s]of Object.entries(t))super._typeCheckConfig({selector:e,entry:s},ja)}_setContent(t,e,s){const i=un.findOne(s,t);i&&((e=this._resolvePossibleFunction(e))?Tr(e)?this._putElementInTemplate(kr(e),i):this._config.html?i.innerHTML=this._maybeSanitize(e):i.textContent=e:i.remove())}_maybeSanitize(t){return this._config.sanitize?function(t,e,s){if(!t.length)return t;if(s&&"function"==typeof s)return s(t);const i=(new window.DOMParser).parseFromString(t,"text/html"),r=[].concat(...i.body.querySelectorAll("*"));for(const t of r){const s=t.nodeName.toLowerCase();if(!Object.keys(e).includes(s)){t.remove();continue}const i=[].concat(...t.attributes),r=[].concat(e["*"]||[],e[s]||[]);for(const e of i)Fa(e,r)||t.removeAttribute(e.nodeName)}return i.body.innerHTML}(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return Br(t,[this])}_putElementInTemplate(t,e){if(this._config.html)return e.innerHTML="",void e.append(t);e.textContent=t.textContent}}const Wa=new Set(["sanitize","allowList","sanitizeFn"]),Ga="fade",Ka="show",$a=".modal",qa="hide.bs.modal",Xa="hover",Va="focus",Ya={AUTO:"auto",TOP:"top",RIGHT:Nr()?"left":"right",BOTTOM:"bottom",LEFT:Nr()?"right":"left"},Qa={allowList:Na,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Za={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Ja extends cn{constructor(t,s){if(void 0===e)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,s),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Qa}static get DefaultType(){return Za}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),en.off(this._element.closest($a),qa,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const t=en.trigger(this._element,this.constructor.eventName("show")),e=(Lr(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!e)return;this._disposePopper();const s=this._getTipElement();this._element.setAttribute("aria-describedby",s.getAttribute("id"));const{container:i}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(i.append(s),en.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(s),s.classList.add(Ka),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))en.on(t,"mouseover",Rr);this._queueCallback((()=>{en.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(en.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;if(this._getTipElement().classList.remove(Ka),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))en.off(t,"mouseover",Rr);this._activeTrigger.click=!1,this._activeTrigger[Va]=!1,this._activeTrigger[Xa]=!1,this._isHovered=null;this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),en.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(Ga,Ka),e.classList.add(`bs-${this.constructor.NAME}-auto`);const s=(t=>{do{t+=Math.floor(1e6*Math.random())}while(document.getElementById(t));return t})(this.constructor.NAME).toString();return e.setAttribute("id",s),this._isAnimated()&&e.classList.add(Ga),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new za({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Ga)}_isShown(){return this.tip&&this.tip.classList.contains(Ka)}_createPopper(t){const e=Br(this._config.placement,[this,t,this._element]),s=Ya[e.toUpperCase()];return vr(this._element,t,this._getPopperConfig(s))}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_resolvePossibleFunction(t){return Br(t,[this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:t=>{this._getTipElement().setAttribute("data-popper-placement",t.state.placement)}}]};return{...e,...Br(this._config.popperConfig,[e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if("click"===e)en.on(this._element,this.constructor.eventName("click"),this._config.selector,(t=>{this._initializeOnDelegatedTarget(t).toggle()}));else if("manual"!==e){const t=e===Xa?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),s=e===Xa?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");en.on(this._element,t,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusin"===t.type?Va:Xa]=!0,e._enter()})),en.on(this._element,s,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusout"===t.type?Va:Xa]=e._element.contains(t.relatedTarget),e._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},en.on(this._element.closest($a),qa,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=on.getDataAttributes(this._element);for(const t of Object.keys(e))Wa.has(t)&&delete e[t];return t={...e,..."object"==typeof t&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=!1===t.container?document.body:kr(t.container),"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,s]of Object.entries(this._config))this.constructor.Default[e]!==s&&(t[e]=s);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each((function(){const e=Ja.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}Mr(Ja);const tc={...Ja.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},ec={...Ja.DefaultType,content:"(null|string|element|function)"};class sc extends Ja{static get Default(){return tc}static get DefaultType(){return ec}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each((function(){const e=sc.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}Mr(sc);const ic=".bs.scrollspy",rc=`activate${ic}`,nc=`click${ic}`,oc=`load${ic}.data-api`,ac="active",cc="[href]",hc=".nav-link",uc=`${hc}, .nav-item > ${hc}, .list-group-item`,lc={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},dc={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class pc extends cn{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return lc}static get DefaultType(){return dc}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=kr(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,"string"==typeof t.threshold&&(t.threshold=t.threshold.split(",").map((t=>Number.parseFloat(t)))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(en.off(this._config.target,nc),en.on(this._config.target,nc,cc,(t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const s=this._rootElement||window,i=e.offsetTop-this._element.offsetTop;if(s.scrollTo)return void s.scrollTo({top:i,behavior:"smooth"});s.scrollTop=i}})))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((t=>this._observerCallback(t)),t)}_observerCallback(t){const e=t=>this._targetLinks.get(`#${t.target.id}`),s=t=>{this._previousScrollData.visibleEntryTop=t.target.offsetTop,this._process(e(t))},i=(this._rootElement||document.documentElement).scrollTop,r=i>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=i;for(const n of t){if(!n.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(n));continue}const t=n.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(r&&t){if(s(n),!i)return}else r||t||s(n)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=un.find(cc,this._config.target);for(const e of t){if(!e.hash||Dr(e))continue;const t=un.findOne(decodeURI(e.hash),this._element);Er(t)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,t))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(ac),this._activateParents(t),en.trigger(this._element,rc,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains("dropdown-item"))un.findOne(".dropdown-toggle",t.closest(".dropdown")).classList.add(ac);else for(const e of un.parents(t,".nav, .list-group"))for(const t of un.prev(e,uc))t.classList.add(ac)}_clearActiveClass(t){t.classList.remove(ac);const e=un.find(`${cc}.${ac}`,t);for(const t of e)t.classList.remove(ac)}static jQueryInterface(t){return this.each((function(){const e=pc.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}en.on(window,oc,(()=>{for(const t of un.find('[data-bs-spy="scroll"]'))pc.getOrCreateInstance(t)})),Mr(pc);const fc=".bs.tab",mc=`hide${fc}`,gc=`hidden${fc}`,bc=`show${fc}`,vc=`shown${fc}`,yc=`click${fc}`,wc=`keydown${fc}`,Cc=`load${fc}`,Ac="ArrowLeft",_c="ArrowRight",xc="ArrowUp",Sc="ArrowDown",Tc="Home",kc="End",Ec="active",Dc="fade",Lc="show",Rc=".dropdown-toggle",Oc=`:not(${Rc})`,Pc='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Ic=`${`.nav-link${Oc}, .list-group-item${Oc}, [role="tab"]${Oc}`}, ${Pc}`,Nc=`.${Ec}[data-bs-toggle="tab"], .${Ec}[data-bs-toggle="pill"], .${Ec}[data-bs-toggle="list"]`;class Mc extends cn{constructor(t){super(t),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),en.on(this._element,wc,(t=>this._keydown(t))))}static get NAME(){return"tab"}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),s=e?en.trigger(e,mc,{relatedTarget:t}):null;en.trigger(t,bc,{relatedTarget:e}).defaultPrevented||s&&s.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(Ec),this._activate(un.getElementFromSelector(t));this._queueCallback((()=>{"tab"===t.getAttribute("role")?(t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),en.trigger(t,vc,{relatedTarget:e})):t.classList.add(Lc)}),t,t.classList.contains(Dc))}_deactivate(t,e){if(!t)return;t.classList.remove(Ec),t.blur(),this._deactivate(un.getElementFromSelector(t));this._queueCallback((()=>{"tab"===t.getAttribute("role")?(t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),en.trigger(t,gc,{relatedTarget:e})):t.classList.remove(Lc)}),t,t.classList.contains(Dc))}_keydown(t){if(![Ac,_c,xc,Sc,Tc,kc].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter((t=>!Dr(t)));let s;if([Tc,kc].includes(t.key))s=e[t.key===Tc?0:e.length-1];else{const i=[_c,Sc].includes(t.key);s=Ur(e,t.target,i,!0)}s&&(s.focus({preventScroll:!0}),Mc.getOrCreateInstance(s).show())}_getChildren(){return un.find(Ic,this._parent)}_getActiveElem(){return this._getChildren().find((t=>this._elemIsActive(t)))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const t of e)this._setInitialAttributesOnChild(t)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),s=this._getOuterElement(t);t.setAttribute("aria-selected",e),s!==t&&this._setAttributeIfNotExists(s,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=un.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const s=this._getOuterElement(t);if(!s.classList.contains("dropdown"))return;const i=(t,i)=>{const r=un.findOne(t,s);r&&r.classList.toggle(i,e)};i(Rc,Ec),i(".dropdown-menu",Lc),s.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,s){t.hasAttribute(e)||t.setAttribute(e,s)}_elemIsActive(t){return t.classList.contains(Ec)}_getInnerElement(t){return t.matches(Ic)?t:un.findOne(Ic,t)}_getOuterElement(t){return t.closest(".nav-item, .list-group-item")||t}static jQueryInterface(t){return this.each((function(){const e=Mc.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}en.on(document,yc,Pc,(function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),Dr(this)||Mc.getOrCreateInstance(this).show()})),en.on(window,Cc,(()=>{for(const t of un.find(Nc))Mc.getOrCreateInstance(t)})),Mr(Mc);const Bc=".bs.toast",Fc=`mouseover${Bc}`,Uc=`mouseout${Bc}`,Hc=`focusin${Bc}`,jc=`focusout${Bc}`,zc=`hide${Bc}`,Wc=`hidden${Bc}`,Gc=`show${Bc}`,Kc=`shown${Bc}`,$c="hide",qc="show",Xc="showing",Vc={animation:"boolean",autohide:"boolean",delay:"number"},Yc={animation:!0,autohide:!0,delay:5e3};class Qc extends cn{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Yc}static get DefaultType(){return Vc}static get NAME(){return"toast"}show(){if(en.trigger(this._element,Gc).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add("fade");this._element.classList.remove($c),Or(this._element),this._element.classList.add(qc,Xc),this._queueCallback((()=>{this._element.classList.remove(Xc),en.trigger(this._element,Kc),this._maybeScheduleHide()}),this._element,this._config.animation)}hide(){if(!this.isShown())return;if(en.trigger(this._element,zc).defaultPrevented)return;this._element.classList.add(Xc),this._queueCallback((()=>{this._element.classList.add($c),this._element.classList.remove(Xc,qc),en.trigger(this._element,Wc)}),this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(qc),super.dispose()}isShown(){return this._element.classList.contains(qc)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":this._hasMouseInteraction=e;break;case"focusin":case"focusout":this._hasKeyboardInteraction=e}if(e)return void this._clearTimeout();const s=t.relatedTarget;this._element===s||this._element.contains(s)||this._maybeScheduleHide()}_setListeners(){en.on(this._element,Fc,(t=>this._onInteraction(t,!0))),en.on(this._element,Uc,(t=>this._onInteraction(t,!1))),en.on(this._element,Hc,(t=>this._onInteraction(t,!0))),en.on(this._element,jc,(t=>this._onInteraction(t,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each((function(){const e=Qc.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}var Zc;function Jc(){this.getInt=function(t,e){switch(e){case 4:return(255&this.data[t+3])<<24|(255&this.data[t+2])<<16|(255&this.data[t+1])<<8|255&this.data[t+0];case 2:return(255&this.data[t+1])<<8|255&this.data[t+0];default:return 255&this.data[t]}},this.getDOSDate=function(t,e){return new Date(1980+(t>>>9&127),(t>>>5&15)-1,31&t,e>>>11&31,e>>>5&63,2*(31&e))},this.stringOf=function(t,e){for(var s="";t!=e;)s+=String.fromCharCode(this.data[t++]);return s},this.open=function(t){if(this.data=t,this.files=[],this.data.length<22)return{status:!1,error:"Invalid data"};for(var e=this.data.length-22;e>=0&&101010256!=this.getInt(e,4);)--e;if(e<0)return{status:!1,error:"Invalid data"};if(0!==this.getInt(e+4,2)||0!==this.getInt(e+6,2))return{status:!1,error:"No multidisk support"};var s=this.getInt(e+8,2),i=this.getInt(e+16,4),r=this.getInt(e+20,2);this.comment=this.stringOf(e+22,e+22+r);for(var n=i,o=0;o<s;++o){if(33639248!=this.getInt(n+0,4))return{status:!1,error:"Invalid data"};if(this.getInt(n+6,2)>20)return{status:!1,error:"Unsupported version"};if(1&this.getInt(n+8,2))return{status:!1,error:"Encryption not implemented"};var a=this.getInt(n+10,2);if(0!==a&&8!==a)return{status:!1,error:"Unsupported compression method"};var c=this.getInt(n+12,2),h=this.getInt(n+14,2),u=this.getDOSDate(h,c),l=(this.getInt(n+16,4),this.getInt(n+20,4)),d=this.getInt(n+24,4),p=this.getInt(n+28,2),f=this.getInt(n+30,2),m=this.getInt(n+32,2),g=this.getInt(n+42,4),b=this.stringOf(n+46,n+46+p),v=this.stringOf(n+46+p+f,n+46+p+f+m);if(67324752!=this.getInt(g+0,4))return{status:!1,error:"Invalid data"};var y=g+30+this.getInt(g+26,2)+this.getInt(g+28,2);this.files[b]={fileComment:v,compressionMethod:a,compressedSize:l,uncompressedSize:d,localFileContent:y,lastModifiedDate:u},n+=46+p+f+m}return{status:!0}},this.read=function(t){var e=this.files[t];if(e){if(8==e.compressionMethod){Zc||(Zc=new th).init();var s=Zc.uncompress(this.data,e.localFileContent,e.uncompressedSize);return s.status==Zc.OK?{status:!0,data:s.data}:{status:!1,error:"deflate error "+s.status}}return{status:!0,data:this.data.subarray(e.localFileContent,e.localFileContent+e.uncompressedSize)}}return{status:!1,error:"File '"+t+"' doesn't exist in zip"}}}function th(){this.OK=0,this.DATA_ERROR=-3,this.TREE=function(){this.table=new Array(16),this.trans=new Array(288)},this.DATA=function(t){this.source="",this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=[],this.ltree=new t.TREE,this.dtree=new t.TREE},this.sltree=new this.TREE,this.sdtree=new this.TREE,this.length_bits=new Array(30),this.length_base=new Array(30),this.dist_bits=new Array(30),this.dist_base=new Array(30),this.clcidx=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],this.build_bits_base=function(t,e,s,i){var r,n;for(r=0;r<s;++r)t[r]=0;for(r=0;r<30-s;++r)t[r+s]=Math.floor(r/s);for(n=i,r=0;r<30;++r)e[r]=n,n+=1<<t[r]},this.build_fixed_trees=function(t,e){var s;for(s=0;s<7;++s)t.table[s]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,s=0;s<24;++s)t.trans[s]=256+s;for(s=0;s<144;++s)t.trans[24+s]=s;for(s=0;s<8;++s)t.trans[168+s]=280+s;for(s=0;s<112;++s)t.trans[176+s]=144+s;for(s=0;s<5;++s)e.table[s]=0;for(e.table[5]=32,s=0;s<32;++s)e.trans[s]=s},this.build_tree=function(t,e,s,i){var r,n,o=new Array(16);for(r=0;r<16;++r)t.table[r]=0;for(r=0;r<i;++r)t.table[e[s+r]]++;for(t.table[0]=0,n=0,r=0;r<16;++r)o[r]=n,n+=t.table[r];for(r=0;r<i;++r)e[s+r]&&(t.trans[o[e[s+r]]++]=r)},this.getbit=function(t){var e;return t.bitcount--||(t.tag=255&t.source[t.sourceIndex++],t.bitcount=7),e=1&t.tag,t.tag>>>=1,e},this.read_bits=function(t,e,s){if(!e)return s;for(;t.bitcount<24;)t.tag=t.tag|(255&t.source[t.sourceIndex++])<<t.bitcount,t.bitcount+=8;var i=t.tag&65535>>>16-e;return t.tag>>>=e,t.bitcount-=e,i+s},this.round_to_byte_boundary=function(t){for(;t.bitcount>=8;)t.sourceIndex--,t.bitcount-=8;t.bitcount=t.tag=0},this.decode_symbol=function(t,e){for(;t.bitcount<24;)t.tag=t.tag|(255&t.source[t.sourceIndex++])<<t.bitcount,t.bitcount+=8;var s=0,i=0,r=0;do{i=2*i+((t.tag&1<<r)>>>r),++r,s+=e.table[r],i-=e.table[r]}while(i>=0);return t.tag>>>=r,t.bitcount-=r,e.trans[s+i]},this.decode_trees=function(t,e,s){var i,r,n,o,a,c,h=new this.TREE,u=new Array(320);for(i=this.read_bits(t,5,257),r=this.read_bits(t,5,1),n=this.read_bits(t,4,4),o=0;o<19;++o)u[o]=0;for(o=0;o<n;++o){var l=this.read_bits(t,3,0);u[this.clcidx[o]]=l}for(this.build_tree(h,u,0,19),a=0;a<i+r;){var d=this.decode_symbol(t,h);switch(d){case 16:var p=u[a-1];for(c=this.read_bits(t,2,3);c;--c)u[a++]=p;break;case 17:for(c=this.read_bits(t,3,3);c;--c)u[a++]=0;break;case 18:for(c=this.read_bits(t,7,11);c;--c)u[a++]=0;break;default:u[a++]=d}}this.build_tree(e,u,0,i),this.build_tree(s,u,i,r)},this.inflate_block_data=function(t,e,s){for(var i=t.dest,r=t.destIndex;;){var n,o,a,c,h=this.decode_symbol(t,e);if(256==h)return t.destIndex=r,this.OK;if(h<256)i[r++]=h;else for(h-=257,n=this.read_bits(t,this.length_bits[h],this.length_base[h]),o=this.decode_symbol(t,s),c=a=r-(a=this.read_bits(t,this.dist_bits[o],this.dist_base[o],26116==r));c<a+n;++c)i[r++]=i[c]}},this.inflate_uncompressed_block=function(t){var e,s;if(this.round_to_byte_boundary(t),(e=256*(e=t.source[t.sourceIndex+1])+t.source[t.sourceIndex])!=(65535&~(256*t.source[t.sourceIndex+3]+t.source[t.sourceIndex+2])))return this.DATA_ERROR;for(t.sourceIndex+=4,s=e;s;--s)t.dest[t.destIndex++]=t.source[t.sourceIndex++];return t.bitcount=0,this.OK},this.inflate_fixed_block=function(t){return this.inflate_block_data(t,this.sltree,this.sdtree)},this.inflate_dynamic_block=function(t){return this.decode_trees(t,t.ltree,t.dtree),this.inflate_block_data(t,t.ltree,t.dtree)},this.init=function(){this.build_fixed_trees(this.sltree,this.sdtree),this.build_bits_base(this.length_bits,this.length_base,4,3),this.build_bits_base(this.dist_bits,this.dist_base,2,1),this.length_bits[28]=0,this.length_base[28]=258},this.uncompress=function(t,e,s){var i,r=new this.DATA(this);r.source=t,r.sourceIndex=e,r.bitcount=0,r.dest=new Uint8Array(s),r.destIndex=0;do{var n;switch(i=this.getbit(r),this.read_bits(r,2,0)){case 0:n=this.inflate_uncompressed_block(r);break;case 1:n=this.inflate_fixed_block(r);break;case 2:n=this.inflate_dynamic_block(r);break;default:return{status:this.DATA_ERROR}}if(n!=this.OK)return{status:this.DATA_ERROR}}while(!i);return this.round_to_byte_boundary(r),{status:this.OK,data:r.dest,offset:r.sourceIndex,dataSize:r.destIndex}}}ln(Qc),Mr(Qc);const eh="undefined"==typeof window;function sh(){return"undefined"!=typeof InstallTrigger}const ih=[],rh={SEMICOLON_PLUS:[7,5],MINUS:[7,1],LEFT_SQUARE_BRACKET:[8,3],RIGHT_SQUARE_BRACKET:[8,5],COMMA:[6,6],PERIOD:[7,6],SLASH:[8,6],SHIFTLOCK:[0,5],TAB:[0,6],RETURN:[9,4],DELETE:[9,5],COPY:[9,6],SHIFT:[0,0],ESCAPE:[0,7],CTRL:[1,0],CAPSLOCK:[0,4],LEFT:[9,1],UP:[9,3],RIGHT:[9,7],DOWN:[9,2],K0:[7,2],K1:[0,3],K2:[1,3],K3:[1,1],K4:[2,1],K5:[3,1],K6:[4,3],K7:[4,2],K8:[5,1],K9:[6,2],Q:[0,1],W:[1,2],E:[2,2],R:[3,3],T:[3,2],Y:[4,4],U:[5,3],I:[5,2],O:[6,3],P:[7,3],A:[1,4],S:[1,5],D:[2,3],F:[3,4],G:[3,5],H:[4,5],J:[5,4],K:[6,4],L:[6,5],Z:[1,6],X:[2,4],C:[2,5],V:[3,6],B:[4,6],N:[5,5],M:[5,6],F0:[0,2],F1:[1,7],F2:[2,7],F3:[3,7],F4:[4,1],F5:[4,7],F6:[5,7],F7:[6,1],F8:[6,7],F9:[7,7],SPACE:[2,6],UNDERSCORE_POUND:[8,2],AT:[7,4],COLON_STAR:[8,4],PIPE_BACKSLASH:[8,7],HAT_TILDE:[8,1],NUMPADPLUS:[10,3],NUMPADMINUS:[11,3],NUMPADSLASH:[10,4],NUMPADASTERISK:[11,5],NUMPAD7:[11,1],NUMPAD8:[10,2],NUMPAD9:[11,2],NUMPADHASH:[10,5],NUMPAD4:[10,7],NUMPAD5:[11,7],NUMPAD6:[10,1],NUMPAD_DELETE:[11,4],NUMPAD1:[11,6],NUMPAD2:[12,7],NUMPAD3:[12,6],NUMPADCOMMA:[12,5],NUMPAD0:[10,6],NUMPAD_DECIMAL_POINT:[12,4],NUMPADENTER:[12,3]};function nh(t){const e=[];let s=!1,i=!0;for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);let o=t.charAt(r),a=null,c=!1,h=!0;if(n>=65&&n<=90)a=rh[o];else if(n>=97&&n<=122)o=String.fromCharCode(n-32),a=rh[o],h=!1;else if(n>=48&&n<=57)a=rh["K"+o];else if(n>=33&&n<=41)o=String.fromCharCode(n+16),a=rh["K"+o],c=!0;else switch(o){case"\n":a=rh.RETURN;break;case"\t":a=rh.TAB;break;case" ":a=rh.SPACE;break;case"-":a=rh.MINUS;break;case"=":a=rh.MINUS,c=!0;break;case"^":a=rh.HAT_TILDE;break;case"~":a=rh.HAT_TILDE,c=!0;break;case"\\":a=rh.PIPE_BACKSLASH;break;case"|":a=rh.PIPE_BACKSLASH,c=!0;break;case"@":a=rh.AT;break;case"[":a=rh.LEFT_SQUARE_BRACKET;break;case"{":a=rh.LEFT_SQUARE_BRACKET,c=!0;break;case"_":a=rh.UNDERSCORE_POUND;break;case";":a=rh.SEMICOLON_PLUS;break;case"+":a=rh.SEMICOLON_PLUS,c=!0;break;case":":a=rh.COLON_STAR;break;case"*":a=rh.COLON_STAR,c=!0;break;case"]":a=rh.RIGHT_SQUARE_BRACKET;break;case"}":a=rh.RIGHT_SQUARE_BRACKET,c=!0;break;case",":a=rh.COMMA;break;case"<":a=rh.COMMA,c=!0;break;case".":a=rh.PERIOD;break;case">":a=rh.PERIOD,c=!0;break;case"/":a=rh.SLASH;break;case"?":a=rh.SLASH,c=!0}a&&((c&&!s||!c&&s)&&(e.push(rh.SHIFT),s=!s),(h&&!i||!h&&i)&&(e.push(rh.CAPSLOCK),i=!i),e.push(a))}return s&&e.push(rh.SHIFT),i||e.push(rh.CAPSLOCK),e}const oh={UNDEFINED:0,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,BREAK:19,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINTSCREEN:44,INSERT:45,DELETE:46,K0:48,K1:49,K2:50,K3:51,K4:52,K5:53,K6:54,K7:55,K8:56,K9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOWS:91,MENU:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPADASTERISK:106,NUMPADPLUS:107,NUMPAD_DECIMAL_COMMA:108,NUMPADMINUS:109,NUMPAD_DECIMAL_POINT:110,NUMPADSLASH:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,VOLUMEUP:174,VOLUMEDOWN:175,FASTFORWARD:176,FASTREWIND:177,PLAYPAUSE:179,COMMA:188,PERIOD:190,SLASH:191,LEFT_SQUARE_BRACKET:219,BACKSLASH:220,RIGHT_SQUARE_BRACKET:221,NUMPADENTER:255,SHIFT_LEFT:256,SHIFT_RIGHT:257,ALT_LEFT:258,ALT_RIGHT:259,CTRL_LEFT:260,CTRL_RIGHT:261};const ah="UK"===function(){if(eh)return"UK";if(localStorage.keyboardLayout)return"US"===localStorage.keyboardLayout?"US":"UK";if(navigator.language){if("en-gb"===navigator.language.toLowerCase())return"UK";if("en-us"===navigator.language.toLowerCase())return"US"}return"UK"}();function ch(t){return(t>>>4&15).toString(16)+(15&t).toString(16)}function hh(t){return ch(t>>>8)+ch(255&t)}function uh(t,e,s,i){const r=(i=i||{}).width||16,n=void 0===i.gap?8:i.gap,o=[];let a="",c=0;for(let i=e;i<s;++i)a+=" ",a+=ch(t(i)),++c===n&&(a+=" "),c===r&&(o.push(a),a="",c=0);a&&o.push(a);let h="";for(let t=0;t<o.length;++t)h+=hh(e+t*r)+" :"+o[t]+"\n";return h}function lh(t){return t>=128?t-256:t}function dh(){}function ph(t,e,s){!eh&&window.location.host.endsWith(".godbolt.org")&&gtag("send","event",t,e,s),console.log("event noted:",t,e,s)}sh()?(oh.SEMICOLON=59,oh.HASH=163,oh.APOSTROPHE=222,oh.BACK_QUOTE=192,oh.MUTE=-1,oh.MINUS=173,oh.EQUALS=61):(oh.SEMICOLON=186,oh.HASH=ah?222:223,oh.APOSTROPHE=ah?192:222,oh.MUTE=173,oh.MINUS=189,oh.EQUALS=187,oh.BACK_QUOTE=ah?223:192),eh||-1===window.navigator.userAgent.indexOf("Mac")||(oh.BACK_QUOTE=192,oh.APOSTROPHE=222,oh.HASH=223);let fh="";function mh(t){let e="";for(let s=0;s<t.length;++s)e+=String.fromCharCode(t[s]);return e}function gh(t){if(t instanceof Uint8Array)return t;const e=t.length,s=new Uint8Array(e);for(let i=0;i<e;++i)s[i]=255&t.charCodeAt(i);return s}function bh(t){return eh?async function(t){if("undefined"!=typeof readbuffer)return new Uint8Array(readbuffer(t));if("undefined"!=typeof read)return read(t,"binary");{const e=await Promise.resolve().then(r.t.bind(r,565,19));return"/"===t[0]&&(t="."+t),e.readFileSync(t)}}(t):function(t){return new Promise((function(e,s){const i=new XMLHttpRequest;i.open("GET",fh+t,!0),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onload=function(){200!==i.status&&s(new Error("Unable to load "+t+", http code "+i.status)),"string"!=typeof i.response?e(i.response):e(gh(i.response))},i.onerror=function(){s(new Error("A network error occurred loading "+t))},i.send(null)}))}(t)}function vh(t,e){return t[e+1]<<8|t[e+0]}const yh=new ArrayBuffer(4),wh=new Uint8Array(yh),Ch=new Float32Array(yh);function Ah(t,e,s){const i=this;if(i.name=t,i.pos=0,i.data=gh(e),!s&&i.data&&i.data.length>4&&31===i.data[0]&&139===i.data[1]&&(console.log("Ungzipping "+t),i.data=function(t){const e=new th;e.init();const s=[];for(;t.length;){if(s.length>1e3)throw new Error("Seems like something went wrong");if(31!==t[0]||139!==t[1])throw new Error("Corrupt data");let i=10;if(2&t[3]&&(i+=2),4&t[3]&&(i+=2+vh(t,i)),8&t[3]){for(;0!==t[i];)i++;i++}if(16&t[3]){for(;0!==t[i];)i++;i++}let r,n=16384;for(;;){if(r=e.uncompress(t,i,n),0!==r.status)throw"Unable to ungzip";if(r.dataSize<n)break;n*=2}s.push(r.data.subarray(0,r.dataSize));const o=r.offset+8;t=t.subarray(o)}const i=s.reduce((function(t,e){return t+e.length}),0),r=new Uint8Array(i);let n=0;return s.forEach((function(t){r.set(t,n),n+=t.length})),r}(i.data)),!i.data)throw new Error("No data in "+t);i.end=i.data.length,i.bytesLeft=function(){return i.end-i.pos},i.eof=function(){return 0===i.bytesLeft()},i.advance=function(t){if(i.bytesLeft()<t)throw new RangeError("EOF in "+i.name);return i.pos+=t,i.pos-t},i.readFloat32=function(t){return void 0===t&&(t=i.advance(4)),function(t,e){return wh[0]=t[e],wh[1]=t[e+1],wh[2]=t[e+2],wh[3]=t[e+3],Ch[0]}(i.data,t)},i.readInt32=function(t){return void 0===t&&(t=i.advance(4)),function(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e+0]}(i.data,t)},i.readInt16=function(t){return void 0===t&&(t=i.advance(2)),vh(i.data,t)},i.readByte=function(t){return void 0===t&&(t=i.advance(1)),i.data[t]},i.readNulString=function(t,e){e||(e=1024);let s,r=void 0===t?i.pos:t,n="";for(;0!==(s=i.readByte(r++))&&--e;)n+=String.fromCharCode(s);return 0===e?"":(void 0===t&&(i.pos=r),n)},i.substream=function(t,e){let s;if(void 0===e)e=t,s=i.advance(e);else if(s=t,s+e>=i.end)throw new RangeError("EOF in "+i.name);return new Ah(i.name+".sub",i.data.subarray(s,s+e))},i.seek=function(t){if(t>=i.end)throw new RangeError("Seek out of range in "+i.name);i.pos=t}}function _h(t){return new Int32Array(t.buffer)}const xh={uef:!0,ssd:!0,dsd:!0,adl:!0},Sh={rom:!0};function Th(t,e){const s=new Jc;console.log("Attempting to unzip");const i=s.open(t);if(!i.status)throw new Error("Error unzipping "+i.error);let r,n=null;for(const t in s.files){const i=t.match(/.*\.([a-z]+)/i);i&&e[i[1].toLowerCase()]?n?console.log("Ignoring",t,"as already found a file"):(r=t,n=s.read(t)):console.log("Skipping file",t)}if(!n)throw new Error("Couldn't find any compatible files in the archive");if(!n.status)throw new Error("Failed to uncompress file '"+r+"' - "+n.error);return console.log("Unzipped '"+r+"'"),{data:n.data,name:r}}function kh(t){return Th(t,xh)}function Eh(t){let e=!1,s=!1,i=204800,r=t.toLowerCase();return r.endsWith(".dsd")&&(i*=2,e=!0),r.endsWith(".adl")&&(i=655360,e=!0,s=!0),(r.endsWith(".adf")||r.endsWith(".adm"))&&(i=327680,e=!1,s=!0),{isDsd:e,isDoubleDensity:s,byteSize:i}}function Dh(t,e){for(let s=0;s<8;++s)t[s]=255&e.charCodeAt(s)}function Lh(t){this.buffer=new Uint8Array(t),this.size=0,this.wPtr=0,this.rPtr=0}Lh.prototype.full=function(){return this.size===this.buffer.length},Lh.prototype.empty=function(){return 0===this.size},Lh.prototype.clear=function(){this.size=0,this.wPtr=0,this.rPtr=0},Lh.prototype.put=function(t){this.full()||(this.buffer[this.wPtr%this.buffer.length]=t,this.wPtr++,this.size++)},Lh.prototype.get=function(){if(this.empty())return;const t=this.buffer[this.rPtr%this.buffer.length];return this.rPtr++,this.size--,t};class Rh{constructor(){this.prevCol=0,this.holdOff=!1,this.col=7,this.bg=0,this.sep=!1,this.dbl=this.oldDbl=this.secondHalfOfDouble=this.wasDbl=!1,this.gfx=!1,this.flash=this.flashOn=!1,this.flashTime=0,this.heldChar=!1,this.holdChar=0,this.dataQueue=[0,0,0,0],this.scanlineCounter=0,this.levelDEW=!1,this.levelDISPTMG=!1,this.levelRA0=!1,this.normalGlyphs=_h(new Uint32Array(1920)),this.graphicsGlyphs=_h(new Uint32Array(1920)),this.separatedGlyphs=_h(new Uint32Array(1920)),this.colour=_h(new Uint32Array(256)),this.nextGlyphs=this.normalGlyphs,this.curGlyphs=this.normalGlyphs,this.heldGlyphs=this.normalGlyphs,this.init()}init(){const t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,1,1,1,1,1,0,0,1,0,1,0,0,1,1,1,1,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0]),e=1/2.2;for(let t=0;t<256;++t){const s=(3&t)/3,i=!!(4&t),r=!!(8&t),n=!!(16&t),o=!!(32&t),a=!!(64&t),c=!!(128&t),h=240*Math.pow(i*s+o*(1-s),e),u=240*Math.pow(r*s+a*(1-s),e),l=240*Math.pow(n*s+c*(1-s),e);this.colour[t]=h|u<<8|l<<16|255<<24}function s(e,s){if(s<0||s>=20)return 0;{let i=60*e+6*(s>>>1),r=0;for(let e=0;e<6;++e)r|=3*t[i++]<<2*e;return r}}function i(t,e){let i=0;for(let o=0;o<96;++o)for(let a=0;a<20;++a){let c;!e||32&o?(r=s(o,a),n=s(o,a+(1&a?1:-1)),c=r|r>>>1&n&~(n>>>1)|r<<1&n&~(n<<1)):c=s(o,a),t[i++]=7*(1&c)+20*(2&c)+52*(4&c)+224*(8&c)+640*(16&c)+1664*(32&c)+7168*(64&c)+20480*(128&c)+53248*(256&c)+229376*(512&c)+655360*(1024&c)+1703936*(2048&c)}var r,n}function r(e,s,i,r,n,o,a){for(let c=0;c<n;++c)for(let h=0;h<r;++h)t[60*e+6*(i+c)+(s+h)]=!o||0!==h&&c!==n-1?a:0}i(this.normalGlyphs,!1);for(let t=0;t<96;++t)32&t||(r(t,0,0,3,3,!1,!!(1&t)),r(t,3,0,3,3,!1,!!(2&t)),r(t,0,3,3,4,!1,!!(4&t)),r(t,3,3,3,4,!1,!!(8&t)),r(t,0,7,3,3,!1,!!(16&t)),r(t,3,7,3,3,!1,!!(64&t)));i(this.graphicsGlyphs,!0);for(let t=0;t<96;++t)32&t||(r(t,0,0,3,3,!0,!!(1&t)),r(t,3,0,3,3,!0,!!(2&t)),r(t,0,3,3,4,!0,!!(4&t)),r(t,3,3,3,4,!0,!!(8&t)),r(t,0,7,3,3,!0,!!(16&t)),r(t,3,7,3,3,!0,!!(64&t)));i(this.separatedGlyphs,!0)}setNextChars(){this.gfx?this.sep?this.nextGlyphs=this.separatedGlyphs:this.nextGlyphs=this.graphicsGlyphs:this.nextGlyphs=this.normalGlyphs}handleControlCode(t){switch(this.holdOff=!1,t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:this.gfx=!1,this.col=t,this.setNextChars();break;case 8:this.flash=!0;break;case 9:this.flash=!1;break;case 12:case 13:this.dbl=!!(1&t),this.dbl&&(this.wasDbl=!0);break;case 17:case 18:case 19:case 20:case 21:case 22:case 23:this.gfx=!0,this.col=7&t,this.setNextChars();break;case 24:this.col=this.prevCol=this.bg;break;case 25:this.sep=!1,this.setNextChars();break;case 26:this.sep=!0,this.setNextChars();break;case 28:this.bg=0;break;case 29:this.bg=this.col;break;case 30:this.holdChar=!0;break;case 31:this.holdOff=!0}return this.holdChar&&this.dbl===this.oldDbl?((t=this.heldChar)>=64&&t<96&&(t=32),this.curGlyphs=this.heldGlyphs):(this.heldChar=32,t=32),t}fetchData(t){this.dataQueue.shift(),this.dataQueue.push(127&t)}setDEW(t){const e=this.levelDEW;this.levelDEW=t,e&&!t&&(this.scanlineCounter=0,this.secondHalfOfDouble=!1,64==++this.flashTime&&(this.flashTime=0),this.flashOn=this.flashTime<16)}setDISPTMG(t){const e=this.levelDISPTMG;this.levelDISPTMG=t,e&&!t&&(this.col=7,this.bg=0,this.holdChar=!1,this.heldChar=32,this.nextGlyphs=this.heldGlyphs=this.normalGlyphs,this.flash=!1,this.sep=!1,this.gfx=!1,this.dbl=!1,this.scanlineCounter++,10===this.scanlineCounter&&(this.scanlineCounter=0,this.secondHalfOfDouble?this.secondHalfOfDouble=!1:this.secondHalfOfDouble=this.wasDbl),this.wasDbl=!1)}setRA0(t){this.levelRA0=t}render(t,e){let s=this.dataQueue[0],i=this.scanlineCounter<<1;this.levelRA0&&i++,this.oldDbl=this.dbl,this.prevCol=this.col,this.curGlyphs=this.nextGlyphs;const r=this.flash;s<32?s=this.handleControlCode(s):this.gfx&&(this.heldChar=s,this.heldGlyphs=this.curGlyphs),this.oldDbl&&(i>>>=1,this.secondHalfOfDouble&&(i+=10));let n=this.curGlyphs[20*(s-32)+i];if(r&&this.flashOn||this.secondHalfOfDouble&&!this.dbl){const s=this.colour[(7&this.bg)<<5];for(let i=0;i<16;++i)t[e++]=s}else{const s=(7&this.bg)<<5|(7&this.prevCol)<<2;for(let i=0;i<16;++i)t[e+i]=this.colour[s+(3&n)],n>>>=2}this.holdOff&&(this.holdChar=!1,this.heldChar=32)}}const Oh=32;class Ph{constructor(t){this.video=t}write(t,e){if(e|=0,1&(t|=0)){const t=e>>>4&15;this.video.actualPal[t]=15&e;let s=7&e;8&e&&1&this.video.ulactrl||(s^=7),this.video.ulaPal[t]!==this.video.collook[s]&&(this.video.ulaPal[t]=this.video.collook[s])}else{if(1&(this.video.ulactrl^e)){const t=!!(1&e);for(let e=0;e<16;++e){let s=7&this.video.actualPal[e];t&&8&this.video.actualPal[e]||(s^=7),this.video.ulaPal[e]!==this.video.collook[s]&&(this.video.ulaPal[e]=this.video.collook[s])}}this.video.ulactrl=e,this.video.pixelsPerChar=16&e?8:16,this.video.halfClock=!(16&e);const t=e>>>2&3;t!==this.video.ulaMode&&(this.video.ulaMode=t),this.video.teletextMode=!!(2&e)}}}class Ih{constructor(t){this.video=t,this.curReg=0,this.crtcmask=new Uint8Array([255,255,255,255,127,31,127,127,243,31,127,31,63,255,63,255,63,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}read(t){if(!(1&t))return 0;switch(this.curReg){case 12:case 13:case 14:case 15:case 16:case 17:return this.video.regs[this.curReg]}return 0}write(t,e){if(1&t)switch(this.video.regs[this.curReg]=e&this.crtcmask[this.curReg],this.curReg){case 3:this.video.hpulseWidth=15&e,this.video.vpulseWidth=(240&e)>>>4;break;case 8:{this.video.interlacedSyncAndVideo=3==(3&e);const t=(48&e)>>>4;t<3?(this.video.displayEnableSkew=t,this.video.dispEnableSet(16)):this.video.dispEnableClear(16);break}case 14:case 15:this.video.cursorPos=16383&(this.video.regs[15]|this.video.regs[14]<<8)}else this.curReg=31&e}}function Nh(t,e){for(let s=0;s<786432;++s)t[s]=e[s]}function Mh(t,e,s){let i=(e-t)*s+t;return i<0&&(i=0),i>255&&(i=255),i}function Bh(t,e,s){s<0&&(s=0),s>1&&(s=1);const i=t>>>8&255,r=t>>>0&255,n=e>>>8&255,o=e>>>0&255;return Mh(t>>>16&255,e>>>16&255,s)<<16|Mh(i,n,s)<<8|Mh(r,o,s)}function Fh(t,e){return t<<12|e<<4}class Uh{constructor(){this.ula=this.crtc={read:function(){return 255},write:dh},this.regs=new Uint8Array(32)}reset(){}polltime(){}setScreenAdd(){}}function Hh(t){return'<span class="addr">'+hh(t)+"</span>"}class jh{constructor(t,e){this._widget=t,this._peekMem=e,this._addr=0,this._prevSnapshot=new Uint8Array(65536),this._rows=[];const s=this._widget.find(".template");for(let t=0;t<16;t++)this._rows.push(s.clone().removeClass("template").appendTo(this._widget));s.remove(),t.bind("wheel",(t=>{const e=t.originalEvent.deltaY;if(0===e)return;const s=e/20|0;this.update(this._addr+8*s),t.preventDefault()}))}update(t){void 0!==t&&(this._addr=t);let e=this._addr-8*Math.floor(this._rows.length/2);e<0&&(e=0);for(const t of this._rows){t.find(".dis_addr").html(Hh(e)),t.toggleClass("highlight",e===this._addr);const i=this.dump(e,e+8),r=t.find(".mem_bytes span"),n=t.find(".mem_asc span");for(let t=0;t<8;++t)s(r[t]).text(i.hex[t]).toggleClass("changed",i.changed[t]),s(n[t]).text(i.asc[t]).toggleClass("changed",i.changed[t]);e=e+8&65535}}dump(t,e){const s=[],i=[],r=[];for(let n=t;n<e;++n){const t=this._peekMem(n);s.push(ch(t)),r.push(n<this._prevSnapshot.length&&this._prevSnapshot[n]!==t),t>=32&&t<128?i.push(String.fromCharCode(t)):i.push(".")}return{hex:s,asc:i,changed:r}}snapshot(){for(let t=0;t<65536;++t)this._prevSnapshot[t]=this._peekMem(t)}step(t){this.update(this._addr+t)}}const zh=hh,Wh=ch,Gh=lh;function Kh(t,e){const s=[];return t?(e||s.push("var newBotBit = cpu.p.c ? 0x01 : 0x00;"),s.push("cpu.p.c = !!(REG & 0x80);"),e?s.push("REG = (REG << 1) & 0xff;"):s.push("REG = ((REG << 1) & 0xff) | newBotBit;")):(e||s.push("var newTopBit = cpu.p.c ? 0x80 : 0x00;"),s.push("cpu.p.c = !!(REG & 0x01);"),e?s.push("REG >>>= 1;"):s.push("REG = (REG >>> 1) | newTopBit;")),s.push("cpu.p.setzn(REG);"),s}function $h(t){return"p"===t?["cpu.p.setFromByte(cpu.pull());"]:["cpu."+t+" = cpu.p.setzn(cpu.pull());"]}function qh(t){return"p"===t?"cpu.push(cpu.p.asByte());":"cpu.push(cpu."+t+");"}class Xh{constructor(t){this.is65c12=t,this.ops={},this.cycle=0}appendOrPrepend(t,e,s,i,r){void 0===s&&(s=e,e=this.cycle),i=i||!1,"string"==typeof s&&(s=[s]),this.ops[e]?(this.ops[e].op=t(this.ops[e].op,s),i&&(this.ops[e].exact=!0),this.ops[e].addr||(this.ops[e].addr=r)):this.ops[e]={op:s,exact:i,addr:r}}append(t,e,s,i){this.appendOrPrepend(((t,e)=>t.concat(e)),t,e,s,i)}prepend(t,e,s,i){this.appendOrPrepend(((t,e)=>e.concat(t)),t,e,s,i)}tick(t){this.cycle+=t||1}readOp(t,e,s){let i;this.cycle++,i=e?e+" = cpu.readmem("+t+");":"cpu.readmem("+t+");",s&&(i+=" // spurious"),this.append(this.cycle,i,!0,t)}writeOp(t,e,s){this.cycle++;let i="cpu.writemem("+t+", "+e+");";s&&(i+=" // spurious"),this.append(this.cycle,i,!0,t)}zpReadOp(t,e){this.cycle++,this.append(this.cycle,e+" = cpu.readmemZpStack("+t+");",!1)}zpWriteOp(t,e){this.cycle++,this.append(this.cycle,"cpu.writememZpStack("+t+", "+e+");",!0)}render(t){return this.cycle<2&&(this.cycle=2),this.prepend(this.cycle-1,"cpu.checkInt();",!0),this.renderInternal(t)}spuriousOp(t,e){this.is65c12?this.readOp(t,"",!0):this.writeOp(t,e,!0)}renderInternal(t){let e=0,s=[];for(let i=t=t||0;i<this.cycle;++i)this.ops[i]?(e&&this.ops[i].exact&&(this.ops[i].addr?s.push("cpu.polltimeAddr("+e+", "+this.ops[i].addr+");"):s.push("cpu.polltime("+e+");"),e=0),s=s.concat(this.ops[i].op),e++):e++;return e&&(this.ops[this.cycle]&&this.ops[this.cycle].addr?s.push("cpu.polltimeAddr("+e+", "+this.ops[this.cycle].addr+");"):s.push("cpu.polltime("+e+");")),this.ops[this.cycle]&&(s=s.concat(this.ops[this.cycle].op)),s.filter((t=>t))}split(t){return new Vh(this,t,this.is65c12)}}class Vh{constructor(t,e,s){this.preamble=t,this.condition=e,this.ifTrue=new Xh(s),this.ifTrue.tick(t.cycle),this.ifFalse=new Xh(s),this.ifFalse.tick(t.cycle),["append","prepend","readOp","writeOp","spuriousOp"].forEach((t=>{this[t]=(...e)=>{this.ifTrue[t](...e),this.ifFalse[t](...e)}}))}indent(t){return t.map((t=>`  ${t}`))}render(){return this.preamble.renderInternal().concat("if ("+this.condition+") {").concat(this.indent(this.ifTrue.render(this.preamble.cycle))).concat("} else {").concat(this.indent(this.ifFalse.render(this.preamble.cycle))).concat("}")}}const Yh={0:"BRK",1:"ORA (,x)",3:"SLO (,x)",4:"NOP zp",5:"ORA zp",6:"ASL zp",7:"SLO zp",8:"PHP",9:"ORA imm",10:"ASL A",11:"ANC imm",12:"NOP abs",13:"ORA abs",14:"ASL abs",15:"SLO abs",16:"BPL branch",17:"ORA (),y",19:"SLO (),y",20:"NOP zp,x",21:"ORA zp,x",22:"ASL zp,x",23:"SLO zp,x",24:"CLC",25:"ORA abs,y",26:"NOP",27:"SLO abs,y",28:"NOP abs,x",29:"ORA abs,x",30:"ASL abs,x",31:"SLO abs,x",32:"JSR abs",33:"AND (,x)",35:"RLA (,x)",36:"BIT zp",37:"AND zp",38:"ROL zp",39:"RLA zp",40:"PLP",41:"AND imm",42:"ROL A",43:"ANC imm",44:"BIT abs",45:"AND abs",46:"ROL abs",47:"RLA abs",48:"BMI branch",49:"AND (),y",51:"RLA (),y",52:"NOP zp,x",53:"AND zp,x",54:"ROL zp,x",55:"RLA zp,x",56:"SEC",57:"AND abs,y",58:"NOP",59:"RLA abs,y",60:"NOP abs,x",61:"AND abs,x",62:"ROL abs,x",63:"RLA abs,x",64:"RTI",65:"EOR (,x)",67:"SRE (,x)",68:"NOP zp",69:"EOR zp",70:"LSR zp",71:"SRE zp",72:"PHA",73:"EOR imm",74:"LSR A",75:"ASR imm",76:"JMP abs",77:"EOR abs",78:"LSR abs",79:"SRE abs",80:"BVC branch",81:"EOR (),y",83:"SRE (),y",84:"NOP zp,x",85:"EOR zp,x",86:"LSR zp,x",87:"SRE zp,x",88:"CLI",89:"EOR abs,y",90:"NOP",91:"SRE abs,y",92:"NOP abs,x",93:"EOR abs,x",94:"LSR abs,x",95:"SRE abs,x",96:"RTS",97:"ADC (,x)",99:"RRA (,x)",100:"NOP zp",101:"ADC zp",102:"ROR zp",103:"RRA zp",104:"PLA",105:"ADC imm",106:"ROR A",107:"ARR imm",108:"JMP (abs)",109:"ADC abs",110:"ROR abs",111:"RRA abs",112:"BVS branch",113:"ADC (),y",115:"RRA (),y",116:"NOP zp,x",117:"ADC zp,x",118:"ROR zp,x",119:"RRA zp,x",120:"SEI",121:"ADC abs,y",122:"NOP",123:"RRA abs,y",124:"NOP abs,x",125:"ADC abs,x",126:"ROR abs,x",127:"RRA abs,x",128:"NOP imm",129:"STA (,x)",130:"NOP imm",131:"SAX (,x)",132:"STY zp",133:"STA zp",134:"STX zp",135:"SAX zp",136:"DEY",137:"NOP imm",138:"TXA",139:"ANE imm",140:"STY abs",141:"STA abs",142:"STX abs",143:"SAX abs",144:"BCC branch",145:"STA (),y",147:"SHA (),y",148:"STY zp,x",149:"STA zp,x",150:"STX zp,y",151:"SAX zp,y",152:"TYA",153:"STA abs,y",154:"TXS",155:"SHS abs,y",156:"SHY abs,x",157:"STA abs,x",158:"SHX abs,y",159:"SHA abs,y",160:"LDY imm",161:"LDA (,x)",162:"LDX imm",163:"LAX (,x)",164:"LDY zp",165:"LDA zp",166:"LDX zp",167:"LAX zp",168:"TAY",169:"LDA imm",170:"TAX",171:"LXA imm",172:"LDY abs",173:"LDA abs",174:"LDX abs",175:"LAX abs",176:"BCS branch",177:"LDA (),y",179:"LAX (),y",180:"LDY zp,x",181:"LDA zp,x",182:"LDX zp,y",183:"LAX zp,y",184:"CLV",185:"LDA abs,y",186:"TSX",187:"LAS abs,y",188:"LDY abs,x",189:"LDA abs,x",190:"LDX abs,y",191:"LAX abs,y",192:"CPY imm",193:"CMP (,x)",194:"NOP imm",195:"DCP (,x)",196:"CPY zp",197:"CMP zp",198:"DEC zp",199:"DCP zp",200:"INY",201:"CMP imm",202:"DEX",203:"SBX imm",204:"CPY abs",205:"CMP abs",206:"DEC abs",207:"DCP abs",208:"BNE branch",209:"CMP (),y",211:"DCP (),y",212:"NOP zp,x",213:"CMP zp,x",214:"DEC zp,x",215:"DCP zp,x",216:"CLD",217:"CMP abs,y",218:"NOP",219:"DCP abs,y",220:"NOP abs,x",221:"CMP abs,x",222:"DEC abs,x",223:"DCP abs,x",224:"CPX imm",225:"SBC (,x)",226:"NOP imm",227:"ISB (,x)",228:"CPX zp",229:"SBC zp",230:"INC zp",231:"ISB zp",232:"INX",233:"SBC imm",234:"NOP",235:"SBC imm",236:"CPX abs",237:"SBC abs",238:"INC abs",239:"ISB abs",240:"BEQ branch",241:"SBC (),y",243:"ISB (),y",244:"NOP zpx",245:"SBC zp,x",246:"INC zp,x",247:"ISB zp,x",248:"SED",249:"SBC abs,y",250:"NOP",251:"ISB abs,y",252:"NOP abs,x",253:"SBC abs,x",254:"INC abs,x",255:"ISB abs,x"},Qh={0:"BRK",1:"ORA (,x)",4:"TSB zp",5:"ORA zp",6:"ASL zp",8:"PHP",9:"ORA imm",10:"ASL A",12:"TSB abs",13:"ORA abs",14:"ASL abs",16:"BPL branch",17:"ORA (),y",18:"ORA ()",20:"TRB zp",21:"ORA zp,x",22:"ASL zp,x",24:"CLC",25:"ORA abs,y",26:"INC A",28:"TRB abs",29:"ORA abs,x",30:"ASL abs,x",32:"JSR abs",33:"AND (,x)",36:"BIT zp",37:"AND zp",38:"ROL zp",40:"PLP",41:"AND imm",42:"ROL A",44:"BIT abs",45:"AND abs",46:"ROL abs",48:"BMI branch",49:"AND (),y",50:"AND ()",52:"BIT zp,x",53:"AND zp,x",54:"ROL zp,x",56:"SEC",57:"AND abs,y",58:"DEC A",60:"BIT abs,x",61:"AND abs,x",62:"ROL abs,x",64:"RTI",65:"EOR (,x)",69:"EOR zp",70:"LSR zp",72:"PHA",73:"EOR imm",74:"LSR A",76:"JMP abs",77:"EOR abs",78:"LSR abs",80:"BVC branch",81:"EOR (),y",82:"EOR ()",85:"EOR zp,x",86:"LSR zp,x",88:"CLI",89:"EOR abs,y",90:"PHY",93:"EOR abs,x",94:"LSR abs,x",96:"RTS",97:"ADC (,x)",100:"STZ zp",101:"ADC zp",102:"ROR zp",104:"PLA",105:"ADC imm",106:"ROR A",108:"JMP (abs)",109:"ADC abs",110:"ROR abs",112:"BVS branch",113:"ADC (),y",114:"ADC ()",116:"STZ zp,x",117:"ADC zp,x",118:"ROR zp,x",120:"SEI",121:"ADC abs,y",122:"PLY",124:"JMP (abs,x)",125:"ADC abs,x",126:"ROR abs,x",128:"BRA branch",129:"STA (,x)",132:"STY zp",133:"STA zp",134:"STX zp",136:"DEY",137:"BIT imm",138:"TXA",140:"STY abs",141:"STA abs",142:"STX abs",144:"BCC branch",145:"STA (),y",146:"STA ()",148:"STY zp,x",149:"STA zp,x",150:"STX zp,y",152:"TYA",153:"STA abs,y",154:"TXS",156:"STZ abs",157:"STA abs,x",158:"STZ abs,x",160:"LDY imm",161:"LDA (,x)",162:"LDX imm",164:"LDY zp",165:"LDA zp",166:"LDX zp",168:"TAY",169:"LDA imm",170:"TAX",172:"LDY abs",173:"LDA abs",174:"LDX abs",176:"BCS branch",177:"LDA (),y",178:"LDA ()",180:"LDY zp,x",181:"LDA zp,x",182:"LDX zp,y",184:"CLV",185:"LDA abs,y",186:"TSX",188:"LDY abs,x",189:"LDA abs,x",190:"LDX abs,y",192:"CPY imm",193:"CMP (,x)",196:"CPY zp",197:"CMP zp",198:"DEC zp",200:"INY",201:"CMP imm",202:"DEX",204:"CPY abs",205:"CMP abs",206:"DEC abs",208:"BNE branch",209:"CMP (),y",210:"CMP ()",213:"CMP zp,x",214:"DEC zp,x",216:"CLD",217:"CMP abs,y",218:"PHX",221:"CMP abs,x",222:"DEC abs,x",224:"CPX imm",225:"SBC (,x)",228:"CPX zp",229:"SBC zp",230:"INC zp",232:"INX",233:"SBC imm",234:"NOP",236:"CPX abs",237:"SBC abs",238:"INC abs",240:"BEQ branch",241:"SBC (),y",242:"SBC ()",245:"SBC zp,x",246:"INC zp,x",248:"SED",249:"SBC abs,y",250:"PLX",253:"SBC abs,x",254:"INC abs,x"};class Zh{constructor(t,e){this.cpu=t,this.opcodes=e}disassemble(t,e){let s=t=>`<span class='instr_mem_ref' data-ref='${t}'>${zh(t)}</span>`,i=t=>`<span class='instr_instr_ref' data-ref='${t}'>${zh(t)}</span>`;e&&(s=zh,i=zh);const r=this.opcodes[this.cpu.peekmem(t)];if(!r)return["???",t+1];const n=r.split(" ");if(!n[1])return[r,t+1];let o=n[1]||"",a="",c="";const h=o.match(/(.*),([xy])$/);switch(h&&(o=h[1],a=","+h[2].toUpperCase(),c=" + "+h[2].toUpperCase()),o){case"imm":return[`${n[0]} #$${Wh(this.cpu.peekmem(t+1))}${a}`,t+2];case"abs":{const e="JMP"===n[0]||"JSR"===n[0]?i:s,r=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8;return[`${n[0]} $${e(r)}${a}`,t+3,r]}case"branch":{const e=t+Gh(this.cpu.peekmem(t+1))+2;return[`${n[0]} $${i(e)}${a}`,t+2,e]}case"zp":return[`${n[0]} $${Wh(this.cpu.peekmem(t+1))}${a}`,t+2];case"(,x)":return[`${n[0]} ($${Wh(this.cpu.peekmem(t+1))}, X)${a}`,t+2];case"()":{const e=this.cpu.peekmem(t+1),s=this.cpu.peekmem(e)|this.cpu.peekmem(e+1)<<8;return[`${n[0]} ($${Wh(e)})${a} ; $${hh(s)}${c}`,t+2]}case"(abs)":{const e=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8,s=this.cpu.peekmem(e)|this.cpu.peekmem(e+1)<<8;return[`${n[0]} ($${i(e)})${a} ; $${hh(s)}${c}`,t+3,s]}case"(abs,x)":{const e=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8,s=this.cpu.peekmem(e)|this.cpu.peekmem(e+1)<<8;return[`${n[0]} ($${i(e)},x)${a}`,t+3,s]}}return[r,t+1]}}function Jh(t,e,s){function i(t,e){const i=t.split(" "),r=i[0],n=i[1],o=function(t,e){switch(t){case"NOP":return{op:"",read:void 0!==e};case"BRK":return{op:"cpu.brk(false);"};case"CLC":return{op:"cpu.p.c = false;"};case"SEC":return{op:"cpu.p.c = true;"};case"CLD":return{op:"cpu.p.d = false;"};case"SED":return{op:"cpu.p.d = true;"};case"CLI":return{op:"cpu.p.i = false;"};case"SEI":return{op:"cpu.p.i = true;"};case"CLV":return{op:"cpu.p.v = false;"};case"LDA":return{op:["cpu.a = cpu.p.setzn(REG);"],read:!0};case"LDX":return{op:["cpu.x = cpu.p.setzn(REG);"],read:!0};case"LDY":return{op:["cpu.y = cpu.p.setzn(REG);"],read:!0};case"STA":return{op:"REG = cpu.a;",write:!0};case"STX":return{op:"REG = cpu.x;",write:!0};case"STY":return{op:"REG = cpu.y;",write:!0};case"INC":return{op:["REG = cpu.p.setzn(REG + 1);"],read:!0,write:!0};case"DEC":return{op:["REG = cpu.p.setzn(REG - 1);"],read:!0,write:!0};case"INX":return{op:["cpu.x = cpu.p.setzn(cpu.x + 1);"]};case"INY":return{op:["cpu.y = cpu.p.setzn(cpu.y + 1);"]};case"DEX":return{op:["cpu.x = cpu.p.setzn(cpu.x - 1);"]};case"DEY":return{op:["cpu.y = cpu.p.setzn(cpu.y - 1);"]};case"ADC":return{op:"cpu.adc(REG);",read:!0};case"SBC":return{op:"cpu.sbc(REG);",read:!0};case"BIT":return"imm"===e?{op:"cpu.p.z = !(cpu.a & REG);",read:!0}:{op:["cpu.p.z = !(cpu.a & REG);","cpu.p.v = !!(REG & 0x40);","cpu.p.n = !!(REG & 0x80);"],read:!0};case"ROL":return{op:Kh(!0,!1),read:!0,write:!0,rotate:!0};case"ROR":return{op:Kh(!1,!1),read:!0,write:!0,rotate:!0};case"ASL":return{op:Kh(!0,!0),read:!0,write:!0,rotate:!0};case"LSR":return{op:Kh(!1,!0),read:!0,write:!0,rotate:!0};case"EOR":return{op:["cpu.a = cpu.p.setzn(cpu.a ^ REG);"],read:!0};case"AND":return{op:["cpu.a = cpu.p.setzn(cpu.a & REG);"],read:!0};case"ORA":return{op:["cpu.a = cpu.p.setzn(cpu.a | REG);"],read:!0};case"CMP":return{op:["cpu.p.setzn(cpu.a - REG);","cpu.p.c = cpu.a >= REG;"],read:!0};case"CPX":return{op:["cpu.p.setzn(cpu.x - REG);","cpu.p.c = cpu.x >= REG;"],read:!0};case"CPY":return{op:["cpu.p.setzn(cpu.y - REG);","cpu.p.c = cpu.y >= REG;"],read:!0};case"TXA":return{op:["cpu.a = cpu.p.setzn(cpu.x);"]};case"TAX":return{op:["cpu.x = cpu.p.setzn(cpu.a);"]};case"TXS":return{op:"cpu.s = cpu.x;"};case"TSX":return{op:["cpu.x = cpu.p.setzn(cpu.s);"]};case"TYA":return{op:["cpu.a = cpu.p.setzn(cpu.y);"]};case"TAY":return{op:["cpu.y = cpu.p.setzn(cpu.a);"]};case"BEQ":return{op:"cpu.branch(cpu.p.z);"};case"BNE":return{op:"cpu.branch(!cpu.p.z);"};case"BCS":return{op:"cpu.branch(cpu.p.c);"};case"BCC":return{op:"cpu.branch(!cpu.p.c);"};case"BMI":return{op:"cpu.branch(cpu.p.n);"};case"BPL":return{op:"cpu.branch(!cpu.p.n);"};case"BVS":return{op:"cpu.branch(cpu.p.v);"};case"BVC":return{op:"cpu.branch(!cpu.p.v);"};case"PLA":return{op:$h("a"),extra:3};case"PLP":return{op:$h("p"),extra:3};case"PLX":return{op:$h("x"),extra:3};case"PLY":return{op:$h("y"),extra:3};case"PHA":return{op:qh("a"),extra:2};case"PHP":return{op:qh("p"),extra:2};case"PHX":return{op:qh("x"),extra:2};case"PHY":return{op:qh("y"),extra:2};case"RTS":return{op:["var temp = cpu.pull();","temp |= cpu.pull() << 8;","cpu.pc = (temp + 1) & 0xffff;"],extra:5};case"RTI":return{preop:["var temp = cpu.pull();","cpu.p.c = !!(temp & 0x01);","cpu.p.z = !!(temp & 0x02);","cpu.p.i = !!(temp & 0x04);","cpu.p.d = !!(temp & 0x08);","cpu.p.v = !!(temp & 0x40);","cpu.p.n = !!(temp & 0x80);","temp = cpu.pull();","cpu.pc = temp | (cpu.pull() << 8);"],extra:5};case"JSR":return{op:["var pushAddr = cpu.pc - 1;","cpu.push(pushAddr >>> 8);","cpu.push(pushAddr & 0xff);","cpu.pc = addr;"],extra:3};case"JMP":return{op:"cpu.pc = addr;"};case"TSB":return{op:["cpu.p.z = !(REG & cpu.a);","REG |= cpu.a;"],read:!0,write:!0};case"TRB":return{op:["cpu.p.z = !(REG & cpu.a);","REG &= ~cpu.a;"],read:!0,write:!0};case"BRA":return{op:"cpu.branch(true);"};case"STZ":return{op:"REG = 0;",write:!0};case"SAX":return{op:"REG = cpu.a & cpu.x;",write:!0};case"ASR":return{op:["REG &= cpu.a;"].concat(Kh(!1,!0)).concat(["cpu.a = REG;"])};case"SLO":return{op:Kh(!0,!0).concat(["cpu.a |= REG;","cpu.p.setzn(cpu.a);"]),read:!0,write:!0};case"SHX":return{op:"REG = (cpu.x & ((addr >>> 8)+1)) & 0xff;",write:!0,zpQuirk:!0};case"SHY":return{op:"REG = (cpu.y & ((addr >>> 8)+1)) & 0xff;",write:!0,zpQuirk:!0};case"LAX":return{op:["var magic = 0xff;","cpu.a = cpu.x = cpu.p.setzn((cpu.a|magic) & REG);"],read:!0};case"LXA":return{op:["var magic = 0xee;","cpu.a = cpu.x = cpu.p.setzn((cpu.a|magic) & REG);"],read:!0};case"SRE":return{op:Kh(!1,!0).concat(["cpu.a = cpu.p.setzn(cpu.a ^ REG);"]),read:!0,write:!0};case"RLA":return{op:Kh(!0,!1).concat(["cpu.a = cpu.p.setzn(cpu.a & REG);"]),read:!0,write:!0};case"ANC":return{op:["cpu.a = cpu.p.setzn(cpu.a & REG); cpu.p.c = cpu.p.n;"],read:!0};case"ANE":return{op:["cpu.a = cpu.p.setzn((cpu.a | 0xee) & REG & cpu.x);"],read:!0};case"ARR":return{op:"cpu.arr(REG);",read:!0};case"DCP":return{op:["REG = cpu.p.setzn(REG - 1);","cpu.p.setzn(cpu.a - REG);","cpu.p.c = cpu.a >= REG;"],read:!0,write:!0};case"LAS":return{op:["cpu.a = cpu.x = cpu.s = cpu.p.setzn(cpu.s & REG);"],read:!0};case"RRA":return{op:Kh(!1,!1).concat(["cpu.adc(REG);"]),read:!0,write:!0};case"SBX":return{op:["var temp = cpu.a & cpu.x;","cpu.p.c = temp >= REG;","cpu.x = cpu.p.setzn(temp - REG);"],read:!0};case"SHA":return{op:["REG = cpu.a & cpu.x & ((addr >>> 8) + 1) & 0xff;"],write:!0,zpQuirk:!0};case"SHS":return{op:["cpu.s = cpu.a & cpu.x;","REG = cpu.a & cpu.x & ((addr >>> 8) + 1) & 0xff;"],write:!0,zpQuirk:!0};case"ISB":return{op:["REG = (REG + 1) & 0xff;","cpu.sbc(REG);"],read:!0,write:!0}}return null}(r,n);if(!o)return null;let a=new Xh(s);switch(e&&a.append("var REG = 0|0;"),n){case void 0:if(o.read||o.write)throw"Unsupported "+t;return a.append(o.preop),a.tick(Math.max(2,1+(o.extra||0))),a.append(o.op),a.render();case"branch":return[o.op];case"zp":case"zpx":case"zp,x":case"zp,y":return"zp"===n?(a.tick(2),a.append("var addr = cpu.getb() | 0;")):(a.tick(3),a.append("var addr = (cpu.getb() + cpu."+n[3]+") & 0xff;")),o.read&&(a.zpReadOp("addr","REG"),o.write&&a.tick(1)),a.append(o.op),o.write&&a.zpWriteOp("addr","REG"),a.render();case"abs":return a.tick(3+(o.extra||0)),a.append("var addr = cpu.getw() | 0;"),o.read&&(a.readOp("addr","REG"),o.write&&a.spuriousOp("addr","REG")),a.append(o.op),o.write&&a.writeOp("addr","REG"),a.render();case"abs,x":case"abs,y":return a.append("var addr = cpu.getw() | 0;"),a.append("var addrWithCarry = (addr + cpu."+n[4]+") & 0xffff;"),a.append("var addrNonCarry = (addr & 0xff00) | (addrWithCarry & 0xff);"),a.tick(3),a=a.split("addrWithCarry !== addrNonCarry"),o.read&&!o.write?(s?a.ifTrue.tick(1):a.ifTrue.readOp("addrNonCarry"),a.readOp("addrWithCarry","REG")):o.read?s?(a.ifTrue.tick(1),o.rotate||a.ifFalse.readOp("addrNonCarry","REG"),a.readOp("addrWithCarry","REG"),a.writeOp("addrWithCarry","REG")):(a.readOp("addrNonCarry"),a.readOp("addrWithCarry","REG"),a.spuriousOp("addrWithCarry","REG")):o.write&&(s?(a.ifTrue.tick(1),a.ifFalse.readOp("addrNonCarry")):(a.readOp("addrNonCarry"),o.zpQuirk&&a.append("if (addrWithCarry !== addrNonCarry) addrWithCarry &= 0xff;"))),a.append(o.op),o.write&&a.writeOp("addrWithCarry","REG"),a.render();case"imm":if(o.write)throw"This isn't possible";return o.read,a.tick(2),a.append("REG = cpu.getb() | 0;"),a.append(o.op),a.render();case"A":return a.tick(2),a.append("REG = cpu.a;"),a.append(o.op),a.append("cpu.a = REG;"),a.render();case"(,x)":return a.tick(3),a.append("var zpAddr = (cpu.getb() + cpu.x) & 0xff;"),a.append("var lo, hi;"),a.zpReadOp("zpAddr","lo"),a.zpReadOp("(zpAddr + 1) & 0xff","hi"),a.append("var addr = lo | (hi << 8);"),o.read&&(a.readOp("addr","REG"),o.write&&a.spuriousOp("addr","REG")),a.append(o.op),o.write&&a.writeOp("addr","REG"),a.render();case"(),y":return a.tick(2),a.append("var zpAddr = cpu.getb() | 0;"),a.append("var lo, hi;"),a.zpReadOp("zpAddr","lo"),a.zpReadOp("(zpAddr + 1) & 0xff","hi"),a.append("var addr = lo | (hi << 8);"),a.append("var addrWithCarry = (addr + cpu.y) & 0xffff;"),a.append("var addrNonCarry = (addr & 0xff00) | (addrWithCarry & 0xff);"),o.read&&!o.write?(a=a.split("addrWithCarry !== addrNonCarry"),s?a.ifTrue.tick(1):a.ifTrue.readOp("addrNonCarry"),a.readOp("addrWithCarry","REG")):o.read?(a.readOp("addrNonCarry"),a.readOp("addrWithCarry","REG"),a.spuriousOp("addrWithCarry","REG")):o.write&&(a.readOp("addrNonCarry"),o.zpQuirk&&a.append("if (addrWithCarry !== addrNonCarry) addrWithCarry &= 0xff;")),a.append(o.op),o.write&&a.writeOp("addrWithCarry","REG"),a.render();case"(abs)":return a.tick(s?4:3),a.append("var addr = cpu.getw() | 0;"),s?a.append("var nextAddr = (addr + 1) & 0xffff;"):a.append("var nextAddr = ((addr + 1) & 0xff) | (addr & 0xff00);"),a.append("var lo, hi;"),a.readOp("addr","lo"),a.readOp("nextAddr","hi"),a.append("addr = lo | (hi << 8);"),a.append(o.op),a.render();case"(abs,x)":return a.tick(4),a.append("var addr = (cpu.getw() + cpu.x) | 0;"),a.append("var lo, hi;"),a.readOp("addr","lo"),a.readOp("(addr + 1) & 0xffff","hi"),a.append("addr = lo | (hi << 8);"),a.append(o.op),a.render();case"()":return a.tick(2),a.append("var zpAddr = cpu.getb() | 0;"),a.append("var lo, hi;"),a.zpReadOp("zpAddr","lo"),a.zpReadOp("(zpAddr + 1) & 0xff","hi"),a.append("var addr = lo | (hi << 8);"),o.read&&a.readOp("addr","REG"),a.append(o.op),o.write&&a.writeOp("addr","REG"),a.render();default:throw"Unknown arg type "+n}}function r(t,s,r){const n=e[s];let o=null;return n&&(o=i(n,!!r)),o||(o=["this.invalidOpcode(cpu, 0x"+ch(s)+");"]),o=['"use strict";',"// "+ch(s)+" - "+n+"\n"].concat(o),t+o.join("\n"+t)}function n(){}return n.prototype.invalidOpcode=function(t,e){if(s)switch(e){case 2:case 34:case 66:case 98:case 130:case 194:case 226:t.getb(),t.polltime(2);break;case 68:t.getb(),t.polltime(3);break;case 84:case 212:case 244:t.getb(),t.polltime(4);break;case 92:t.getw(),t.polltime(8);break;case 220:case 252:t.polltimeAddr(4,t.getw());break;default:t.polltime(1)}else t.pc--,t.polltime(1)},n.prototype.cpu=t,n.prototype.run=function(){const t=[];for(let e=0;e<256;++e)t[e]=new Function("cpu",r("  ",e,!0));return function(e){return t[e].call(this,this.cpu)}}(),{disassembler:new Zh(t,e),runInstruction:new n,opcodes:e,getInstruction:i}}class tu{constructor(t,e){this.cpu=t,this.irq=e,this.ora=0,this.orb=0,this.ira=0,this.irb=0,this.ddra=0,this.ddrb=0,this.sr=0,this.t1l=0,this.t2l=0,this.t1c=0,this.t2c=0,this.acr=0,this.pcr=0,this.ifr=0,this.ier=0,this.t1hit=!1,this.t2hit=!1,this.portapins=0,this.portbpins=0,this.ca1=!1,this.ca2=!1,this.cb1=!1,this.cb2=!1,this.ca2changecallback=null,this.cb2changecallback=null,this.justhit=0,this.t1_pb7=0}reset(){this.ora=this.orb=0,this.ddra=this.ddrb=0,this.ifr=this.ier=0,this.t1c=this.t1l=this.t2c=this.t2l=131070,this.t1hit=this.t2hit=!0,this.acr=this.pcr=0,this.t1_pb7=1}polltime(t){t|=0,this.justhit=0;let e=this.t1c-t;for(e<-2&&this.t1c>-3&&(this.t1hit||(this.ifr|=64,this.updateIFR(),-3===e&&(this.justhit|=1),this.t1_pb7=!this.t1_pb7),64&this.acr||(this.t1hit=!0));e<-3;)e+=this.t1l+4;if(this.t1c=e,!(32&this.acr)){let e=this.t2c-t;e<-2&&(this.t2hit||(this.ifr|=32,this.updateIFR(),-3===e&&(this.justhit|=2),this.t2hit=!0),e+=131072),this.t2c=e}}updateIFR(){this.ifr&this.ier&127?(this.ifr|=128,this.cpu.interrupt|=this.irq):(this.ifr&=-129,this.cpu.interrupt&=~this.irq)}write(t,e){let s;switch(e|=0,15&t){case 1:this.ifr&=-3,2!=(10&this.pcr)&&(this.ifr&=-2),this.updateIFR(),s=14&this.pcr,8===s?this.setca2(!1):10===s&&(this.setca2(!1),this.setca2(!0));case 15:this.ora=e,this.recalculatePortAPins();break;case 0:this.ifr&=-17,32!=(160&this.pcr)&&(this.ifr&=-9),this.updateIFR(),this.orb=e,this.recalculatePortBPins(),s=(224&this.pcr)>>>4,8===s?this.setcb2(!1):10===s&&(this.setcb2(!1),this.setcb2(!0));break;case 3:this.ddra=e,this.recalculatePortAPins();break;case 2:this.ddrb=e,this.recalculatePortBPins();break;case 11:this.acr=e,1&this.justhit&&!(64&e)&&(this.t1hit=!0);break;case 12:this.pcr=e,12==(14&e)?this.setca2(!1):8&e&&this.setca2(!0),192==(224&e)?this.setcb2(!1):128&e&&this.setcb2(!0);break;case 10:this.sr=e;break;case 6:case 4:this.t1l&=130560,this.t1l|=e<<1;break;case 7:this.t1l&=510,this.t1l|=e<<9,1&this.justhit||(this.ifr&=-65,this.updateIFR());break;case 5:this.t1l&=510,this.t1l|=e<<9,this.t1c=this.t1l+1,this.t1hit=!1,1&this.justhit||(this.ifr&=-65,this.updateIFR()),this.t1_pb7=0;break;case 8:this.t2l&=130560,this.t2l|=e<<1;break;case 9:this.t2l&=510,this.t2l|=e<<9,this.t2c=this.t2l+1,32&this.acr&&(this.t2c-=2),2&this.justhit||(this.ifr&=-33,this.updateIFR()),this.t2hit=!1;break;case 14:128&e?this.ier|=127&e:this.ier&=~(127&e),this.updateIFR();break;case 13:this.ifr&=~(127&e),1&this.justhit&&(this.ifr|=64),2&this.justhit&&(this.ifr|=32),this.updateIFR()}}read(t){switch(15&t){case 1:this.ifr&=-3,2!=(10&this.pcr)&&(this.ifr&=-2),this.updateIFR();case 15:return 1&this.acr?this.ira:(this.recalculatePortAPins(),this.portapins);case 0:{this.ifr&=-17,32!=(160&this.pcr)&&(this.ifr&=-9),this.updateIFR(),this.recalculatePortBPins();let t=this.orb&this.ddrb;2&this.acr?t|=this.irb&~this.ddrb:t|=this.portbpins&~this.ddrb,128&this.acr&&(t&=127,t|=this.t1_pb7<<7);const e=this.getJoysticks();return t&=207,e.button1||(t|=16),e.button2||(t|=32),t}case 3:return this.ddra;case 2:return this.ddrb;case 6:return(510&this.t1l)>>>1&255;case 7:return this.t1l>>>9&255;case 4:return 1&this.justhit||(this.ifr&=-65,this.updateIFR()),this.t1c+1>>>1&255;case 5:return this.t1c+1>>>9&255;case 8:return 2&this.justhit||(this.ifr&=-33,this.updateIFR()),this.t2c+1>>>1&255;case 9:return this.t2c+1>>>9&255;case 10:return this.sr;case 11:return this.acr;case 12:return this.pcr;case 14:return 128|this.ier;case 13:return this.ifr;default:throw"Unknown VIA read"}}drivePortA(){}portAUpdated(){}drivePortB(){}portBUpdated(){}getJoysticks(){return{button1:!1,button2:!1}}recalculatePortAPins(){this.portapins=this.ora&this.ddra,this.portapins|=255&~this.ddra,this.drivePortA(),this.portAUpdated()}recalculatePortBPins(){this.portbpins=this.orb&this.ddrb,this.portbpins|=255&~this.ddrb,this.drivePortB(),this.portBUpdated()}setca1(t){if(t===this.ca1)return;!!(1&this.pcr)===t&&(1&this.acr&&(this.ira=this.portapins),this.ifr|=2,this.updateIFR(),8==(12&this.pcr)&&this.setca2(!0)),this.ca1=t}setca2(t){if(t===this.ca2)return;this.ca2=t;const e=!!(8&this.pcr);if(this.ca2changecallback&&this.ca2changecallback(t,e),e)return;!!(4&this.pcr)===t&&(this.ifr|=1,this.updateIFR())}setcb1(t){if(t===this.cb1)return;!!(16&this.pcr)===t&&(2&this.acr&&(this.irb=this.portbpins),this.ifr|=16,this.updateIFR(),128==(192&this.pcr)&&this.setcb2(!0)),this.cb1=t}setcb2(t){if(t===this.cb2)return;this.cb2=t;const e=!!(128&this.pcr);if(this.cb2changecallback&&this.cb2changecallback(t,e),e)return;!!(64&this.pcr)===t&&(this.ifr|=8,this.updateIFR())}}class eu extends tu{constructor(t,e,s,i,r,n,o){super(t,1),this.IC32=0,this.capsLockLight=!1,this.shiftLockLight=!1,this.keys=[];for(let t=0;t<16;++t)this.keys[t]=new Uint8Array(16);this.keyboardEnabled=!0,this.setKeyLayout(n),this.video=e,this.soundChip=s,this.cmos=i,this.isMaster=r,this.getGamepadsFunc=o,this.reset()}setKeyLayout(t){this.keycodeToRowCol=function(t){const e=[];function s(t,s,i){e[i][t]&&e[i][t]!==s&&console.log("Warning: duplicate binding for key",(i?"<SHIFT>":"")+t,s,e[i][t]),e[i][t]=s}function i(t,e,i){(t||0===t)&&e||console.log("error binding key",t,e),"string"==typeof t&&(t=t.charCodeAt(0)),void 0===i?(s(t,e,!0),s(t,e,!1)):s(t,e,i)}for(e[!0]={},e[!1]={},i(oh.Q,rh.Q),i(oh.W,rh.W),i(oh.E,rh.E),i(oh.R,rh.R),i(oh.T,rh.T),i(oh.Y,rh.Y),i(oh.U,rh.U),i(oh.I,rh.I),i(oh.O,rh.O),i(oh.P,rh.P),i(oh.A,rh.A),i(oh.S,rh.S),i(oh.D,rh.D),i(oh.F,rh.F),i(oh.G,rh.G),i(oh.H,rh.H),i(oh.J,rh.J),i(oh.K,rh.K),i(oh.L,rh.L),i(oh.Z,rh.Z),i(oh.X,rh.X),i(oh.C,rh.C),i(oh.V,rh.V),i(oh.B,rh.B),i(oh.N,rh.N),i(oh.M,rh.M),i(oh.F10,rh.F0),i(oh.F1,rh.F1),i(oh.F2,rh.F2),i(oh.F3,rh.F3),i(oh.F4,rh.F4),i(oh.F5,rh.F5),i(oh.F6,rh.F6),i(oh.F7,rh.F7),i(oh.F8,rh.F8),i(oh.F9,rh.F9),i(oh.COMMA,rh.COMMA),i(oh.PERIOD,rh.PERIOD),i(oh.SLASH,rh.SLASH),i(oh.SPACE,rh.SPACE),i(oh.TAB,rh.TAB),i(oh.ENTER,rh.RETURN),i(oh.SHIFT,rh.SHIFT),i(oh.SHIFT_RIGHT,rh.SHIFT),i(oh.LEFT,rh.LEFT),i(oh.UP,rh.UP),i(oh.RIGHT,rh.RIGHT),i(oh.DOWN,rh.DOWN),"natural"===t?(i(oh.SHIFT_LEFT,rh.SHIFT),i(oh.BACK_QUOTE,ah?rh.UNDERSCORE_POUND:rh.HAT_TILDE),i(oh.APOSTROPHE,ah?rh.AT:rh.K2,!0),i(oh.K2,ah?rh.K2:rh.AT,!0),i(oh.K3,rh.UNDERSCORE_POUND,!0),i(oh.K7,rh.K6,!0),i(oh.K8,rh.COLON_STAR,!0),i(oh.K9,rh.K8,!0),i(oh.K0,rh.K9,!0),i(oh.K2,rh.K2,!1),i(oh.K3,rh.K3,!1),i(oh.K7,rh.K7,!1),i(oh.K8,rh.K8,!1),i(oh.K9,rh.K9,!1),i(oh.K0,rh.K0,!1),i(oh.K1,rh.K1),i(oh.K4,rh.K4),i(oh.K5,rh.K5),i(oh.K6,rh.K6),i(oh.MINUS,rh.MINUS),i(oh.LEFT_SQUARE_BRACKET,rh.LEFT_SQUARE_BRACKET),i(oh.RIGHT_SQUARE_BRACKET,rh.RIGHT_SQUARE_BRACKET),i(oh.SEMICOLON,rh.SEMICOLON_PLUS),i(oh.APOSTROPHE,rh.COLON_STAR,!1),i(oh.HASH,rh.HAT_TILDE),i(oh.EQUALS,rh.SEMICOLON_PLUS),i(oh.WINDOWS,rh.SHIFTLOCK),i(oh.END,rh.COPY),i(oh.F11,rh.COPY),i(oh.ESCAPE,rh.ESCAPE),i(oh.CTRL,rh.CTRL),i(oh.CTRL_LEFT,rh.CTRL),i(oh.CTRL_RIGHT,rh.CTRL),i(oh.CAPSLOCK,rh.CAPSLOCK),i(oh.DELETE,rh.DELETE),i(oh.BACKSPACE,rh.DELETE),i(oh.BACKSLASH,rh.PIPE_BACKSLASH)):"gaming"===t?(i(oh.ESCAPE,rh.F0),i(oh.BACK_QUOTE,rh.ESCAPE),i(oh.K1,rh.K1),i(oh.K2,rh.K2),i(oh.K3,rh.K3),i(oh.K4,rh.K4),i(oh.K5,rh.K5),i(oh.K6,rh.K6),i(oh.K7,rh.K7),i(oh.K8,rh.K8),i(oh.K9,rh.K9),i(oh.K0,rh.K0),i(oh.MINUS,rh.MINUS),i(oh.EQUALS,rh.HAT_TILDE),i(oh.BACKSPACE,rh.PIPE_BACKSLASH),i(oh.INSERT,rh.LEFT),i(oh.HOME,rh.RIGHT),i(oh.LEFT_SQUARE_BRACKET,rh.AT),i(oh.RIGHT_SQUARE_BRACKET,rh.LEFT_SQUARE_BRACKET),i(oh.DELETE,rh.UP),i(oh.END,rh.DOWN),i(oh.CAPSLOCK,rh.CTRL),i(oh.SEMICOLON,rh.SEMICOLON_PLUS),i(oh.APOSTROPHE,rh.COLON_STAR),i(oh.HASH,rh.RIGHT_SQUARE_BRACKET),i(oh.SHIFT_LEFT,ah?rh.SHIFTLOCK:rh.SHIFT),i(oh.BACKSLASH,ah?rh.SHIFT:rh.UNDERSCORE_POUND),i(oh.CTRL_LEFT,rh.CAPSLOCK),i(oh.ALT_LEFT,rh.CTRL),i(oh.MENU,rh.DELETE),i(oh.CTRL_RIGHT,rh.COPY),i(oh.ALT_RIGHT,rh.SHIFTLOCK),i(oh.WINDOWS,rh.SHIFTLOCK)):(i(oh.K1,rh.K1),i(oh.K2,rh.K2),i(oh.K3,rh.K3),i(oh.K4,rh.K4),i(oh.K5,rh.K5),i(oh.K6,rh.K6),i(oh.K7,rh.K7),i(oh.K8,rh.K8),i(oh.K9,rh.K9),i(oh.K0,rh.K0),i(oh.SHIFT_LEFT,rh.SHIFT),i(oh.EQUALS,rh.HAT_TILDE),i(oh.SEMICOLON,rh.SEMICOLON_PLUS),i(oh.MINUS,rh.MINUS),i(oh.LEFT_SQUARE_BRACKET,rh.LEFT_SQUARE_BRACKET),i(oh.RIGHT_SQUARE_BRACKET,rh.RIGHT_SQUARE_BRACKET),i(oh.COMMA,rh.COMMA),i(oh.PERIOD,rh.PERIOD),i(oh.SLASH,rh.SLASH),i(oh.WINDOWS,rh.SHIFTLOCK),i(oh.TAB,rh.TAB),i(oh.ENTER,rh.RETURN),i(oh.DELETE,rh.DELETE),i(oh.BACKSPACE,rh.DELETE),i(oh.END,rh.COPY),i(oh.F11,rh.COPY),i(oh.SHIFT,rh.SHIFT),i(oh.ESCAPE,rh.ESCAPE),i(oh.CTRL,rh.CTRL),i(oh.CTRL_LEFT,rh.CTRL),i(oh.CTRL_RIGHT,rh.CTRL),i(oh.CAPSLOCK,rh.CAPSLOCK),i(oh.LEFT,rh.LEFT),i(oh.UP,rh.UP),i(oh.RIGHT,rh.RIGHT),i(oh.DOWN,rh.DOWN),i(oh.APOSTROPHE,rh.COLON_STAR),i(oh.HASH,rh.RIGHT_SQUARE_BRACKET),i(oh.BACK_QUOTE,rh.AT),i(oh.BACKSLASH,rh.PIPE_BACKSLASH),i(oh.PAGEUP,rh.UNDERSCORE_POUND)),i(oh.NUMPAD0,rh.NUMPAD0),i(oh.NUMPAD1,rh.NUMPAD1),i(oh.NUMPAD2,rh.NUMPAD2),i(oh.NUMPAD3,rh.NUMPAD3),i(oh.NUMPAD4,rh.NUMPAD4),i(oh.NUMPAD5,rh.NUMPAD5),i(oh.NUMPAD6,rh.NUMPAD6),i(oh.NUMPAD7,rh.NUMPAD7),i(oh.NUMPAD8,rh.NUMPAD8),i(oh.NUMPAD9,rh.NUMPAD9),i(oh.NUMPAD_DECIMAL_POINT,rh.NUMPAD_DECIMAL_POINT),i(oh.NUMPADPLUS,rh.NUMPADPLUS),i(oh.NUMPADMINUS,rh.NUMPADMINUS),i(oh.NUMPADSLASH,rh.NUMPADSLASH),i(oh.NUMPADASTERISK,rh.NUMPADASTERISK),i(oh.NUMPADENTER,rh.NUMPADENTER);ih.length>0;){const t=ih.pop();i(oh[t.native],rh[t.bbc])}return e}(t)}setVBlankInt(t){this.setca1(t)}clearKeys(){for(let t=0;t<this.keys.length;++t)for(let e=0;e<this.keys[t].length;++e)this.keys[t][e]=!1;this.updateKeys()}disableKeyboard(){this.keyboardEnabled=!1,this.clearKeys()}enableKeyboard(){this.keyboardEnabled=!0,this.clearKeys()}set(t,e,s){if(!this.keyboardEnabled)return;const i=this.keycodeToRowCol[!!s][t];i&&(this.keys[i[0]][i[1]]=e,this.updateKeys())}keyDown(t,e){this.set(t,1,e)}keyUp(t){this.set(t,0,!0),this.set(t,0,!1)}keyDownRaw(t){this.keys[t[0]][t[1]]=1,this.updateKeys()}keyUpRaw(t){this.keys[t[0]][t[1]]=0,this.updateKeys()}keyToggleRaw(t){this.keys[t[0]][t[1]]=1-this.keys[t[0]][t[1]],this.updateKeys()}hasAnyKeyDown(){for(let t=0;t<13;++t)for(let e=0;e<8;++e)if(this.keys[t][e])return!0;return!1}updateKeys(){if(8&this.IC32){for(let t=0;t<13;++t)for(let e=1;e<8;++e)if(this.keys[t][e])return void this.setca2(!0)}else{const t=this.portapins,e=t>>>4&7,s=15&t;if(this.keys[s][e]?128&this.ddra||(this.portapins|=128):this.portapins&=127,s<13)for(let t=1;t<8;++t)if(this.keys[s][t])return void this.setca2(!0)}this.setca2(!1)}portAUpdated(){this.updateKeys(),this.soundChip.updateSlowDataBus(this.portapins,!(1&this.IC32))}portBUpdated(){const t=this.portbpins;8&t?this.IC32|=1<<(7&t):this.IC32&=~(1<<(7&t)),this.capsLockLight=!(64&this.IC32),this.shiftLockLight=!(128&this.IC32),this.video.setScreenAdd((16&this.IC32?2:0)|(32&this.IC32?1:0)),this.isMaster&&this.cmos.writeControl(t,this.portapins,this.IC32),this.recalculatePortAPins()}drivePortA(){let t=255;this.isMaster&&(t&=this.cmos.read(this.IC32)),this.portapins&=t,this.updateKeys()}drivePortB(){}getGamepads(){return this.getGamepadsFunc?this.getGamepadsFunc():null}getJoysticks(){let t=!1,e=!1;const s=this.getGamepads();if(s&&s[0]){const i=s[0],r=s[1];t=i.buttons[10].pressed,e=r?r.buttons[10].pressed:i.buttons[11].pressed}return{button1:t,button2:e}}}class su extends tu{constructor(t,e,s){super(t,2),this.isMaster=e,this.userPortPeripheral=s,this.reset()}portBUpdated(){this.userPortPeripheral.write(this.portbpins)}drivePortB(){this.portbpins&=this.userPortPeripheral.read()}}class iu{constructor(t,e,s,i){this.cpu=t,this.toneGen=e,this.rs423Handler=i,this.sr=0,this.cr=0,this.dr=0,this.rs423Selected=!1,this.motorOn=!1,this.tapeCarrierCount=0,this.tapeDcdLineLevel=!1,this.hadDcdHigh=!1,this.serialReceiveRate=0,this.serialReceiveCyclesPerByte=0,this.setSerialReceive(19200),this.txCompleteTask=s.newTask((()=>{this.sr|=2})),this.runTapeTask=s.newTask((()=>this.runTape())),this.runRs423Task=s.newTask((()=>this.runRs423()))}updateIrq(){this.sr&this.cr&128?this.cpu.interrupt|=4:this.cpu.interrupt&=-5}reset(){this.sr&=12,this.sr|=2,this.hadDcdHigh=!1,this.updateIrq()}tone(t){t?this.toneGen.tone(t):this.toneGen.mute()}setMotor(t){t&&!this.motorOn?this.runTape():!t&&this.motorOn&&(this.toneGen.mute(),this.runTapeTask.cancel(),this.setTapeCarrier(!1)),this.motorOn=t}read(t){if(1&t)return this.sr&=-162,this.hadDcdHigh=!1,this.updateIrq(),this.dr;{let t=127&this.sr|this.sr&this.cr&128;return 8&t&&(t&=-3),this.hadDcdHigh&&(t|=4),t}}write(t,e){1&t?(this.sr&=-3,this.txCompleteTask.reschedule(2e3),this.updateIrq(),this.rs423Selected&&this.rs423Handler&&this.rs423Handler.onTransmit(e)):3==(3&e)?this.reset():(this.cr=e,this.setSerialReceive(this.serialReceiveRate))}selectRs423(t){this.rs423Selected=!!t,this.rs423Selected?this.sr|=8:this.sr&=-9,this.dcdLineUpdated(),this.runRs423Task.ensureScheduled(this.rs423Selected,this.serialReceiveCyclesPerByte)}dcdLineUpdated(){const t=!this.rs423Selected&&this.tapeDcdLineLevel;!t||4&this.sr?!t&&4&this.sr&&(this.sr&=-5):(this.sr|=132,this.hadDcdHigh=!0),this.updateIrq()}setTapeCarrier(t){t?(this.tapeCarrierCount++,this.tapeDcdLineLevel=209===this.tapeCarrierCount):(this.tapeCarrierCount=0,this.tapeDcdLineLevel=!1),this.dcdLineUpdated()}receive(t){t|=0,1&this.sr?(console.log("Serial overrun"),this.sr|=160):(this.dr=t&(16&this.cr?255:127),this.sr|=129),this.updateIrq()}setTape(t){this.tape=t}rewindTape(){this.tape&&(console.log("rewinding tape"),this.tape.rewind())}secondsToCycles(t){return 0|Math.floor(2e6*t)}numBitsPerByte(){const t=16&this.cr?8:7;let e,s;switch(this.cr>>>2&7){case 0:case 1:e=2,s=1;break;case 2:case 3:case 6:case 7:e=1,s=1;break;case 4:e=2,s=0;break;case 5:e=1,s=0}return t+e+s}rts(){return 0==(64&this.cr)||96==(96&this.cr)}setSerialReceive(t){this.serialReceiveRate=t,this.serialReceiveCyclesPerByte=this.secondsToCycles(this.numBitsPerByte()/t)}runTape(){this.tape&&this.runTapeTask.reschedule(this.tape.poll(this))}runRs423(){if(!this.rs423Handler)return;const t=this.rs423Handler.tryReceive(this.rts());t>=0&&this.receive(t),this.runRs423Task.reschedule(this.serialReceiveCyclesPerByte)}}function ru(t){const e=this;function s(){e.reg=0,e.transmitRate=0,e.receiveRate=0}const i=[19200,9600,4800,2400,1200,300,150,75];function r(s,r){r&=255,e.reg=r,e.transmitRate=7&r,e.receiveRate=r>>>3&7,t.setSerialReceive(i[e.receiveRate]),t.setMotor(!!(128&r)),t.selectRs423(!!(64&r))}e.reset=s,e.write=r,e.read=function(){return r(0,254),0},s()}const nu=128,ou=64;class au{constructor(t,e){this.hostCpu=t,this.parasiteCpu=e,this.internalStatusRegister=0,this.hostStatus=new Uint8Array(4),this.parasiteStatus=new Uint8Array(4),this.parasiteToHostData=[new Uint8Array(24),new Uint8Array(1),new Uint8Array(2),new Uint8Array(1)],this.hostToParasiteData=[new Uint8Array(1),new Uint8Array(1),new Uint8Array(2),new Uint8Array(1)],this.parasiteToHostFifoByteCount1=0,this.parasiteToHostFifoByteCount3=0,this.hostToParasiteFifoByteCount3=0,this.debug=!1}reset(t=!0){t&&(this.internalStatusRegister=0);for(let t=0;t<4;t++)this.hostStatus[t]=ou,this.parasiteStatus[t]=ou,2===t&&(this.hostStatus[t]|=nu,this.parasiteToHostData[t][0]=0);this.parasiteToHostFifoByteCount1=0,this.parasiteToHostFifoByteCount3=1,this.hostToParasiteFifoByteCount3=0,this.updateInterrupts()}updateInterrupts(){this.hostStatus[3]&nu&&1&this.internalStatusRegister?this.hostCpu.interrupt|=8:this.hostCpu.interrupt&=-9,this.parasiteStatus[0]&nu&&2&this.internalStatusRegister||this.parasiteStatus[3]&nu&&4&this.internalStatusRegister?this.parasiteCpu.interrupt=!0:this.parasiteCpu.interrupt=!1;const t=16&this.internalStatusRegister?2:1;8&this.internalStatusRegister&&(this.hostToParasiteFifoByteCount3>=t||0===this.parasiteToHostFifoByteCount3)?this.parasiteCpu.nmi=!0:this.parasiteCpu.nmi=!1,this.parasiteCpu.resetHeldLow=32&this.internalStatusRegister}hostRead(t){let e=254;switch(7&t){case 0:e=192&this.hostStatus[0]|-193&this.internalStatusRegister;break;case 1:if(e=this.parasiteToHostData[0][0],this.hostStatus[0]&nu){for(let t=1;t<24;t++)this.parasiteToHostData[0][t-1]=this.parasiteToHostData[0][t];this.parasiteStatus[0]|=ou,this.parasiteToHostFifoByteCount1--,0===this.parasiteToHostFifoByteCount1&&(this.hostStatus[0]&=-129)}break;case 2:e=this.hostStatus[1];break;case 3:e=this.parasiteToHostData[1][0],this.parasiteStatus[1]|=ou,this.hostStatus[1]&=-129;break;case 4:e=this.hostStatus[2];break;case 5:e=this.parasiteToHostData[2][0],this.hostStatus[2]&nu&&(this.parasiteToHostData[2][0]=this.parasiteToHostData[2][1],this.parasiteStatus[2]|=ou,this.parasiteToHostFifoByteCount3--,0===this.parasiteToHostFifoByteCount3&&(this.hostStatus[2]&=-129));break;case 6:e=this.hostStatus[3];break;case 7:e=this.parasiteToHostData[3][0],this.parasiteStatus[3]|=ou,this.hostStatus[3]&=-129}return this.updateInterrupts(),this.debug&&console.log("TUBE ULA: host read "+hh(t)+" = "+ch(e)),e}hostWrite(t,e){switch(this.debug&&console.log("TUBE ULA: host write "+hh(t)+" = "+ch(e)),7&t){case 0:128&e?this.internalStatusRegister|=-193&e:this.internalStatusRegister&=~(-193&e),64&e&&this.reset(!1),32&e&&32&this.internalStatusRegister&&this.parasiteCpu.reset(!0);break;case 1:this.hostStatus[0]&ou&&(this.hostToParasiteData[0][0]=e,this.parasiteStatus[0]|=nu,this.hostStatus[0]&=-65);break;case 3:this.hostStatus[1]&ou&&(this.hostToParasiteData[1][0]=e,this.parasiteStatus[1]|=nu,this.hostStatus[1]&=-65);break;case 5:this.hostStatus[2]&ou&&(16&this.internalStatusRegister?(this.hostToParasiteFifoByteCount3<2&&(this.hostToParasiteData[this.hostToParasiteFifoByteCount3++]=e),2===this.hostToParasiteFifoByteCount3&&(this.parasiteStatus[2]|=nu,this.hostStatus[2]&=-65)):(this.hostToParasiteData[2][0]=e,this.hostToParasiteFifoByteCount3=1,this.parasiteStatus[2]|=nu,this.hostStatus[2]&=-65));break;case 7:this.hostStatus[3]&ou&&(this.hostToParasiteData[3][0]=e,this.parasiteStatus[3]|=nu,this.hostStatus[3]&=-65)}this.updateInterrupts()}parasiteRead(t){let e=0;switch(7&t){case 0:e=this.parasiteStatus[0];break;case 1:e=this.hostToParasiteData[0][0],this.hostStatus[0]|=ou,this.parasiteStatus[0]&=-129;break;case 2:e=this.parasiteStatus[1];break;case 3:e=this.hostToParasiteData[1][0],this.hostStatus[1]|=ou,this.parasiteStatus[1]&=-129;break;case 4:e=this.parasiteStatus[2];break;case 5:e=this.hostToParasiteData[2][0],this.parasiteStatus[2]&nu&&(this.hostToParasiteData[2][0]=this.hostToParasiteData[2][1],this.hostToParasiteFifoByteCount3--,0===this.hostToParasiteFifoByteCount3&&(this.hostStatus[2]|=ou,this.parasiteStatus[2]&=-129));break;case 6:e=this.parasiteStatus[3];break;case 7:e=this.hostToParasiteData[3][0],this.hostStatus[3]|=ou,this.parasiteStatus[3]&=-129}return this.updateInterrupts(),this.debug&&console.log("TUBE ULA: parasite read "+hh(t)+" = "+ch(e)),e}parasiteWrite(t,e){switch(this.debug&&console.log("TUBE ULA: parasite write "+hh(t)+" = "+ch(e)),7&t){case 1:this.parasiteStatus[0]&ou&&(this.parasiteToHostData[0][this.parasiteToHostFifoByteCount1++]=e,this.hostStatus[0]|=nu,24===this.parasiteToHostFifoByteCount1&&(this.parasiteStatus[0]&=-65));break;case 3:this.parasiteStatus[1]&ou&&(this.parasiteToHostData[1][0]=e,this.hostStatus[1]|=nu,this.parasiteStatus[1]&=-65);break;case 5:this.parasiteStatus[2]&ou&&(16&this.internalStatusRegister?(this.parasiteToHostFifoByteCount3<2&&(this.parasiteToHostData[this.parasiteToHostFifoByteCount3++]=e),2===this.parasiteToHostFifoByteCount3&&(this.hostStatus[2]|=nu,this.parasiteStatus[2]&=-65)):(this.parasiteToHostData[0]=e,this.parasiteToHostFifoByteCount3=1,this.hostStatus[2]|=nu,this.parasiteStatus[2]&=-65));break;case 7:this.parasiteStatus[3]&ou&&(this.parasiteToHostData[3][0]=e,this.hostStatus[3]|=nu,this.parasiteStatus[3]&=-65)}this.updateInterrupts()}}class cu{constructor(t,e){this.sysvia=t,this.task=e.newTask(this.onComplete.bind(this)),this.status=64,this.low=0,this.high=0}read(t){switch(3&t){case 0:return this.status;case 1:return this.high;case 2:return this.low}return 64}write(t,e){0==(3&t)&&(this.task.cancel(),this.task.schedule(8&e?2e4:8e3),this.status=15&e|128,this.sysvia.setcb1(!0))}onComplete(){let t=32768;const e=this.sysvia.getGamepads();if(e&&e[0]){const s=e[0],i=e[1];let r=0;switch(Math.floor(3&this.status)){default:case 0:r=s.axes[0];break;case 1:r=s.axes[1];break;case 2:r=i?i.axes[0]:s.axes[2];break;case 3:r=i?i.axes[1]:s.axes[3]}t=Math.floor((1-r)/2*65535)}this.status=15&this.status|64|t>>>10&3,this.low=255&t,this.high=t>>>8&255,this.sysvia.setcb1(!1)}}class hu{constructor(){this.scheduled=null,this.epoch=0}schedule(t,e){if(t.scheduler!==this)throw new Error("Wrong scheduler for task, or non-task");if(t.scheduled())throw new Error("Task is already scheduled");const s=e+this.epoch;t.expireEpoch=s,t._scheduled=!0;let i=this.scheduled,r=null;for(;i&&i.expireEpoch<=s;)r=i,i=i.next;t.next=i,t.prev=r,t.next&&(t.next.prev=t),t.prev?t.prev.next=t:this.scheduled=t}cancel(t){t.scheduled()&&(t.prev?t.prev.next=t.next:this.scheduled=t.next,t.next&&(t.next.prev=t.prev),t.next=t.prev=null,t._scheduled=!1)}polltime(t){const e=this.epoch+t;for(;this.scheduled&&this.scheduled.expireEpoch<=e;){const t=this.scheduled;this.epoch=t.expireEpoch,t.cancel(),t.onExpire()}this.epoch=e}headroom(){return null===this.scheduled?4294967295:this.scheduled.expireEpoch-this.epoch}newTask(t){return new uu(this,t)}}class uu{constructor(t,e){this.scheduler=t,this.prev=this.next=null,this.expireEpoch=0,this.onExpire=e,this._scheduled=!1}scheduled(){return this._scheduled}schedule(t){this.scheduler.schedule(this,t)}reschedule(t){this.scheduler.cancel(this),this.scheduler.schedule(this,t)}cancel(){this.scheduler.cancel(this)}ensureScheduled(t,e){t?this.scheduled()||this.schedule(e):this.cancel()}}const lu=25e4;function du(t,e,s){return(t=(t-s)/(1-2*s))*e}class pu{constructor(t){this.scheduler=t,this.mouse=[],this.outBuffer=new Lh(16),this.delay=0,this.mode=0,this.pollTask=this.scheduler.newTask(this.poll)}tryReceive(t){return this.outBuffer.size&&t?this.outBuffer.get():-1}doRead(){const t=du(this.mouse.x,120,.13),e=du(1-this.mouse.y,100,.03),s=[79,79,79,79],i=0|Math.min(255,Math.max(0,t)),r=0|Math.min(255,Math.max(0,e));this.mouse.button&&(s[0]=64|(240&i)>>>4,s[1]=64|15&i,s[2]=64|(240&r)>>>4,s[3]=64|15&r);for(let t=0;t<4;++t)this.store(s[t]);this.store(".".charCodeAt(0))}poll(){this.doRead(),this.pollTask.reschedule(lu)}store(t){this.outBuffer.put(t)}onMouse(t,e,s){this.mouse={x:t,y:e,button:s}}onTransmit(t){switch(String.fromCharCode(t)){case"M":this.mode=0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this.mode=10*this.mode+t-"0".charCodeAt(0);break;case".":break;case"?":1===this.mode&&this.doRead()}this.pollTask.ensureScheduled(129===this.mode||130===this.mode,lu)}}class fu{constructor(t){this.cpu=t,this.teletextStatus=15,this.teletextInts=!1,this.teletextEnable=!1,this.channel=0,this.currentFrame=0,this.totalFrames=0,this.rowPtr=0,this.colPtr=0,this.frameBuffer=new Array(16).fill(0).map((()=>new Array(64).fill(0))),this.streamData=null,this.pollCount=0}reset(t){t&&(console.log("Teletext adaptor: initialisation"),this.loadChannelStream(this.channel))}loadChannelStream(t){console.log("Teletext adaptor: switching to channel "+t);const e=this;bh("teletext/txt"+t+".dat").then((function(t){e.streamData=t,e.totalFrames=t.length/860,e.currentFrame=0}))}read(t){let e=0;switch(t){case 0:e=this.teletextStatus;break;case 1:break;case 2:e=this.frameBuffer[this.rowPtr][this.colPtr++];break;case 3:this.teletextStatus&=-209,this.cpu.interrupt&=-33}return e}write(t,e){switch(t){case 0:this.teletextInts=8==(8&e),this.teletextInts&&128&this.teletextStatus?this.cpu.interrupt|=32:this.cpu.interrupt&=-33,this.teletextEnable=4==(4&e),(3&e)!==this.channel&&this.teletextEnable&&(this.channel=3&e,this.loadChannelStream(this.channel));break;case 1:this.rowPtr=e,this.colPtr=0;break;case 2:this.frameBuffer[this.rowPtr][this.colPtr++]=255&e;break;case 3:this.teletextStatus&=-209,this.cpu.interrupt&=-33}}polltime(t){this.pollCount+=t,this.pollCount>5e4&&(this.pollCount=0,this.cpu.resetLine?this.update():this.pollCount=-5e5)}update(){this.currentFrame>=this.totalFrames&&(this.currentFrame=0);const t=860*this.currentFrame+129;if(this.teletextStatus&=15,this.teletextStatus|=208,this.teletextEnable)for(let e=0;e<16;++e)if(0!==this.streamData[t+43*e]){this.frameBuffer[e][0]=103;for(let s=1;s<=42;s++)this.frameBuffer[e][s]=this.streamData[t+(43*e+(s-1))]}else this.frameBuffer[e][0]=0;this.currentFrame++,this.rowPtr=0,this.colPtr=0,this.teletextInts&&(this.cpu.interrupt|=32)}}class mu{constructor(){this.control1=0,this.control2=0,this.control3=0,this.control4=0,this.txfifo=new Uint8Array(3),this.rxfifo=new Uint8Array(3),this.txfptr=0,this.rxfptr=0,this.txftl=0,this.rxffc=0,this.rxap=0,this.status1=0,this.status2=0,this.sr2pse=0,this.cts=0,this.idle=0}}class gu{constructor(){if(arguments.length>0){this.buffer=new Uint8Array(32768),this.bytesInBuffer=arguments.length,this.pointer=0;for(let t=0;t<arguments.length;t++)this.buffer[t]=arguments[t]}else this.buffer=new Uint8Array(32768),this.bytesInBuffer=0,this.pointer=0;this.controlFlag=0,this.port=0}}class bu{constructor(t,e,s,i,r){this.id=t,this.controlFlag=e,this.receivePort=s,this.bufferStart=i,this.bufferEnd=r,this.data=new gu,this.stationId=0}}class vu{constructor(t){this.TIME_BETWEEN_BYTES=128,this.SERVER_STATION_ID=254,this.FWH_Idle=0,this.FWH_RX_Scout_Received=1,this.FWH_RX_ScoutAck_Received=2,this.FWH_RX_Body_Received=3,this.FWH_TX_Scout_Sent=4,this.stationId=t,this.ADLC=new mu,this.ADLCprev=new mu,this.beebTx=new gu,this.beebRx=new gu,this.serverTx=new gu,this.pollTotalCycles=0,this.pollNextTrigger=0,this.powers=[1,2,4,8],this.econetNMIEnabled=!0,this.econetStateChanged=!1,this.receiveBlocks=[],this.nextReceiveBlockNumber=1,this.wireState=this.FWH_Idle,this.wireStateEntryTimer=0,this.statusLight=!1,this.txPort=0,this.txControlFlag=0}copyBuffer(t,e){t.bytesInBuffer=e.bytesInBuffer,t.pointer=e.pointer,t.buffer=e.buffer.slice()}sniffBuffer(t){let e=Math.min(30,t.pointer),s="";for(let i=0;i<e;i++)s+=(t.buffer[i]<16?"0":"")+t.buffer[i].toString(16)+" ";return s+="("+t.pointer+" bytes)",s}deleteReceiveBlock(t){let e=this.receiveBlocks.findIndex((e=>e.id===t));e>=0&&this.receiveBlocks.splice(e,1)}activityLight(){return this.statusLight}advanceState(t){this.wireState=t,this.wireStateEntryTimer=this.pollTotalCycles,this.wireState>0&&(this.statusLight=!0)}polltime(t){if(this.pollTotalCycles+=t,this.pollNextTrigger<=this.pollTotalCycles||this.econetStateChanged){if(this.econetStateChanged=!1,this.wireState===this.FWH_Idle&&this.serverTx.bytesInBuffer>0&&(this.beebRx=new gu(this.stationId,0,this.SERVER_STATION_ID,0,this.serverTx.controlFlag,this.serverTx.port),this.advanceState(this.FWH_RX_Scout_Received)),this.wireState===this.FWH_RX_ScoutAck_Received&&(this.copyBuffer(this.beebRx,this.serverTx),this.advanceState(this.FWH_RX_Body_Received)),this.pollTotalCycles>this.wireStateEntryTimer+1e6)if(this.wireState!==this.FWH_Idle)switch(this.wireState){case this.FWH_RX_Scout_Received:this.beebRx=new gu(this.stationId,0,this.SERVER_STATION_ID,0,this.serverTx.controlFlag,this.serverTx.port),this.advanceState(this.FWH_RX_Scout_Received);break;case this.FWH_RX_Body_Received:this.copyBuffer(this.beebRx,this.serverTx),this.advanceState(this.FWH_RX_Body_Received);break;default:this.beebRx=new gu(this.SERVER_STATION_ID,0,this.stationId,0)}else this.statusLight=!1;return this.updateRegisters(),this.pollNextTrigger<=this.pollTotalCycles&&(this.transmit(),this.receive()),this.status(),this.checkForNMI()}return!1}reset(){console.log("Econet: initialisation"),this.ADLC.control1=192,this.ADLC.control4=0,this.ADLC.control2=0,this.ADLC.control3=0,this.ADLC.status1=0,this.ADLC.status2=0,this.ADLC.sr2pse=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.txfptr=0,this.ADLC.txftl=0,this.ADLC.idle=1,this.ADLC.cts=0,this.irqcause=0,this.sr1b2cause=0,this.pollNextTrigger=this.pollTotalCycles+this.TIME_BETWEEN_BYTES,this.econetStateChanged=!0,this.receiveBlocks=[],this.nextReceiveBlockNumber=1}readRegister(t){return 0===t?this.ADLC.status1:1===t?this.ADLC.status2:t>1&&0==(64&this.ADLC.control1)&&this.ADLC.rxfptr&&this.ADLC.rxfptr?(this.econetStateChanged=!0,this.ADLC.rxfifo[--this.ADLC.rxfptr]):0}writeRegister(t,e){0===t?this.ADLC.control1=e:1!==t||1&this.ADLC.control1?1===t&&1&this.ADLC.control1?this.ADLC.control3=e:3===t&&1&this.ADLC.control1?this.ADLC.control4=e:2!==t&&3!==t||0==(128&this.ADLC.control1)&&(this.ADLC.txfifo[2]=this.ADLC.txfifo[1],this.ADLC.txfifo[1]=this.ADLC.txfifo[0],this.ADLC.txfifo[0]=e,this.ADLC.txfptr++,this.ADLC.txftl=this.ADLC.txftl<<1,3===t&&(this.ADLC.control2|=16)):this.ADLC.control2=e,this.econetStateChanged=!0}updateRegisters(){this.ADLCprev.status1=this.ADLC.status1,this.ADLCprev.status2=this.ADLC.status2,32&this.ADLC.control1&&(this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.control1&=-33),16&this.ADLC.control2&&(this.ADLC.txftl|=1,this.ADLC.control2&=-17),(32&this.ADLC.control2||64&this.ADLC.control1)&&(this.ADLC.control2&=-33,this.ADLC.status1&=-11,this.ADLC.status2&=-127,1&this.ADLC.control2&&this.ADLC.sr2pse?(this.ADLC.sr2pse++,this.ADLC.sr2pse>4&&(this.ADLC.sr2pse=0)):this.ADLC.sr2pse=0,this.sr1b2cause=0,64&this.ADLC.control1&&(this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.sr2pse=0)),(64&this.ADLC.control2||128&this.ADLC.control1)&&(this.ADLC.control2&=-65,this.ADLC.status1&=-113,this.ADLC.cts&&(this.ADLC.status1|=16,this.ADLCprev.status1|=16),128&this.ADLC.control1&&(this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.txfptr=0,this.ADLC.txftl=0)),32&this.ADLC.control4&&(this.ADLC.txfptr=0,this.ADLC.txftl=0,this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.control4&=-33)}transmit(){if(!(128&this.ADLC.control1)&&this.ADLC.txfptr){let t=!1;if(this.ADLC.txftl&this.powers[this.ADLC.txfptr-1]&&(t=!0),this.beebTx.pointer>32768||this.ADLC.txfptr>4?(this.ADLC.status1|=32,this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.txfptr=0,this.ADLC.txftl=0):(this.beebTx.buffer[this.beebTx.pointer]=this.ADLC.txfifo[--this.ADLC.txfptr],this.beebTx.pointer++),t){if(this.beebTx.bytesInBuffer=this.beebTx.pointer,10===this.beebTx.bytesInBuffer&&0===this.beebTx.buffer[5]&&this.beebTx.buffer[4]>=130&&this.beebTx.buffer[4]<=136&&(this.beebRx=new gu(this.stationId,0,this.SERVER_STATION_ID,0,1,0,96,3)),4===this.beebTx.bytesInBuffer&&(this.wireState===this.FWH_RX_Scout_Received&&this.advanceState(this.FWH_RX_ScoutAck_Received),this.wireState===this.FWH_RX_Body_Received&&(this.serverTx.bytesInBuffer=0,this.advanceState(this.FWH_Idle))),this.beebTx.bytesInBuffer>=6&&this.wireState===this.FWH_TX_Scout_Sent){let t=this.receiveBlocks.find((t=>t.receivePort===this.txPort));t&&(this.copyBuffer(t.data,this.beebTx),t.stationId=this.stationId,t.controlFlag=this.txControlFlag),this.beebRx=new gu(this.stationId,0,this.SERVER_STATION_ID,0),this.advanceState(this.FWH_Idle)}6===this.beebTx.bytesInBuffer&&this.wireState===this.FWH_Idle&&(this.txControlFlag=this.beebTx.buffer[4],this.txPort=this.beebTx.buffer[5],this.receiveBlocks.find((t=>t.receivePort===this.txPort))&&(this.beebRx=new gu(this.stationId,0,this.SERVER_STATION_ID,0),this.advanceState(this.FWH_TX_Scout_Sent))),this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0}}}receive(){64&this.ADLC.control1||(this.beebRx.pointer<this.beebRx.bytesInBuffer&&this.ADLC.rxfptr<3&&(this.ADLC.rxfifo[2]=this.ADLC.rxfifo[1],this.ADLC.rxfifo[1]=this.ADLC.rxfifo[0],this.ADLC.rxfifo[0]=this.beebRx.buffer[this.beebRx.pointer],this.ADLC.rxfptr++,this.ADLC.rxffc=this.ADLC.rxffc<<1&7,this.ADLC.rxap=this.ADLC.rxap<<1&7,0===this.beebRx.pointer&&(this.ADLC.rxap|=1),this.beebRx.pointer++,this.beebRx.pointer>=this.beebRx.bytesInBuffer&&(this.ADLC.rxffc|=1,this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0)),0===this.ADLC.rxfptr&&(this.ADLC.control1&=-33)),64&this.ADLC.control1||this.ADLC.rxfptr||2&this.ADLC.status2||0!==this.beebRx.bytesInBuffer?this.ADLC.idle=!1:this.ADLC.idle=!0,this.pollNextTrigger=this.pollTotalCycles+this.TIME_BETWEEN_BYTES}status(){64&this.ADLC.control1||(this.ADLC.rxfptr&&!(2&this.ADLC.control2)||this.ADLC.rxfptr>1&&2&this.ADLC.control2?(this.ADLC.status1|=1,this.ADLC.status2|=128):(this.ADLC.status1&=-2,this.ADLC.status2&=-129)),this.ADLC.status1&=-9,128&this.ADLC.control2?(this.ADLC.cts=!1,this.ADLC.status1&=-17):this.ADLC.cts=!0,128&this.ADLC.control1&&this.ADLC.cts&&(this.ADLC.status1|=16),this.ADLC.txfptr>4&&(this.ADLC.status1|=32,this.ADLC.txfptr=4),128&this.ADLC.control1||(8&this.ADLC.control2?this.ADLC.txfptr?this.ADLC.status1&=-65:this.ADLC.status1|=64:!(this.ADLC.txfptr<3&&!(2&this.ADLC.control2)||this.ADLC.txfptr<2&&2&this.ADLC.control2)||16&this.ADLC.status1||32&this.ADLC.status2?this.ADLC.status1&=-65:this.ADLC.status1|=64),64&this.ADLC.control1||(this.ADLC.rxfptr&&this.ADLC.rxap&this.powers[this.ADLC.rxfptr-1]?this.ADLC.status2|=1:this.ADLC.status2&=-2,this.ADLC.rxfptr&&this.ADLC.rxffc&this.powers[this.ADLC.rxfptr-1]&&(this.ADLC.status2|=2),this.ADLC.idle?this.ADLC.status2|=4:this.ADLC.status2&=-5),this.ADLC.status2&=-33,this.ADLC.rxfptr>4&&(this.ADLC.status2|=64,this.ADLC.rxfptr=4),1&this.ADLC.control2?(this.ADLC.sr2pse<=1&&122&this.ADLC.status2?(this.ADLC.sr2pse=1,this.ADLC.status2&=-134):this.ADLC.sr2pse<=2&&4&this.ADLC.status2?(this.ADLC.sr2pse=2,this.ADLC.status2&=-130):this.ADLC.sr2pse<=3&&1&this.ADLC.status2?(this.ADLC.sr2pse=3,this.ADLC.status2&=-129):128&this.ADLC.status2?(this.ADLC.sr2pse=4,this.ADLC.status2&=-3):this.ADLC.sr2pse=0,128&this.ADLC.status2?this.ADLC.status1|=1:this.ADLC.status1&=-2):this.ADLC.sr2pse=0}checkForNMI(){let t=!1;if(this.ADLC.status1!==this.ADLCprev.status1||this.ADLC.status2!==this.ADLCprev.status2){let e,s;e=(this.ADLC.status2^this.ADLCprev.status2)&this.ADLC.status2&-129,2&this.ADLC.control1||(e=0),e?(this.ADLC.status1|=2,this.sr1b2cause=this.sr1b2cause|e):this.ADLC.status2&this.sr1b2cause||(this.ADLC.status1&=-3,this.sr1b2cause=0),e=(this.ADLC.status1^this.ADLCprev.status1)&this.ADLC.status1&-129,2&this.ADLC.control1||(e&=-12),4&this.ADLC.control1||(e&=-113),e&&(t=!0,this.irqcause=this.irqcause|e,this.ADLC.status1|=128),s=(this.ADLC.status1^this.ADLCprev.status1)&this.ADLCprev.status1&-129,s&&(this.irqcause=this.irqcause&~s,0===this.irqcause?this.ADLC.status1&=-129:1&this.ADLC.control2&&(t=!0))}return t}}class yu{constructor(t,e){this.cpu=t,this.econet=e,this.scsi=[],this.l3fs=[],this.pollCount=0,this.ram=new Uint8Array(98304),this.emulationSpeed=0,this.logTemp="",this.A=this.X=this.Y=this.SP=this.M=0,this.PC=this.XPC=this.L=this.R=0,this.N=this.V=this.Z=this.C=this.F=0}GBYTE(){return this.ram[this.PC++]}GWORD(){return this.ram[this.PC++]|this.ram[this.PC++]<<8}WORD(t){return this.ram[t]|this.ram[t+1]<<8}PUSH(t){this.ram[256+this.SP]=t,this.SP--,this.SP&=255}PULL(){return this.SP++,this.SP&=255,this.ram[256+this.SP]}NZ(t){return t&=255,this.Z=0|0===t,this.N=0|t>=128,t}oswrch(t){0===this.emulationSpeed&&(t>=32&&t<=127&&(this.logTemp+=String.fromCharCode(t)),13===t&&(console.log("Filestore: "+this.logTemp.trim()),this.logTemp.includes("Starting")&&(this.emulationSpeed=20),this.logTemp=""))}osword(){let t=this.Y<<8|this.X;switch(this.A){case 0:{let e=this.ram[t]|this.ram[t+1]<<8;this.ram[e]=49,this.ram[e+1]=13,this.Y=1,this.C=0,this.oswrch(49);break}case 14:{const e=new Date;this.ram[t]=e.getFullYear()-2e3,this.ram[t+1]=e.getMonth()+1,this.ram[t+2]=e.getDate(),this.ram[t+3]=e.getDay()+1,this.ram[t+4]=e.getHours(),this.ram[t+5]=e.getMinutes(),this.ram[t+6]=e.getSeconds();break}case 16:{let e=this.ram[t+2];if(255!==e){let s=(this.ram[t+4]|this.ram[t+5]<<8|this.ram[t+6]<<16|this.ram[t+7]<<24)>>>0,i=((this.ram[t+8]|this.ram[t+9]<<8|this.ram[t+10]<<16|this.ram[t+11]<<24)>>>0)-s;s>=65536&&(s=65535&s|65536),this.econet.serverTx=new gu(e,0,254,0),this.econet.serverTx.controlFlag=this.ram[t],this.econet.serverTx.port=this.ram[t+1];for(let t=0;t<i;t++)this.econet.serverTx.buffer[t+4]=this.ram[s+t];this.econet.serverTx.bytesInBuffer=4+i}break}case 17:if(0===this.ram[t+0]){let e=new bu(this.econet.nextReceiveBlockNumber,this.ram[t+1],this.ram[t+2],(this.ram[t+5]|this.ram[t+6]<<8|this.ram[t+7]<<16|this.ram[t+8]<<24)>>>0,(this.ram[t+9]|this.ram[t+10]<<8|this.ram[t+11]<<16|this.ram[t+12]<<24)>>>0);this.econet.receiveBlocks.push(e),this.ram[t]=this.econet.nextReceiveBlockNumber,this.econet.nextReceiveBlockNumber++,this.econet.nextReceiveBlockNumber&=255,0===this.econet.nextReceiveBlockNumber&&(this.econet.nextReceiveBlockNumber=1)}else{let e=this.econet.receiveBlocks.find((e=>e.id===this.ram[t+0]));e.bufferStart+e.data.bytesInBuffer-4<e.bufferEnd&&(e.bufferEnd=e.bufferStart+e.data.bytesInBuffer-4),this.ram[t+1]=e.controlFlag,this.ram[t+2]=e.receivePort,this.ram[t+3]=e.stationId,this.ram[t+4]=0,this.ram[t+5]=255&e.bufferStart,this.ram[t+6]=e.bufferStart>>>8&255,this.ram[t+7]=e.bufferStart>>>16&255,this.ram[t+8]=e.bufferStart>>>24&255,this.ram[t+9]=255&e.bufferEnd,this.ram[t+10]=e.bufferEnd>>>8&255,this.ram[t+11]=e.bufferEnd>>>16&255,this.ram[t+12]=e.bufferEnd>>>24&255;let s=e.bufferStart;s>=65536&&(s=65535&s|65536);for(let t=0;t<e.bufferEnd-e.bufferStart;t++)this.ram[s+t]=e.data.buffer[t+4];this.econet.deleteReceiveBlock(this.ram[t])}break;case 19:this.ram[t+1]=254;break;case 114:{let e=(this.ram[t+1]|this.ram[t+2]<<8|this.ram[t+3]<<16|this.ram[t+4]<<24)>>>0;e>=65536&&(e=65535&e|65536);let s=4,i=(31&this.ram[t+6])<<16|this.ram[t+7]<<8|this.ram[t+8],r=256*this.ram[t+9];switch(r||(r=this.ram[t+11]|this.ram[t+12]<<8|this.ram[t+13]<<16|this.ram[t+14]<<24>>>0),this.ram[t+5]){case 8:case 10:if(8===this.ram[t+5])for(let t=256*i;t<256*i+r;t++)this.ram[e++]=this.scsi[t];else for(let t=256*i;t<256*i+r;t++)this.scsi[t]=this.ram[e++];s=0}this.ram[t]=s;break}case 115:this.ram[t]=0,this.ram[t+1]=0,this.ram[t+2]=0,this.ram[t+3]=0,this.ram[t+4]=0;break;default:console.log("Filestore: unhandled osword 0x"+this.A.toString(16))}}osbyte(){switch(this.A){case 13:case 14:case 15:case 53:case 135:case 150:case 151:case 229:break;case 50:this.econet.serverTx.bytesInBuffer>0?this.X=128:this.X=0;break;case 51:{let t=this.econet.receiveBlocks.find((t=>t.id===this.X));this.X=0,t&&(this.X=t.controlFlag,this.X>=128&&(this.X=t.controlFlag));break}case 52:this.econet.deleteReceiveBlock(this.X);break;case 133:this.X=0,this.Y=128;break;case 134:this.X=this.Y=0;break;case 180:this.X=0;break;default:console.log("Filestore: unhandled osbyte 0x"+this.A.toString(16))}}reset(){console.log("Filestore: initialisation");const t=this;bh("econet/L3FS.dat").then((function(e){t.l3fs=e;for(let s=0;s<e.length;s++)t.ram[1024+s]=e[s];t.PC=1024,t.SP=255,t.A=1})),bh("econet/scsi.dat").then((function(e){t.scsi=e}))}polltime(t){if(this.pollCount+=t,this.pollCount>this.emulationSpeed){this.pollCount=0;let t,e,s,i=0;if(this.XPC=this.PC,t=this.PC>=63488?96:this.GBYTE(),e=31&t,s=3&e,i=t>>5,0===e&&i<4)switch(i){case 0:this.PC=this.WORD(514);break;case 1:this.L=this.GWORD(),this.PUSH(--this.PC>>8),this.PUSH(this.PC),this.PC=this.L;break;case 2:break;case 3:this.PC=this.PULL(),this.PC|=this.PULL()<<8,this.PC++}else if(8===e)switch(i){case 0:this.M=this.N<<7|this.V<<6|this.Z<<1|this.C,this.PUSH(this.M);break;case 1:this.M=this.PULL(),this.N=(128&this.M)>0,this.V=(64&this.M)>0,this.Z=(2&this.M)>0,this.C=1&this.M;break;case 2:this.PUSH(this.A);break;case 3:this.A=this.NZ(this.PULL());break;case 4:this.Y--,this.Y&=255,this.NZ(this.Y);break;case 5:this.Y=this.NZ(this.A);break;case 6:this.Y++,this.Y&=255,this.NZ(this.Y);break;case 7:this.X++,this.X&=255,this.NZ(this.X)}else if(10===e&&i>3)switch(i){case 4:this.A=this.NZ(this.X);break;case 5:this.X=this.NZ(this.A);break;case 6:this.X--,this.X&=255,this.NZ(this.X)}else if(16===e){let t=1&~i;switch(i>>1){case 0:t^=this.N;break;case 1:t^=this.V;break;case 2:t^=this.C;break;case 3:t^=this.Z}this.M=this.GBYTE(),t&&(128&this.M&&(this.PC-=256),this.PC+=this.M)}else if(24===e)switch(i){case 0:this.C=0;break;case 1:this.C=1;break;case 2:case 3:case 6:case 7:break;case 4:this.A=this.NZ(this.Y);break;case 5:this.V=0}else if(26===e)1&i?this.X=this.NZ(this.SP):this.SP=this.X;else{let r=0,n=0,o=0;if(10===e)r=1;else if(1===e)this.L=this.GBYTE()+this.X,this.L=this.WORD(this.L);else if(25===e||190===t)this.L=this.GWORD()+this.Y;else switch(e>>2){case 0:case 2:n=1;break;case 1:this.L=this.GBYTE();break;case 3:this.L=this.GWORD();break;case 4:this.L=this.GBYTE(),this.L=this.WORD(this.L)+this.Y;break;case 5:this.L=150===t?this.GBYTE()+this.Y:this.GBYTE()+this.X;break;case 7:this.L=this.GWORD()+this.X}switch(this.M=r?this.A:n?this.GBYTE():this.ram[this.L],s){case 0:switch(i){case 1:this.NZ(this.A&this.M),this.V=(64&this.M)>0,this.N=(128&this.M)>0;break;case 2:this.PC=this.L;break;case 3:this.PC=this.WORD(this.L);break;case 4:this.M=this.Y,o=1;break;case 5:this.Y=this.NZ(this.M);break;case 6:this.NZ(this.Y-this.M),this.C=this.Y>=this.M;break;case 7:this.NZ(this.X-this.M),this.C=this.X>=this.M}break;case 1:switch(i){case 0:this.A=this.NZ(this.A|this.M);break;case 1:this.A=this.NZ(this.A&this.M);break;case 2:this.A=this.NZ(this.A^this.M);break;case 7:this.M=255&~this.M;case 3:this.R=this.A+this.M+this.C,this.C=this.R>=256,this.V=((this.A^this.R)&(this.M^this.R)&128)>0,this.A=this.NZ(this.R);break;case 4:this.M=this.A,o=1;break;case 5:this.A=this.NZ(this.M);break;case 6:this.NZ(this.A-this.M),this.C=this.A>=this.M}break;case 2:switch(o=1,i){case 0:this.C=0;case 1:this.F=(128&this.M)>0,this.M=this.NZ(this.M<<1|this.C),this.C=this.F;break;case 2:this.C=0;case 3:this.F=1&this.M,this.M=this.NZ(this.M>>1|this.C<<7),this.C=this.F;break;case 4:this.M=this.X;break;case 5:this.X=this.NZ(this.M),o=0;break;case 6:this.M--,this.M&=255,this.NZ(this.M);break;case 7:this.M++,this.M&=255,this.NZ(this.M)}}o&&(r?this.A=this.M:this.ram[this.L]=this.M)}if(this.PC>=63488)switch(this.PC){case 63488:case 65527:default:break;case 65504:this.A=83,this.C=0;break;case 65521:this.osword();break;case 65524:this.osbyte();break;case 65511:case 65507:case 65518:this.oswrch(this.A)}}}}const wu=lh;function Cu(t,e,s){return t&~e|(s?e:0)}class Au{constructor(){this._byte=48}get c(){return!!(1&this._byte)}set c(t){this._byte=Cu(this._byte,1,t)}get z(){return!!(2&this._byte)}set z(t){this._byte=Cu(this._byte,2,t)}get i(){return!!(4&this._byte)}set i(t){this._byte=Cu(this._byte,4,t)}get d(){return!!(8&this._byte)}set d(t){this._byte=Cu(this._byte,8,t)}get v(){return!!(64&this._byte)}set v(t){this._byte=Cu(this._byte,64,t)}get n(){return!!(128&this._byte)}set n(t){this._byte=Cu(this._byte,128,t)}reset(){this._byte=48}debugString(){return(this.n?"N":"n")+(this.v?"V":"v")+"xx"+(this.d?"D":"d")+(this.i?"I":"i")+(this.z?"Z":"z")+(this.c?"C":"c")}setzn(t){return t&=255,this._byte=-131&this._byte|128&t|(0===t?2:0),0|t}asByte(){return 48|this._byte}setFromByte(t){this._byte=48|t}}class _u{constructor(t){this.model=t,this.a=this.x=this.y=this.s=0,this.p=new Au,this.pc=0,this.opcodes=t.nmos?Jh(this,Yh,!1):function(t){return Jh(t,Qh,!0)}(this),this.disassembler=this.opcodes.disassembler,this.forceTracing=!1,this.runner=this.opcodes.runInstruction,this.interrupt=0,t.nmos?(this.adc=function(t){this.p.d?this.adcBCD(t):this.adcNonBCD(t)},this.sbc=function(t){this.p.d?this.sbcBCD(t):this.adcNonBCD(255^t)}):(this.adc=function(t){this.p.d?this.adcBCDcmos(t):this.adcNonBCD(t)},this.sbc=function(t){this.p.d?this.sbcBCDcmos(t):this.adcNonBCD(255^t)})}incpc(){this.pc=this.pc+1&65535}getb(){const t=this.readmem(this.pc);return this.incpc(),0|t}getw(){let t=0|this.readmem(this.pc);return this.incpc(),t|=(0|this.readmem(this.pc))<<8,this.incpc(),0|t}checkInt(){this.takeInt=!(!this.interrupt||this.p.i),this.takeInt|=this.nmi}writemem(t,e){throw new Error("Must be overridden")}writememZpStack(t,e){this.writemem(t,e)}readmem(t){throw new Error("Must be overridden")}readmemZpStack(t){return this.readmem(t)}push(t){this.writememZpStack(256+this.s,t),this.s=this.s-1&255}pull(){return this.s=this.s+1&255,this.readmemZpStack(256+this.s)}NMI(t){this.nmi=!!t}polltime(){throw new Error("Must be overridden")}brk(t){let e=this.pc;t||(e=e+1&65535),this.readmem(e),this.push(e>>>8),this.push(255&e);let s=this.p.asByte();t&&(s&=-17),this.push(s),this.polltime(4);let i=65534;(this.model.nmos||t)&&this.nmi&&(i=65530,this.nmi=!1),this.takeInt=!1,this.pc=this.readmem(i)|this.readmem(i+1)<<8,this.p.i=!0,this.model.nmos?this.polltime(3):(this.p.d=!1,t?this.polltime(3):(this.polltime(2),this.checkInt(),this.polltime(1)))}branch(t){const e=wu(this.getb());if(!t)return this.polltime(1),this.checkInt(),void this.polltime(1);const s=this.pc+e&65535,i=!!(65280&this.pc^65280&s);if(this.pc=s,this.model.nmos)if(i){this.polltime(1),this.checkInt();const t=this.takeInt;this.polltime(2),this.checkInt(),this.takeInt|=t,this.polltime(1)}else this.polltime(1),this.checkInt(),this.polltime(2);else this.polltime(2+i),this.checkInt(),this.polltime(1)}adcNonBCD(t){const e=this.a+t+(this.p.c?1:0);this.p.v=!!((this.a^e)&(t^e)&128),this.p.c=!!(256&e),this.a=this.p.setzn(e)}adcBCD(t){let e=0;const s=this.a+t+(this.p.c?1:0)&255;this.p.z=!s;let i=(15&this.a)+(15&t)+(this.p.c?1:0);i>9&&(i-=10,i&=15,e=1),e+=(this.a>>>4)+(t>>>4),this.p.n=!!(8&e),this.p.v=!(128&(this.a^t)||!(128&(this.a^e<<4))),this.p.c=!1,e>9&&(this.p.c=!0,e-=10,e&=15),this.a=255&(15&i|e<<4)}sbcBCD(t){const e=this.p.c?0:1;let s=(15&this.a)-(15&t)-e,i=(this.a>>>4)-(t>>>4);16&s&&(s=s-6&15,i--),16&i&&(i=i-6&15);const r=this.a-t-e;this.p.n=!!(128&r),this.p.z=!(255&r),this.p.v=!!((this.a^r)&(t^this.a)&128),this.p.c=!(256&r),this.a=s|i<<4}adcBCDcmos(t){this.polltime(1);const e=this.p.c?1:0;let s=(15&this.a)+(15&t)+e,i=(this.a>>>4)+(t>>>4);s>9&&(s=s-10&15,i++),this.p.v=!(128&(this.a^t)||!(128&(this.a^i<<4))),this.p.c=!1,i>9&&(i=i-10&15,this.p.c=!0),this.a=this.p.setzn(s|i<<4)}sbcBCDcmos(t){this.polltime(1);const e=this.p.c?0:1,s=(15&this.a)-(15&t)-e;let i=this.a-t-e;i<0&&(i-=96),s<0&&(i-=6),this.adcNonBCD(255^t),this.a=this.p.setzn(i)}arr(t){if(this.p.d){const e=this.a&t,s=e>>>4,i=15&e;this.p.n=this.p.c,this.a=e>>>1|(this.p.c?128:0),this.p.z=!this.a,this.p.v=64&(e^this.a),i+(1&i)>5&&(this.a=240&this.a|this.a+6&15),this.p.c=s+(1&s)>5,this.p.c&&(this.a=this.a+96&255)}else this.a=this.a&t,this.p.v=!!(1&(this.a>>>7^this.a>>>6)),this.a>>>=1,this.p.c&&(this.a|=128),this.p.setzn(this.a),this.p.c=!!(64&this.a)}}class xu extends _u{constructor(t,e){super(t),this.cycles=0,this.romPaged=!0,this.memory=new Uint8Array(65536),this.rom=new Uint8Array(4096),this.tube=new au(e,this)}reset(t){this.romPaged=!0,this.pc=this.readmem(65532)|this.readmem(65533)<<8,this.p.i=!0,this.tube.reset(t)}readmem(t){return 65272==(65528&t)?(0==(7&t)&&(this.romPaged=!1),this.tube.parasiteRead(t)):this.romPaged&&61440==(61440&t)?this.rom[4095&t]:this.memory[65535&t]}readmemZpStack(t){return this.memory[65535&t]}writemem(t,e){if(65272==(65528&t))return this.tube.parasiteWrite(t,e);this.memory[65535&t]=e}writememZpStack(t,e){this.memory[65535&t]=e}polltime(t){this.cycles-=t}polltimeAddr(t){this.polltime(t)}read(t){return this.tube.hostRead(t)}write(t,e){this.tube.hostWrite(t,e)}execute(t){if(this.cycles+=2*t,!(this.cycles<3))for(;this.cycles>0;){const t=this.readmem(this.pc);this.incpc(),this.runner.run(t),this.takeInt&&this.brk(!0)}}async loadOs(){console.log("Loading tube rom from roms/"+this.model.os);const t=this.rom,e=await bh("roms/"+this.model.os),s=e.length;if(2048!==s)throw new Error("Broken ROM file (length="+s+")");for(let i=0;i<s;++i)t[i+2048]=e[i]}}class Su{read(){return 254}write(){}execute(){}reset(){}}class Tu{write(){}read(){return 255}}class ku{constructor(t,e){this.cpu=t,this.functionName=e,this.handlers=[]}add(t){const e=this;return this.handlers.push(t),this.cpu[this.functionName]||(this.cpu[this.functionName]=function(){for(let t=0;t<e.handlers.length;++t){const s=e.handlers[t];if(s.apply(s,arguments))return e.cpu.stop(),!0}return!1}),t.remove=function(){e.remove(t)},t}remove(t){const e=this.handlers.indexOf(t);if(e<0)throw"Unable to find debug hook handler";this.handlers=this.handlers.slice(0,e).concat(this.handlers.slice(e+1)),0===this.handlers.length&&(this.cpu[this.functionName]=null)}clear(){this.handlers=[],this.cpu[this.functionName]=null}}class Eu extends _u{constructor(t,e,s,i,r,n,o,a,c){super(t),this.config=function(t){return void 0===t&&(t={}),t.keyLayout||(t.keyLayout="physical"),t.cpuMultiplier||(t.cpuMultiplier=1),t.userPort||(t.userPort=new Tu),void 0===t.printerPort&&(t.printerPort=null),t.extraRoms=t.extraRoms||[],t}(a),this.cmos=o,this.debugger=e,this.video=s,this.soundChip=i,this.music5000=n,this.ddNoise=r,this.memStatOffsetByIFetchBank=0,this.memStatOffset=0,this.memStat=new Uint8Array(512),this.memLook=new Int32Array(512),this.ramRomOs=new Uint8Array(4587520),this.romOffset=131072,this.osOffset=this.romOffset+262144,this.romsel=0,this.acccon=0,this.oldPcArray=new Uint16Array(256),this.oldAArray=new Uint8Array(256),this.oldXArray=new Uint8Array(256),this.oldYArray=new Uint8Array(256),this.oldPcIndex=0,this.resetLine=!0,this.cpuMultiplier=this.config.cpuMultiplier,this.videoCyclesBatch=0|this.config.videoCyclesBatch,this.peripheralCyclesPerSecond=2e6,this.tube=t.tube?new xu(t.tube,this):new Su,this.music5000PageSel=0,this.econet=c,this.peripheralCycles=0,this.videoCycles=0,1===this.cpuMultiplier&&0===this.videoCyclesBatch?this.polltime=this.polltimeFast:this.polltime=this.polltimeSlow,this._debugRead=this._debugWrite=this._debugInstruction=null,this.debugInstruction=new ku(this,"_debugInstruction"),this.debugRead=new ku(this,"_debugRead"),this.debugWrite=new ku(this,"_debugWrite")}getPrevPc(t){return this.oldPcArray[this.oldPcIndex-t&255]}romSelect(t){this.romsel=t;const e=((15&t)<<14)+this.romOffset-32768;for(let t=128;t<192;++t)this.memLook[t]=this.memLook[256+t]=e;const s=this.model.swram[15&t]?1:2;for(let t=128;t<192;++t)this.memStat[t]=this.memStat[256+t]=s;if(this.model.isMaster&&128&t)for(let t=128;t<144;++t)this.memLook[t]=this.memLook[256+t]=0,this.memStat[t]=this.memStat[256+t]=1}writeAcccon(t){this.acccon=t,this.videoDisplayPage=1&t?32768:0;const e=!!(2&t),s=!!(4&t),i=!!(8&t);for(let t=48;t<128;++t)this.memLook[t]=s?32768:0,this.memLook[t+256]=i?this.memLook[t]:e?32768:0;const r=i?1:2,n=i?-12288:this.osOffset-49152;for(let t=192;t<224;++t)this.memLook[t]=this.memLook[t+256]=n,this.memStat[t]=this.memStat[t+256]=r}readmemZpStack(t){t&=65535;const e=this.ramRomOs[t];return this._debugRead&&this._debugRead(t,0,e),0|e}writememZpStack(t,e){t&=65535,e|=0,this._debugWrite&&this._debugWrite(t,e),this.ramRomOs[t]=e}readString(t){let e="";for(;;){const s=this.readmem(t);if(t++,0===s||13===s)break;e+=String.fromCharCode(s)}return e}findString(t,e){for(e|=0;e<65535;++e){let s;for(s=0;s<t.length&&this.readmem(e+s)===t.charCodeAt(s);++s);if(s===t.length)return e}return null}readArea(t,e){let s="";for(let i=0;i<e;++i)s+=ch(this.readmem(t+i));return s}handleEconetStationId(){return this.econet.econetNMIEnabled=!1,this.econet.stationId}handleEconetNMIEnable(){return this.econet.econetNMIEnabled||(this.econet.econetNMIEnabled=!0,128&this.econet.ADLC.status1&&this.NMI(!0)),255}readDevice(t){if(this.model.isMaster&&64&this.acccon)return this.ramRomOs[this.osOffset+(16383&t)];switch(-4&(t&=65535)){case 64528:if(this.model.hasTeletextAdaptor)return this.teletextAdaptor.read(t-64528);break;case 64544:case 64548:case 64552:case 64556:case 64560:case 64564:case 64568:case 64572:case 64576:case 64580:case 64584:case 64588:case 64592:case 64596:case 64600:case 64604:break;case 64764:if(64767===t&&this.model.hasMusic5000)return this.music5000PageSel;break;case 65024:case 65028:return this.crtc.read(t);case 65032:case 65036:return this.acia.read(t);case 65040:case 65044:return this.serial.read(t);case 65048:return this.model.isMaster?this.adconverter.read(t):this.handleEconetStationId();case 65056:if(!this.model.isMaster)return this.handleEconetNMIEnable();break;case 65060:case 65064:if(this.model.isMaster)return this.fdc.read(t);break;case 65072:if(this.model.isMaster)return 143&this.romsel;break;case 65076:if(this.model.isMaster)return this.acccon;break;case 65080:if(this.model.isMaster)return this.handleEconetStationId();break;case 65084:if(this.model.isMaster)return this.handleEconetNMIEnable();break;case 65088:case 65092:case 65096:case 65100:case 65104:case 65108:case 65112:case 65116:return this.sysvia.read(t);case 65120:case 65124:case 65128:case 65132:case 65136:case 65140:case 65144:case 65148:return this.uservia.read(t);case 65152:case 65156:case 65160:case 65164:case 65168:case 65172:case 65176:case 65180:if(!this.model.isMaster)return this.fdc.read(t);break;case 65184:if(this.econet)return this.econet.readRegister(3&t);break;case 65216:case 65220:case 65224:case 65228:case 65232:case 65236:case 65240:case 65244:if(!this.model.isMaster)return this.adconverter.read(t);break;case 65248:case 65252:case 65256:case 65260:case 65264:case 65268:case 65272:case 65276:return this.tube.read(t)}return this.model.hasMusic5000&&48==(240&this.music5000PageSel)&&64768==(65280&t)?this.music5000.read(this.music5000PageSel,t):t>=64512&&t<65024?255:t>>>8}videoRead(t){return 0|this.ramRomOs[t|this.videoDisplayPage]}readmem(t){t&=65535;const e=this.memStatOffset+(t>>>8);if(this.memStat[e]){const s=this.memLook[e],i=this.ramRomOs[s+t];return this._debugRead&&this._debugRead(t,i,s),0|i}{const e=this.readDevice(t);return this._debugRead&&this._debugRead(t,e,0),0|e}}peekmem(t){const e=this.memStatOffset+(t>>>8);if(this.memStat[e]){const s=this.memLook[e];return this.ramRomOs[s+t]}return 255}writemem(t,e){t&=65535,e|=0,this._debugWrite&&this._debugWrite(t,e);const s=this.memStatOffset+(t>>>8);if(1!==this.memStat[s])t<64512||t>=65280||this.writeDevice(t,e);else{const i=this.memLook[s];this.ramRomOs[i+t]=e}}writeDevice(t,e){if(t&=65535,e|=0,this.model.hasMusic5000&&64768==(65280&t)&&48==(240&this.music5000PageSel))this.music5000.write(this.music5000PageSel,t,e);else switch(-4&t){case 64528:if(this.model.hasTeletextAdaptor)return this.teletextAdaptor.write(t-64528,e);break;case 64544:case 64548:case 64552:case 64556:case 64560:case 64564:case 64568:case 64572:case 64576:case 64580:case 64584:case 64588:case 64592:case 64596:case 64600:case 64604:break;case 64764:64767===t&&this.model.hasMusic5000&&(this.music5000PageSel=e);break;case 65024:case 65028:return this.crtc.write(t,e);case 65032:case 65036:return this.acia.write(t,e);case 65040:case 65044:return this.serial.write(t,e);case 65048:if(this.model.isMaster)return this.adconverter.write(t,e);!this.model.isMaster&&this.econet&&(this.econet.econetNMIEnabled=!1);break;case 65056:return this.ula.write(t,e);case 65060:case 65064:return this.model.isMaster?this.fdc.write(t,e):this.ula.write(t,e);case 65068:if(!this.model.isMaster)return this.ula.write(t,e);break;case 65072:return this.romSelect(e);case 65076:return this.model.isMaster?this.writeAcccon(e):this.romSelect(e);case 65080:this.model.isMaster&&this.econet&&(this.econet.econetNMIEnabled=!1);break;case 65084:if(!this.model.isMaster)return this.romSelect(e);break;case 65088:case 65092:case 65096:case 65100:case 65104:case 65108:case 65112:case 65116:return this.sysvia.write(t,e);case 65120:case 65124:case 65128:case 65132:case 65136:case 65140:case 65144:case 65148:return this.uservia.write(t,e);case 65152:case 65156:case 65160:case 65164:case 65168:case 65172:case 65176:case 65180:if(!this.model.isMaster)return this.fdc.write(t,e);break;case 65184:case 65188:case 65192:case 65196:case 65200:case 65204:case 65208:case 65212:this.econet&&this.econet.writeRegister(3&t,e);break;case 65216:case 65220:case 65224:case 65228:case 65232:case 65236:case 65240:case 65244:if(!this.model.isMaster)return this.adconverter.write(t,e);break;case 65248:case 65252:case 65256:case 65260:case 65264:case 65268:case 65272:case 65276:return this.tube.write(t,e)}}async loadRom(t,e){0!==t.indexOf("http")&&(t="roms/"+t),console.log("Loading ROM from "+t);const s=this.ramRomOs;let i=await bh(t);/\.zip/i.test(t)&&(i=function(t){return Th(t,Sh)}(i).data);const r=i.length;if(16384!==r&&8192!==r)throw new Error("Broken rom file");for(let t=0;t<r;++t)s[e+t]=i[t]}async loadOs(t){const e=Array.prototype.slice.call(arguments,1).concat(this.config.extraRoms);t="roms/"+t,console.log("Loading OS from "+t);const s=this.ramRomOs,i=await bh(t),r=i.length;if(r<16384||16383&r)throw new Error("Broken ROM file (length="+r+")");for(let t=0;t<16384;++t)s[this.osOffset+t]=i[t];const n=(r-16384)/16384;let o=16-n;for(let t=0;t<n;++t){const e=16384+16384*t,r=this.romOffset+16384*(o+t);for(let t=0;t<16384;++t)s[r+t]=i[e+t]}const a=[];for(let t=0;t<e.length;++t){for(o--;this.model.swram[o];)o--;a.push(this.loadRom(e[t],this.romOffset+16384*o))}return await Promise.all(a)}setReset(t){this.resetLine=!t}reset(t){if(t){if(this.memStatOffsetByIFetchBank=this.model.isMaster?12288:0,this.model.isTest)for(let t=0;t<256;++t)this.memStat[t]=this.memStat[256+t]=1,this.memLook[t]=this.memLook[256+t]=0;else{for(let t=0;t<128;++t)this.memStat[t]=this.memStat[256+t]=1;for(let t=128;t<256;++t)this.memStat[t]=this.memStat[256+t]=2;for(let t=0;t<128;++t)this.memLook[t]=this.memLook[256+t]=0;for(let t=128;t<192;++t)this.memLook[t]=this.memLook[256+t]=this.romOffset-32768;for(let t=192;t<256;++t)this.memLook[t]=this.memLook[256+t]=this.osOffset-49152;for(let t=252;t<255;++t)this.memStat[t]=this.memStat[256+t]=0}for(let t=0;t<this.romOffset;++t)this.ramRomOs[t]=t<256?0:255;this.videoDisplayPage=0,this.scheduler=new hu,this.soundChip.setScheduler(this.scheduler),this.sysvia=new eu(this,this.video,this.soundChip,this.cmos,this.model.isMaster,this.config.keyLayout,this.config.getGamepads),this.uservia=new su(this,this.model.isMaster,this.config.userPort),this.config.printerPort&&(this.uservia.ca2changecallback=this.config.printerPort.outputStrobe),this.touchScreen=new pu(this.scheduler),this.acia=new iu(this,this.soundChip.toneGenerator,this.scheduler,this.touchScreen),this.serial=new ru(this.acia),this.ddNoise.spinDown(),this.fdc=new this.model.Fdc(this,this.ddNoise,this.scheduler),this.crtc=this.video.crtc,this.ula=this.video.ula,this.adconverter=new cu(this.sysvia,this.scheduler),this.model.hasTeletextAdaptor&&(this.teletextAdaptor=new fu(this)),this.econet&&(this.filestore=new yu(this,this.econet)),this.sysvia.reset(t),this.uservia.reset(t)}this.tube.reset(t),t&&(this.targetCycles=0,this.currentCycles=0,this.cycleSeconds=0),this.pc=this.readmem(65532)|this.readmem(65533)<<8,this.p.i=!0,this.nmi=!1,this.halted=!1,this.music5000PageSel=0,this.video.reset(this,this.sysvia,t),t&&this.soundChip.reset(t),this.teletextAdaptor&&this.teletextAdaptor.reset(t),this.music5000&&this.music5000.reset(t),t&&this.econet&&(this.econet.reset(),this.filestore.reset())}updateKeyLayout(){this.sysvia.setKeyLayout(this.config.keyLayout)}polltimeAddr(t,e){t|=0,function(t){return t>=64512&&t<65280&&(t<65024||[!0,!1,!0,!0,!1,!1,!0,!1][t>>>5&7])}(e)&&(t+=1+(1&(t^this.currentCycles))),this.polltime(t)}polltimeCommon(t){if(this.sysvia.polltime(t),this.uservia.polltime(t),this.scheduler.polltime(t),this.tube.execute(t),this.teletextAdaptor&&this.teletextAdaptor.polltime(t),this.music5000&&this.music5000.polltime(t),this.econet){this.econet.polltime(t)&&this.econet.econetNMIEnabled&&this.NMI(!0),this.filestore.polltime(t)}}polltimeSlow(t){t|=0,this.currentCycles+=t,this.peripheralCycles+=t,this.videoCycles+=t,(t=this.videoCycles/this.cpuMultiplier|0)>this.videoCyclesBatch&&(this.video.polltime(t),this.videoCycles-=t*this.cpuMultiplier|0),(t=this.peripheralCycles/this.cpuMultiplier|0)&&(this.peripheralCycles-=t*this.cpuMultiplier|0,this.polltimeCommon(t))}polltimeFast(t){t|=0,this.currentCycles+=t,this.video.polltime(t),this.polltimeCommon(t)}execute(t){this.halted=!1,this.targetCycles+=t;return(4294967294&Math.min(this.targetCycles,this.currentCycles))>=2e6&&(this.targetCycles-=2e6,this.currentCycles-=2e6,this.cycleSeconds++),this.forceTracing||this._debugInstruction||this._debugRead||this._debugWrite?this.executeInternal():this.executeInternalFast()}executeInternal(){let t=!0;for(;!this.halted&&this.currentCycles<this.targetCycles;){this.oldPcIndex=this.oldPcIndex+1&255,this.oldPcArray[this.oldPcIndex]=this.pc,this.memStatOffset=this.memStatOffsetByIFetchBank&1<<(this.pc>>>12)?256:0;const e=this.readmem(this.pc);if(this._debugInstruction&&!t&&this._debugInstruction(this.pc,e))return!1;t=!1,this.incpc(),this.runner.run(e),this.oldAArray[this.oldPcIndex]=this.a,this.oldXArray[this.oldPcIndex]=this.x,this.oldYArray[this.oldPcIndex]=this.y,this.takeInt&&this.brk(!0),this.resetLine||this.reset(!1)}return!this.halted}executeInternalFast(){for(;!this.halted&&this.currentCycles<this.targetCycles;){this.memStatOffset=this.memStatOffsetByIFetchBank&1<<(this.pc>>>12)?256:0;const t=this.readmem(this.pc);this.incpc(),this.runner.run(t),this.takeInt&&this.brk(!0),this.resetLine||this.reset(!1)}return!this.halted}stop(){this.halted=!0}dumpTrace(t,e){t||(t=256),t>256&&(t=256);const s=this.disassembler;e=e||function(t,e,i,r){const n=s.disassemble(t,!0)[0];console.log(hh(t),(n+"                       ").substr(0,15),ch(e),ch(i),ch(r))};for(let s=t-2;s>=0;--s){const t=this.oldPcIndex-s&255;e(this.oldPcArray[t],this.oldAArray[t],this.oldXArray[t],this.oldYArray[t])}e(this.pc,this.a,this.x,this.y)}async initialise(){this.model.os.length&&await this.loadOs.apply(this,this.model.os),this.model.tube&&await this.tube.loadOs(),this.reset(!0),this.debugger.setCpu(this)}}const Du=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,254,0,235,0,201,255,255,18,0,23,202,30,5,0,53,166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let Lu=0;function Ru(){const t=new Date(Date.now()+Lu);return t.setMilliseconds(0),t}function Ou(t){return parseInt(t.toString(10),16)}function Pu(t){return parseInt(t.toString(16),10)}class Iu{constructor(t,e,s){this.store=t?t.load():null,this.persistence=t,this.enabled=!1,this.isRead=!1,this.addressSelect=!1,this.dataSelect=!1,this.cmosAddr=0,this.store||(this.store=Du),e&&(this.store=e(this.store)),s&&(this.store[14]=s.stationId,0===this.store[15]&&(this.store[15]=254)),this.save()}save(){this.persistence&&this.persistence.save(this.store)}read(){if(!this.enabled)return 255;if(!this.addressSelect&&this.dataSelect&&this.isRead){if(!(this.cmosAddr<10))return 255&this.store[this.cmosAddr];{const t=Ru();switch(this.cmosAddr){case 0:return Ou(t.getSeconds());case 2:return Ou(t.getMinutes());case 4:return Ou(t.getHours());case 6:return Ou(t.getDay()+1);case 7:return Ou(t.getDate());case 8:return Ou(t.getMonth()+1);case 9:return Ou(t.getFullYear())}}}return 255}writeControl(t,e,s){if(this.enabled=!!(64&t),!this.enabled)return;const i=this.dataSelect,r=this.addressSelect;if(this.isRead=!!(2&s),this.dataSelect=!!(4&s),this.addressSelect=!!(128&t),r&&!this.addressSelect&&(this.cmosAddr=63&e),i&&!this.dataSelect&&!this.addressSelect&&!this.isRead)if(this.cmosAddr>11)this.store[this.cmosAddr]=e,this.save();else{const t=Ru();switch(this.cmosAddr){case 0:t.setSeconds(Pu(e));break;case 2:t.setMinutes(Pu(e));break;case 4:t.setHours(Pu(e));break;case 7:t.setDate(Pu(e));break;case 8:t.setMonth(Pu(e-1));break;case 9:{const s=Pu(e)>80?1900:2e3;t.setFullYear(Pu(e)+s);break}}const s=1e3*Math.floor(Date.now()/1e3);Lu=t.getTime()-s}}}class Nu{constructor(t,e,s,i){this._baseUrl=`${document.location.protocol}//www.stairwaytohell.com/bbc/archive/${i?"tape":"disk"}images/`,this._catalog=[],this._onStart=t,this._onCat=e,this._onError=s}populate(){if(this._onStart(),0===this._catalog.length){const t=new XMLHttpRequest;t.open("GET",this._baseUrl+"reclist.php?sort=name&filter=.zip",!0),t.onerror=()=>{this._onError&&this._onError()},t.onload=()=>{s(s.parseHTML(t.responseText,null,!1)).find("tr td:nth-child(3) a").each(((t,e)=>{const i=s(e).attr("href");i.indexOf(".zip")>0&&this._catalog.push(i)})),this._onCat&&this._onCat(this._catalog)},t.send()}else this._onCat&&this._onCat(this._catalog)}async fetch(t){const e=this._baseUrl+t;console.log("Loading ZIP from "+e);return kh(await bh(e)).data}}const Mu=rh;const Bu=256;function Fu(t){const e={notFound:0,seek:function(){return 0},notFoundTask:t.scheduler.newTask((()=>{t.notFound()}))};return e.read=e.write=e.address=e.format=()=>{e.notFoundTask.reschedule(128e3)},e}function Uu(t,e,s,i){const r="string"!=typeof s?s:gh(s),n=new Uint8Array(r);return new Hu(t,e,r,(t=>{(function(){let t=!1;for(let e=0;e<r.length;++e)r[e]!==n[e]&&(n[e]=r[e],t=!0);return t})()&&i&&i(t.data)}))}class Hu{constructor(t,e,s,i){if(null==s)throw new Error("Bad disc data");let r=Eh(e),n=r.isDsd,o=r.isDoubleDensity?16:10,a=r.byteSize;s.length>a&&!n&&(r=Eh(".dsd"),n=!0,a=r.byteSize),s=function(t,e){const s=new Uint8Array(e);return s.set(t.subarray(0,e)),s}(s,a),this.fdc=t,this.name=e,this.isDsd=n,this.sectorsPerTrack=o,this.flusher=i,this.data=s,this.byteWithinSector=0,this.writeProt=!i,this.seekOffset=0,this.sectorOffset=0,this.formatSector=0,this.rsector=0,this.track=0,this.side=-1,this.notFoundTask=t.scheduler.newTask((()=>this.fdc.notFound())),this.readTask=t.scheduler.newTask((()=>{this.fdc.discData(this.data[this.seekOffset+this.sectorOffset+this.byteWithinSector]),256==++this.byteWithinSector?this.fdc.discFinishRead():this.readTask.reschedule(Bu)})),this.writeTask=t.scheduler.newTask((()=>{this.writeProt?this.fdc.writeProtect():(this.data[this.seekOffset+this.sectorOffset+this.byteWithinSector]=this.fdc.readDiscData(255===this.byteWithinSector),256==++this.byteWithinSector?(this.fdc.discFinishRead(),this.flush()):this.writeTask.reschedule(Bu))})),this.readAddrTask=t.scheduler.newTask((()=>{switch(this.byteWithinSector){case 0:this.fdc.discData(this.track);break;case 1:this.fdc.discData(this.side);break;case 2:this.fdc.discData(this.rsector);break;case 3:this.fdc.discData(1);break;case 4:case 5:this.fdc.discData(0);break;case 6:return this.fdc.discFinishRead(),this.rsector++,void(this.rsector===this.sectorsPerTrack&&(this.rsector=0))}this.byteWithinSector++,this.readAddrTask.reschedule(Bu)})),this.formatTask=t.scheduler.newTask((()=>{if(this.writeProt)this.fdc.writeProtect();else{if(this.data[this.seekOffset+this.sectorOffset+this.byteWithinSector]=0,256==++this.byteWithinSector&&(this.byteWithinSector=0,this.sectorOffset+=256,++this.formatSector===this.sectorsPerTrack))return this.fdc.discFinishRead(),void this.flush();this.formatTask.reschedule(Bu)}}))}flush(){this.flusher&&this.flusher(this)}seek(t){this.seekOffset=t*this.sectorsPerTrack*256,this.isDsd&&(this.seekOffset<<=1);const e=this.track;return this.track=t,this.track-e}check(t,e){return!(this.track!==t||e&&!this.isDsd)||(this.notFoundTask.reschedule(128e3),!1)}read(t,e,s){this.check(e,s)&&(this.side=s,this.readTask.reschedule(Bu),this.sectorOffset=256*t+(s?256*this.sectorsPerTrack:0),this.byteWithinSector=0)}write(t,e,s){this.check(e,s)&&(this.side=s,this.writeTask.reschedule(Bu),this.sectorOffset=256*t+(s?256*this.sectorsPerTrack:0),this.byteWithinSector=0)}address(t,e){this.check(t,e)&&(this.side=e,this.readAddrTask.reschedule(Bu),this.byteWithinSector=0,this.rsector=0)}format(t,e){this.check(t,e)&&(this.side=e,this.formatTask.reschedule(Bu),this.formatSector=0,this.sectorOffset=e?256*this.sectorsPerTrack:0,this.byteWithinSector=0)}}class ju{constructor(t,e,s){this.cpu=t,this.noise=e,this.status=0,this.result=0,this.curData=0,this.curDrive=0,this.drvout=0,this.curTrack=[0,0],this.realTrack=[0,0],this.sectorsLeft=0,this.curSector=0,this.phase=0,this.curCommand=255,this.callbackTask=s.newTask((()=>{this.callback()})),this.paramNum=0,this.paramReq=0,this.params=new Uint8Array(8),this.motorOn=[!1,!1],this.motorSpinDownTask=[s.newTask((()=>{this.motorOn[0]=!1,this.drvout&=-65,e.spinDown()})),s.newTask((()=>{this.motorOn[1]=!1,this.drvout&=-129,e.spinDown()}))],this.written=!1,this.verify=!1,this.scheduler=s,this.drives=[Fu(this),Fu(this)]}NMI(){this.cpu.NMI(8&this.status)}loadDisc(t,e){console.log(`loading ${e.name} in ${t}`),this.drives[t]=e}read(t){switch(7&t){case 0:return this.status;case 1:return this.status&=-25,this.NMI(),this.result;case 4:case 5:case 6:case 7:return this.status&=-13,this.NMI(),this.curData}return 0}error(t){this.result=t,this.status=24,this.NMI(),this.callbackTask.cancel(),this.setspindown()}notFound(){this.error(24)}writeProtect(){this.error(18)}headerCrcError(){this.error(12)}dataCrcError(){this.error(14)}discData(t){this.verify||(this.curData=t,this.status=140,this.result=0,this.NMI())}readDiscData(t){return this.written?(t||(this.status=140,this.result=0,this.NMI()),this.written=!1,this.curData):0}discFinishRead(){this.callbackTask.reschedule(Bu)}numParams(t){const e={53:4,41:1,44:0,61:1,58:2,19:3,11:3,27:3,31:3,35:5}[t];return e||0}command(t){128&this.status||(this.curCommand=63&t,23===this.curCommand&&(this.curCommand=19),this.curDrive=128&t?1:0,this.curCommand<44&&(this.drvout&=-193,this.drvout|=192&t),this.paramNum=0,this.paramReq=this.numParams(this.curCommand),this.status=128,this.paramReq||(44===this.curCommand?(this.status=16,this.result=128,this.result|=this.realTrack[this.curDrive]?0:2,this.result|=this.drives[this.curDrive].writeProt?8:0,64&this.drvout&&(this.result|=4),128&this.drvout&&(this.result|=64)):(this.result=24,this.status=24,this.NMI())))}writeSpecial(t,e){switch(this.status=0,t){case 23:break;case 18:this.curTrack[0]=e;break;case 26:this.curTrack[1]=e;break;case 35:this.drvout=e;break;default:this.result=this.status=24,this.NMI()}}readSpecial(t){switch(this.status=16,this.result=0,t){case 6:break;case 18:this.result=this.curTrack[0];break;case 26:this.result=this.curTrack[1];break;case 35:this.result=this.drvout;break;default:this.result=this.status=24,this.NMI()}}spinup(){let t=Bu;this.motorOn[this.curDrive]||(t=.5*this.cpu.peripheralCyclesPerSecond|0,this.motorOn[this.curDrive]=!0,this.noise.spinUp()),this.callbackTask.reschedule(t),this.motorSpinDownTask[this.curDrive].cancel(),this.phase=0}setspindown(){this.motorOn[this.curDrive]&&this.motorSpinDownTask[this.curDrive].reschedule(2*this.cpu.peripheralCyclesPerSecond)}seek(t){let e=this.realTrack[this.curDrive];e+=t-this.curTrack[this.curDrive],e<0&&(e=0),e>79&&(e=79),this.realTrack[this.curDrive]=e;const s=this.drives[this.curDrive].seek(e),i=.9*this.noise.seek(s)*this.cpu.peripheralCyclesPerSecond|0;this.callbackTask.reschedule(Math.max(Bu,i)),this.phase=1}prepareSectorIO(t,e,s){void 0!==s&&(this.sectorsLeft=31&s),void 0!==e&&(this.curSector=e),this.spinup()}parameter(t){if(this.paramNum<5&&(this.params[this.paramNum++]=t),this.paramNum===this.paramReq)switch(this.curCommand){case 53:this.status=0;break;case 41:this.spinup();break;case 31:case 19:case 11:this.prepareSectorIO(this.params[0],this.params[1],this.params[2]);break;case 27:this.prepareSectorIO(this.params[0],void 0,this.params[2]);break;case 35:this.prepareSectorIO(this.params[0]);break;case 58:this.writeSpecial(this.params[0],this.params[1]);break;case 61:this.readSpecial(this.params[0]);break;default:this.result=24,this.status=24,this.NMI()}}reset(){}data(t){this.curData=t,this.written=!0,this.status&=-13,this.NMI()}write(t,e){switch(7&t){case 0:this.command(e);break;case 1:this.parameter(e);break;case 2:this.reset(e);break;case 4:case 5:case 6:case 7:this.data(e)}}density(){return!!(32&this.drvout)}update(t){this.status=t,this.result=0,this.NMI()}done(){this.update(24),this.setspindown(),this.verify=!1}callback(){if(0!==this.phase)switch(this.curCommand){case 41:this.curTrack[this.curDrive]=this.params[0],this.done();break;case 11:if(1===this.phase)return this.curTrack[this.curDrive]=this.params[0],this.phase=2,this.drives[this.curDrive].write(this.curSector,this.params[0],this.density(),0),void this.update(140);if(0==--this.sectorsLeft)return void this.done();this.curSector++,this.drives[this.curDrive].write(this.curSector,this.params[0],this.density(),0),this.update(140);break;case 19:case 31:if(1===this.phase)return this.curTrack[this.curDrive]=this.params[0],this.phase=2,void this.drives[this.curDrive].read(this.curSector,this.params[0],this.density(),0);if(0==--this.sectorsLeft)return void this.done();this.curSector++,this.drives[this.curDrive].read(this.curSector,this.params[0],this.density(),0);break;case 27:if(1===this.phase)return this.curTrack[this.curDrive]=this.params[0],this.phase=2,void this.drives[this.curDrive].address(this.params[0],this.density(),0);if(0==--this.sectorsLeft)return void this.done();this.drives[this.curDrive].address(this.params[0],this.density(),0);break;case 35:switch(this.phase){case 1:this.curTrack[this.curDrive]=this.params[0],this.drives[this.curDrive].write(this.curSector,this.params[0],this.density(),0),this.update(140),this.phase=2;break;case 2:this.drives[this.curDrive].format(this.params[0],this.density(),0),this.phase=3;break;case 3:this.done()}break;case 255:break;default:console.log("ERK bad command",ch(this.curCommand))}else this.seek(this.params[0])}}class zu{constructor(t,e,s){this.cpu=t,this.noise=e,this.command=0,this.sector=0,this.track=0,this.status=0,this.data=0,this.side=0,this.curDrive=0,this.curTrack=0,this.written=!1,this.density=!1,this.stepIn=!1,this.motorOn=[!1,!1],this.motorSpinDownTask=[s.newTask((()=>{this.motorOn[0]=!1,this.checkSpinDownNoise()})),s.newTask((()=>{this.motorOn[1]=!1,this.checkSpinDownNoise()}))],this.scheduler=s,this.drives=[Fu(this),Fu(this)],this.callbackTask=s.newTask((()=>{this.callback()}))}checkSpinDownNoise(){this.motorOn[0]||this.motorOn[1]||this.noise.spinDown()}spinUp(){this.status|=128,this.motorOn[this.curDrive]=!0,this.motorSpinDownTask[this.curDrive].cancel(),this.noise.spinUp()}spinDown(){this.status&=-129,this.motorOn[this.curDrive]=!1,this.checkSpinDownNoise()}setSpinDown(){this.motorSpinDownTask[this.curDrive].reschedule(576e4)}track0(){return 0===this.curTrack?0:4}callback(){switch(this.command>>>4){case 0:this.track=this.curTrack=0,this.status=128,this.setSpinDown(),this.cpu.NMI(!0);break;case 1:this.curTrack=this.track=this.data,this.status=128|this.track0(),this.cpu.NMI(!0);break;case 3:case 5:case 7:this.track=this.curTrack;case 2:case 4:case 6:this.status=128|this.track0(),this.cpu.NMI(!0);break;case 8:case 10:case 15:this.status=128,this.setSpinDown(),this.cpu.NMI(!0);break;case 12:this.status=128,this.setSpinDown(),this.cpu.NMI(!0),this.sector=this.track}}read(t){switch(t){case 65156:case 65064:return this.status;case 65157:case 65065:return this.track;case 65158:case 65066:return this.sector;case 65159:case 65067:return this.status&=-3,this.data}return 254}write(t,e){switch(t){case 65152:this.curDrive=2&e?1:0,this.side=4&e?1:0,this.density=!(8&e);break;case 65060:this.curDrive=2&e?1:0,this.side=16&e?1:0,this.density=!(32&e);break;case 65156:case 65064:{const t=e>>>4&15,s=13===t;if(1&this.status&&!s)return;this.command=e,s||this.spinUp(),this.handleCommand(t);break}case 65157:case 65065:this.track=e;break;case 65158:case 65066:this.sector=e;break;case 65159:case 65067:this.status&=-3,this.data=e,this.written=!0}}curDisc(){return this.drives[this.curDrive]}seek(t){const e=this.curDisc().seek(t),s=this.noise.seek(e)*this.cpu.peripheralCyclesPerSecond|0;this.callbackTask.reschedule(Math.max(Bu,s))}handleCommand(t){switch(t){case 0:this.status=161|this.track0(),this.seek(0);break;case 1:this.status=161|this.track0(),this.seek(this.data);break;case 2:case 3:this.status=161|this.track0(),this.curTrack+=this.stepIn?1:-1,this.curTrack<0&&(this.curTrack=0),this.seek(this.curTrack);break;case 4:case 5:this.status=161|this.track0(),this.curTrack++,this.seek(this.curTrack),this.stepIn=!0;break;case 6:case 7:this.status=161|this.track0(),this.curTrack--,this.curTrack<0&&(this.curTrack=0),this.seek(this.curTrack),this.stepIn=!1;break;case 8:this.status=129,this.curDisc().read(this.sector,this.track,this.side,this.density);break;case 10:this.status=131,this.curDisc().write(this.sector,this.track,this.side,this.density),this.written=!1,this.cpu.NMI(!0);break;case 12:this.status=129,this.curDisc().address(this.track,this.side,this.density);break;case 13:this.status=128|this.track0(),this.cpu.NMI(8&this.command),this.spinDown();break;case 15:this.status=129,this.curDisc().format(this.track,this.side,this.density);break;default:this.callbackTask.cancel(),this.status=144,this.cpu.NMI(!0),this.spinDown()}}discData(t){this.status|=2,this.data=t,this.cpu.NMI(!0)}readDiscData(t){return this.written?(this.written=!1,t||(this.cpu.NMI(!0),this.status|=2),this.data):255}error(t){this.callbackTask.cancel(),this.cpu.NMI(!0),this.status=t,this.spinDown()}discFinishRead(){this.callbackTask.reschedule(Bu)}notFound(){this.error(144)}writeProtect(){this.error(192)}headerCrcError(){this.error(152)}dataCrcError(){this.error(136)}loadDisc(t,e){this.drives[t]=e}}function Wu(t){return 2e6*t|0}const Gu="N".charCodeAt(0);class Ku{constructor(t){this.stream=t,this.baseFrequency=1200,this.rewind(),this.curChunk=this.readChunk()}rewind(){this.dummyData=[!1,!1,!0,!1,!0,!1,!0,!1,!0,!0],this.state=-1,this.count=0,this.curByte=0,this.numDataBits=8,this.parity=Gu,this.numParityBits=0,this.numStopBits=1,this.carrierBefore=0,this.carrierAfter=0,this.stream.seek(10);const t=this.stream.readByte(),e=this.stream.readByte();if(0!==e)throw"Unsupported UEF version "+e+"."+t}readChunk(){const t=this.stream.readInt16(),e=this.stream.readInt32();return{id:t,stream:this.stream.substream(e)}}poll(t){if(!this.curChunk)return;if(-1===this.state){if(this.stream.eof())return void(this.curChunk=null);this.curChunk=this.readChunk()}let e;switch(this.curChunk.id){case 0:console.log("Origin: "+this.curChunk.stream.readNulString());break;case 256:return t.setTapeCarrier(!1),-1===this.state?(this.state=0,this.curByte=this.curChunk.stream.readByte(),t.tone(this.baseFrequency)):this.state<9?(0===this.state?t.tone(this.baseFrequency):t.tone(this.curByte&1<<this.state-1?2*this.baseFrequency:this.baseFrequency),this.state++):(t.receive(this.curByte),t.tone(2*this.baseFrequency),this.curChunk.stream.eof()?this.state=-1:(this.state=0,this.curByte=this.curChunk.stream.readByte())),this.cycles(1);case 260:if(t.setTapeCarrier(!1),-1===this.state&&(this.numDataBits=this.curChunk.stream.readByte(),this.parity=this.curChunk.stream.readByte(),this.numStopBits=this.curChunk.stream.readByte(),this.numParityBits=this.parity!==Gu?1:0,console.log(`Defined data with ${this.numDataBits}${String.fromCharCode(this.parity)}${this.numStopBits}`),this.state=0),0===this.state)this.curChunk.stream.eof()?this.state=-1:(this.curByte=this.curChunk.stream.readByte()&(1<<this.numDataBits)-1,t.tone(this.baseFrequency),this.state++);else if(this.state<1+this.numDataBits)t.tone(this.curByte&1<<this.state-1?2*this.baseFrequency:this.baseFrequency),this.state++;else if(this.state<1+this.numDataBits+this.numParityBits){let e=function(t){let e=!1;for(;t;)e=!e,t>>>=1;return e}(this.curByte);this.parity===Gu&&(e=!e),t.tone(e?2*this.baseFrequency:this.baseFrequency),this.state++}else{if(!(this.state<1+this.numDataBits+this.numParityBits+this.numStopBits))return t.receive(this.curByte),this.state=0,0;t.tone(2*this.baseFrequency),this.state++}return this.cycles(1);case 273:return-1===this.state&&(this.state=0,this.carrierBefore=this.curChunk.stream.readInt16(),this.carrierAfter=this.curChunk.stream.readInt16(),console.log("Carrier with",this.carrierBefore,this.carrierAfter)),0===this.state?(t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.carrierBefore--,this.carrierBefore<=0&&(this.state=1)):this.state<11?(t.setTapeCarrier(!1),t.tone(this.dummyData[this.state-1]?this.baseFrequency:2*this.baseFrequency),10===this.state&&t.receive(170),this.state++):(t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.carrierAfter--,this.carrierAfter<=0&&(this.state=-1)),this.cycles(1);case 276:console.log("Ignoring security cycles");break;case 277:console.log("Ignoring polarity change");break;case 272:return-1===this.state&&(this.state=0,this.count=this.curChunk.stream.readInt16()),t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.count--,this.count<=0&&(this.state=-1),this.cycles(1);case 275:this.baseFrequency=this.curChunk.stream.readFloat32(),console.log("Frequency change ",this.baseFrequency);break;case 274:return t.setTapeCarrier(!1),e=1/(2*this.curChunk.stream.readInt16()*this.baseFrequency),console.log("Tape gap of "+e+"s"),t.tone(0),Wu(e);case 278:return t.setTapeCarrier(!1),e=this.curChunk.stream.readFloat32(),console.log("Tape gap of "+e+"s"),t.tone(0),Wu(e);default:console.log("Skipping unknown chunk "+hh(this.curChunk.id)),this.curChunk=this.readChunk()}return this.cycles(1)}cycles(t){return Wu(t/this.baseFrequency)}}const $u=[1,16,64,-1];class qu{constructor(t){this.count=0,this.stream=t}rate(t){let e=9;128&t.cr||e++;const s=2e6/(19200/$u[3&t.cr]);return Math.floor(e*s)}rewind(){this.stream.seek(10)}poll(t){if(this.stream.eof())return 1e5;let e=this.stream.readByte();if(255===e){if(e=this.stream.readByte(),0===e)return t.setTapeCarrier(!1),0;if(4===e)return t.setTapeCarrier(!0),1e7;if(255!==e)throw"Got a weird byte in the tape"}return t.receive(e),this.rate(t)}}function Xu(t,e){const s=new Ah(t,e);return 255===s.readByte(0)&&4===s.readByte(1)?(console.log("Detected a 'tapefile' tape"),new qu(s)):"UEF File!"===s.readNulString(0)?(console.log("Detected a UEF tape"),new Ku(s)):(console.log("Unknown tape format"),null)}class Vu{constructor(t,e,s,i,r,n,o,a,c){this.name=t,this.synonyms=e,this.os=s,this.nmos=i,this.isMaster=r,this.Fdc=o,this.swram=n,this.isTest=!1,this.tube=a,this.cmosOverride=c}}const Yu=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],Qu=[!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],Zu=[new Vu("BBC B with DFS 1.2",["B-DFS1.2"],["os.rom","BASIC.ROM","b/DFS-1.2.rom"],!0,!1,Yu,ju),new Vu("BBC B with DFS 0.9",["B-DFS0.9","B"],["os.rom","BASIC.ROM","b/DFS-0.9.rom"],!0,!1,Yu,ju),new Vu("BBC B with 1770 (DFS)",["B1770"],["os.rom","BASIC.ROM","b1770/dfs1770.rom","b1770/zADFS.ROM"],!0,!1,Yu,zu),new Vu("BBC B with 1770 (ADFS)",["B1770A"],["os.rom","BASIC.ROM","b1770/zADFS.ROM","b1770/dfs1770.rom"],!0,!1,Yu,zu),new Vu("BBC Master 128 (DFS)",["Master"],["master/mos3.20"],!1,!0,Qu,zu,null,(function(t){return t[19]=240&t[19]|9,t})),new Vu("BBC Master 128 (ADFS)",["MasterADFS"],["master/mos3.20"],!1,!0,Qu,zu,null,(function(t){return t[19]=240&t[19]|13,t})),new Vu("BBC Master 128 (ANFS)",["MasterANFS"],["master/mos3.20"],!1,!0,Qu,zu,null,(function(t){return t[19]=240&t[19]|8,t})),new Vu("Tube65C02",[],["tube/6502Tube.rom"],!1,!1)];function Ju(t){t=t.toLowerCase();for(let e=0;e<Zu.length;++e){const s=Zu[e];if(s.name.toLowerCase()===t)return s;for(let e=0;e<s.synonyms.length;++e)if(s.synonyms[e].toLowerCase()===t)return s}return null}const tl=new Vu("TEST",["TEST"],[],!0,!1,Yu,ju);tl.isTest=!0;new Vu("TEST",["TEST"],[],!1,!1,Qu,ju).isTest=!0;const el=new Vu("Basic only",["Basic only"],["master/mos3.20"],!1,!0,Qu,zu);function sl(t){const e=25e4/t,s=5e-7*t,i=[0,0,0,0];this.registers=i;const r=[0,0,0,0],n=[!1,!1,!1,!1],o=[0,0,0,0];this.volume=o;const a=[null,null,null,null,null],c=[];let h=1;for(let t=0;t<16;++t)c[t]=h/a.length,h*=Math.pow(10,-.1);c[15]=0;const u=8192,l=[];for(let t=0;t<u;++t)l[t]=Math.sin(2*Math.PI*t/u)/a.length;let d=0,p=!1,f=0;function m(t,s,a,c){let h=i[t];const u=o[t];0===h&&(h=1024);for(let i=0;i<c;++i)r[t]-=e,r[t]<0&&(r[t]+=h,r[t]<0&&(r[t]=0),n[t]=!n[t]),s[i+a]+=n[t]*u}this.toneGenerator={mute:function(){S(),p=!1},tone:function(e){S(),p=!0,d=e/t*u}};let g=0;function b(){g=g>>>1|(1&g^(2&g)>>>1)<<14}function v(){g>>=1,0===g&&(g=16384)}let y=b;function w(){y=4&i[3]?b:v,g=16384}this.debugPokeAll=(t,e,s,i,r,n,a,h)=>{S(),this.registers[0]=16777215&t,this.registers[1]=16777215&s,this.registers[2]=16777215&r,this.registers[3]=16777215&a,o[0]=c[e],o[1]=c[i],o[2]=c[n],o[3]=c[h],w()};let C=!0;function A(t,e,s){e|=0,s|=0;for(let i=0;i<s;++i)t[i+e]=0;if(C)for(let i=0;i<a.length;++i)a[i](i,t,e,s)}let _={epoch:0},x=0;function S(){const t=_.epoch-x;t>0&&R(t),x=_.epoch}let T=null;this.setScheduler=function(t){_=t,x=_.epoch,T=_.newTask(function(){this.active&&function(t){let e;S(),128&t?(O=112&t,e=240&t):e=O;const s=e>>5&3;if(16&e){const e=15&t;o[s]=c[e]}else 3===s?(i[s]=15&t,w()):i[s]=128&e?-16&i[s]|15&t:15&i[s]|(63&t)<<4}(this.slowDataBus)}.bind(this))};let k=0,E=0;const D=4096;let L;function R(t){const e=t*s+k;let i=0|e;k=e-i,E+i>=D&&(i=D-E),0!==i&&(A(L,E,i),E+=i)}L="undefined"!=typeof Float64Array?new Float64Array(D):new Float32Array(D);let O=0;for(let t=0;t<3;++t)a[t]=m;a[3]=function(t,s,a,c){const h=function(t){switch(3&i[t|=0]){case 0:return 16;case 1:return 32;case 2:return 64;case 3:return i[t-1]}}(t),u=o[t];for(let i=0;i<c;++i)r[t]-=e,r[t]<0&&(r[t]+=h,r[t]<0&&(r[t]=0),n[t]=!n[t],n[t]&&y()),s[i+a]+=(1&g)*u},a[4]=function(t,e,s,i){if(p){for(let t=0;t<i;++t)e[t+s]+=l[8191&f],f+=d;for(;f>u;)f-=u}},this.render=function(t,e,s){S();const i=E>s?s:E;for(let s=0;s<i;++s)t[e+s]=L[s];e+=i,s-=i;for(let t=i;t<E;++t)L[t-i]=L[t];E-=i,0!==s&&A(t,e,s)},this.active=!1,this.slowDataBus=0,this.updateSlowDataBus=function(t,e){this.slowDataBus=t,this.active=e,e&&T.ensureScheduled(!0,14)},this.reset=function(t){if(t){for(let t=0;t<4;++t)r[t]=0,i[t]=0,o[t]=0;w(),R(1e5),this.setScheduler(_)}},this.enable=function(t){C=t},this.mute=function(){C=!1},this.unmute=function(){C=!0}}function il(){this.reset=this.enable=this.mute=this.unmute=this.render=this.updateSlowDataBus=this.setScheduler=dh,this.toneGenerator=this}class rl{constructor(t){this.context=t,this.sounds={},this.state=0,this.motor=null,this.gain=t.createGain(),this.gain.gain.value=.25,this.gain.connect(t.destination),this.playing=[]}async initialise(){const t=await async function(t,e){const s=await Promise.all(zs.map(e,(async e=>{const s=await bh(e);return await new Promise((e=>{t.decodeAudioData(s.buffer,(t=>{e(t)}))}))}))),i=zs.keys(e),r={};for(let t=0;t<i.length;++t)r[i[t]]=s[t];return r}(this.context,{motorOn:"sounds/disc525/motoron.wav",motorOff:"sounds/disc525/motoroff.wav",motor:"sounds/disc525/motor.wav",step:"sounds/disc525/step.wav",seek:"sounds/disc525/seek.wav",seek2:"sounds/disc525/seek2.wav",seek3:"sounds/disc525/seek3.wav"});this.sounds=t}oneShot(t){const e=t.duration,s=this.context;if("running"!==s.state)return e;const i=s.createBufferSource();return i.buffer=t,i.connect(this.gain),i.start(),e}play(t,e){return"running"!==this.context.state?Promise.reject():new Promise((s=>{const i=this.context.createBufferSource();i.loop=!!e,i.buffer=t,i.connect(this.gain),i.onended=()=>{this.playing=zs.without(this.playing,i),i.loop||s()},i.start(),this.playing.push(i),i.loop&&s(i)}))}spinUp(){2!==this.state&&1!==this.state&&(this.state=1,this.play(this.sounds.motorOn).then((()=>{0!==this.state&&this.play(this.sounds.motor,!0).then((t=>{this.motor=t,this.state=2}))}),(()=>{})))}spinDown(){0!==this.state&&(this.state=0,this.motor&&(this.motor.stop(),this.motor=null,this.oneShot(this.sounds.motorOff)))}seek(t){return t<0&&(t=-t),0===t?0:1===t?this.oneShot(this.sounds.step):t<10?this.oneShot(this.sounds.seek):t<30?this.oneShot(this.sounds.seek2):this.oneShot(this.sounds.seek3)}mute(){this.gain.gain.value=0}unmute(){this.gain.gain.value=.25}}class nl{constructor(){}seek(){return 0}initialise(){return Promise.resolve()}spinUp(){}spinDown(){}mute(){}unmute(){}}const ol=16,al=1792,cl=128;class hl{constructor(t){this._onBufferMusic5000=t,this.waveRam=new Uint8Array(2048),this.phaseRam=new Uint32Array(ol),this.cycleCount=0,this.curCh=0,this.activeRegSet=0,this.sampleLeft=0,this.sampleRight=0,this.chordBase=[0,8.25,24.75,57.75,123.75,255.75,519.75,1047.75],this.stepInc=[.5,1,2,4,8,16,32,64],this.stereoLeft=[0,0,0,0,0,0,0,0,100,100,100,83,67,50,33,17],this.stereoRight=[100,100,100,100,100,100,100,100,0,0,0,17,33,50,67,83],this.D2ATable=new Uint16Array(128),this.sampleBuffer=new Float64Array(256),this.position=0,this.cReg_freqLow=function(t,e){return this.waveRam[al+e*cl+0+t]},this.cReg_freqMedium=function(t,e){return this.waveRam[al+e*cl+16+t]},this.cReg_freqHigh=function(t,e){return this.waveRam[al+e*cl+32+t]},this.cReg_waveformReg=function(t,e){return this.waveRam[al+e*cl+80+t]},this.cReg_amplitudeReg=function(t,e){return this.waveRam[al+e*cl+96+t]},this.cReg_controlReg=function(t,e){return this.waveRam[al+e*cl+112+t]},this.waveTableVal=function(t,e){return this.waveRam[128*t+e]}}reset(t){if(t){console.log("Music 5000: initialisation");let t=0;for(let e=0;e<8;e++){let s=this.chordBase[e];for(let i=0;i<16;i++)this.D2ATable[t]=Math.floor(4*s),s+=this.stepInc[e],t++}}for(let t=0;t<2048;t++)this.waveRam[t]=0;for(let t=0;t<ol;t++)this.phaseRam[t]=0}read(t,e){const s=((14&t)<<7)+e;return this.waveRam[s]}write(t,e,s){const i=((14&t)<<7)+(255&e);this.waveRam[i]=s}polltime(t){let e,s,i,r,n,o,a,c,h=0;for(this.cycleCount+=3*t;this.cycleCount>=8;){1&this.cReg_freqLow(this.curCh,this.activeRegSet)?(this.phaseRam[this.curCh]=0,e=0):(s=(this.cReg_freqHigh(this.curCh,this.activeRegSet)<<16)+(this.cReg_freqMedium(this.curCh,this.activeRegSet)<<8)+(254&this.cReg_freqLow(this.curCh,this.activeRegSet)),this.phaseRam[this.curCh]+=s,e=this.phaseRam[this.curCh]&1<<24,this.phaseRam[this.curCh]&=16777215),i=this.phaseRam[this.curCh]>>17&127,r=this.cReg_waveformReg(this.curCh,this.activeRegSet)>>4,a=this.waveTableVal(r,i),n=this.cReg_amplitudeReg(this.curCh,this.activeRegSet),o=this.cReg_controlReg(this.curCh,this.activeRegSet),c=128&a,a&=127,this.activeRegSet=32&o&&(c||e)?1:0,n>128&&(n=128),a=a*n/128;let t=this.D2ATable[parseInt(a)];16&o&&(c^=128),c&&(t=-t),h=15&o,this.sampleLeft+=t*this.stereoLeft[h]/100,this.sampleRight+=t*this.stereoRight[h]/100,this.curCh++,this.curCh===ol&&(this.curCh=0,this.activeRegSet=0,this.sampleLeft<-32768?this.sampleLeft=-32768:this.sampleLeft>32767&&(this.sampleLeft=32767),this.sampleRight<-32768?this.sampleRight=-32768:this.sampleRight>32767&&(this.sampleRight=32767),this.sampleBuffer[this.position++]=this.sampleLeft,this.sampleBuffer[this.position++]=this.sampleRight,256===this.position&&(this._onBufferMusic5000(this.sampleBuffer),this.position=0),this.sampleLeft=0,this.sampleRight=0),this.cycleCount-=8}}}class ul{constructor(){this.reset=function(){},this.polltime=function(){},this.read=function(){return 0},this.write=function(){}}}const ll=new Uh,dl=new il,pl={setCpu:()=>{}};function fl(t,e){const s=(e=e||{}).video||ll;return new Eu(t=t||tl,pl,s,dl,new nl,new ul,new Iu)}async function ml(){const t=fl(el),e=/^([0-9]+)?(.*)/,s=function(s,i){const r=s.match(e),n=r[1]?parseInt(r[1]):i,o=function(e){t.pc=36274,t.s=240;let s=4096;t.writemem(59,0),t.writemem(60,0),t.writemem(55,255&s),t.writemem(56,s>>>8&255),t.writemem(65072,12);for(let i=0;i<e.length;++i)t.writemem(s+i,e.charCodeAt(i));t.writemem(s+e.length,13);let i=2e7,r="";for(;t.s<=240&&(t.execute(1),0!=--i);)if(36513===t.pc){let e=t.readmemZpStack(56)<<8|t.readmemZpStack(55);for(;s<e;)r+=String.fromCharCode(t.readmem(s)),s++;r+=String.fromCharCode(t.a),s+=t.y,t.writememZpStack(55,255&s),t.writememZpStack(56,s>>>8&255),++s,t.pc+=3}for(let e=s;13!==t.readmem(e);++e)r+=String.fromCharCode(t.readmem(e));if(0===i)throw new Error("Unable to tokenize '"+e+"' - got as far as '"+r+"' pc="+hh(t.pc));return r}(r[2]);if(o.length>251)throw new Error("Line "+n+" tokenised length "+o.length+" > 251 bytes");return"\r"+String.fromCharCode(n>>>8&255)+String.fromCharCode(255&n)+String.fromCharCode(o.length+4)+o};return await t.initialise(),{tokenise:function(t){let e="";return t.split("\n").forEach((function(t,i){t&&(e+=s(t,10+10*i))})),e+"\rÃ¿"}}}var gl=function(t){window.console&&window.console.error?window.console.error(t):function(t){window.console&&window.console.log&&window.console.log(t)}(t)},bl={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},vl=null,yl=null;function wl(t){if(null==vl)for(var e in vl={},yl={},t)"number"==typeof t[e]&&(vl[t[e]]=e,yl[e]=t[e])}function Cl(){if(null==vl)throw"WebGLDebugUtils.init(ctx) not called"}function Al(t){Cl();var e=vl[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function _l(t,e,s,i){var r;if(void 0!==(r=bl[t])&&(void 0!==(r=r[e])&&r[s])){if("object"==typeof r[s]&&void 0!==r[s].enumBitwiseOr){for(var n=r[s].enumBitwiseOr,o=0,a=[],c=0;c<n.length;++c){var h=yl[n[c]];0!=(i&h)&&(o|=h,a.push(Al(h)))}return o===i?a.join(" | "):Al(i)}return Al(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function xl(t,e,s){t.__defineGetter__(s,(function(){return e[s]})),t.__defineSetter__(s,(function(t){e[s]=t}))}function Sl(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s);for(var i=0;i<e;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(s);var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<r;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}const Tl={init:wl,mightBeEnum:function(t){return Cl(),void 0!==vl[t]},glEnumToString:Al,glFunctionArgToString:_l,glFunctionArgsToString:function(t,e){for(var s="",i=e.length,r=0;r<i;++r)s+=(0==r?"":", ")+_l(t,i,r,e[r]);return s},makeDebugContext:function t(e,s,i,r){r=r||e,wl(e),s=s||function(t,e,s){for(var i="",r=s.length,n=0;n<r;++n)i+=(0==n?"":", ")+_l(e,r,n,s[n]);gl("WebGL error "+Al(t)+" in "+e+"("+i+")")};var n={};function o(t,e){return function(){i&&i(e,arguments);var o=t[e].apply(t,arguments),a=r.getError();return 0!=a&&(n[a]=!0,s(a,e,arguments)),o}}var a={};for(var c in e)if("function"==typeof e[c])if("getExtension"!=c)a[c]=o(e,c);else{var h=o(e,c);a[c]=function(){return t(h.apply(e,arguments),s,i,r)}}else xl(a,e,c);return a.getError=function(){for(var t in n)if(n.hasOwnProperty(t)&&n[t])return n[t]=!1,t;return e.NO_ERROR},a},makeLostContextSimulatingCanvas:function(t){var e,s,i=[],r=[],n={},o=1,a=!1,c=[],h=0,u=0,l=!1,d=0,p={};function f(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function m(){++u,a||h==u&&t.loseContext()}function g(t,e){var s=t[e];return function(){if(m(),!a)return s.apply(t,arguments)}}function b(t){return{statusMessage:t,preventDefault:function(){l=!0}}}return t.getContext=(s=t.getContext,function(){var i=s.apply(t,arguments);if(i instanceof WebGLRenderingContext){if(i!=e){if(e)throw"got different context";n=function(t){for(var s in t)"function"==typeof t[s]?n[s]=g(t,s):xl(n,t,s);n.getError=function(){if(m(),!a)for(;t=e.getError();)p[t]=!0;for(var t in p)if(p[t])return delete p[t],t;return n.NO_ERROR};for(var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<i.length;++r){var h=i[r];n[h]=function(e){return function(){if(m(),a)return null;var s=e.apply(t,arguments);return s.__webglDebugContextLostId__=o,c.push(s),s}}(t[h])}var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<u.length;++r)h=u[r],n[h]=function(e){return function(){return m(),a?null:e.apply(t,arguments)}}(n[h]);var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<l.length;++r)h=l[r],n[h]=function(e){return function(){return m(),!a&&e.apply(t,arguments)}}(n[h]);return n.checkFramebufferStatus=function(e){return function(){return m(),a?n.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(n.checkFramebufferStatus),n.getAttribLocation=function(e){return function(){return m(),a?-1:e.apply(t,arguments)}}(n.getAttribLocation),n.getVertexAttribOffset=function(e){return function(){return m(),a?0:e.apply(t,arguments)}}(n.getVertexAttribOffset),n.isContextLost=function(){return a},n}(e=i)}return n}return i}),function(t){var e=t.addEventListener;t.addEventListener=function(s,n,o){switch(s){case"webglcontextlost":!function(t){i.push(f(t))}(n);break;case"webglcontextrestored":!function(t){r.push(f(t))}(n);break;default:e.apply(t,arguments)}}}(t),t.loseContext=function(){if(!a){for(a=!0,h=0,++o;e.getError(););!function(){for(var t=Object.keys(p),e=0;e<t.length;++e)delete p[t]}(),p[e.CONTEXT_LOST_WEBGL]=!0;var s=b("context lost"),r=i.slice();setTimeout((function(){for(var e=0;e<r.length;++e)r[e](s);d>=0&&setTimeout((function(){t.restoreContext()}),d)}),0)}},t.restoreContext=function(){a&&r.length&&setTimeout((function(){if(!l)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var t=0;t<c.length;++t){var s=c[t];s instanceof WebGLBuffer?e.deleteBuffer(s):s instanceof WebGLFramebuffer?e.deleteFramebuffer(s):s instanceof WebGLProgram?e.deleteProgram(s):s instanceof WebGLRenderbuffer?e.deleteRenderbuffer(s):s instanceof WebGLShader?e.deleteShader(s):s instanceof WebGLTexture&&e.deleteTexture(s)}}(),Sl(e),a=!1,u=0,l=!1;for(var t=r.slice(),s=b("context restored"),i=0;i<t.length;++i)t[i](s)}),0)},t.loseContextInNCalls=function(t){if(a)throw"You can not ask a lost contet to be lost";h=u+t},t.getNumCalls=function(){return u},t.setRestoreTimeout=function(t){d=t},t},resetToInitialState:Sl};class kl{constructor(t){if(this.ctx=t.getContext("2d"),null===this.ctx)throw new Error("Unable to get a 2D context");this.ctx.fillStyle="black",this.ctx.fillRect(0,0,1024,625),this.backBuffer=window.document.createElement("canvas"),this.backBuffer.width=1024,this.backBuffer.height=625,this.backCtx=this.backBuffer.getContext("2d"),this.imageData=this.backCtx.createImageData(this.backBuffer.width,this.backBuffer.height),this.canvasWidth=t.width,this.canvasHeight=t.height,this.fb32=new Uint32Array(this.imageData.data.buffer)}paint(t,e,s,i){const r=s-t,n=i-e;this.backCtx.putImageData(this.imageData,0,0,t,e,r,n),this.ctx.drawImage(this.backBuffer,t,e,r,n,0,0,this.canvasWidth,this.canvasHeight)}}const El=1024,Dl=1024;class Ll{constructor(t){const e={alpha:!1,antialias:!1,depth:!1,preserveDrawingBuffer:!1,stencil:!1,failIfMajorPerformanceCaveat:!0},s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(this.gl=s,!s)throw new Error("Unable to create a GL context");const i=Tl.makeDebugContext(s,(function(t,e){throw new Error("Problem creating GL context: "+Tl.glEnumToString(t)+" in "+e)}));function r(t,e){const s=i.createShader(t);return i.shaderSource(s,e.join("\n")),i.compileShader(s),s}i.depthMask(!1);const n=r(i.VERTEX_SHADER,["attribute vec2 pos;","attribute vec2 uvIn;","varying vec2 uv;","void main() {","  uv = uvIn;","  gl_Position = vec4(2.0 * pos - 1.0, 0.0, 1.0);","}"]),o=r(i.FRAGMENT_SHADER,["precision mediump float;","uniform sampler2D tex;","varying vec2 uv;","void main() {","  gl_FragColor = texture2D(tex, uv).rgba;","}"]),a=i.createProgram();i.attachShader(a,o),i.attachShader(a,n),i.linkProgram(a),i.useProgram(a),this.fb8=new Uint8Array(4194304),this.fb32=new Uint32Array(this.fb8.buffer),this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.pixelStorei(i.UNPACK_ALIGNMENT,4),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,El,Dl,0,i.RGBA,i.UNSIGNED_BYTE,this.fb8),i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(i.getUniformLocation(a,"tex"),0);const c=i.getAttribLocation(a,"pos");i.enableVertexAttribArray(c);const h=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),i.STATIC_DRAW),i.vertexAttribPointer(c,2,i.FLOAT,!1,0,0);const u=i.getAttribLocation(a,"uvIn");i.enableVertexAttribArray(u),this.uvBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),i.vertexAttribPointer(u,2,i.FLOAT,!1,0,0),i.activeTexture(s.TEXTURE0),i.bindTexture(s.TEXTURE_2D,this.texture),this.uvFloatArray=new Float32Array(8),this.lastExtent={},console.log("GL Canvas set up")}paint(t,e,s,i){const r=this.gl;r.texSubImage2D(r.TEXTURE_2D,0,0,e,El,i-e,r.RGBA,r.UNSIGNED_BYTE,this.fb8.subarray(e*El*4,i*El*4));const n={minx:t,miny:e,maxx:s,maxy:i};n.minx===this.lastExtent.minx&&n.miny===this.lastExtent.miny&&n.maxx===this.lastExtent.maxx&&n.maxy===this.lastExtent.maxy||(this.lastExtent=n,t/=El,s/=El,e/=Dl,i/=Dl,this.uvFloatArray[0]=t,this.uvFloatArray[1]=i,this.uvFloatArray[2]=t,this.uvFloatArray[3]=e,this.uvFloatArray[4]=s,this.uvFloatArray[5]=i,this.uvFloatArray[6]=s,this.uvFloatArray[7]=e,r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.bufferData(r.ARRAY_BUFFER,this.uvFloatArray,r.DYNAMIC_DRAW)),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}let Rl,Ol,Pl,Il=function(){};void 0!==window.nodeRequire&&(Il=function(t){const{loadDiscImage:e,processor:s}=t;window.nodeRequire("electron").ipcRenderer.on("load",(async(t,i)=>{const{drive:r,path:n}=i,o=await e(n);s.fdc.loadDisc(r,o)}))});let Nl,Ml,Bl,Fl,Ul,Hl=0,jl=0;const zl=new class{constructor(){this.gamepad0=null,this.gamepadMapping=[],this.gamepadMapping[14]=Mu.Z,this.gamepadMapping[15]=Mu.X,this.gamepadMapping[13]=Mu.SLASH,this.gamepadMapping[12]=Mu.COLON_STAR,this.gamepadMapping[0]=Mu.RETURN,this.gamepadMapping[9]=Mu.SPACE,this.gamepadAxisMapping=[[],[],[],[]]}remap(t,e){"0123456789".indexOf(e)>0&&(e="K"+e);const s=Mu[e];if(s)switch(t){case"LEFT":this.gamepadMapping[3]=s,this.gamepadAxisMapping[0][-1]=s,this.gamepadAxisMapping[2][-1]=s;break;case"RIGHT":this.gamepadMapping[1]=s,this.gamepadAxisMapping[0][1]=s,this.gamepadAxisMapping[2][1]=s;break;case"UP":this.gamepadMapping[0]=s,this.gamepadAxisMapping[1][-1]=s,this.gamepadAxisMapping[3][-1]=s;break;case"DOWN":this.gamepadMapping[2]=s,this.gamepadAxisMapping[1][1]=s,this.gamepadAxisMapping[3][1]=s;break;case"FIRE":for(let t=0;t<16;t++)this.gamepadMapping[t]=s;break;case"UP2":this.gamepadAxisMapping[3][-1]=s;break;case"UP1":this.gamepadAxisMapping[1][-1]=s;break;case"UP3":case"A":this.gamepadMapping[0]=s;break;case"DOWN2":this.gamepadAxisMapping[3][1]=s;break;case"DOWN1":this.gamepadAxisMapping[1][1]=s;break;case"DOWN3":case"X":this.gamepadMapping[2]=s;break;case"LEFT2":this.gamepadAxisMapping[2][-1]=s;break;case"LEFT1":this.gamepadAxisMapping[0][-1]=s;break;case"LEFT3":case"Y":this.gamepadMapping[3]=s;break;case"RIGHT2":this.gamepadAxisMapping[2][1]=s;break;case"RIGHT1":this.gamepadAxisMapping[0][1]=s;break;case"RIGHT3":case"B":this.gamepadMapping[1]=s;break;case"FIRE2":this.gamepadMapping[11]=s;break;case"FIRE1":this.gamepadMapping[10]=s;break;case"START":this.gamepadMapping[9]=s;break;case"BACK":this.gamepadMapping[8]=s;break;case"RB":this.gamepadMapping[5]=s;break;case"RT":this.gamepadMapping[7]=s;break;case"LB":this.gamepadMapping[4]=s;break;case"LT":this.gamepadMapping[6]=s;break;default:console.log("unknown gamepad key: "+t)}else console.log("unknown BBC key: "+e)}update(t){if(navigator.getGamepads&&!this.gamepad0){const t=navigator.getGamepads();this.gamepad0=t[0],this.gamepad0&&(console.log("initing gamepad"),this.gamepadButtons=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.gamepadAxes=[0,0,0,0])}if(this.gamepad0){sh()||(this.gamepad0=navigator.getGamepads()[0]);for(let e=0;e<4;e++){const s=this.gamepad0.axes[e],i=.15;let r;if(r=s<-i?-1:s>i?1:0,r!==this.gamepadAxes[e]){const s=this.gamepadAxisMapping[e][this.gamepadAxes[e]];s&&t.keyUpRaw(s);const i=this.gamepadAxisMapping[e][r];i&&t.keyDownRaw(i)}this.gamepadAxes[e]=r}for(let e=0;e<16;e++)if(this.gamepad0.buttons[e]){const s=this.gamepad0.buttons[e];s.pressed!==this.gamepadButtons[e]&&this.gamepadMapping[e]&&(s.pressed?t.keyDownRaw(this.gamepadMapping[e]):t.keyUpRaw(this.gamepadMapping[e])),this.gamepadButtons[e]=s.pressed}}}};let Wl,Gl;const Kl=[];Wl=[{name:"Elite",desc:"An 8-bit classic. Hit F10 to launch from the space station, then use <, >, S, X and A to fly around.",file:"elite.ssd"},{name:"Welcome",desc:"The disc supplied with BBC Disc systems to demonstrate some of the features of the system.",file:"Welcome.ssd"},{name:"Music 5000",desc:"The Music 5000 system disk and demo songs.",file:"5000mstr36008.ssd"}],Wl&&Wl[0]&&(Gl=Wl[0].file);let $l=document.location.search.substring(1)+"&"+window.location.hash.substring(1),ql=null,Xl={},Vl=!1,Yl="",Ql=window.localStorage.keyLayout||"physical";const Zl=rh,Jl=oh,td={};let ed=1,sd=!1,id=!1,rd=!1,nd=!1,od=!1,ad=7e3,cd=5,hd=101,ud=null;$l&&("/"===$l[$l.length-1]&&($l=$l.substring(0,$l.length-1)),$l.split("&").forEach((function(t){const e=t.split("="),i=decodeURIComponent(e[0]);let r,n=null;if(e.length>1&&(n=decodeURIComponent(e[1])),Xl[i]=n,0===i.toUpperCase().indexOf("KEY."))if(r=n.toUpperCase(),Zl[r]){const t=i.substring(4).toUpperCase();Jl[t]?(console.log("mapping "+t+" to "+r),ih.push({native:t,bbc:r})):console.log("unknown key: "+t)}else console.log("unknown BBC key: "+n);else if(0===i.indexOf("GP.")){const t=i.substring(3).toUpperCase();zl.remap(t,n.toUpperCase())}else switch(i){case"LEFT":case"RIGHT":case"UP":case"DOWN":case"FIRE":zl.remap(i,n.toUpperCase());break;case"autoboot":Vl="boot";break;case"autochain":Vl="chain";break;case"autorun":Vl="run";break;case"autotype":Vl="type",Yl=n;break;case"keyLayout":Ql=(n+"").toLowerCase();break;case"disc":case"disc1":Gl=n;break;case"rom":Kl.push(n);break;case"disc2":ql=n;break;case"embed":s(".embed-hide").hide(),s("body").css("background-color","transparent");break;case"fasttape":id=!0;break;case"noseek":rd=!0;break;case"audiofilterfreq":ad=Number(n);break;case"audiofilterq":cd=Number(n);break;case"stationId":hd=Number(n)}}))),Xl.frameSkip&&(jl=parseInt(Xl.frameSkip));const ld={outputStrobe:function(t,e){if(!Pd)return;if(!e||t)return;const s=Rl.uservia;s.setca1(!1),s.setca1(!0);const i=String.fromCharCode(s.ora);Pd.value+=i}};let dd=null;{let t=255;const e=function(e,s){const i=1<<s-oh.K1;e?t&=255^i:t|=i};for(let t=oh.K1;t<=oh.K8;++t)td[t]=e;dd={write:function(){},read:function(){return t}}}const pd={keyLayout:Ql,coProcessor:Xl.coProcessor,cpuMultiplier:ed,videoCyclesBatch:Xl.videoCyclesBatch,extraRoms:Kl,userPort:dd,printerPort:ld,getGamepads:function(){return navigator.getGamepads?navigator.getGamepads():[]}},fd=new class{constructor(t){this.changed={},this.model=null,this.coProcessor=null;const e=document.getElementById("configuration");e.addEventListener("show.bs.modal",(()=>{this.changed={},this.setDropdownText(this.model.name),this.set65c02(this.model.tube),this.setTeletext(this.model.hasTeletextAdaptor),this.setMusic5000(this.model.hasMusic5000),this.setEconet(this.model.hasEconet)})),e.addEventListener("hide.bs.modal",(()=>t(this.changed))),s(".model-menu a").on("click",(t=>{this.changed.model=s(t.target).attr("data-target"),this.setDropdownText(s(t.target).text())})),s("#65c02").on("click",(()=>{this.changed.coProcessor=s("#65c02").prop("checked")})),s("#hasTeletextAdaptor").on("click",(()=>{this.changed.hasTeletextAdaptor=s("#hasTeletextAdaptor").prop("checked")})),s("#hasEconet").on("click",(()=>{this.changed.hasEconet=s("#hasEconet").prop("checked")})),s("#hasMusic5000").on("click",(()=>{this.changed.hasMusic5000=s("#hasMusic5000").prop("checked")})),s(".keyboard-menu a").on("click",(t=>{const e=s(t.target).attr("data-target");this.changed.keyLayout=e,this.setKeyLayout(e)}))}setModel(t){this.model=Ju(t),s(".bbc-model").text(this.model.name)}setKeyLayout(t){s(".keyboard-layout").text(t[0].toUpperCase()+t.substr(1))}set65c02(t){t=!!t,s("#65c02").prop("checked",t),this.model.tube=t?Ju("Tube65c02"):null}setEconet(t){t=!!t,s("#hasEconet").prop("checked",t),this.model.hasEconet=t,t&&this.model.isMaster&&this.addRemoveROM("master/anfs-4.25.rom",!0)}setMusic5000(t){t=!!t,s("#hasMusic5000").prop("checked",t),this.model.hasMusic5000=t,this.addRemoveROM("ample.rom",t)}setTeletext(t){t=!!t,s("#hasTeletextAdaptor").prop("checked",t),this.model.hasTeletextAdaptor=t,this.addRemoveROM("ats-3.0.rom",t)}setDropdownText(t){s("#bbc-model-dropdown .bbc-model").text(t)}addRemoveROM(t,e){if(e&&!this.model.os.includes(t))this.model.os.push(t);else{let e=this.model.os.indexOf(t);-1!==e&&this.model.os.splice(e,1)}}mapLegacyModels(t){t.model&&("masterturbo"===t.model.toLowerCase()&&(t.model="Master",t.coProcessor=!0),"bmusic5000"===t.model.toLowerCase()&&(t.model="B-DFS1.2",t.hasMusic5000=!0),"bteletext"===t.model.toLowerCase()&&(t.model="B-DFS1.2",t.hasTeletextAdaptor=!0))}}((function(t){var e,s,i,r;Xl=zs.extend(Xl,t),(t.model||void 0!==t.coProcessor||void 0!==t.hasMusic5000||void 0!==t.hasTeletextAdaptor||void 0!==t.hasEconet)&&(e="Changing model requires a restart of the emulator. Restart now?",s="Yes, restart now",i="No, thanks",r=function(){zd(),window.location.reload()},vp.find(".context").text(e),vp.find(".ays-yes").text(s),vp.find(".ays-no").text(i),vp.find(".ays-yes").one("click",(function(){yp.hide(),r()})),yp.show()),t.keyLayout&&(window.localStorage.keyLayout=t.keyLayout,pd.keyLayout=t.keyLayout,Rl.updateKeyLayout())}));function md(t,e,s){const i=t.find("img");i.hide(),e&&i.attr("src",e).bind("load",(function(){s(t,i),i.show()}))}fd.mapLegacyModels(Xl),fd.setModel(Xl.model||(0===window.location.hostname.indexOf("bbc")?"B-DFS1.2":0===window.location.hostname.indexOf("master")?"Master":"B-DFS1.2")),fd.setKeyLayout(Ql),fd.set65c02(Xl.coProcessor),fd.setEconet(Xl.hasEconet),fd.setMusic5000(Xl.hasMusic5000),fd.setTeletext(Xl.hasTeletextAdaptor),Ul=fd.model,md(s(".sidebar.left"),Xl.sbLeft,(function(t,e){t.css({left:-e.width()-5})})),md(s(".sidebar.right"),Xl.sbRight,(function(t,e){t.css({right:-e.width()-5})})),md(s(".sidebar.bottom"),Xl.sbBottom,(function(t,e){t.css({bottom:-e.height()})})),Xl.cpuMultiplier&&(ed=parseFloat(Xl.cpuMultiplier),console.log("CPU multiplier set to "+ed));const gd=2*ed*1e3*1e3|0,bd=gd/10;let vd=!0;void 0!==Xl.glEnabled&&(vd="true"===Xl.glEnabled);const yd=s("#screen"),wd=vd?function(t){try{return new Ll(t)}catch(t){console.log("Unable to use OpenGL: "+t)}return new kl(t)}(yd[0]):new kl(yd[0]);Ol=new class{constructor(t,e,s){this.isMaster=t,this.fb32=_h(e),this.collook=_h(new Uint32Array([4278190080,4278190335,4278255360,4278255615,4294901760,4294902015,4294967040,4294967295])),this.screenAddrAdd=new Uint16Array([16384,12288,24576,22528]),this.cursorTable=new Uint8Array([0,0,0,128,64,32,32]),this.cursorFlashMask=new Uint8Array([0,0,8,16]),this.regs=new Uint8Array(32),this.bitmapX=0,this.bitmapY=0,this.oddClock=!1,this.frameCount=0,this.doEvenFrameLogic=!1,this.isEvenRender=!0,this.lastRenderWasEven=!1,this.firstScanline=!0,this.inHSync=!1,this.inVSync=!1,this.hadVSyncThisRow=!1,this.checkVertAdjust=!1,this.endOfMainLatched=!1,this.endOfVertAdjustLatched=!1,this.endOfFrameLatched=!1,this.inVertAdjust=!1,this.inDummyRaster=!1,this.hpulseWidth=0,this.vpulseWidth=0,this.hpulseCounter=0,this.vpulseCounter=0,this.dispEnabled=Oh,this.horizCounter=0,this.vertCounter=0,this.scanlineCounter=0,this.vertAdjustCounter=0,this.addr=0,this.lineStartAddr=0,this.nextLineStartAddr=0,this.ulactrl=0,this.pixelsPerChar=8,this.halfClock=!1,this.ulaMode=0,this.teletextMode=!1,this.displayEnableSkew=0,this.ulaPal=_h(new Uint32Array(16)),this.actualPal=new Uint8Array(16),this.teletext=new Rh,this.cursorOn=!1,this.cursorOff=!1,this.cursorOnThisFrame=!1,this.cursorDrawIndex=0,this.cursorPos=0,this.interlacedSyncAndVideo=!1,this.doubledScanlines=!0,this.frameSkipCount=0,this.screenAdd=0,this.topBorder=12,this.bottomBorder=13,this.leftBorder=80,this.rightBorder=48,this.paint_ext=s,this.debugPrevScreen=null,this.table4bpp=(()=>{const t=new Uint8Array(16384);let e,s,i,r;for(s=0;s<256;++s){for(i=s,e=0;e<16;++e)r=0,2&i&&(r|=1),8&i&&(r|=2),32&i&&(r|=4),128&i&&(r|=8),t[Fh(3,s)+e]=r,i<<=1,i|=1;for(e=0;e<16;++e)t[Fh(2,s)+e]=t[Fh(3,s)+(e>>>1)],t[Fh(1,s)+e]=t[Fh(3,s)+(e>>>2)],t[Fh(0,s)+e]=t[Fh(3,s)+(e>>>3)]}return t})(),this.crtc=new Ih(this),this.ula=new Ph(this),this.reset(null),this.clearPaintBuffer(),this.paint()}reset(t,e){this.cpu=t,this.sysvia=e,e&&(e.cb2changecallback=this.cb2changed.bind(this))}paint(){this.paint_ext(this.leftBorder,this.topBorder,1024-this.rightBorder,625-this.bottomBorder)}clearPaintBuffer(){const t=this.fb32;if(this.interlacedSyncAndVideo||!this.doubledScanlines){let e=1&this.frameCount;for(;e<625;){const s=1024*e;t.fill(0,s,s+1024),e+=2}}else t.fill(0)}paintAndClear(){this.dispEnabled&Oh&&(this.paint(),this.clearPaintBuffer()),this.dispEnabled&=-33;let t=Oh;this.frameSkipCount>1&&this.frameCount%this.frameSkipCount&&(t=0),this.dispEnabled|=t,this.bitmapY=0,1&this.regs[8]&&1&this.frameCount&&(this.bitmapY=-1)}debugOffset(t,e){return t<0||t>=1024||e<0||e>=768?-1:1024*e+t}debugPaint(){this.debugPrevScreen||(this.debugPrevScreen=new Uint32Array(786432)),Nh(this.debugPrevScreen,this.fb32);for(let t=-10;t<=10;t++)for(let e=-10;e<=10;++e){const s=Math.sqrt(e*e+t*t)/10;if(s>1)continue;const i=this.debugOffset(this.bitmapX+e,this.bitmapY+t);this.fb32[i]=Bh(this.fb32[i],16777215,Math.pow(1-s,2))}this.paint(),Nh(this.fb32,this.debugPrevScreen)}blitFb(t,e,s){e|=0;const i=Fh(this.ulaMode,t),r=this.fb32,n=this.ulaPal,o=this.table4bpp;if(8===s)for(let t=0;t<8;++t)r[e+t]=n[o[i+t]];else for(let t=0;t<16;++t)r[e+t]=n[o[i+t]]}handleCursor(t){if(this.cursorOnThisFrame&&this.ulactrl&this.cursorTable[this.cursorDrawIndex]){for(let e=0;e<this.pixelsPerChar;++e)this.fb32[t+e]^=16777215;if(this.doubledScanlines&&!this.interlacedSyncAndVideo)for(let e=0;e<this.pixelsPerChar;++e)this.fb32[t+1024+e]^=16777215}7==++this.cursorDrawIndex&&(this.cursorDrawIndex=0)}setScreenAdd(t){this.screenAdd=this.screenAddrAdd[t]}readVideoMem(){if(8192&this.addr){let t=1023&this.addr;return 2048&this.addr||this.isMaster?t|=31744:t|=15360,this.cpu.videoRead(t)}{let t=7&this.scanlineCounter|this.addr<<3;return 4096&this.addr&&(t+=this.screenAdd),this.cpu.videoRead(32767&t)}}endOfFrame(){this.vertCounter=0,this.firstScanline=!0,this.nextLineStartAddr=16383&(this.regs[13]|this.regs[12]<<8),this.lineStartAddr=this.nextLineStartAddr,this.dispEnableSet(1);const t=(96&this.regs[10])>>>5;this.cursorOnThisFrame=0===t||!!(this.frameCount&this.cursorFlashMask[t]),this.lastRenderWasEven=this.isEvenRender,this.isEvenRender=!(1&this.frameCount),this.inVSync||(this.doEvenFrameLogic=!1)}endOfCharacterLine(){this.vertCounter=this.vertCounter+1&127,this.scanlineCounter=0,this.hadVSyncThisRow=!1,this.dispEnableSet(8),this.cursorOn=!1,this.cursorOff=!1}endOfScanline(){this.firstScanline=!1,this.scanlineCounter===this.regs[11]&&(this.cursorOff=!0),this.vpulseCounter=this.vpulseCounter+1&15;const t=this.scanlineCounter===this.regs[9];if(t&&(this.lineStartAddr=this.nextLineStartAddr),this.interlacedSyncAndVideo?this.scanlineCounter=this.scanlineCounter+2&30:this.scanlineCounter=this.scanlineCounter+1&31,!this.teletextMode){this.scanlineCounter>>>3&1?this.dispEnableClear(8):this.dispEnableSet(8)}!this.inVertAdjust&&t&&this.endOfCharacterLine(),this.endOfMainLatched&&!this.endOfVertAdjustLatched&&(this.inVertAdjust=!0);let e=!1;this.endOfFrameLatched&&(e=!0),this.endOfVertAdjustLatched&&(this.inVertAdjust=!1,1&this.regs[8]&&this.doEvenFrameLogic?(this.inDummyRaster=!0,this.endOfFrameLatched=!0):e=!0),e&&(this.endOfMainLatched=!1,this.endOfVertAdjustLatched=!1,this.endOfFrameLatched=!1,this.inDummyRaster=!1,this.endOfCharacterLine(),this.endOfFrame()),this.addr=this.lineStartAddr;const s=31&this.regs[10];this.scanlineCounter===s&&(this.cursorOn=!0);let i=this.scanlineCounter;this.interlacedSyncAndVideo&&1&this.frameCount&&i++,this.teletext.setRA0(!!(1&i))}handleHSync(){this.hpulseCounter=this.hpulseCounter+1&15,this.hpulseCounter===this.hpulseWidth>>>1?(this.bitmapX=-8,1&this.hpulseWidth&&(this.bitmapX-=4),this.bitmapY+=2,this.bitmapY>=768&&this.paintAndClear()):this.hpulseCounter===(15&this.regs[3])&&(this.inHSync=!1)}cb2changed(t,e){t&&e&&(this.regs[16]=this.addr>>8&63,this.regs[17]=255&this.addr)}dispEnableChanged(){const t=19==(19&this.dispEnabled);this.teletext.setDISPTMG(t)}dispEnableSet(t){this.dispEnabled|=t,this.dispEnableChanged()}dispEnableClear(t){this.dispEnabled&=~t,this.dispEnableChanged()}polltime(t){for(;t--;){if(this.oddClock=!this.oddClock,this.bitmapX+=8,this.halfClock&&!this.oddClock)continue;this.inHSync&&this.handleHSync();const t=this.displayEnableSkew+(this.teletextMode?2:0);this.horizCounter===t&&this.dispEnableSet(4),this.horizCounter===this.regs[1]&&(this.nextLineStartAddr=this.addr),this.horizCounter!==this.regs[1]+t&&this.horizCounter!==this.regs[0]+t||this.dispEnableClear(6),this.horizCounter!==this.regs[2]||this.inHSync||(this.inHSync=!0,this.hpulseCounter=0);const e=!!(1&this.regs[8]),s=this.horizCounter===this.regs[0]>>>1,i=!e||!this.doEvenFrameLogic||s;let r=!1,n=!1;this.inVSync&&this.vpulseCounter===this.vpulseWidth&&i&&(r=!0,this.inVSync=!1),this.vertCounter!==this.regs[7]||this.inVSync||this.hadVSyncThisRow||!i||(n=!0,this.inVSync=!0),n&&!r&&(this.hadVSyncThisRow=!0,this.vpulseCounter=0,this.regs[0]&&this.regs[4]&&this.paintAndClear()),(n||r)&&(this.sysvia.setVBlankInt(this.inVSync),this.teletext.setDEW(this.inVSync));const o=3==(3&this.dispEnabled);if((o||this.cursorDrawIndex)&&this.dispEnabled&Oh){const t=this.readVideoMem();if(o&&(this.teletextMode&&this.teletext.fetchData(t),this.addr===this.cursorPos&&this.cursorOn&&!this.cursorOff&&this.horizCounter<this.regs[1]&&(this.cursorDrawIndex=3-(this.regs[8]>>>6&3))),this.bitmapX>=0&&this.bitmapX<1024&&this.bitmapY<625){let e=!1,s=this.bitmapY;(this.doubledScanlines&&!this.interlacedSyncAndVideo||this.isEvenRender===this.lastRenderWasEven)&&(e=!0,s&=-2),s=1024*s+this.bitmapX,63==(63&this.dispEnabled)&&(this.teletextMode?this.teletext.render(this.fb32,s):this.blitFb(t,s,this.pixelsPerChar,e),e&&this.fb32.copyWithin(s+1024,s,s+this.pixelsPerChar)),this.cursorDrawIndex&&this.handleCursor(s,e)}}this.addr=this.addr+1&16383,this.checkVertAdjust&&(this.checkVertAdjust=!1,this.endOfMainLatched&&(this.vertAdjustCounter===this.regs[5]&&(this.endOfVertAdjustLatched=!0),this.vertAdjustCounter++,this.vertAdjustCounter&=31)),1===this.horizCounter&&(this.vertCounter===this.regs[4]&&this.scanlineCounter===this.regs[9]&&(this.endOfMainLatched=!0,this.vertAdjustCounter=0),this.checkVertAdjust=!0),this.horizCounter===this.regs[0]?(this.endOfScanline(),this.horizCounter=0,this.dispEnableSet(2)):this.horizCounter=this.horizCounter+1&255;const a=this.vertCounter===this.regs[6];a&&!this.firstScanline&&1&this.dispEnabled&&(this.dispEnableClear(1),this.frameCount++);const c=this.vertCounter===this.regs[7];(a||c)&&(this.doEvenFrameLogic=!!(1&this.frameCount))}}}(Ul.isMaster,wd.fb32,(function(t,e,s,i){Hl++,Hl<jl||(Hl=0,wd.paint(t,e,s,i))})),void 0!==Xl.fakeVideo&&(Ol=new Uh);const Cd=new class{constructor(t,e,s,i){this.warningNode=t,this.audioContext="undefined"!=typeof AudioContext?new AudioContext:"undefined"!=typeof webkitAudioContext?new webkitAudioContext:null,this.audioContext?(this.audioContext.onstatechange=()=>this.checkStatus(),this.soundChip=new sl(this.audioContext.sampleRate),this.ddNoise=i?new nl:new rl(this.audioContext),this._setup(e,s)):(this.soundChip=new il,this.ddNoise=new nl),this.warningNode.on("mousedown",(()=>this.tryResume())),this.warningNode.toggle(!1),this.audioContextM5000="undefined"!=typeof AudioContext?new AudioContext({sampleRate:46875}):"undefined"!=typeof webkitAudioContext?new webkitAudioContext({sampleRate:46875}):null,this.audioContextM5000&&this.audioContextM5000.audioWorklet?(this.audioContextM5000.onstatechange=()=>this.checkStatus(),this.music5000=new hl((t=>this._onBufferMusic5000(t))),this.audioContextM5000.audioWorklet.addModule("./music5000-worklet.js").then((()=>{this._music5000workletnode=new AudioWorkletNode(this.audioContextM5000,"music5000",{outputChannelCount:[2]}),this._music5000workletnode.connect(this.audioContextM5000.destination)}))):this.music5000=new ul}_setup(t,e){this._jsAudioNode=this.audioContext.createScriptProcessor(2048,0,1),this._jsAudioNode.onaudioprocess=t=>{const e=t.outputBuffer.getChannelData(0);this.soundChip.render(e,0,e.length)},0!==t?(this.soundChip.filterNode=this.audioContext.createBiquadFilter(),this.soundChip.filterNode.type="lowpass",this.soundChip.filterNode.frequency.value=t,this.soundChip.filterNode.Q.value=e,this._jsAudioNode.connect(this.soundChip.filterNode),this.soundChip.filterNode.connect(this.audioContext.destination)):this.soundChip._jsAudioNode.connect(this.audioContext.destination)}async tryResume(){this.audioContext&&await this.audioContext.resume(),this.audioContextM5000&&await this.audioContextM5000.resume()}_onBufferMusic5000(t){this._music5000workletnode&&this._music5000workletnode.port.postMessage(t)}checkStatus(){this.audioContext&&("suspended"===this.audioContext.state&&this.warningNode.fadeIn(),"running"===this.audioContext.state&&this.warningNode.fadeOut())}async initialise(){await this.ddNoise.initialise()}mute(){this.soundChip.mute(),this.ddNoise.mute()}unmute(){this.soundChip.unmute(),this.ddNoise.unmute()}}(s("#audio-warning"),ad,cd,rd);window.setTimeout((()=>Cd.checkStatus()),1e3);let Ad=1,_d=1,xd=1;function Sd(t){const e=t.which||t.charCode||t.keyCode,s=oh;switch(t.location){default:switch(e){case s.SHIFT:return 1===Ad?s.SHIFT_LEFT:s.SHIFT_RIGHT;case s.ALT:return 1===xd?s.ALT_LEFT:s.ALT_RIGHT;case s.CTRL:return 1===_d?s.CTRL_LEFT:s.CTRL_RIGHT}break;case 1:switch(e){case s.SHIFT:return Ad=1,s.SHIFT_LEFT;case s.ALT:return xd=1,s.ALT_LEFT;case s.CTRL:return _d=1,s.CTRL_LEFT}break;case 2:switch(e){case s.SHIFT:return Ad=2,s.SHIFT_RIGHT;case s.ALT:return xd=2,s.ALT_RIGHT;case s.CTRL:return _d=2,s.CTRL_RIGHT}break;case 3:switch(e){case s.ENTER:return oh.NUMPADENTER;case s.DELETE:return oh.NUMPAD_DECIMAL_POINT}}return e}Pl=new class{constructor(t){function e(t,e){const s=t.find(".goto-addr");t.on("submit",(t=>{var i;e("$"===(i=s.val())[0]||"&"===i[0]?parseInt(i.substr(1),16):0===i.indexOf("0x")?parseInt(i.substr(2),16):parseInt(i,16)),s.val(""),s.blur(),t.preventDefault()}))}this.video=t,this.patchInstructions={},this._enabled=!1,this.disass=s("#disassembly"),this._memoryView=new jh(s("#memory"),(t=>this.cpu?this.cpu.peekmem(t):0)),this.debugNode=s("#debug, #hardware_debug, #crtc_debug"),this.disassPc=0,this.disassStack=[],this.uservia=this.sysvia=this.crtc=null,this.breakpoints={},e(s("#goto-mem-addr-form"),(t=>this._memoryView.update(t))),e(s("#goto-dis-addr-form"),this.updateDisassembly.bind(this)),this.enable(!1);for(let t=0;t<16;t++)this.disass.find(".template").clone().removeClass("template").appendTo(this.disass);this.disass.find(".bp_gutter").click(this.bpClick.bind(this)),this.disass.bind("wheel",(t=>{let e=t.originalEvent.deltaY;if(0===e)return;let s=this.disassPc;const i=e<0?this.prevInstruction.bind(this):this.nextInstruction.bind(this);for(e=Math.abs(e);e>0;)s=i(s),e-=30;this.updateDisassembly(s),t.preventDefault()}))}setCpu(t){this.cpu=t,this.sysvia=this.setupVia(s("#sysvia"),t.sysvia),this.uservia=this.setupVia(s("#uservia"),t.uservia),this.crtc=this.setupCrtc(s("#crtc_debug"),t.video)}disassemble(t){return this.cpu.disassembler.disassemble(t)}setupCrtc(t,e){if(!e)return dh;const s=[],i=t.find(".crtc_regs");function r(t,e){const s=t.find(".template").clone().removeClass("template").appendTo(t);return s.find(".register").text(e),s.find(".value")}for(let t=0;t<16;++t){const n=r(i,"R"+t);s.push((()=>{this.updateElem(n,ch(e.regs[t]))}))}const n=t.find(".crtc_state"),o=["bitmapX","bitmapY","dispEnabled","horizCounter","inHSync","scanlineCounter","vertAdjustCounter","vertCounter","inVSync","endOfMainLatched","endOfVertAdjustLatched","inVertAdjust","inDummyRaster","addr","lineStartAddr","nextLineStartAddr"];for(const t of o){const i=r(n,t);"boolean"==typeof e[t]?s.push((()=>this.updateElem(i,e[t]?"true":"false"))):s.push((()=>this.updateElem(i,hh(e[t]))))}const a=()=>{for(const t of s)t()};return a(),a}setupVia(t,e){const s=[];if(!e)return dh;const i=["ora","orb","ira","irb","ddra","ddrb","acr","pcr","ifr","ier","t1c","t1l","t2c","t2l","portapins","portbpins","IC32"];for(const r of i){if(void 0===e[r])continue;const i=t.find(".template").clone().removeClass("template").appendTo(t);i.find(".register").text(r.toUpperCase());const n=i.find(".value");r.match(/t[12][cl]/)?s.push((()=>{const t=e[r];this.updateElem(n,ch(t>>>16&255)+ch(t>>>8&255)+ch(255&t))})):s.push((()=>{this.updateElem(n,ch(e[r]))}))}const r=()=>{for(const t of s)t()};return r(),r}updateElem(t,e){const s=t.text();s!==e&&t.text(e),t.toggleClass("changed",s!==e&&""!==s)}updateRegisters(){this.updateElem(s("#cpu6502_a"),ch(this.cpu.a)),this.updateElem(s("#cpu6502_x"),ch(this.cpu.x)),this.updateElem(s("#cpu6502_y"),ch(this.cpu.y)),this.updateElem(s("#cpu6502_s"),ch(this.cpu.s)),this.updateElem(s("#cpu6502_pc"),hh(this.cpu.pc));for(const t of["c","z","i","d","v","n"])this.updateElem(s("#cpu6502_flag_"+t),this.cpu.p[t]?t.toUpperCase():t)}execPatch(t){const e=t.split(",");if(1!==e.length)return void zs.each(e,this.execPatch);if(!t)return;const s=t.split(":");let i=parseInt(s[0],16);const r=s[1];for(let t=0;t<r.length;t+=2){const e=parseInt(r.substr(t,2),16);this.cpu.writemem(i,e),i++}}setPatch(t){if(zs.each(t.split(";"),(t=>{if("@"===t[0]){const e=parseInt(t.substr(1,4),16);t=t.substr(5),this.patchInstructions[e]||(this.patchInstructions[e]=[]),this.patchInstructions[e].push(t)}else this.execPatch(t)})),0!==Object.keys(this.patchInstructions).length){const t=this.cpu.debugInstruction.add((e=>{const s=this.patchInstructions[e];return!!s&&(zs.each(s,this.execPatch),delete this.patchInstructions[e],0===Object.keys(this.patchInstructions).length&&(console.log("All patches done"),t.remove()),!1)}))}}debug(t){this.enable(!0),this.updateDisassembly(t),this.updateRegisters(),this._memoryView.update(),this.sysvia(),this.uservia(),this.crtc(),this.video.debugPaint()}enable(t){this._enabled&&!t&&this.updatePrevMem(),this._enabled=t,this.debugNode.toggle(this._enabled)}enabled(){return this._enabled}updateDisassembly(t){this.disassPc=t;const e=this.disass.children().filter(":visible"),i=(t,e)=>{const s=this.disassemble(e),i=this._memoryView.dump(e,s[1]);t.find(".dis_addr").html(Hh(e)),t.toggleClass("current",e===this.cpu.pc),t.toggleClass("highlight",e===this.disassPc),t.find(".instr_bytes").text(i.hex.join(" ")),t.find(".instr_asc").text(i.asc.join(""));const r=t.find(".disassembly").html(s[0]);return r.find(".instr_mem_ref").click((t=>this.memClick(t))),r.find(".instr_instr_ref").click((t=>this.instrClick(t))),t.find(".bp_gutter").toggleClass("active",!!this.breakpoints[e]),t.data({addr:e,ref:s[2]}),s[1]};for(let r=0;r<8;++r){t=i(s(e[r+8]),t)}t=this.disassPc;for(let r=7;r>=0;--r){t=this.prevInstruction(t);i(s(e[r]),t)}}prevInstruction(t){const e=/(RTS|B..|JMP|JSR|LD[AXY]|ST[AXY]|TA[XY]|T[XY]A|AD[DC]|SUB|SBC|CLC|SEC|CMP|EOR|ORR|AND|INC|DEC).*/,s=/.*,\s*([XY]|X\))$/;let i=(t&=65535)-1,r=0;for(let n=t-20;n!==t;n++){let o=0,a=65535&n;for(;a<t;){const n=this.disassemble(a);if(n[0]===this.cpu.pc&&(o+=10),n[0].match(e)&&!n[0].match(s)&&o++,n[1]===t&&o>r){r=o,i=a;break}a=n[1]}}return i}updatePrevMem(){this._memoryView.snapshot()}hide(){this.enable(!1)}stepUntil(t){this.cpu.targetCycles=this.cpu.currentCycles;for(let e=0;e<65536&&(this.cpu.execute(1),!t());e++);this.debug(this.cpu.pc)}step(){this.updatePrevMem();const t=this.cpu.pc;this.stepUntil((()=>this.cpu.pc!==t))}isUnconditionalJump(t){return!!this.disassemble(t)[0].match(/^(JMP|RTS|BRA)/)}stepOver(){if(this.updatePrevMem(),this.isUnconditionalJump(this.cpu.pc))return this.step();const t=this.nextInstruction(this.cpu.pc);this.stepUntil((()=>this.cpu.pc===t))}isReturn(t){return"RTS"===this.disassemble(t)[0]}stepOut(){this.updatePrevMem();const t=this.cpu.s;this.stepUntil((()=>{if(this.cpu.s>=t&&this.isReturn(this.cpu.pc)){const t=this.nextInstruction(this.cpu.pc);return this.step(),this.cpu.pc!==t}return!1}))}nextInstruction(t){return 65535&this.disassemble(t)[1]}instrClick(t){const e=s(t.target).data();this.disassStack.push(this.disassPc),this.updateDisassembly(e.ref)}memClick(t){const e=s(t.target).data();this._memoryView.update(e.ref)}toggleBreakpoint(t){this.breakpoints[t]?(console.log("Removing breakpoint from address "+hh(t)),this.breakpoints[t].remove(),this.breakpoints[t]=void 0):(console.log("Adding breakpoint to address "+hh(t)),this.breakpoints[t]=this.cpu.debugInstruction.add((e=>e===t)))}bpClick(t){const e=s(t.target).closest(".dis_elem").data().addr;this.toggleBreakpoint(e),s(t.target).toggleClass("active",!!this.breakpoints[e])}keyPress(t){if(s(":focus").length>0)return!1;switch(String.fromCharCode(t)){case"b":this.disassStack.length&&this.updateDisassembly(this.disassStack.pop());break;case"k":this.updateDisassembly(this.prevInstruction(this.disassPc));break;case"j":this.updateDisassembly(this.nextInstruction(this.disassPc));break;case"t":this.toggleBreakpoint(this.disassPc),this.updateDisassembly(this.disassPc);break;case"u":this._memoryView.step(8);break;case"i":this._memoryView.step(-8);break;case"U":this._memoryView.step(64);break;case"I":this._memoryView.step(-64);break;case"n":this.step();break;case"N":this.updatePrevMem(),this.cpu.execute(1),self.debug(this.cpu.pc);break;case"m":this.stepOver();break;case"o":this.stepOut()}return!0}}(Ol),s(".initially-hidden").removeClass("initially-hidden"),td[oh.S]=function(t){t&&(ph("keyboard","press","S"),kp(!0))},td[oh.R]=function(t){t&&window.location.reload()};const Td=new ga(document.getElementById("discs")),kd=new ga(document.getElementById("econetfs"));function Ed(t){const e=new FileReader;e.onload=function(e){Rl.fdc.loadDisc(0,Uu(Rl.fdc,t.name,e.target.result)),delete Xl.disc,delete Xl.disc1,zd(),Td.hide()},e.readAsBinaryString(t)}const Dd=s("#paste-text");Dd.on("paste",(function(t){Hd(nh(t.originalEvent.clipboardData.getData("text/plain")),!0)})),Dd.on("dragover",(function(t){t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="copy"})),Dd.on("drop",(function(t){ph("local","drop");Ed(t.originalEvent.dataTransfer.files[0])}));const Ld=s("#cub-monitor");Ld.on("mousemove mousedown mouseup",(function(t){Cd.tryResume(),document.activeElement!==document.body&&document.activeElement.blur();const e=Ld.offset(),s=yd.offset(),i=(t.offsetX-e.left+s.left)/yd.width(),r=(t.offsetY-e.top+s.top)/yd.height();Rl.touchScreen&&Rl.touchScreen.onMouse(i,r,t.buttons),t.preventDefault()})),s(window).blur((function(){Rl.sysvia&&Rl.sysvia.clearKeys()})),s("#fs").click((function(t){yd[0].requestFullscreen(),t.preventDefault()})),document.onkeydown=function(t){if(Cd.tryResume(),"paste-text"===document.activeElement.id)return;if(!Fl)return;const e=Sd(t);if(t.altKey){const s=td[e];s&&(s(!0,e),t.preventDefault())}else e===oh.HOME&&t.ctrlKey?(ph("keyboard","press","home"),kp(!0)):e===oh.INSERT&&t.ctrlKey?(ph("keyboard","press","insert"),sd=!sd):e===oh.END&&t.ctrlKey?(ph("keyboard","press","end"),nd=!0,kp(!1)):e===oh.F12||e===oh.BREAK?(ph("keyboard","press","break"),Rl.setReset(!0),t.preventDefault()):e===oh.B&&t.ctrlKey?(Rl.sysvia.keyDown(Sd(t),t.shiftKey),t.preventDefault(),function(){if(Od&&!Od.closed)return;Od=window.open("","_blank","height=300,width=400"),Od.document.write('<textarea id="text" rows="15" cols="40" placeholder="Printer outputs here..."></textarea>'),Pd=Od.document.getElementById("text"),Rl.uservia.setca1(!0)}()):(Rl.sysvia.keyDown(Sd(t),t.shiftKey),t.preventDefault())},document.onkeypress=function(t){if("paste-text"===document.activeElement.id)return;if(Fl||!Pl.enabled()&&!nd)return;const e=Sd(t);if(Pl.enabled()&&103===e)return Pl.hide(),void Tp();if(nd){if(103===e)return nd=!1,void Tp();if(110===e)return od=!0,void Tp()}Pl.keyPress(Sd(t))&&t.preventDefault()},document.onkeyup=function(t){if("paste-text"===document.activeElement.id)return;const e=Sd(t);if(Rl&&Rl.sysvia&&Rl.sysvia.keyUp(e),Fl){if(t.altKey){const s=td[e];s&&(s(!1,e),t.preventDefault())}else e!==oh.F12&&e!==oh.BREAK||Rl.setReset(!1);t.preventDefault()}},document.ondragover=function(t){t.preventDefault(),t.dataTransfer.dropEffect="none"},document.ondrop=function(t){t.preventDefault()},window.onbeforeunload=function(){if(Fl&&Rl.sysvia.hasAnyKeyDown())return"It seems like you're still using the emulator. If you're in Chrome, it's impossible for jsbeeb to prevent some shortcuts (like ctrl-W) from performing their default behaviour (e.g. closing the window).\nAs a workarond, create an 'Application Shortcut' from the Tools menu.  When jsbeeb runs as an application, it *can* prevent ctrl-W from closing the window."},Ul.hasEconet?ud=new vu(hd):s("#fsmenuitem").hide();const Rd=new Iu({load:function(){return window.localStorage.cmosRam?JSON.parse(window.localStorage.cmosRam):null},save:function(t){window.localStorage.cmosRam=JSON.stringify(t)}},Ul.cmosOverride,ud);let Od=null,Pd=null;function Id(t){delete Xl.disc,Xl.disc1=t,zd()}function Nd(){s("#sth-list li:not('.template')").remove()}function Md(){s("#sth .loading").text("Loading catalog from STH archive"),s("#sth .loading").show(),Nd()}Rl=new Eu(Ul,Pl,Ol,Cd.soundChip,Cd.ddNoise,Ul.hasMusic5000?Cd.music5000:null,Rd,pd,ud);const Bd=new ga(document.getElementById("sth"));function Fd(t){return function(e){Nd();const i=s("#sth-list");s("#sth .loading").hide();const r=i.find(".template");!function e(n){const o=n.slice(0,100),a=n.slice(100),c=s("#sth-filter").val();s.each(o,(function(e,n){const o=r.clone().removeClass("template").appendTo(i);o.find(".name").text(n),s(o).on("click",(function(){t(n),Bd.hide()})),o.toggle(n.toLowerCase().indexOf(c)>=0)})),n.length&&zs.delay(e,30,a)}(e)}}function Ud(){s("#sth .loading").text("There was an error accessing the STH archive"),s("#sth .loading").show(),Nd()}function Hd(t,e){let s,i=0;if(Rl.sysvia.disableKeyboard(),e){let e=null;Rl.sysvia.capsLockLight?Rl.sysvia.shiftLockLight&&(e=Zl.SHIFTLOCK):e=Zl.CAPSLOCK,e&&(t.unshift(e),t.push(e))}const r=Rl.debugInstruction.add((function(){const e=1e3*Rl.cycleSeconds+Rl.currentCycles/(gd/1e3);if(e<i)return;if(s&&s!==rh.SHIFT&&Rl.sysvia.keyToggleRaw(s),0===t.length)return Rl.sysvia.enableKeyboard(),void r.remove();const n=t[0],o=s===n;if(s=n,o)return s=void 0,void(i=e+30);let a=50;"number"==typeof s?(a=s,s=void 0):Rl.sysvia.keyToggleRaw(s),t.shift(),i=e+a}))}function jd(t){const e=rh;console.log("Autobooting disc"),ph("init","autoboot",t),Hd([e.SHIFT,1e3],!1)}function zd(){let t=window.location.origin+window.location.pathname,e="?";s.each(Xl,(function(s,i){s.length>0&&i&&(t+=e+encodeURIComponent(s)+"="+encodeURIComponent(i),e="&")})),window.history.pushState(null,null,t)}Ml=new Nu(Md,Fd((function(t){ph("sth","click",t),Id("sth:"+t);const e=void 0!==Xl.autoboot;e&&Rl.reset(!0),Zd("Loading "+t),$d(Xl.disc1).then((function(t){Rl.fdc.loadDisc(0,t)})).then((function(){Jd(),e&&jd(t)}),(function(t){Jd(t)}))})),Ud,!1),Bl=new Nu(Md,Fd((function(t){ph("sth","clickTape",t),Xl.tape="sth:"+t,zd(),Zd("Loading "+t),qd(Xl.tape).then((function(){Jd()}),(function(t){Jd(t)}))})),Ud,!0),s("#sth .autoboot").click((function(){s("#sth .autoboot").prop("checked")?Xl.autoboot="":delete Xl.autoboot,zd()})),s(document).on("click","a.sth",(function(){const t=s(this).data("id");"discs"===t?Ml.populate():"tapes"===t?Bl.populate():console.log("unknown id",t)})),s("#sth-filter").on("change keyup",(function(){!function(t){t=t.toLowerCase(),s("#sth-list li:not('.template')").each((function(){const e=s(this);e.toggle(e.text().toLowerCase().indexOf(t)>=0)}))}(s("#sth-filter").val())}));const Wd=s("#error-dialog"),Gd=new ga(Wd[0]);function Kd(t){const e=t.match(/(([^:]+):\/?\/?|[!^|])?(.*)/),s=e[2]||e[1]||"";return{image:t=e[3],schema:s}}function $d(t){if(!t)return Promise.resolve(null);const e=Kd(t);t=e.image;const s=e.schema;if("!"===s[0]||"local"===s)return Promise.resolve(function(t,e){const s="disc_"+e;let i;const r=localStorage[s];return r?(console.log("Loading browser-local disc "+e),i=gh(r)):(console.log("Creating browser-local disc "+e),i=new Uint8Array(Eh(e).byteSize),Dh(i,e)),new Hu(t,s,i,(t=>{try{const e=mh(t.data);window.localStorage.setItem(t.name,e)}catch(t){window.alert("Writing to localStorage failed: "+t)}}))}(Rl.fdc,t));if("|"===s||"sth"===s)return Ml.fetch(t).then((function(e){return Uu(Rl.fdc,t,e)}));if("gd"===s){const e=t.match(/([^/]+)\/?(.*)/);let s="(unknown)";return e&&(t=e[1],s=e[2]),np({title:s,id:t})}if("b64data"===s){const e=atob(t);return t="disk.ssd",Promise.resolve(Uu(Rl.fdc,t,e))}if("data"===s){const e=kh(Array.prototype.map.call(atob(t),(t=>t.charCodeAt(0)))),s=e.data;return t=e.name,Promise.resolve(Uu(Rl.fdc,t,s))}return"http"===s||"https"===s||"file"===s?bh(s+"://"+t).then((function(e){if(/\.zip/i.test(t)){const s=kh(e);e=s.data,t=s.name}return Uu(Rl.fdc,t,e)})):(i="discs/"+t,console.log("Loading disc from "+i),bh(i)).then((function(e){return Uu(Rl.fdc,t,e)}));var i}function qd(t){const e=Kd(t);t=e.image;const s=e.schema;if("|"===s||"sth"===s)return Bl.fetch(t).then((function(e){Rl.acia.setTape(Xu(t,e))}));if("data"===s){const e=kh(Array.prototype.map.call(atob(t),(t=>t.charCodeAt(0))));return Promise.resolve(Rl.acia.setTape(Xu(e.name,e.data)))}return"http"===s||"https"===s?bh(s+"://"+t).then((function(e){if(/\.zip/i.test(t)){const s=kh(e);e=s.data,t=s.name}Rl.acia.setTape(Xu(t,e))})):async function(t){return console.log("Loading tape from "+t),Xu(t,await bh(t))}("tapes/"+t).then((function(t){Rl.acia.setTape(t)}))}function Xd(){return 0!==s(".modal:visible").length}s("#disc_load").on("change",(function(t){if(0===t.target.files.length)return;ph("local","click");Ed(t.target.files[0]),t.target.value=""})),s("#fs_load").on("change",(function(t){if(0===t.target.files.length)return;ph("local","click");!function(t){const e=new FileReader;e.onload=function(t){Rl.filestore.scsi=gh(t.target.result),Rl.filestore.PC=1024,Rl.filestore.SP=255,Rl.filestore.A=1,Rl.filestore.emulationSpeed=0,Rl.econet.receiveBlocks=[],Rl.econet.nextReceiveBlockNumber=1,kd.hide()},e.readAsBinaryString(t)}(t.target.files[0]),t.target.value=""})),s("#tape_load").on("change",(function(t){if(0===t.target.files.length)return;const e=t.target.files[0],i=new FileReader;ph("local","clickTape"),i.onload=function(t){Rl.acia.setTape(Xu("local file",t.target.result)),delete Xl.tape,zd(),s("#tapes").modal("hide")},i.readAsBinaryString(e),t.target.value=""}));let Vd=!1;document.addEventListener("show.bs.modal",(function(){Xd()||(Vd=Fl),Fl&&kp(!1)})),document.addEventListener("hidden.bs.modal",(function(){!Xd()&&Vd&&Tp()}));const Yd=s("#loading-dialog"),Qd=new ga(Yd[0]);function Zd(t){Yd.find(".loading").text(t),s("#google-drive-auth").hide(),Qd.show()}function Jd(t){s("#google-drive-auth").hide(),t?(Qd.show(),Yd.find(".loading").text("Error: "+t),setTimeout((function(){Qd.hide()}),5e3)):Qd.hide()}let tp=!1;const ep=new function(){const t=this,e="application/vnd.jsbeeb.disc-image";let s=null;const i=Hu;t.initialise=function(){return new Promise((function(t){const e=document.createElement("script");e.src="https://apis.google.com/js/client.js?onload=__onGapiLoad__",window.__onGapiLoad__=function(){s=window.gapi,s.client.load("drive","v2",(function(){console.log("Google Drive: available"),t(!0)}))},document.body.appendChild(e)}))},t.authorize=function(t){return new Promise((function(e,i){console.log("Authorizing",t),s.auth.authorize({client_id:"356883185894-bhim19837nroivv18p0j25gecora60r5.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",immediate:t},(function(s){s&&!s.error?(console.log("Google Drive: authorized"),e(!0)):s&&s.error&&!t?i(new Error(s.error)):(console.log("Google Drive: Need to auth"),e(!1))}))}))};const r="-------314159265358979323846",n="\r\n--"+r+"\r\n",o="\r\n--"+r+"--";function a(t,i,a){const c={title:t,parents:["jsbeeb disc images"],mimeType:e},h=mh(i),u=btoa(h),l=n+"Content-Type: application/json\r\n\r\n"+JSON.stringify(c)+n+"Content-Type: "+e+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+u+o;return s.client.request({path:"/upload/drive/v2/files"+(a?"/"+a:""),method:a?"PUT":"POST",params:{uploadType:"multipart",newRevision:!1},headers:{"Content-Type":'multipart/mixed; boundary="'+r+'"'},body:l})}function c(t,e,s){let r=null;const n=s.title;return s.editable?(console.log("Making editable disc"),r=zs.debounce((function(){a(this.name,this.data,s.id).then((function(){console.log("Saved ok")}))}),200)):console.log("Making read-only disc"),new i(t,n,e,r)}t.create=function(t,e){console.log("Google Drive: creating disc image: '"+e+"'");const s=Eh(e).byteSize,i=new Uint8Array(s);return Dh(i,e),a(e,i).then((function(e){const s=e.result;return{fileId:s.id,disc:c(t,i,s)}}))},t.load=function(t,e){let i=!1;return function(t){return s.client.drive.files.get({fileId:t})}(e).then((function(t){return i=t.result,(e=t.result).downloadUrl?new Promise((function(t,i){const r=s.auth.getToken().access_token,n=new XMLHttpRequest;n.open("GET",e.downloadUrl,!0),n.setRequestHeader("Authorization","Bearer "+r),n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){200!==n.status?i(new Error("Unable to load '"+e.title+"', http code "+n.status)):"string"!=typeof n.response?t(n.response):t(gh(n.response))},n.onerror=function(){i(new Error("Error sending request for "+e))},n.send()})):Promise.resolve(null);var e})).then((function(e){return c(t,e,i)}))},t.cat=function(){return new Promise((function(t){const i=function(e,r){e.execute((function(n){r=r.concat(n.items);const o=n.nextPageToken;o?(e=s.client.drive.files.list({pageToken:o}),i(e,r)):t(r)}))};i(s.client.drive.files.list({q:"mimeType = '"+e+"'"}),[])}))}};function sp(t){return ep.authorize(t).then((function(t){return tp=t,console.log("authed =",t),t}),(function(t){console.log("Error handling google auth: "+t),op.find(".loading").text("There was an error accessing your Google Drive account: "+t)}))}let ip,rp;function np(t){return Zd("Loading '"+t.title+"' from Google Drive"),ep.initialise().then((function(t){if(console.log("Google Drive available =",t),!t)throw new Error("Google Drive is not available");return sp(!0)})).then((function(t){return console.log("Google Drive authed=",t),!!t||new Promise((function(t,e){ip=t,rp=e,s("#google-drive-auth").show()}))})).then((function(){return ep.load(Rl.fdc,t.id)})).then((function(t){return console.log("Google Drive loading finished"),Jd(),t})).catch((function(t){console.log("Google Drive loading error:",t),Jd(t)}))}s("#google-drive-auth form").on("submit",(function(t){s("#google-drive-auth").hide(),t.preventDefault(),sp(!1).then((function(t){t?ip():rp(new Error("Unable to authorize Google Drive"))}))})),s(".if-drive-available").hide(),ep.initialise().then((function(t){t&&(s(".if-drive-available").show(),sp(!0))}));const op=s("#google-drive"),ap=new ga(op[0]);s("#open-drive-link").on("click",(function(){return tp?ap.show():sp(!1).then((function(t){t&&ap.hide()})),!1})),op[0].addEventListener("show.bs.modal",(function(){op.find(".loading").text("Loading...").show(),op.find("li").not(".template").remove(),ep.cat().then((function(t){const e=op.find(".list");op.find(".loading").hide();const i=e.find(".template");s.each(t,(function(t,r){const n=i.clone().removeClass("template").appendTo(e);n.find(".name").text(r.title),s(n).on("click",(function(){ph("google-drive","click",r.title),Id("gd:"+r.id+"/"+r.title),np(r).then((function(t){Rl.fdc.loadDisc(0,t)})),ap.hide()}))}))}))}));const cp=s("#disc-list"),hp=cp.find(".template");function up(t){const e=s("#"+t);let i=!1;this.update=function(t){t!==i&&(i=t,e.toggleClass("on",i))}}s.each(Wl,(function(t,e){const i=hp.clone().removeClass("template").appendTo(cp);i.find(".name").text(e.name),i.find(".description").text(e.desc),s(i).on("click",(function(){ph("images","click",e.file),Id(e.file),$d(Xl.disc1).then((function(t){Rl.fdc.loadDisc(0,t)})),Td.hide()}))})),s("#google-drive form").on("submit",(function(t){t.preventDefault();const e=s("#google-drive .disc-name").val();e&&(Zd("Connecting to Google Drive"),ap.hide(),Zd("Creating '"+e+"' on Google Drive"),ep.create(Rl.fdc,e).then((function(t){Id("gd:"+t.fileId+"/"+e),Rl.fdc.loadDisc(0,t.disc),Jd()}),(function(t){Jd(t)})))})),s("#download-drive-link").on("click",(function(){const t=document.createElement("a");document.body.appendChild(t),t.style="display: none";const e=new Blob([Rl.fdc.drives[0].data],{type:"application/octet-stream"}),s=window.URL.createObjectURL(e);t.href=s,t.download=Rl.fdc.drives[0].name,t.click(),window.URL.revokeObjectURL(s)})),s("#download-filestore-link").on("click",(function(){const t=document.createElement("a");document.body.appendChild(t),t.style="display: none";const e=new Blob([Rl.filestore.scsi],{type:"application/octet-stream"}),s=window.URL.createObjectURL(e);t.href=s,t.download="scsi.dat",t.click(),window.URL.revokeObjectURL(s)})),s("#hard-reset").click((function(t){Rl.reset(!0),t.preventDefault()})),s("#soft-reset").click((function(t){Rl.reset(!1),t.preventDefault()})),s("#tape-menu a").on("click",(function(t){const e=s(t.target).attr("data-id");void 0!==e&&("rewind"===e?(console.log("Rewinding tape to the start"),Rl.acia.rewindTape()):console.log("unknown type",e))}));const lp=new up("motorlight"),dp=new up("capslight"),pp=new up("shiftlight"),fp=new up("drive0"),mp=new up("drive1"),gp=new up("networklight");Nl=function(){dp.update(Rl.sysvia.capsLockLight),pp.update(Rl.sysvia.shiftLockLight),fp.update(Rl.fdc.motorOn[0]),mp.update(Rl.fdc.motorOn[1]),lp.update(Rl.acia.motorOn),Ul.hasEconet&&gp.update(Rl.econet.activityLight())};const bp=Promise.all([Cd.initialise(),Rl.initialise()]).then((function(){const t=[];function e(e,s){t.push(e.then((function(t){return ml().then((function(e){return e.tokenise(t)}))})).then((function(t){const e=Rl.model.isMaster?59366:58753,i=Rl.debugInstruction.add((function(r){if(r!==e)return;const n=Rl.readmem(24)<<8;for(let e=0;e<t.length;++e)Rl.writemem(n+e,t.charCodeAt(e));const o=n+t.length,a=255&o,c=o>>>8&255;Rl.writemem(2,a),Rl.writemem(3,c),Rl.writemem(18,a),Rl.writemem(19,c),i.remove(),s&&function(){console.log("Auto Running basic"),ph("init","autorunbasic");const t=nh("RUN\n");Hd([1e3].concat(t),!1)}()}))})))}if(Gl&&t.push($d(Gl).then((function(t){Rl.fdc.loadDisc(0,t)}))),ql&&t.push($d(ql).then((function(t){Rl.fdc.loadDisc(1,t)}))),Xl.tape&&t.push(qd(Xl.tape)),Xl.loadBasic){const t="run"===Vl;Vl="",e(new Promise((function(t){bh(Xl.loadBasic).then((function(e){t(String.fromCharCode.apply(null,e))}))})),t)}return Xl.embedBasic&&e(new Promise((function(t){t(Xl.embedBasic)})),!0),Promise.all(t)}));bp.then((function(){switch(Vl){case"boot":s("#sth .autoboot").prop("checked",!0),jd(Gl);break;case"type":!function(t){console.log("Auto typing '"+t+"'"),ph("init","autochain");const e=nh(t);Hd([1e3].concat(e),!1)}(Yl);break;case"chain":!function(){console.log("Auto Chaining Tape"),ph("init","autochain");const t=nh('*TAPE\nCH.""\n');Hd([1e3].concat(t),!1)}();break;case"run":!function(){console.log("Auto Running Tape"),ph("init","autorun");const t=nh("*TAPE\n*/\n");Hd([1e3].concat(t),!1)}();break;default:s("#sth .autoboot").prop("checked",!1)}Xl.patch&&Pl.setPatch(Xl.patch),Tp()}),(function(t){!function(t,e){Wd.find(".context").text(t),Wd.find(".error").text(e),Gd.show()}("initialising",t),console.log(t)}));const vp=s("#are-you-sure"),yp=new ga(vp[0]);function wp(t){t=t||1e7;const e=jl;jl=1e6;const s=performance.now();Rl.execute(t);const i=performance.now();jl=e;const r=i-s,n=t/r/1e3;console.log("Took "+r+"ms to execute "+t+" cycles"),console.log("Virtual "+n.toFixed(2)+"MHz")}function Cp(t){t=t||1e7;const e=jl;jl=1e6;const s=performance.now();Ol.polltime(t);const i=performance.now();jl=e;const r=i-s,n=t/r/1e3;console.log("Took "+r+"ms to execute "+t+" video cycles"),console.log("Virtual "+n.toFixed(2)+"MHz")}let Ap=0;const _p=new function(){this.cycles=0,this.time=0,this.v=s(".virtualMHz"),this.header=s("#virtual-mhz-header"),this.speedy=!1,this.update=function(t,e,s){this.cycles+=t,this.time+=e,this.speedy=s},this.display=function(){if(this.cycles){const t=this.cycles/this.time/1e3;this.v.text(t.toFixed(1)),this.cycles>=2e7&&(this.cycles=this.time=0),this.header.css("color",this.speedy?"red":"white")}setTimeout(this.display.bind(this),3333)},this.display()};function xp(t){if(!Fl)return void(Ap=0);void 0===t&&(t=window.performance.now());const e=Rl.acia.motorOn,s=Rl.fdc.motorOn[0]||Rl.fdc.motorOn[1],i=sd||id&&e,r=i||e||s,n=i?0:20,o=i?9:0;if(Ol.frameSkipCount=o,r?window.setTimeout(xp,n):window.requestAnimationFrame(xp),zl.update(Rl.sysvia),Nl(),0!==Ap){let e;if(i)e=gd/50;else{e=(t-Ap)*gd/1e3,e=Math.min(e,bd)}e|=0;try{Rl.execute(e)||kp(!0);const s=performance.now();_p.update(e,s-t,i)}catch(t){throw Fl=!1,ph("exception","thrown",t.stack),Pl.debug(Rl.pc),t}od&&(kp(!1),od=!1)}Ap=t}let Sp=!1;function Tp(){Cd.unmute(),Fl=!0,window.requestAnimationFrame(xp)}function kp(t){Fl=!1,Rl.stop(),t&&Pl.debug(Rl.pc),Cd.mute()}document.addEventListener("visibilitychange",(function(){if("hidden"===document.visibilityState){Sp=Fl;const t=Rl.acia.motorOn||Rl.fdc.motorOn[0]||Rl.fdc.motorOn[1];Fl&&!t&&kp(!1)}else Sp&&Tp()}),!1),function(){const t=s("#cub-monitor"),e=s("#cub-monitor-pic"),i=e.attr("height"),r=e.attr("width"),n=yd.attr("height")/i,o=yd.attr("width")/r,a=r/i,c=r/4,h=i/4,u=void 0!==Xl.embed?0:100,l=void 0!==Xl.embed?0:68;function d(){let i=s("#header-bar").outerHeight(),r=Math.max(c,window.innerWidth-2*u),d=Math.max(h,window.innerHeight-i-l);r/d<=a?d=r/a:r=d*a,t.height(d).width(r),e.height(d).width(r),yd.height(d*n).width(r*o)}window.onresize=d,window.setTimeout(d,1),window.setTimeout(d,500)}(),window.benchmarkCpu=zs.debounce(wp,1),window.profileCpu=zs.debounce((function(t){console.profile("CPU"),wp(t),console.profileEnd()}),1),window.benchmarkVideo=zs.debounce(Cp,1),window.profileVideo=zs.debounce((function(t){console.profile("Video"),Cp(t),console.profileEnd()}),1),window.go=Tp,window.stop=kp,window.soundChip=Cd.soundChip,window.processor=Rl,window.video=Ol,window.hd=function(t,e){console.log(uh((function(t){return Rl.readmem(t)}),t,e))},window.m7dump=function(){console.log(uh((function(t){return 127&Rl.readmem(t)}),31744,32744,{width:40,gap:!1}))},Il({loadDiscImage:$d,processor:Rl})})()})();
//# sourceMappingURL=main.b873c5e3c43e916fb760.js.map